<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>How-To-Guides/Installation-Troubleshooting</title>
</head>
<body>
  <div class="section" id="installation-troubleshooting">
<h1>安装故障排除<a class="headerlink" href="#installation-troubleshooting" title="永久链接至标题"></a></h1>
<p>安装故障排除技巧根据适用的平台进行了分类。</p>
<div class="contents local topic" id="platforms">
<p class="topic-title">平台</p>
<ul class="simple">
<li><p><a class="reference internal" href="#general" id="id1">通用</a></p></li>
<li><p><a class="reference internal" href="#linux" id="id2">Linux</a></p></li>
<li><p><a class="reference internal" href="#macos" id="id3">macOS</a></p></li>
<li><p><a class="reference internal" href="#windows" id="id4">Windows</a></p></li>
</ul>
</div>
<div class="section" id="general">
<h2><a class="toc-backref" href="#id1">通用</a><a class="headerlink" href="#general" title="永久链接至标题"></a></h2>
<p>通用故障排除技巧适用于所有平台。</p>
<div class="section" id="enable-multicast">
<h3>启用多播<a class="headerlink" href="#enable-multicast" title="永久链接至标题"></a></h3>
<p>为了通过DDS成功通信，使用的网络接口必须启用组播功能。在过去的经验中，我们发现当使用环回适配器（在Ubuntu或OSX上）时，默认情况下可能未启用组播功能。请参阅 <a class="reference external" href="https://github.com/ros2/ros2/issues/552">原始问题</a> 或 <a class="reference external" href="https://answers.ros.org/question/300370/ros2-talker-cannot-communicate-with-listener/">ros-answers 上的讨论</a>。您可以使用ROS 2工具验证您当前的设置是否允许组播：</p>
<p>在终端1中：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 multicast receive
</pre></div>
</div>
<p>在终端2中：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 multicast send
</pre></div>
</div>
<p>如果第一个命令没有返回类似以下内容的响应</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Received from xx.xxx.xxx.xx:43751: <span class="s1">&#39;Hello World!&#39;</span>
</pre></div>
</div>
<p>如果需要使用多播，您需要更新防火墙配置以允许多播，使用 <a class="reference external" href="https://help.ubuntu.com/community/UFW">ufw</a> 命令。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo ufw allow <span class="k">in</span> proto udp to <span class="m">224</span>.0.0.0/4
sudo ufw allow <span class="k">in</span> proto udp from <span class="m">224</span>.0.0.0/4
</pre></div>
</div>
<p>您可以使用 <code class="code docutils literal notranslate"><span class="pre">ifconfig</span></code> 工具检查您的网络接口是否启用了多播标志，在 flags 部分查找 <code class="code docutils literal notranslate"><span class="pre">MULTICAST</span></code>：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>eno1: <span class="nv">flags</span><span class="o">=</span><span class="m">4163</span>&lt;...,MULTICAST&gt;
   ...
</pre></div>
</div>
</div>
<div class="section" id="import-failing-without-library-present-on-the-system">
<h3>导入失败，因为系统上没有找到所需的库。<a class="headerlink" href="#import-failing-without-library-present-on-the-system" title="永久链接至标题"></a></h3>
<p>有时候，<code class="docutils literal notranslate"><span class="pre">rclpy</span></code> 导入失败是因为找不到预期的 C 扩展库。如果是这样，请将目录中存在的库与错误消息中提到的库进行比较。假设存在一个类似的文件（具有相同的前缀，例如 <code class="docutils literal notranslate"><span class="pre">_rclpy.</span></code>，和相同的后缀，例如 <code class="docutils literal notranslate"><span class="pre">.so</span></code>，但使用的是不同的 Python 版本/架构），则表示您正在使用与用于构建 C 扩展的 Python 解释器不同的 Python 解释器。请确保使用与构建二进制文件时相同的 Python 解释器。</p>
<p>例如，在操作系统更新后可能会出现这样的不匹配问题。然后，重建工作区可能会解决这个问题。</p>
</div>
</div>
<div class="section" id="linux">
<span id="linux-troubleshooting"></span><h2><a class="toc-backref" href="#id2">Linux</a><a class="headerlink" href="#linux" title="永久链接至标题"></a></h2>
<div class="section" id="internal-compiler-error">
<h3>内部编译器错误<a class="headerlink" href="#internal-compiler-error" title="永久链接至标题"></a></h3>
<p>如果在像树莓派这样的内存受限平台上尝试编译时遇到内部编译器错误（ICE），您可能希望使用单线程构建（在构建命令前加上 <code class="docutils literal notranslate"><span class="pre">MAKEFLAGS=-j1</span></code>）。</p>
</div>
<div class="section" id="out-of-memory">
<h3>内存不足<a class="headerlink" href="#out-of-memory" title="永久链接至标题"></a></h3>
<p>目前的 <code class="docutils literal notranslate"><span class="pre">ros1_bridge</span></code> 需要4GB的可用内存进行编译。如果您没有足够的可用内存，建议在该文件夹中使用 <code class="docutils literal notranslate"><span class="pre">COLCON_IGNORE</span></code> 跳过编译过程。</p>
</div>
<div class="section" id="multiple-host-interference">
<h3>多个主机干扰<a class="headerlink" href="#multiple-host-interference" title="永久链接至标题"></a></h3>
<p>如果您在同一网络上运行多个实例，可能会发生干扰。为了避免这种情况，您可以将环境变量 <code class="docutils literal notranslate"><span class="pre">ROS_DOMAIN_ID</span></code> 设置为不同的整数值，默认值为零。这将为您的系统定义DDS域ID。</p>
</div>
<div class="section" id="exception-sourcing-setup-bash">
<h3>加载 setup.bash 异常<a class="headerlink" href="#exception-sourcing-setup-bash" title="永久链接至标题"></a></h3>
<p>如果在构建源码后尝试引用环境时遇到异常，请尝试使用以下命令升级相关的``colcon``软件包</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>colcon version-check  <span class="c1"># check if newer versions available</span>
sudo apt install python3-colcon* --only-upgrade  <span class="c1"># upgrade installed colcon packages to latest version</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="macos">
<span id="macos-troubleshooting"></span><h2><a class="toc-backref" href="#id3">macOS</a><a class="headerlink" href="#macos" title="永久链接至标题"></a></h2>
<div class="section" id="segmentation-fault-when-using-pyenv">
<h3>使用``pyenv``时出现分段错误<a class="headerlink" href="#segmentation-fault-when-using-pyenv" title="永久链接至标题"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">pyenv``似乎默认使用</span></code>.a``文件构建Python，但这会导致``rclpy``出现问题，因此建议在使用``pyenv``时在macOS上启用Frameworks构建Python：</p>
<p><a class="reference external" href="https://github.com/pyenv/pyenv/wiki#how-to-build-cpython-with-framework-support-on-os-x">https://github.com/pyenv/pyenv/wiki#how-to-build-cpython-with-framework-support-on-os-x</a></p>
</div>
<div class="section" id="library-not-loaded-image-not-found">
<h3>无法加载库文件；找不到图像<a class="headerlink" href="#library-not-loaded-image-not-found" title="永久链接至标题"></a></h3>
<p>如果您在运行时（无论是运行测试还是运行节点）遇到库加载问题，例如以下情况：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ImportError: dlopen<span class="o">(</span>.../ros2_&lt;distro&gt;/ros2-osx/lib/python3.7/site-packages/rclpy/_rclpy.cpython-37m-darwin.so, <span class="m">2</span><span class="o">)</span>: Library not loaded: @rpath/librcl_interfaces__rosidl_typesupport_c.dylib
  Referenced from: .../ros2_&lt;distro&gt;/ros2-osx/lib/python3.7/site-packages/rclpy/_rclpy.cpython-37m-darwin.so
  Reason: image not found
</pre></div>
</div>
<p>那么您可能已启用系统完整性保护（System Integrity Protection）。按照 <a class="reference external" href="https://developer.apple.com/library/content/documentation/Security/Conceptual/System_Integrity_Protection_Guide/ConfiguringSystemIntegrityProtection/ConfiguringSystemIntegrityProtection.html">这些说明</a> 禁用系统完整性保护（SIP）。</p>
</div>
<div class="section" id="qt-build-error-unknown-type-name-q-enum">
<h3>Qt构建错误：<code class="docutils literal notranslate"><span class="pre">unknown</span> <span class="pre">type</span> <span class="pre">name</span> <span class="pre">'Q_ENUM'</span></code><a class="headerlink" href="#qt-build-error-unknown-type-name-q-enum" title="永久链接至标题"></a></h3>
<p>如果您遇到与Qt相关的构建错误，例如：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>In file included from /usr/local/opt/qt/lib/QtGui.framework/Headers/qguiapplication.h:46:
/usr/local/opt/qt/lib/QtGui.framework/Headers/qinputmethod.h:87:5: error:
      unknown <span class="nb">type</span> name <span class="s1">&#39;Q_ENUM&#39;</span>
    Q_ENUM<span class="o">(</span>Action<span class="o">)</span>
    ^
</pre></div>
</div>
<p>可能是因为您正在使用Qt4而不是Qt5，请参考https://github.com/ros2/ros2/issues/441</p>
</div>
<div class="section" id="missing-symbol-when-opencv-and-therefore-libjpeg-libtiff-and-libpng-are-installed-with-homebrew">
<h3>当使用Homebrew安装opencv（因此也安装了libjpeg、libtiff和libpng）时出现缺少符号的情况<a class="headerlink" href="#missing-symbol-when-opencv-and-therefore-libjpeg-libtiff-and-libpng-are-installed-with-homebrew" title="永久链接至标题"></a></h3>
<p>如果您已安装opencv，可能会出现以下情况：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dyld: Symbol not found: __cg_jpeg_resync_to_restart
  Referenced from: /System/Library/Frameworks/ImageIO.framework/Versions/A/ImageIO
  Expected <span class="k">in</span>: /usr/local/lib/libJPEG.dylib
 <span class="k">in</span> /System/Library/Frameworks/ImageIO.framework/Versions/A/ImageIO
/bin/sh: line <span class="m">1</span>: <span class="m">25274</span> Trace/BPT trap: <span class="m">5</span>       /usr/local/bin/cmake
</pre></div>
</div>
<p>如果是这样，要构建，你需要执行以下步骤：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ brew unlink libpng libtiff libjpeg
</pre></div>
</div>
<p>但这将会破坏OpenCV，所以你还需要更新它以继续工作：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo install_name_tool -change /usr/local/lib/libjpeg.8.dylib /usr/local/opt/jpeg/lib/libjpeg.8.dylib /usr/local/lib/libopencv_highgui.2.4.dylib
$ sudo install_name_tool -change /usr/local/lib/libpng16.16.dylib /usr/local/opt/libpng/lib/libpng16.16.dylib /usr/local/lib/libopencv_highgui.2.4.dylib
$ sudo install_name_tool -change /usr/local/lib/libtiff.5.dylib /usr/local/opt/libtiff/lib/libtiff.5.dylib /usr/local/lib/libopencv_highgui.2.4.dylib
$ sudo install_name_tool -change /usr/local/lib/libjpeg.8.dylib /usr/local/opt/jpeg/lib/libjpeg.8.dylib /usr/local/Cellar/libtiff/4.0.4/lib/libtiff.5.dylib
</pre></div>
</div>
<p>第一个命令是为了避免使用系统libjpeg（等等）构建的内容获取到/usr/local/lib中的版本。其他命令是为了更新由Homebrew构建的内容，使其能够找到libjpeg（等等）的版本，而不必将它们放在/usr/local/lib中。</p>
</div>
<div class="section" id="xcode-select-error-tool-xcodebuild-requires-xcode-but-active-developer-directory-is-a-command-line-instance">
<h3>Xcode-select错误：工具``xcodebuild``需要Xcode，但活动开发人员目录是一个命令行实例<a class="headerlink" href="#xcode-select-error-tool-xcodebuild-requires-xcode-but-active-developer-directory-is-a-command-line-instance" title="永久链接至标题"></a></h3>
<p>如果您最近安装了Xcode，可能会遇到此错误：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Xcode: xcode-select: error: tool <span class="s1">&#39;xcodebuild&#39;</span> requires Xcode,
but active developer directory <span class="s1">&#39;/Library/Developer/CommandLineTools&#39;</span> is a <span class="nb">command</span> line tools instance
</pre></div>
</div>
<p>要解决此错误，您需要执行以下操作：</p>
<ol class="arabic simple">
<li><p>请仔细检查是否安装了命令行工具：</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ xcode-select --install
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>在终端中输入以下命令接受Xcode的条款和条件：</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo xcodebuild -license accept
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>确保 Xcode 应用程序位于 <code class="docutils literal notranslate"><span class="pre">/Applications</span></code> 目录下（而不是 <code class="docutils literal notranslate"><span class="pre">/Users/{user}/Applications</span></code>）</p></li>
<li><p>使用以下命令将 <code class="docutils literal notranslate"><span class="pre">xcode-select</span></code> 指向 Xcode 应用程序的开发者目录：</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ sudo xcode-select -s /Applications/Xcode.app/Contents/Developer
</pre></div>
</div>
</div>
<div class="section" id="qt-gui-cpp-error-sip-binding-generator-not-available">
<h3>qt_gui_cpp 错误：SIP 绑定生成器不可用<a class="headerlink" href="#qt-gui-cpp-error-sip-binding-generator-not-available" title="永久链接至标题"></a></h3>
<p>构建 qt_gui_cpp 时可能会出现以下类似的错误：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--- stderr: qt_gui_cpp

CMake Error at src/CMakeLists.txt:10 <span class="o">(</span>message<span class="o">)</span>:
  No Python binding generator found.

---
Failed   <span class="o">&lt;&lt;&lt;</span> qt_gui_cpp <span class="o">[</span> Exited with code <span class="m">1</span> <span class="o">]</span>
</pre></div>
</div>
<p>要解决此问题，请按照 <a class="reference internal" href="RQt-Source-Install-MacOS.html"><span class="doc">这些步骤</span></a> 安装 RQt 的依赖项。</p>
</div>
<div class="section" id="rosdep-install-error-homebrew-failed-to-detect-successful-installation-of-qt5">
<h3>rosdep 安装错误 <code class="docutils literal notranslate"><span class="pre">homebrew:</span> <span class="pre">Failed</span> <span class="pre">to</span> <span class="pre">detect</span> <span class="pre">successful</span> <span class="pre">installation</span> <span class="pre">of</span> <span class="pre">[qt5]</span></code><a class="headerlink" href="#rosdep-install-error-homebrew-failed-to-detect-successful-installation-of-qt5" title="永久链接至标题"></a></h3>
<p>在遵循 <a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Creating-A-Workspace/Creating-A-Workspace.html"><span class="doc">创建工作空间</span></a> 教程时，您可能会遇到以下错误，指出 <code class="docutils literal notranslate"><span class="pre">rosdep</span></code> 无法安装 Qt5。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ rosdep install -i --from-path src --rosdistro humble -y
executing <span class="nb">command</span> <span class="o">[</span>brew install qt5<span class="o">]</span>
Warning: qt <span class="m">5</span>.15.0 is already installed and up-to-date
To reinstall <span class="m">5</span>.15.0, run <span class="sb">`</span>brew reinstall qt<span class="sb">`</span>
ERROR: the following rosdeps failed to install
  homebrew: Failed to detect successful installation of <span class="o">[</span>qt5<span class="o">]</span>
</pre></div>
</div>
<p>此错误似乎源于 <a class="reference external" href="https://github.com/ros-infrastructure/rosdep/issues/490#issuecomment-334959426">链接问题</a>，可以通过运行以下命令来解决。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> /usr/local/Cellar
$ sudo ln -s qt qt5
</pre></div>
</div>
<p>现在执行 <code class="docutils literal notranslate"><span class="pre">rosdep</span></code> 命令应该正常运行：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ rosdep install -i --from-path src --rosdistro humble -y
<span class="c1">#All required rosdeps installed successfully</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="windows">
<span id="windows-troubleshooting"></span><h2><a class="toc-backref" href="#id4">Windows</a><a class="headerlink" href="#windows" title="永久链接至标题"></a></h2>
<div class="section" id="import-failing-even-with-library-present-on-the-system">
<h3>即使系统中存在该库，导入仍然失败<a class="headerlink" href="#import-failing-even-with-library-present-on-the-system" title="永久链接至标题"></a></h3>
<p>有时候由于系统上缺少某些 DLL 文件，导致无法导入 <code class="docutils literal notranslate"><span class="pre">rclpy</span></code>。如果出现这种情况，请确保安装了 <a class="reference internal" href="../Installation/Windows-Install-Binary.html#windows-install-binary-installing-prerequisites"><span class="std std-ref">安装指南</span></a> 中“安装先决条件”部分列出的所有依赖项。</p>
<p>如果您正在使用二进制文件进行安装，则可能需要更新您的依赖项：它们必须与用于构建二进制文件的版本相同。</p>
<p>如果您仍然遇到问题，您可以使用 <a class="reference external" href="https://github.com/lucasg/Dependencies">Dependencies</a> 工具来确定您的系统缺少哪些依赖项。使用该工具加载相应的 <code class="docutils literal notranslate"><span class="pre">.pyd</span></code> 文件，它将报告不可用的 <code class="docutils literal notranslate"><span class="pre">DLL</span></code> 模块。在执行工具之前，请确保当前的工作空间已被激活，否则将出现未解决的 ROS DLL 文件。根据这些信息安装额外的依赖项或根据需要调整您的路径。</p>
</div>
<div class="section" id="cmake-error-setting-modification-time">
<h3>CMake 错误设置修改时间<a class="headerlink" href="#cmake-error-setting-modification-time" title="永久链接至标题"></a></h3>
<p>如果在安装文件时遇到 CMake 错误 <code class="docutils literal notranslate"><span class="pre">file</span> <span class="pre">INSTALL</span> <span class="pre">cannot</span> <span class="pre">set</span> <span class="pre">modification</span> <span class="pre">time</span> <span class="pre">on</span> <span class="pre">...</span></code>，很可能是由于杀毒软件或 Windows Defender 干扰了构建过程。例如，对于 Windows Defender，您可以将工作空间位置列入排除列表，以防止其扫描这些文件。</p>
</div>
<div class="section" id="character-path-limit">
<h3>260 字符路径限制<a class="headerlink" href="#character-path-limit" title="永久链接至标题"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>The input line is too long.
The syntax of the <span class="nb">command</span> is incorrect.
</pre></div>
</div>
<p>根据您的目录层次结构，在从源代码构建ROS 2或您自己的库时，可能会出现路径长度限制错误。</p>
<p>要允许更深的路径长度：</p>
<p>运行 <code class="docutils literal notranslate"><span class="pre">regedit.exe</span></code>，导航至 <code class="docutils literal notranslate"><span class="pre">Computer\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem</span></code>，并将 <code class="docutils literal notranslate"><span class="pre">LongPathsEnabled</span></code> 设置为 0x00000001（1）。</p>
<p>按下 Windows 键并输入 <code class="docutils literal notranslate"><span class="pre">Edit</span> <span class="pre">Group</span> <span class="pre">Policy</span></code>。导航至 Local Computer Policy &gt; Computer Configuration &gt; Administrative Templates &gt; System &gt; Filesystem。右键单击 <code class="docutils literal notranslate"><span class="pre">Enable</span> <span class="pre">Win32</span> <span class="pre">long</span> <span class="pre">paths</span></code>，点击编辑。在对话框中，选择已启用并点击确定。</p>
<p>关闭并重新打开终端以重置环境，并尝试重新构建。</p>
</div>
<div class="section" id="cmake-packages-unable-to-find-asio-tinyxml2-tinyxml-or-eigen">
<h3>CMake软件包无法找到asio、tinyxml2、tinyxml或eigen。<a class="headerlink" href="#cmake-packages-unable-to-find-asio-tinyxml2-tinyxml-or-eigen" title="永久链接至标题"></a></h3>
<p>我们发现有时候``asio``、<code class="docutils literal notranslate"><span class="pre">tinyxml2``等的chocolatey软件包没有添加重要的注册表项，导致在构建ROS</span> <span class="pre">2时CMake无法找到它们。我们还没有找到根本原因，但是卸载chocolatey软件包（如果首次卸载失败，则使用</span></code>-n``参数），然后重新安装它们可以解决这个问题。</p>
</div>
<div class="section" id="patch-exe-opens-a-new-command-window-and-asks-for-administrator">
<h3>patch.exe会打开一个新的命令窗口并要求管理员权限。<a class="headerlink" href="#patch-exe-opens-a-new-command-window-and-asks-for-administrator" title="永久链接至标题"></a></h3>
<p>即使您允许使用管理员权限，这也会导致需要使用补丁的软件包构建失败。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">choco</span> <span class="pre">uninstall</span> <span class="pre">patch;</span> <span class="pre">colcon</span> <span class="pre">build</span> <span class="pre">--cmake-clean-cache</span></code> - 这是 <a class="reference external" href="https://chocolatey.org/packages/patch">GNU Patch For Windows package</a> 中的一个错误。如果未安装此软件包，构建过程将使用与 git 分发的 Patch 版本。</p></li>
</ul>
</div>
<div class="section" id="failed-to-load-fast-rtps-shared-library">
<h3>无法加载 Fast RTPS 共享库<a class="headerlink" href="#failed-to-load-fast-rtps-shared-library" title="永久链接至标题"></a></h3>
<p>Fast RTPS 需要 <code class="docutils literal notranslate"><span class="pre">msvcr20.dll</span></code>，它是 <a href="#id1"><span class="problematic" id="id2">``</span></a>Visual C++ Redistributable Packages for Visual Studio 201</p>
</div>
<div class="section" id="binary-installation-specific">
<h3>二进制安装特定<a class="headerlink" href="#binary-installation-specific" title="永久链接至标题"></a></h3>
<ul class="simple">
<li><p>如果由于缺少 DLL 文件而无法启动示例，请验证所有外部依赖库（如 OpenCV）是否位于您的 <code class="docutils literal notranslate"><span class="pre">PATH</span></code> 变量中。</p></li>
<li><p>如果您忘记从终端调用 <code class="docutils literal notranslate"><span class="pre">local_setup.bat</span></code> 文件，演示程序很可能会立即崩溃。</p></li>
</ul>
</div>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>