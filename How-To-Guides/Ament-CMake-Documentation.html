<!DOCTYPE html>
<html class="writer-html5" lang="zh" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ament_cmake 用户文档 &mdash; ROS 2 Documentation: Humble  文档</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="canonical" href="https://docs.ros.org/en/humble/How-To-Guides/Ament-CMake-Documentation.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="ament_cmake_python 用户文档" href="Ament-CMake-Python-Documentation.html" />
    <link rel="prev" title="开发ROS 2软件包" href="Developing-a-ROS-2-Package.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> ROS 2 Documentation: Humble
            <img src="../_static/humble-small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Installation.html">安装</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Installation/Ubuntu-Install-Debians.html">Ubuntu (Debian)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Installation/Windows-Install-Binary.html">Windows (binary)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Installation/RHEL-Install-RPMs.html">RHEL (RPM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Installation/Alternatives.html">Alternatives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Installation/Alternatives/Ubuntu-Development-Setup.html">Ubuntu (source)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Installation/Alternatives/Ubuntu-Install-Binary.html">Ubuntu (binary)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Installation/Alternatives/Windows-Development-Setup.html">Windows (source)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Installation/Alternatives/RHEL-Development-Setup.html">RHEL (source)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Installation/Alternatives/RHEL-Install-Binary.html">RHEL (binary)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Installation/Alternatives/macOS-Development-Setup.html">macOS (source)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Installation/Alternatives/Fedora-Development-Setup.html">Fedora (source)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Installation/Alternatives/Latest-Development-Setup.html">Latest development (source)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Installation/Maintaining-a-Source-Checkout.html">Maintain source checkout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Installation/Testing.html">Testing with pre-release binaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Installation/DDS-Implementations.html">DDS implementations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Installation/DDS-Implementations/Install-Connext-Security-Plugins.html">Connext security plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Installation/DDS-Implementations/Install-Connext-University-Eval.html">RTI Connext DDS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Installation/DDS-Implementations/Working-with-Eclipse-CycloneDDS.html">Eclipse Cyclone DDS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Installation/DDS-Implementations/Working-with-GurumNetworks-GurumDDS.html">GurumNetworks GurumDDS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Installation/DDS-Implementations/Working-with-eProsima-Fast-DDS.html">eProsima Fast DDS</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Releases.html">Distributions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Releases/Release-Iron-Irwini.html">Iron Irwini (<code class="docutils literal notranslate"><span class="pre">iron</span></code>)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Releases/Iron-Irwini-Complete-Changelog.html">Iron Irwini Changelog</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Releases/Release-Humble-Hawksbill.html">Humble Hawksbill (<code class="docutils literal notranslate"><span class="pre">humble</span></code>)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Releases/Humble-Hawksbill-Complete-Changelog.html">Humble Hawksbill changelog</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Releases/Release-Foxy-Fitzroy.html">Foxy Fitzroy (<code class="docutils literal notranslate"><span class="pre">foxy</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Releases/Release-Rolling-Ridley.html">Rolling Ridley (<code class="docutils literal notranslate"><span class="pre">rolling</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Releases/Development.html">Development Distribution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Releases/Release-Jazzy-Jalisco.html">Jazzy Jalisco (codename 'jazzy'; May, 2024)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Releases/End-of-Life.html">End-of-Life Distributions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Releases/Release-Galactic-Geochelone.html">Galactic Geochelone (<code class="docutils literal notranslate"><span class="pre">galactic</span></code>)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../Releases/Galactic-Geochelone-Complete-Changelog.html">Galactic Geochelone changelog</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../Releases/Release-Eloquent-Elusor.html">Eloquent Elusor (<code class="docutils literal notranslate"><span class="pre">eloquent</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Releases/Release-Dashing-Diademata.html">Dashing Diademata (<code class="docutils literal notranslate"><span class="pre">dashing</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Releases/Release-Crystal-Clemmys.html">Crystal Clemmys (<code class="docutils literal notranslate"><span class="pre">crystal</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Releases/Release-Bouncy-Bolson.html">Bouncy Bolson (<code class="docutils literal notranslate"><span class="pre">bouncy</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Releases/Release-Ardent-Apalone.html">Ardent Apalone (<code class="docutils literal notranslate"><span class="pre">ardent</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Releases/Beta3-Overview.html">Beta 3 (<code class="docutils literal notranslate"><span class="pre">r2b3</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Releases/Beta2-Overview.html">Beta 2 (<code class="docutils literal notranslate"><span class="pre">r2b2</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Releases/Beta1-Overview.html">Beta 1 (<code class="docutils literal notranslate"><span class="pre">Asphalt</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Releases/Alpha-Overview.html">Alphas</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Releases/Release-Process.html">Development process for a release</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Tutorials.html">教程</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Tutorials/Beginner-CLI-Tools.html">初学者：CLI 工具</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-CLI-Tools/Configuring-ROS2-Environment.html">配置环境</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-CLI-Tools/Introducing-Turtlesim/Introducing-Turtlesim.html">使用``turtlesim``、<code class="docutils literal notranslate"><span class="pre">ros2``和``rqt</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Nodes/Understanding-ROS2-Nodes.html">理解节点</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Topics/Understanding-ROS2-Topics.html">理解话题</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Services/Understanding-ROS2-Services.html">了解服务</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Parameters/Understanding-ROS2-Parameters.html">理解参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Actions/Understanding-ROS2-Actions.html">理解行为</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-CLI-Tools/Using-Rqt-Console/Using-Rqt-Console.html">使用 <code class="docutils literal notranslate"><span class="pre">rqt_console</span></code> 查看日志</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-CLI-Tools/Launching-Multiple-Nodes/Launching-Multiple-Nodes.html">启动节点</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-CLI-Tools/Recording-And-Playing-Back-Data/Recording-And-Playing-Back-Data.html">录制和回放数据</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Tutorials/Beginner-Client-Libraries.html">初学者：客户端库</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Colcon-Tutorial.html">使用 <code class="docutils literal notranslate"><span class="pre">colcon</span></code> 构建软件包</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Creating-A-Workspace/Creating-A-Workspace.html">创建一个工作空间</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html">创建软件包</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Cpp-Publisher-And-Subscriber.html">编写一个简单的发布者和订阅者（C++）</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Publisher-And-Subscriber.html">编写一个简单的发布者和订阅者（Python）</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Cpp-Service-And-Client.html">编写一个简单的服务和客户端（C++）</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Service-And-Client.html">编写一个简单的服务和客户端（Python）</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Custom-ROS2-Interfaces.html">创建自定义的 msg 和 srv 文件。</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Single-Package-Define-And-Use-Interface.html">实现自定义接口</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Using-Parameters-In-A-Class-CPP.html">在类中使用参数（C++）</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Using-Parameters-In-A-Class-Python.html">在类中使用参数（Python）</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Getting-Started-With-Ros2doctor.html">使用``ros2doctor``来识别问题</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Pluginlib.html">创建和使用插件（C++）</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Tutorials/Intermediate.html">Intermediate</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Intermediate/Rosdep.html">Managing Dependencies with rosdep</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Intermediate/Creating-an-Action.html">Creating an action</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Intermediate/Writing-an-Action-Server-Client/Cpp.html">Writing an action server and client (C++)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Intermediate/Writing-an-Action-Server-Client/Py.html">Writing an action server and client (Python)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Intermediate/Composition.html">Composing multiple nodes in a single process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Intermediate/Monitoring-For-Parameter-Changes-CPP.html">Monitoring for parameter changes (C++)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Intermediate/Launch/Launch-Main.html">启动</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Launch/Creating-Launch-Files.html">Creating a launch file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Launch/Launch-system.html">Integrating launch files into ROS 2 packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Launch/Using-Substitutions.html">Using substitutions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Launch/Using-Event-Handlers.html">Using event handlers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Launch/Using-ROS2-Launch-For-Large-Projects.html">Managing large projects</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Tf2-Main.html"><code class="docutils literal notranslate"><span class="pre">tf2</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Introduction-To-Tf2.html">Introducing <code class="docutils literal notranslate"><span class="pre">tf2</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Writing-A-Tf2-Static-Broadcaster-Py.html">Writing a static broadcaster (Python)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Writing-A-Tf2-Static-Broadcaster-Cpp.html">Writing a static broadcaster (C++)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Writing-A-Tf2-Broadcaster-Py.html">Writing a broadcaster (Python)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Writing-A-Tf2-Broadcaster-Cpp.html">Writing a broadcaster (C++)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Writing-A-Tf2-Listener-Py.html">Writing a listener (Python)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Writing-A-Tf2-Listener-Cpp.html">Writing a listener (C++)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Adding-A-Frame-Py.html">Adding a frame (Python)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Adding-A-Frame-Cpp.html">Adding a frame (C++)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Learning-About-Tf2-And-Time-Py.html">Using time (Python)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Learning-About-Tf2-And-Time-Cpp.html">Using time (C++)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Time-Travel-With-Tf2-Py.html">Traveling in time (Python)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Time-Travel-With-Tf2-Cpp.html">Traveling in time (C++)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Debugging-Tf2-Problems.html">Debugging</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Quaternion-Fundamentals.html">Quaternion fundamentals</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Tf2/Using-Stamped-Datatypes-With-Tf2-Ros-MessageFilter.html">Using stamped datatypes with <code class="docutils literal notranslate"><span class="pre">tf2_ros::MessageFilter</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Intermediate/Testing/Testing-Main.html">测试</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Testing/CLI.html">Running Tests in ROS 2 from the Command Line</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Testing/Cpp.html">Writing Basic Tests with C++ with GTest</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/Testing/Python.html">Writing Basic Tests with Python</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Intermediate/URDF/URDF-Main.html">URDF</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/URDF/Building-a-Visual-Robot-Model-with-URDF-from-Scratch.html">Building a visual robot model from scratch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/URDF/Building-a-Movable-Robot-Model-with-URDF.html">Building a movable robot model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/URDF/Adding-Physical-and-Collision-Properties-to-a-URDF-Model.html">Adding physical and collision properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/URDF/Using-Xacro-to-Clean-Up-a-URDF-File.html">Using Xacro to clean up your code</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Intermediate/URDF/Using-URDF-with-Robot-State-Publisher.html">Using URDF with <code class="docutils literal notranslate"><span class="pre">robot_state_publisher</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Tutorials/Advanced.html">高级</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Advanced/Topic-Statistics-Tutorial/Topic-Statistics-Tutorial.html">启用主题统计信息（C++）</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Advanced/Discovery-Server/Discovery-Server.html">使用Fast DDS Discovery Server作为发现协议[社区贡献]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Advanced/Allocator-Template-Tutorial.html">实现自定义内存分配器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Advanced/FastDDS-Configuration.html">发挥Fast DDS中间件的潜力 [社区贡献]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Advanced/Recording-A-Bag-From-Your-Own-Node-CPP.html">从节点（C++）录制一个包</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Advanced/Recording-A-Bag-From-Your-Own-Node-Py.html">从节点录制包（Python）</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Advanced/Simulators/Simulation-Main.html">模拟器</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Advanced/Simulators/Webots/Simulation-Webots.html">Webots</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../Tutorials/Advanced/Simulators/Webots/Installation-Ubuntu.html">安装（Ubuntu）</a></li>
<li class="toctree-l5"><a class="reference internal" href="../Tutorials/Advanced/Simulators/Webots/Installation-Windows.html">安装（Windows）</a></li>
<li class="toctree-l5"><a class="reference internal" href="../Tutorials/Advanced/Simulators/Webots/Installation-MacOS.html">安装（macOS）</a></li>
<li class="toctree-l5"><a class="reference internal" href="../Tutorials/Advanced/Simulators/Webots/Setting-Up-Simulation-Webots-Basic.html">设置机器人仿真（基础）</a></li>
<li class="toctree-l5"><a class="reference internal" href="../Tutorials/Advanced/Simulators/Webots/Setting-Up-Simulation-Webots-Advanced.html">设置机器人模拟（高级）</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Advanced/Simulators/Gazebo/Simulation-Gazebo.html">Gazebo</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../Tutorials/Advanced/Simulators/Gazebo/Gazebo.html">设置机器人仿真（Gazebo）。</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Advanced/Security/Security-Main.html">安全性</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Advanced/Security/Introducing-ros2-security.html">设置安全性</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Advanced/Security/The-Keystore.html">理解安全密钥库</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Advanced/Security/Security-on-Two.html">确保跨机器的安全性</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Advanced/Security/Examine-Traffic.html">检查网络流量</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Advanced/Security/Access-Controls.html">设置访问控制</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorials/Advanced/Security/Deployment-Guidelines.html">部署指南</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Tutorials/Demos.html">演示</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Demos/Quality-of-Service.html">在不稳定网络中使用服务质量设置</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Demos/Managed-Nodes.html">使用受控生命周期管理节点</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Demos/Intra-Process-Communication.html">设置高效的进程内通信</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Demos/Rosbag-with-ROS1-Bridge.html">使用ROS 1桥接在`rosbag`中记录和回放数据</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Demos/Real-Time-Programming.html">理解实时编程</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Demos/dummy-robot-demo.html">Experimenting with a dummy robot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Demos/Logging-and-logger-configuration.html">记录日志</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Demos/Content-Filtering-Subscription.html">创建内容过滤订阅</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Tutorials/Miscellaneous.html">Miscellaneous</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Miscellaneous/Deploying-ROS-2-on-IBM-Cloud.html">Deploying on IBM Cloud Kubernetes [community-contributed]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Miscellaneous/Eclipse-Oxygen-with-ROS-2-and-rviz2.html">Using Eclipse Oxygen with <code class="docutils literal notranslate"><span class="pre">rviz2</span></code> [community-contributed]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Miscellaneous/Building-Realtime-rt_preempt-kernel-for-ROS-2.html">Building a real-time Linux kernel [community-contributed]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Tutorials/Miscellaneous/Building-ROS2-Package-with-eclipse-2021-06.html">Building a package with Eclipse 2021-06</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../How-To-Guides.html">如何指南</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Installation-Troubleshooting.html">安装故障排除</a></li>
<li class="toctree-l2"><a class="reference internal" href="Developing-a-ROS-2-Package.html">开发ROS 2软件包</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ament_cmake 用户文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="Ament-CMake-Python-Documentation.html">ament_cmake_python 用户文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="Launch-files-migration-guide.html">将启动文件从ROS 1迁移到ROS 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="Launch-file-different-formats.html">使用 Python、XML 和 YAML 编写 ROS 2 启动文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="Launching-composable-nodes.html">使用ROS 2 launch启动可组合节点</a></li>
<li class="toctree-l2"><a class="reference internal" href="Parameters-YAML-files-migration-guide.html">将YAML参数文件从ROS 1迁移到ROS 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="Node-arguments.html">通过命令行向节点传递ROS参数</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sync-Vs-Async.html">同步与异步服务客户端</a></li>
<li class="toctree-l2"><a class="reference internal" href="DDS-tuning.html">DDS调优信息</a></li>
<li class="toctree-l2"><a class="reference internal" href="Overriding-QoS-Policies-For-Recording-And-Playback.html">rosbag2：覆盖 QoS 策略</a></li>
<li class="toctree-l2"><a class="reference internal" href="Working-with-multiple-RMW-implementations.html">使用多个ROS 2中间件实现</a></li>
<li class="toctree-l2"><a class="reference internal" href="Cross-compilation.html">交叉编译</a></li>
<li class="toctree-l2"><a class="reference internal" href="Releasing/Releasing-a-Package.html">发布软件包</a><ul>
<li class="toctree-l3"><a class="reference internal" href="Releasing/First-Time-Release.html">首次发布</a></li>
<li class="toctree-l3"><a class="reference internal" href="Releasing/Subsequent-Releases.html">后续发布</a></li>
<li class="toctree-l3"><a class="reference internal" href="Releasing/Release-Team-Repository.html">发布团队/仓库</a></li>
<li class="toctree-l3"><a class="reference internal" href="Releasing/Release-Track.html">发布跟踪</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Using-Python-Packages.html">在ROS 2中使用Python包</a></li>
<li class="toctree-l2"><a class="reference internal" href="RQt-Port-Plugin-Windows.html">将RQt插件移植到Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="Run-2-nodes-in-single-or-separate-docker-containers.html">在 Docker 中运行 ROS 2 节点[社区贡献]</a></li>
<li class="toctree-l2"><a class="reference internal" href="Visualizing-ROS-2-Data-With-Foxglove-Studio.html">使用Foxglove Studio可视化ROS 2数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="Package-maintainer-guide.html">ROS 2软件包维护人员指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="Building-a-Custom-Debian-Package.html">构建自定义的Debian软件包</a></li>
<li class="toctree-l2"><a class="reference internal" href="Building-ROS-2-with-Tracing-Instrumentation.html">使用跟踪工具构建ROS 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="Topics-Services-Actions.html">主题 vs 服务 vs 动作</a></li>
<li class="toctree-l2"><a class="reference internal" href="Using-Variants.html">使用变体</a></li>
<li class="toctree-l2"><a class="reference internal" href="Using-ros2-param.html">使用``ros2 param``命令行工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="Using-ros1_bridge-Jammy-upstream.html">在Ubuntu 22.04上使用``ros1_bridge``和上游ROS</a></li>
<li class="toctree-l2"><a class="reference internal" href="Disabling-ZeroCopy-loaned-messages.html">禁用零拷贝借用消息</a></li>
<li class="toctree-l2"><a class="reference internal" href="Installing-on-Raspberry-Pi.html">在 Raspberry Pi 上的 ROS 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="Using-callback-groups.html">使用回调组</a></li>
<li class="toctree-l2"><a class="reference internal" href="Setup-ROS-2-with-VSCode-and-Docker-Container.html">使用VSCode和Docker设置ROS 2 [社区贡献]</a></li>
<li class="toctree-l2"><a class="reference internal" href="RQt-Source-Install.html">从源代码构建 RQt</a><ul>
<li class="toctree-l3"><a class="reference internal" href="RQt-Source-Install-MacOS.html">在 macOS 上从源代码构建 RQt</a></li>
<li class="toctree-l3"><a class="reference internal" href="RQt-Source-Install-Windows10.html">在 Windows 10 上从源代码构建 RQt</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Concepts.html">Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-Domain-ID.html">The ROS_DOMAIN_ID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-Different-Middleware-Vendors.html">About different ROS 2 DDS/RTPS vendors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-Logging.html">About logging and logger configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-Quality-of-Service-Settings.html">About Quality of Service settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-ROS-2-Client-Libraries.html">About ROS 2 client libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-ROS-Interfaces.html">About ROS 2 interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-ROS-2-Parameters.html">About parameters in ROS 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-Executors.html">Executors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-Topic-Statistics.html">About topic statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-Command-Line-Tools.html">Introspection with command line tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-RQt.html">Overview and usage of RQt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-Composition.html">About Composition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-Catment.html">On the mixing of ament and catkin (catment)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-Cross-Compilation.html">About Cross-compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-Security.html">About ROS 2 Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-Tf2.html">About tf2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-Build-System.html">About the build system</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-Internal-Interfaces.html">About internal ROS 2 interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-Middleware-Implementations.html">About ROS 2 middleware implementations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Concepts/About-ROS-2-Client-Libraries.html">About ROS 2 client libraries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../The-ROS2-Project.html">ROS 2 项目</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../The-ROS2-Project/Contributing.html">贡献</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../The-ROS2-Project/Contributing/Developer-Guide.html">ROS 2开发者指南</a></li>
<li class="toctree-l3"><a class="reference internal" href="../The-ROS2-Project/Contributing/Code-Style-Language-Versions.html">代码风格和语言版本</a></li>
<li class="toctree-l3"><a class="reference internal" href="../The-ROS2-Project/Contributing/Quality-Guide.html">质量指南：确保代码质量</a></li>
<li class="toctree-l3"><a class="reference internal" href="../The-ROS2-Project/Contributing/Migration-Guide.html">从ROS 1迁移指南</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../The-ROS2-Project/Contributing/Migration-Guide-Python.html">ROS 1的Python迁移指南</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../The-ROS2-Project/Contributing/Build-Farms.html">ROS构建农场</a></li>
<li class="toctree-l3"><a class="reference internal" href="../The-ROS2-Project/Contributing/Windows-Tips-and-Tricks.html">Windows提示和技巧</a></li>
<li class="toctree-l3"><a class="reference internal" href="../The-ROS2-Project/Contributing/Contributing-To-ROS-2-Documentation.html">为ROS 2文档做出贡献</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../The-ROS2-Project/Features.html">功能状态</a></li>
<li class="toctree-l2"><a class="reference internal" href="../The-ROS2-Project/Feature-Ideas.html">功能点子</a></li>
<li class="toctree-l2"><a class="reference internal" href="../The-ROS2-Project/Roadmap.html">路线图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../The-ROS2-Project/ROSCon-Content.html">ROSCon 演讲</a></li>
<li class="toctree-l2"><a class="reference internal" href="../The-ROS2-Project/Governance.html">项目治理</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../The-ROS2-Project/Governance/ROS2-TSC-Charter.html">ROS 2 技术指导委员会章程</a></li>
<li class="toctree-l3"><a class="reference internal" href="../The-ROS2-Project/Governance/ROS2-TSC-Intake-process.html">ROS 2 TSC申请者招募流程</a></li>
<li class="toctree-l3"><a class="reference internal" href="../The-ROS2-Project/Governance/How-To-Start-A-Community-Working-Group.html">如何启动社区工作组</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../The-ROS2-Project/Marketing.html">营销</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../API-Docs.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Related-Projects.html">Related Projects</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Related-Projects/Intel-ROS2-Projects.html">Intel ROS 2 Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Related-Projects/Nvidia-ROS2-Projects.html">NVIDIA ROS 2 Projects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Glossary.html">术语表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Citations.html">Citations</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ROS 2 Documentation: Humble</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../How-To-Guides.html">如何指南</a> &raquo;</li>
      <li>ament_cmake 用户文档</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ros2/ros2_documentation/blob/humble/source/How-To-Guides/Ament-CMake-Documentation.rst" class="fa fa-github"> 在 GitHub 上修改</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             


  <div class="section" id="ament-cmake-user-documentation">
<h1>ament_cmake 用户文档<a class="headerlink" href="#ament-cmake-user-documentation" title="永久链接至标题"></a></h1>
<p>ament_cmake 是 ROS 2 中基于 CMake 的软件包构建系统（特别是将用于大多数，如果不是全部 C/C++ 项目）。它是一组增强 CMake 功能并为软件包作者添加便利功能的脚本。了解 <a class="reference external" href="https://cmake.org/cmake/help/v3.5/">CMake</a> 的基础知识将非常有帮助，可以在 <a class="reference external" href="https://cmake.org/cmake/help/latest/guide/tutorial/index.html">这里</a> 找到官方教程。</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#basics" id="id1">基础知识</a></p>
<ul>
<li><p><a class="reference internal" href="#basic-project-outline" id="id2">基本项目概述</a></p></li>
<li><p><a class="reference internal" href="#adding-files-and-headers" id="id3">添加文件和头文件</a></p></li>
<li><p><a class="reference internal" href="#adding-dependencies" id="id4">添加依赖项</a></p></li>
<li><p><a class="reference internal" href="#building-a-library" id="id5">构建库</a></p></li>
<li><p><a class="reference internal" href="#compiler-and-linker-options" id="id6">编译器和链接器选项</a></p></li>
<li><p><a class="reference internal" href="#building-libraries-on-windows" id="id7">在Windows上构建库</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#testing-and-linting" id="id8">测试和代码检查</a></p>
<ul>
<li><p><a class="reference internal" href="#linting" id="id9">代码检查</a></p></li>
<li><p><a class="reference internal" href="#testing" id="id10">测试</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#extending-ament" id="id11">扩展 ament</a></p>
<ul>
<li><p><a class="reference internal" href="#adding-a-function-macro-to-ament" id="id12">向 ament 添加函数/宏</a></p></li>
<li><p><a class="reference internal" href="#adding-to-extension-points" id="id13">添加到扩展点</a></p></li>
<li><p><a class="reference internal" href="#adding-extension-points" id="id14">添加扩展点</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#adding-resources" id="id15">添加资源</a></p>
<ul>
<li><p><a class="reference internal" href="#the-ament-index-explained" id="id16">解释ament索引</a></p></li>
<li><p><a class="reference internal" href="#querying-the-ament-index" id="id17">查询ament索引</a></p></li>
<li><p><a class="reference internal" href="#adding-to-the-ament-index" id="id18">添加到 ament 索引</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="basics">
<h2><a class="toc-backref" href="#id1">基础知识</a><a class="headerlink" href="#basics" title="永久链接至标题"></a></h2>
<p>可以使用命令行上的 <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">pkg</span> <span class="pre">create</span> <span class="pre">&lt;package_name&gt;</span></code> 创建基本的 CMake 概述。基本的构建信息然后会在两个文件中收集：<code class="docutils literal notranslate"><span class="pre">package.xml</span></code> 和 <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>。<code class="docutils literal notranslate"><span class="pre">package.xml</span></code> 必须包含所有依赖项和一些元数据，以使 colcon 能够找到正确的软件包构建顺序，以在 CI 中安装所需的依赖项，并提供用于 <code class="docutils literal notranslate"><span class="pre">bloom</span></code> 发布的信息。<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> 包含构建和打包可执行文件和库的命令，并且将是本文档的主要焦点。</p>
<div class="section" id="basic-project-outline">
<h3><a class="toc-backref" href="#id2">基本项目概述</a><a class="headerlink" href="#basic-project-outline" title="永久链接至标题"></a></h3>
<p>一个ament包的``CMakeLists.txt``的基本概述包括：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.5</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">my_project</span><span class="p">)</span>

<span class="nb">ament_package</span><span class="p">()</span>
</pre></div>
</div>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>project``的参数将是包名，并且必须与``package.xml``中的包名完全相同。</p>
<p>项目的设置由``ament_package()``完成，此调用必须每个包只出现一次。<code class="docutils literal notranslate"><span class="pre">ament_package()``安装``package.xml</span></code>，在ament索引中注册包，并安装用于CMake的配置（以及可能的目标）文件，以便其他使用``find_package``的包可以找到它。由于``ament_package()``从``CMakeLists.txt``中收集了大量信息，因此它应该是``CMakeLists.txt``中的最后一个调用。尽管可以在``ament_package()``调用之后跟随``install``函数调用以复制文件和目录，但简单起见，最好将``ament_package()``保持为最后一个调用。</p>
<p><code class="docutils literal notranslate"><span class="pre">ament_package</span></code> 可以接受额外的参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_EXTRAS</span></code>：CMake 文件列表（通过 <code class="docutils literal notranslate"><span class="pre">configure_file()</span></code> 扩展的 <code class="docutils literal notranslate"><span class="pre">.cmake</span></code> 或 <code class="docutils literal notranslate"><span class="pre">.cmake.in</span></code> 模板），应该对软件包的客户端可用。关于何时使用这些参数的示例，请参阅 <a class="reference internal" href="#adding-resources">Adding resources</a> 中的讨论。有关如何使用模板文件的更多信息，请参阅 <a class="reference external" href="https://cmake.org/cmake/help/v3.5/command/configure_file.html">官方文档</a>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONFIG_EXTRAS_POST</span></code>：与 <code class="docutils literal notranslate"><span class="pre">CONFIG_EXTRAS</span></code> 相同，但添加文件的顺序不同。<code class="docutils literal notranslate"><span class="pre">CONFIG_EXTRAS</span></code> 文件在为 <code class="docutils literal notranslate"><span class="pre">ament_export_*</span></code> 调用生成文件之前包含，而 <code class="docutils literal notranslate"><span class="pre">CONFIG_EXTRAS_POST</span></code> 的文件在之后包含。</p></li>
</ul>
<p>除了向 <code class="docutils literal notranslate"><span class="pre">ament_package</span></code> 添加外，您还可以添加到变量 <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_CONFIG_EXTRAS</span></code> 和 <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_CONFIG_EXTRAS_POST</span></code>，效果相同。唯一的区别是再次添加文件的顺序，具体顺序如下：</p>
<ul class="simple">
<li><p>由``CONFIG_EXTRAS``添加的文件</p></li>
<li><p>通过附加到``${PROJECT_NAME}_CONFIG_EXTRAS``添加的文件</p></li>
<li><p>通过附加到``${PROJECT_NAME}_CONFIG_EXTRAS_POST``添加的文件</p></li>
<li><p>由``CONFIG_EXTRAS_POST``添加的文件</p></li>
</ul>
</div>
<div class="section" id="adding-files-and-headers">
<h3><a class="toc-backref" href="#id3">添加文件和头文件</a><a class="headerlink" href="#adding-files-and-headers" title="永久链接至标题"></a></h3>
<p>有两个主要的构建目标：库和可执行文件分别通过``add_library``和``add_executable``构建。</p>
<p>在C/C++中，由于头文件和实现文件的分离，不一定需要将这两个文件都作为``add_library``/ <a href="#id1"><span class="problematic" id="id2">``</span></a>add_executable``的参数添加进去。</p>
<p>建议采用以下最佳实践：</p>
<ul class="simple">
<li><p>如果您正在构建一个库，将所有应该可供客户使用并且必须安装的头文件放入名为包名称的``include``文件夹的子目录中，而其他文件（<a href="#id1"><span class="problematic" id="id2">``</span></a>.c/.cpp``和不应导出的头文件）则放在``src``文件夹中。</p></li>
<li><p>只有cpp文件在调用``add_library``或``add_executable``时被显式引用。</p></li>
<li><p>通过允许找到头文件</p></li>
</ul>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">target_include_directories</span><span class="p">(</span><span class="s">my_target</span>
<span class="w">  </span><span class="s">PUBLIC</span>
<span class="w">    </span><span class="o">$&lt;</span><span class="nv">BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include</span><span class="o">&gt;</span>
<span class="w">    </span><span class="o">$&lt;</span><span class="nv">INSTALL_INTERFACE:include</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>这将在构建时将``${CMAKE_CURRENT_SOURCE_DIR}/include``文件夹中的所有文件添加到公共接口中，并在安装时将所有文件添加到include文件夹中（相对于``${CMAKE_INSTALL_DIR}``）。</p>
<p>原则上，如果两个文件夹都称为“include”并且相对于“${CMAKE_CURRENT_SOURCE_DIR}”和“${CMAKE_INSTALL_DIR}”是顶层的话，在这里使用生成器表达式是不必要的，但这是非常常见的。</p>
</div>
<div class="section" id="adding-dependencies">
<h3><a class="toc-backref" href="#id4">添加依赖项</a><a class="headerlink" href="#adding-dependencies" title="永久链接至标题"></a></h3>
<p>有两种方法可以将您的软件包与新的依赖关系进行链接。</p>
<p>第一种推荐的方法是使用ament宏 <code class="docutils literal notranslate"><span class="pre">ament_target_dependencies</span></code>。例如，假设我们想将``my_target``与线性代数库Eigen3进行链接。</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">Eigen3</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">ament_target_dependencies</span><span class="p">(</span><span class="s">my_target</span><span class="w"> </span><span class="s">Eigen3</span><span class="p">)</span>
</pre></div>
</div>
<p>它包含了必要的头文件、库文件及其依赖项，以便项目能够正确找到它们。同时，在使用叠加工作空间时，它还会确保所有依赖项的包含目录被正确排序。</p>
<p>第二种方法是使用``target_link_libraries``函数。</p>
<p>在现代CMake中，推荐的方式是仅使用目标（targets），并将其导出和链接。CMake目标使用命名空间，类似于C++。例如，<code class="docutils literal notranslate"><span class="pre">Eigen3``定义了目标``Eigen3::Eigen</span></code>。</p>
<p>至少在``ament_target_dependencies``宏中不支持``Crystal Clemmys``目标名称之前，有时需要调用``target_link_libraries`` CMake函数。以Eigen3为例，调用应该如下所示：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">Eigen3</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">my_target</span><span class="w"> </span><span class="s">Eigen3::Eigen</span><span class="p">)</span>
</pre></div>
</div>
<p>这也会包括必要的头文件、库以及它们的依赖项，但与 <code class="docutils literal notranslate"><span class="pre">ament_target_dependencies</span></code> 不同的是，使用覆盖工作空间时它可能无法正确地排序依赖项。</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>通常情况下不需要对不明确需要但是另一个明确需要的依赖项的依赖项进行 <code class="docutils literal notranslate"><span class="pre">find_package</span></code>。如果出现这种情况，请向相应的软件包提交错误报告。</p>
</div>
</div>
<div class="section" id="building-a-library">
<h3><a class="toc-backref" href="#id5">构建库</a><a class="headerlink" href="#building-a-library" title="永久链接至标题"></a></h3>
<p>在构建可重用库时，需要导出一些信息以便下游软件包能够轻松使用它。</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ament_export_targets</span><span class="p">(</span><span class="s">my_libraryTargets</span><span class="w"> </span><span class="s">HAS_LIBRARY_TARGET</span><span class="p">)</span>
<span class="nb">ament_export_dependencies</span><span class="p">(</span><span class="s">some_dependency</span><span class="p">)</span>

<span class="nb">install</span><span class="p">(</span>
<span class="w">  </span><span class="s">DIRECTORY</span><span class="w"> </span><span class="s">include/</span>
<span class="w">  </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">include</span>
<span class="p">)</span>

<span class="nb">install</span><span class="p">(</span>
<span class="w">  </span><span class="s">TARGETS</span><span class="w"> </span><span class="s">my_library</span>
<span class="w">  </span><span class="s">EXPORT</span><span class="w"> </span><span class="s">my_libraryTargets</span>
<span class="w">  </span><span class="s">LIBRARY</span><span class="w"> </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">lib</span>
<span class="w">  </span><span class="s">ARCHIVE</span><span class="w"> </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">lib</span>
<span class="w">  </span><span class="s">RUNTIME</span><span class="w"> </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">bin</span>
<span class="w">  </span><span class="s">INCLUDES</span><span class="w"> </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">include</span>
<span class="p">)</span>
</pre></div>
</div>
<p>这里我们假设文件夹 <code class="docutils literal notranslate"><span class="pre">include</span></code> 包含需要导出的头文件。请注意，并不需要将所有的头文件放入单独的文件夹中，只需将需要由客户端包含的头文件放入其中。</p>
<p>上面的代码片段中发生了什么，下面是说明：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ament_export_targets</span></code> 宏将 CMake 的目标导出。这是必要的，以便允许库的客户端使用 <code class="docutils literal notranslate"><span class="pre">target_link_libraries(client</span> <span class="pre">my_library::my_library)</span></code> 语法。<code class="docutils literal notranslate"><span class="pre">ament_export_targets</span></code> 可以在 install 调用中使用一个名为 <code class="docutils literal notranslate"><span class="pre">EXPORT</span></code> 的任意目标列表，并添加一个额外的选项 <code class="docutils literal notranslate"><span class="pre">HAS_LIBRARY_TARGET</span></code>，它将潜在的库添加到环境变量中。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ament_export_dependencies</span></code> 将依赖项导出到下游包。这是必要的，这样库的使用者也不必为这些依赖项调用 <code class="docutils literal notranslate"><span class="pre">find_package</span></code>。</p></li>
<li><p>第一个 <code class="docutils literal notranslate"><span class="pre">install</span></code> 命令安装了应该对客户端可用的头文件。</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>从CMake子目录调用``ament_export_targets``、<a href="#id1"><span class="problematic" id="id2">``</span></a>ament_export_dependencies``或其他ament命令将不会按预期工作。这是因为CMake子目录无法在调用``ament_package``的父范围中设置必要的变量。</p>
</div>
<ul class="simple">
<li><p>最后一个大型安装命令安装库。存档和库文件将被导出到lib文件夹，运行时二进制文件将被安装到bin文件夹，已安装头文件的路径为``include``。</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>Windows DLL被视为运行时工件，并安装到``RUNTIME DESTINATION``文件夹中。因此，建议即使在基于Unix的系统上开发库时也不要忽略``RUNTIME``安装。</p>
</div>
<ul class="simple">
<li><p>关于``include directory``，安装命令只是向CMake添加信息，实际上并没有安装包含文件夹。这是通过复制头文件来实现的，方法是使用``install(DIRECTORY &lt;dir&gt; DESTINATION &lt;dest&gt;)``，如上所述。</p></li>
<li><p>安装调用中``EXPORT``标注需要额外注意：它安装了``my_library``目标的CMake文件。它的名称与``ament_export_targets``中的参数完全相同，并且可以与库的名称相同。然而，这将阻止使用``ament_target_dependencies``包含库的方式。为了实现完全的灵活性，建议在导出目标之前添加类似``&lt;target&gt;Targets``的内容。</p></li>
<li><p>所有安装路径都相对于``CMAKE_INSTALL_PREFIX``，colcon/ament已经正确设置了该值。</p></li>
</ul>
<p>还有两个可以使用但对于基于目标的安装来说是多余的函数：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ament_export_include_directories</span><span class="p">(</span><span class="s">include</span><span class="p">)</span>
<span class="nb">ament_export_libraries</span><span class="p">(</span><span class="s">my_library</span><span class="p">)</span>
</pre></div>
</div>
<p>第一个宏标记导出包含目录的目录（这通过目标“install”调用中的“INCLUDES DESTINATION”实现）。第二个宏标记已安装库的位置（这是通过调用“ament_export_targets”中的“HAS_LIBRARY_TARGET”参数完成的）。</p>
<p>一些宏可以接受不同类型的参数用于非目标导出，但由于现代Make的推荐方式是使用目标，我们将不在此处介绍它们。这些选项的文档可以在源代码本身中找到。</p>
</div>
<div class="section" id="compiler-and-linker-options">
<h3><a class="toc-backref" href="#id6">编译器和链接器选项</a><a class="headerlink" href="#compiler-and-linker-options" title="永久链接至标题"></a></h3>
<p>ROS 2针对符合C++14和C99标准的编译器进行编译，至少到“Crystal Clemmys”。将来可能针对更新版本进行目标设置，并在此处引用。因此，惯例是设置相应的CMake标志：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">if</span><span class="p">(</span><span class="s">NOT</span><span class="w"> </span><span class="s">CMAKE_C_STANDARD</span><span class="p">)</span>
<span class="w">  </span><span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_C_STANDARD</span><span class="w"> </span><span class="s">99</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>
<span class="nb">if</span><span class="p">(</span><span class="s">NOT</span><span class="w"> </span><span class="s">CMAKE_CXX_STANDARD</span><span class="p">)</span>
<span class="w">  </span><span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_CXX_STANDARD</span><span class="w"> </span><span class="s">14</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
<p>为了保持代码的清洁，编译器应该对可疑的代码发出警告，并且这些警告应该被修复。</p>
<p>建议至少包括以下警告级别：</p>
<ul class="simple">
<li><p>对于Visual Studio，保留了默认的``W1``警告级别。</p></li>
<li><p>对于GCC和Clang：需要使用``-Wall -Wextra -Wpedantic``，建议使用``-Wshadow -Werror``（后者将警告转为错误）。</p></li>
</ul>
<p>尽管现代CMake建议根据目标添加编译器标志，即调用</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">target_compile_options</span><span class="p">(</span><span class="s">my_target</span><span class="w"> </span><span class="s">PRIVATE</span><span class="w"> </span><span class="s">-Wall</span><span class="p">)</span>
</pre></div>
</div>
<p>目前建议使用目录级别的函数 <code class="docutils literal notranslate"><span class="pre">add_compile_options(-Wall)</span></code> ，以避免为所有可执行文件和测试添加基于目标的编译选项，从而不会使代码混乱。</p>
</div>
<div class="section" id="building-libraries-on-windows">
<h3><a class="toc-backref" href="#id7">在Windows上构建库</a><a class="headerlink" href="#building-libraries-on-windows" title="永久链接至标题"></a></h3>
<p>由于Linux、Mac和Windows都是官方支持的平台，为了最大限度地发挥作用，任何软件包也应该在Windows上构建。Windows库格式强制执行符号可见性：应该由库显式导出要从客户端使用的每个符号（并且数据符号需要隐式导入）。</p>
<p>为了与Clang和GCC构建兼容，建议使用`GCC维基 &lt;<a class="reference external" href="https://gcc.gnu.org/wiki/Visibility">https://gcc.gnu.org/wiki/Visibility</a>&gt;`__中的逻辑。要在名为``my_library``的软件包中使用它：</p>
<ul class="simple">
<li><p>将链接中的逻辑复制到名为``visibility_control.hpp``的头文件中。</p></li>
<li><p>将``DLL``替换为``MY_LIBRARY``（例如，查看`rviz_rendering的可见性控制 &lt;<a class="reference external" href="https://github.com/ros2/rviz/blob/ros2/rviz_rendering/include/rviz_rendering/visibility_control.hpp">https://github.com/ros2/rviz/blob/ros2/rviz_rendering/include/rviz_rendering/visibility_control.hpp</a>&gt;`__）。</p></li>
<li><p>对于需要导出的所有符号（例如类或函数），请使用宏&quot;MY_LIBRARY_PUBLIC&quot;。</p></li>
<li><p>在项目的 <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> 中使用：</p></li>
</ul>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">target_compile_definitions</span><span class="p">(</span><span class="s">my_library</span><span class="w"> </span><span class="s">PRIVATE</span><span class="w"> </span><span class="s2">&quot;MY_LIBRARY_BUILDING_LIBRARY&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>有关更多详细信息，请参阅：<a class="reference internal" href="../The-ROS2-Project/Contributing/Windows-Tips-and-Tricks.html#windows-symbol-visibility"><span class="std std-ref">Windows_Tips_and_Tricks 文档中的 Windows 符号可见性</span></a>。</p>
</div>
</div>
<div class="section" id="testing-and-linting">
<h2><a class="toc-backref" href="#id8">测试和代码检查</a><a class="headerlink" href="#testing-and-linting" title="永久链接至标题"></a></h2>
<p>为了将测试与使用 colcon 构建库分开，将所有对代码检查和测试的调用都包装在条件语句中：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">if</span><span class="p">(</span><span class="s">BUILD_TESTING</span><span class="p">)</span>
<span class="w">  </span><span class="nb">find_package</span><span class="p">(</span><span class="s">ament_cmake_gtest</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="w">  </span><span class="nb">ament_add_gtest</span><span class="p">(</span><span class="s">&lt;tests&gt;</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="linting">
<h3><a class="toc-backref" href="#id9">代码检查</a><a class="headerlink" href="#linting" title="永久链接至标题"></a></h3>
<p>建议使用`ament_lint_auto &lt;<a class="reference external" href="https://github.com/ament/ament_lint/blob/humble/ament_lint_auto/doc/index.rst#ament_lint_auto">https://github.com/ament/ament_lint/blob/humble/ament_lint_auto/doc/index.rst#ament_lint_auto</a>&gt;`_中的组合调用：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">ament_lint_auto</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">ament_lint_auto_find_test_dependencies</span><span class="p">()</span>
</pre></div>
</div>
<p>这将按照``package.xml``中定义的方式运行代码检查工具。建议使用由``ament_lint_common``软件包定义的代码检查工具集。其中包含的各个代码检查工具及其功能可以在`ament_lint_common文档 &lt;<a class="reference external" href="https://github.com/ament/ament_lint/blob/humble/ament_lint_common/doc/index.rst">https://github.com/ament/ament_lint/blob/humble/ament_lint_common/doc/index.rst</a>&gt;`_中查看。</p>
<p>ament提供的代码检查工具也可以单独添加，而不是运行``ament_lint_auto``。如何添加的一个示例可以在`ament_cmake_lint_cmake文档 &lt;<a class="reference external" href="https://github.com/ament/ament_lint/blob/humble/ament_cmake_lint_cmake/doc/index.rst">https://github.com/ament/ament_lint/blob/humble/ament_cmake_lint_cmake/doc/index.rst</a>&gt;`_中找到。</p>
</div>
<div class="section" id="testing">
<h3><a class="toc-backref" href="#id10">测试</a><a class="headerlink" href="#testing" title="永久链接至标题"></a></h3>
<p>Ament包含CMake宏，可以简化设置GTests的过程。调用：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">ament_cmake_gtest</span><span class="p">)</span>
<span class="nb">ament_add_gtest</span><span class="p">(</span><span class="s">some_test</span><span class="w"> </span><span class="s">&lt;test_sources&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>以添加一个GTest。然后，这是一个常规目标，可以与其他库链接（如项目库）。这些宏有额外的参数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">APPEND_ENV</span></code>：追加环境变量。例如，您可以通过调用来添加到ament前缀路径：</p></li>
</ul>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">ament_cmake_gtest</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">ament_add_gtest</span><span class="p">(</span><span class="s">some_test</span><span class="w"> </span><span class="s">&lt;test_sources&gt;</span>
<span class="w">  </span><span class="s">APPEND_ENV</span><span class="w"> </span><span class="s">PATH=some/addtional/path/for/testing/resources</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">APPEND_LIBRARY_DIRS</span></code>：追加库文件目录，以便链接器在运行时能够找到它们。这可以通过设置环境变量，如在Windows上设置``PATH``，在Linux上设置``LD_LIBRARY_PATH``来实现，但这样做会使调用与特定平台相关。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ENV</span></code>：设置环境变量（语法与``APPEND_ENV``相同）。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code>：设置测试的超时时间（以秒为单位）。GTests的默认超时时间为60秒。例如：</p></li>
</ul>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ament_add_gtest</span><span class="p">(</span><span class="s">some_test</span><span class="w"> </span><span class="s">&lt;test_sources&gt;</span><span class="w"> </span><span class="s">TIMEOUT</span><span class="w"> </span><span class="s">120</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SKIP_TEST</span></code>：跳过此测试（在控制台输出中将显示为“通过”）。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SKIP_LINKING_MAIN_LIBRARIES</span></code>：不链接GTest。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WORKING_DIRECTORY</span></code>：设置测试的工作目录。</p></li>
</ul>
<p>否则，默认工作目录是 <code class="docutils literal notranslate"><span class="pre">CMAKE_CURRENT_BINARY_DIR</span></code>，在 <a class="reference external" href="https://cmake.org/cmake/help/latest/variable/CMAKE_CURRENT_BINARY_DIR.html">CMake 文档</a> 中有描述。</p>
<p>类似地，有一个 CMake 宏用于设置 GTest，包括 GMock：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">ament_cmake_gmock</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">ament_add_gmock</span><span class="p">(</span><span class="s">some_test</span><span class="w"> </span><span class="s">&lt;test_sources&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>它具有与 <code class="docutils literal notranslate"><span class="pre">ament_add_gtest</span></code> 相同的附加参数。</p>
</div>
</div>
<div class="section" id="extending-ament">
<h2><a class="toc-backref" href="#id11">扩展 ament</a><a class="headerlink" href="#extending-ament" title="永久链接至标题"></a></h2>
<p>可以使用 <code class="docutils literal notranslate"><span class="pre">ament_cmake</span></code> 注册附加的宏/函数，并以多种方式进行扩展。</p>
<div class="section" id="adding-a-function-macro-to-ament">
<h3><a class="toc-backref" href="#id12">向 ament 添加函数/宏</a><a class="headerlink" href="#adding-a-function-macro-to-ament" title="永久链接至标题"></a></h3>
<p>扩展ament通常意味着您希望其他软件包可以使用某些函数。向客户端软件包提供宏的最佳方法是将其注册到ament中。</p>
<p>可以通过追加``${PROJECT_NAME}_CONFIG_EXTRAS``变量来实现，该变量由``ament_package()``使用，通过以下方式：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="s">APPEND</span><span class="w"> </span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="s">_CONFIG_EXTRAS</span>
<span class="w">  </span><span class="s">path/to/file.cmake</span><span class="s2">&quot;</span>
<span class="s2">  other/pathto/file.cmake&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>或者，您可以直接将文件添加到``ament_package()``调用中：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ament_package</span><span class="p">(</span><span class="s">CONFIG_EXTRAS</span>
<span class="w">  </span><span class="s">path/to/file.cmake</span>
<span class="w">  </span><span class="s">other/pathto/file.cmake</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-to-extension-points">
<h3><a class="toc-backref" href="#id13">添加到扩展点</a><a class="headerlink" href="#adding-to-extension-points" title="永久链接至标题"></a></h3>
<p>除了可以在其他软件包中使用的简单函数文件外，您还可以向ament添加扩展。这些扩展是通过定义扩展点的函数执行的脚本。ament扩展的最常见用例可能是注册rosidl消息生成器：当编写生成器时，通常希望使用生成器生成所有消息和服务，而无需修改消息/服务定义软件包的代码。通过将生成器注册为``rosidl_generate_interfaces``的扩展，可以实现这一点。</p>
<p>例如，参见</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ament_register_extension</span><span class="p">(</span>
<span class="w">  </span><span class="s2">&quot;rosidl_generate_interfaces&quot;</span>
<span class="w">  </span><span class="s2">&quot;rosidl_generator_cpp&quot;</span>
<span class="w">  </span><span class="s2">&quot;rosidl_generator_cpp_generate_interfaces.cmake&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>它为软件包``rosidl_generator_cpp``在扩展点``rosidl_generate_interfaces``上注册了宏``rosidl_generator_cpp_generate_interfaces.cmake``。当扩展点被执行时，它将触发在此处执行脚本``rosidl_generator_cpp_generate_interfaces.cmake``。特别地，这将在每次执行函数``rosidl_generate_interfaces``时调用生成器。</p>
<p>除了``rosidl_generate_interfaces``之外，生成器的最重要的扩展点是``ament_package``，它将通过``ament_package()``调用简单地执行脚本。在注册资源时，此扩展点非常有用（请参见下文）。</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>ament_register_extension``是一个接受三个参数的函数：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">extension_point</span></code>：扩展点的名称（大多数情况下，这将是 <code class="docutils literal notranslate"><span class="pre">ament_package</span></code> 或 <code class="docutils literal notranslate"><span class="pre">rosidl_generate_interfaces</span></code> 中的一个）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">package_name</span></code>：包含CMake文件的包的名称（即文件所在的项目的项目名称）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmake_filename</span></code>：当运行扩展点时执行的CMake文件</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>可以以类似于 <code class="docutils literal notranslate"><span class="pre">ament_package</span></code> 和 <code class="docutils literal notranslate"><span class="pre">rosidl_generate_interfaces</span></code> 的方式定义自定义扩展点，但这几乎是不必要的。</p>
</div>
</div>
<div class="section" id="adding-extension-points">
<h3><a class="toc-backref" href="#id14">添加扩展点</a><a class="headerlink" href="#adding-extension-points" title="永久链接至标题"></a></h3>
<p>非常罕见的情况下，定义一个新的扩展点到ament可能是有趣的。</p>
<p>扩展点可以在宏中注册，以便在调用相应的宏时执行所有扩展。要实现这一点</p>
<ul class="simple">
<li><p>为您的扩展定义和记录一个名称（例如``my_extension_point``），这个名称将在使用扩展点时传递给``ament_register_extension``宏。</p></li>
<li><p>在应执行扩展调用的宏/函数中：</p></li>
</ul>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ament_execute_extensions</span><span class="p">(</span><span class="s">my_extension_point</span><span class="p">)</span>
</pre></div>
</div>
<p>Ament扩展通过定义一个变量来工作，该变量包含扩展点的名称，并用要执行的宏填充该变量。在调用``ament_execute_extensions``时，然后按顺序执行变量中定义的脚本。</p>
</div>
</div>
<div class="section" id="adding-resources">
<h2><a class="toc-backref" href="#id15">添加资源</a><a class="headerlink" href="#adding-resources" title="永久链接至标题"></a></h2>
<p>特别是在开发插件或允许插件的软件包时，通常需要从另一个ROS软件包（例如插件）中添加资源。示例可以是使用pluginlib的工具的插件。</p>
<p>这可以通过使用ament索引（也称为“资源索引”）来实现。</p>
<div class="section" id="the-ament-index-explained">
<h3><a class="toc-backref" href="#id16">解释ament索引</a><a class="headerlink" href="#the-ament-index-explained" title="永久链接至标题"></a></h3>
<p>有关设计和意图的详细信息，请参阅`此处 &lt;<a class="reference external" href="https://github.com/ament/ament_cmake/blob/humble/ament_cmake_core/doc/resource_index.md">https://github.com/ament/ament_cmake/blob/humble/ament_cmake_core/doc/resource_index.md</a>&gt;`__</p>
<p>原则上，ament索引包含在您的软件包的install/share文件夹中的一个文件夹中。它包含以不同类型资源命名的浅层子文件夹。在子文件夹内，每个提供该资源的软件包都以“标记文件”的形式引用。该文件可以包含获取资源所需的任何内容，例如资源的安装目录的相对路径，也可以是空的。</p>
<p>举个例子，考虑为RViz提供显示插件：在名为``my_rviz_displays``的项目中提供RViz插件，这些插件将被pluginlib读取，您将提供一个``plugin_description.xml``文件，该文件将被安装和用于pluginlib来加载插件。为了实现这一点，通过资源索引将plugin_description.xml注册为资源</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">pluginlib_export_plugin_description_file</span><span class="p">(</span><span class="s">rviz_common</span><span class="w"> </span><span class="s">plugins_description.xml</span><span class="p">)</span>
</pre></div>
</div>
<p>运行``colcon build``时，它会将文件``my_rviz_displays``安装到resource_index的子文件夹``rviz_common__pluginlib__plugin``中。rviz_common内的Pluginlib工厂将从所有名为``rviz_common__pluginlib__plugin``的文件夹中收集来自导出插件的软件包的信息。Pluginlib工厂的标记文件包含到``plugins_description.xml``文件的安装文件夹相对路径（以及库的名称作为标记文件名）。有了这些信息，pluginlib可以加载库并从``plugin_description.xml``文件中知道要加载哪些插件。</p>
<p>作为第二个例子，考虑让您自己的RViz插件使用您自己的自定义网格的可能性。网格在启动时加载，这样插件所有者就不必处理它，但这意味着RViz必须知道这些网格。为了实现这一点，RViz提供了一个函数：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">register_rviz_ogre_media_exports</span><span class="p">(</span><span class="s">DIRECTORIES</span><span class="w"> </span><span class="s">&lt;my_dirs&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>这将目录注册为ament索引中的ogre_media资源。简而言之，它会将名为该项目的文件安装到名为“rviz_ogre_media_exports”的子文件夹中，该文件调用该函数。该文件包含安装文件夹相对于宏中列出的目录的路径。在启动时，RViz现在可以搜索所有名为“rviz_ogre_media_exports”的文件夹，并加载所提供文件夹中的资源。这些搜索使用``ament_index_cpp``（对于Python软件包，使用``ament_index_py``）进行。</p>
<p>在接下来的几节中，我们将探讨如何将您自己的资源添加到ament索引中，并提供最佳实践。</p>
</div>
<div class="section" id="querying-the-ament-index">
<h3><a class="toc-backref" href="#id17">查询ament索引</a><a class="headerlink" href="#querying-the-ament-index" title="永久链接至标题"></a></h3>
<p>如有必要，可以通过CMake查询ament索引中的资源。为此，有三个函数：</p>
<p><code class="docutils literal notranslate"><span class="pre">ament_index_has_resource</span></code>：如果资源存在，则使用以下参数获取资源的前缀路径：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">var</span></code>：输出参数：如果资源不存在，请将此变量填充为FALSE，否则填充为资源的前缀路径</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resource_type</span></code>：资源的类型（例如``rviz_common__pluginlib__plugin``）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resource_name</span></code>: 资源的名称通常等于添加资源的包的名称，资源的类型为 resource_type（例如 <code class="docutils literal notranslate"><span class="pre">rviz_default_plugins</span></code>）。</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ament_index_get_resource</span></code>: 获取特定资源的内容，即 ament 索引中标记文件的内容。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">var</span></code>: 输出参数，如果存在，将填充资源标记文件的内容。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resource_type</span></code>：资源的类型（例如``rviz_common__pluginlib__plugin``）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resource_name</span></code>: 资源的名称通常等于添加资源的包的名称，资源的类型为 resource_type（例如 <code class="docutils literal notranslate"><span class="pre">rviz_default_plugins</span></code>）。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PREFIX_PATH</span></code>: 要搜索的前缀路径（通常，默认的 <code class="docutils literal notranslate"><span class="pre">ament_index_get_prefix_path()</span></code> 就足够了）。</p></li>
</ul>
<p>请注意，如果资源不存在，<code class="docutils literal notranslate"><span class="pre">ament_index_get_resource</span></code> 将抛出错误，因此可能需要使用 <code class="docutils literal notranslate"><span class="pre">ament_index_has_resource</span></code> 进行检查。</p>
<p><code class="docutils literal notranslate"><span class="pre">ament_index_get_resources</span></code>：从索引中获取所有注册了特定类型资源的软件包</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">var</span></code>：输出参数，包含所有注册了指定资源类型的软件包名称列表</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resource_type</span></code>：资源的类型（例如``rviz_common__pluginlib__plugin``）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PREFIX_PATH</span></code>: 要搜索的前缀路径（通常，默认的 <code class="docutils literal notranslate"><span class="pre">ament_index_get_prefix_path()</span></code> 就足够了）。</p></li>
</ul>
</div>
<div class="section" id="adding-to-the-ament-index">
<h3><a class="toc-backref" href="#id18">添加到 ament 索引</a><a class="headerlink" href="#adding-to-the-ament-index" title="永久链接至标题"></a></h3>
<p>定义资源需要两个信息：</p>
<ul class="simple">
<li><p>资源的名称必须是唯一的，</p></li>
<li><p>标记文件的布局可以是任意的，也可以是空的（例如，用于标记ROS 2包的“package”资源）</p></li>
</ul>
<p>对于RViz网格资源，对应的选择是：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rviz_ogre_media_exports</span></code> 作为资源的名称，</p></li>
<li><p>安装路径相对于包含资源的所有文件夹的路径。这将使您能够编写使用包中相应资源的逻辑。</p></li>
</ul>
<p>为了让用户能够轻松地为您的软件包注册资源，您还应该提供宏或函数，例如 pluginlib 函数或 <code class="docutils literal notranslate"><span class="pre">rviz_ogre_media_exports</span></code> 函数。</p>
<p>要注册一个资源，请使用 ament 函数 <code class="docutils literal notranslate"><span class="pre">ament_index_register_resource</span></code>。这将在资源索引中创建和安装标记文件。例如，对于 <code class="docutils literal notranslate"><span class="pre">rviz_ogre_media_exports</span></code> 的相应调用如下所示：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ament_index_register_resource</span><span class="p">(</span><span class="s">rviz_ogre_media_exports</span><span class="w"> </span><span class="s">CONTENT</span><span class="w"> </span><span class="o">${</span><span class="nv">OGRE_MEDIA_RESOURCE_FILE</span><span class="o">}</span><span class="p">)</span>
</pre></div>
</div>
<p>这将安装一个名为 <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}</span></code> 的文件到资源索引中的文件夹 <code class="docutils literal notranslate"><span class="pre">rviz_ogre_media_exports</span></code> 中，其内容由变量 <code class="docutils literal notranslate"><span class="pre">${OGRE_MEDIA_RESOURCE_FILE}</span></code> 提供。该宏有一些可能有用的参数：</p>
<ul class="simple">
<li><p>第一个（无名称）参数是资源的名称，对应于资源索引中文件夹的名称</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONTENT</span></code>: 标记文件的内容作为字符串。这可以是一个相对路径列表等。<code class="docutils literal notranslate"><span class="pre">CONTENT</span></code> 不能与 <code class="docutils literal notranslate"><span class="pre">CONTENT_FILE</span></code> 一起使用。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CONTENT_FILE</span></code>: 用于创建标记文件的文件的路径。该文件可以是一个普通文件或使用 <code class="docutils literal notranslate"><span class="pre">configure_file()</span></code> 扩展的模板文件。<code class="docutils literal notranslate"><span class="pre">CONTENT_FILE</span></code> 不能与 <code class="docutils literal notranslate"><span class="pre">CONTENT</span></code> 一起使用。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PACKAGE_NAME</span></code>：导出资源的软件包/库的名称，即标记文件的名称。默认为 <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AMENT_INDEX_BINARY_DIR</span></code>：生成的ament索引的基路径。除非真的有必要，否则始终使用默认值 <code class="docutils literal notranslate"><span class="pre">${CMAKE_BINARY_DIR}/ament_cmake_index</span></code>。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SKIP_INSTALL</span></code>：跳过安装标记文件。</p></li>
</ul>
<p>由于每个软件包只存在一个标记文件，如果同一项目调用了两次CMake函数/宏，则通常会出现问题。然而，对于大型项目，最好将调用注册资源的操作拆分为多次。</p>
<p>因此，最佳实践是让一个注册资源的宏，例如 <code class="docutils literal notranslate"><span class="pre">register_rviz_ogre_media_exports.cmake</span></code>，仅填充一些变量。然后，在 <code class="docutils literal notranslate"><span class="pre">ament_package</span></code> 的扩展中添加对 <code class="docutils literal notranslate"><span class="pre">ament_index_register_resource</span></code> 的真实调用。由于每个项目只能有一次对 <code class="docutils literal notranslate"><span class="pre">ament_package</span></code> 的调用，因此资源的注册始终只有一个位置。对于 <code class="docutils literal notranslate"><span class="pre">rviz_ogre_media_exports</span></code>，这就是以下策略：</p>
<ul class="simple">
<li><p>宏 <code class="docutils literal notranslate"><span class="pre">register_rviz_ogre_media_exports</span></code> 接受一个文件夹列表，并将它们附加到名为 <code class="docutils literal notranslate"><span class="pre">OGRE_MEDIA_RESOURCE_FILE</span></code> 的变量中。</p></li>
<li><p>另一个名为 <code class="docutils literal notranslate"><span class="pre">register_rviz_ogre_media_exports_hook</span></code> 的宏在 <code class="docutils literal notranslate"><span class="pre">${OGRE_MEDIA_RESOURCE_FILE}</span></code> 非空时调用 <code class="docutils literal notranslate"><span class="pre">ament_index_register_resource</span></code>。</p></li>
<li><p>通过调用，将 <code class="docutils literal notranslate"><span class="pre">register_rviz_ogre_media_exports_hook.cmake</span></code> 文件在第三个文件 <code class="docutils literal notranslate"><span class="pre">register_rviz_ogre_media_exports_hook-extras.cmake</span></code> 中注册为 ament 扩展</p></li>
</ul>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ament_register_extension</span><span class="p">(</span><span class="s2">&quot;ament_package&quot;</span><span class="w"> </span><span class="s2">&quot;rviz_rendering&quot;</span>
<span class="w">  </span><span class="s2">&quot;register_rviz_ogre_media_exports_hook.cmake&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>文件 <code class="docutils literal notranslate"><span class="pre">register_rviz_ogre_media_exports.cmake</span></code> 和 <code class="docutils literal notranslate"><span class="pre">register_rviz_ogre_media_exports_hook-extra.cmake</span></code> 在 <code class="docutils literal notranslate"><span class="pre">ament_package()</span></code> 中被注册为 <code class="docutils literal notranslate"><span class="pre">CONFIG_EXTRA</span></code>。</p></li>
</ul>
</div>
</div>
</div>



           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Developing-a-ROS-2-Package.html" class="btn btn-neutral float-left" title="开发ROS 2软件包" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="Ament-CMake-Python-Documentation.html" class="btn btn-neutral float-right" title="ament_cmake_python 用户文档" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2023, Open Robotics.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-EVD5Z6G6NH', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>