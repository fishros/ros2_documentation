<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>How-To-Guides/Developing-a-ROS-2-Package</title>
</head>
<body>
  <div class="section" id="developing-a-ros-2-package">
<h1>开发ROS 2软件包<a class="headerlink" href="#developing-a-ros-2-package" title="永久链接至标题"></a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#prerequisites" id="id1">先决条件</a></p></li>
<li><p><a class="reference internal" href="#creating-a-package" id="id2">创建软件包</a></p>
<ul>
<li><p><a class="reference internal" href="#c-packages" id="id3">C++软件包</a></p></li>
<li><p><a class="reference internal" href="#python-packages" id="id4">Python包</a></p></li>
<li><p><a class="reference internal" href="#combined-c-and-python-packages" id="id5">结合C++和Python包</a></p></li>
</ul>
</li>
</ul>
</div>
<p>本教程将教你如何创建你的第一个ROS 2应用程序。它适用于希望学习如何在ROS 2中创建自定义软件包的开发人员，而不适用于希望使用ROS 2及其现有软件包的用户。</p>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id1">先决条件</a><a class="headerlink" href="#prerequisites" title="永久链接至标题"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="../Installation.html"><span class="doc">安装ROS</span></a></p></li>
<li><p><a class="reference external" href="https://colcon.readthedocs.io/en/released/user/installation.html">安装 colcon</a></p></li>
<li><p>通过将您的 ROS 2 安装路径设置为源，设置您的工作空间。</p></li>
</ul>
</div>
<div class="section" id="creating-a-package">
<h2><a class="toc-backref" href="#id2">创建软件包</a><a class="headerlink" href="#creating-a-package" title="永久链接至标题"></a></h2>
<p>所有 ROS 2 软件包都需要运行以下命令开始</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 pkg create &lt;pkg-name&gt; --dependencies <span class="o">[</span>deps<span class="o">]</span>
</pre></div>
</div>
<p>在您的工作空间中（通常为 <code class="docutils literal notranslate"><span class="pre">~/ros2_ws/src</span></code>）。</p>
<p>要为特定的客户端库创建软件包：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-Qysr" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-Qysr" name="Qysr" role="tab" tabindex="0">C++</button><button aria-controls="panel-0-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-0-Qysr" class="sphinx-tabs-panel group-tab" id="panel-0-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 pkg create &lt;pkg-name&gt; --dependencies <span class="o">[</span>deps<span class="o">]</span> --build-type ament_cmake
</pre></div>
</div>
</div><div aria-labelledby="tab-0-UHl0aG9u" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 pkg create &lt;pkg-name&gt; --dependencies <span class="o">[</span>deps<span class="o">]</span> --build-type ament_python
</pre></div>
</div>
</div></div>
<p>然后，您可以使用您的软件包信息（例如依赖项、描述和作者信息）更新``package.xml``文件。</p>
<div class="section" id="c-packages">
<h3><a class="toc-backref" href="#id3">C++软件包</a><a class="headerlink" href="#c-packages" title="永久链接至标题"></a></h3>
<p>您将主要使用``add_executable()`` CMake宏，以及</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">ament_target_dependencies</span><span class="p">(</span><span class="s">&lt;executable-name&gt;</span><span class="w"> </span><span class="s">[dependencies]</span><span class="p">)</span>
</pre></div>
</div>
<p>创建可执行节点并链接依赖项。</p>
<p>要安装启动文件和节点，您可以使用位于文件末尾但在``ament_package()``宏之前的``install()``宏。</p>
<p>启动文件和节点示例：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="c"># Install launch files</span>
<span class="nb">install</span><span class="p">(</span>
<span class="w">  </span><span class="s">DIRECTORY</span><span class="w"> </span><span class="s">launch</span>
<span class="w">  </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">share/</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span>
<span class="p">)</span>

<span class="c"># Install nodes</span>
<span class="nb">install</span><span class="p">(</span>
<span class="w">  </span><span class="s">TARGETS</span><span class="w"> </span><span class="s">[node-names]</span>
<span class="w">  </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">lib/</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="python-packages">
<h3><a class="toc-backref" href="#id4">Python包</a><a class="headerlink" href="#python-packages" title="永久链接至标题"></a></h3>
<p>ROS 2遵循Python的标准模块分发过程，使用``setuptools``。对于Python包，<a href="#id1"><span class="problematic" id="id2">``</span></a>setup.py``文件与C++包的``CMakeLists.txt``相辅相成。有关分发的更多详细信息，请参阅`官方文档 &lt;<a class="reference external" href="https://docs.python.org/3/distributing/index.html#distributing-index">https://docs.python.org/3/distributing/index.html#distributing-index</a>&gt;`_。</p>
<p>在你的ROS 2包中，你应该有一个看起来像这样的``setup.cfg``文件：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>develop<span class="o">]</span>
<span class="nv">script_dir</span><span class="o">=</span><span class="nv">$base</span>/lib/&lt;package-name&gt;
<span class="o">[</span>install<span class="o">]</span>
<span class="nv">install_scripts</span><span class="o">=</span><span class="nv">$base</span>/lib/&lt;package-name&gt;
</pre></div>
</div>
<p>还有一个看起来像这样的``setup.py``文件：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">package_name</span> <span class="o">=</span> <span class="s1">&#39;my_package&#39;</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="n">package_name</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;0.0.0&#39;</span><span class="p">,</span>
    <span class="c1"># Packages to export</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="n">package_name</span><span class="p">],</span>
    <span class="c1"># Files we want to install, specifically launch files</span>
    <span class="n">data_files</span><span class="o">=</span><span class="p">[</span>
        <span class="c1"># Install marker file in the package index</span>
        <span class="p">(</span><span class="s1">&#39;share/ament_index/resource_index/packages&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;resource/&#39;</span> <span class="o">+</span> <span class="n">package_name</span><span class="p">]),</span>
        <span class="c1"># Include our package.xml file</span>
        <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;share&#39;</span><span class="p">,</span> <span class="n">package_name</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;package.xml&#39;</span><span class="p">]),</span>
        <span class="c1"># Include all launch files.</span>
        <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;share&#39;</span><span class="p">,</span> <span class="n">package_name</span><span class="p">,</span> <span class="s1">&#39;launch&#39;</span><span class="p">),</span> <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;launch&#39;</span><span class="p">,</span> <span class="s1">&#39;*.launch.py&#39;</span><span class="p">))),</span>
    <span class="p">],</span>
    <span class="c1"># This is important as well</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;setuptools&#39;</span><span class="p">],</span>
    <span class="n">zip_safe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s1">&#39;ROS 2 Developer&#39;</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="s1">&#39;ros2@ros.com&#39;</span><span class="p">,</span>
    <span class="n">maintainer</span><span class="o">=</span><span class="s1">&#39;ROS 2 Developer&#39;</span><span class="p">,</span>
    <span class="n">maintainer_email</span><span class="o">=</span><span class="s1">&#39;ros2@ros.com&#39;</span><span class="p">,</span>
    <span class="n">keywords</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">],</span>
    <span class="n">classifiers</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;Intended Audience :: Developers&#39;</span><span class="p">,</span>
        <span class="s1">&#39;License :: TODO&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Programming Language :: Python&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Topic :: Software Development&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;My awesome package.&#39;</span><span class="p">,</span>
    <span class="n">license</span><span class="o">=</span><span class="s1">&#39;TODO&#39;</span><span class="p">,</span>
    <span class="c1"># Like the CMakeLists add_executable macro, you can add your python</span>
    <span class="c1"># scripts here.</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;console_scripts&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;my_script = my_package.my_script:main&#39;</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="combined-c-and-python-packages">
<h3><a class="toc-backref" href="#id5">结合C++和Python包</a><a class="headerlink" href="#combined-c-and-python-packages" title="永久链接至标题"></a></h3>
<p>当编写既包含C++代码又包含Python代码的包时，不使用``setup.py``文件和``setup.cfg``文件。而是使用 <a class="reference internal" href="Ament-CMake-Python-Documentation.html"><span class="doc">ament_cmake_python</span></a>。</p>
</div>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>