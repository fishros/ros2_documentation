<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>How-To-Guides/Working-with-multiple-RMW-implementations</title>
</head>
<body>
  <div class="section" id="working-with-multiple-ros-2-middleware-implementations">
<h1>使用多个ROS 2中间件实现<a class="headerlink" href="#working-with-multiple-ros-2-middleware-implementations" title="永久链接至标题"></a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#prerequisites" id="id1">先决条件</a></p></li>
<li><p><a class="reference internal" href="#specifying-rmw-implementations" id="id2">指定RMW实现</a></p></li>
<li><p><a class="reference internal" href="#adding-rmw-implementations-to-your-workspace" id="id3">将 RMW 实现添加到您的工作空间中</a></p></li>
<li><p><a class="reference internal" href="#troubleshooting" id="id4">故障排除</a></p>
<ul>
<li><p><a class="reference internal" href="#checking-the-current-rmw" id="id5">检查当前的RMW</a></p></li>
<li><p><a class="reference internal" href="#ensuring-use-of-a-particular-rmw-implementation" id="id6">确保使用特定的RMW实现</a></p></li>
<li><p><a class="reference internal" href="#rti-connext-on-osx-failure-due-to-insufficient-shared-memory-kernel-settings" id="id7">RTI Connext在OSX上的故障是由于内核设置的共享内存不足引起的。</a></p></li>
</ul>
</li>
</ul>
</div>
<p>本页面介绍了默认的RMW实现以及如何指定替代实现。</p>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id1">先决条件</a><a class="headerlink" href="#prerequisites" title="永久链接至标题"></a></h2>
<p>你应该已经阅读了:doc:<a class="reference internal" href="../Concepts/About-Different-Middleware-Vendors.html"><span class="doc">DDS和ROS中间件实现页面</span></a>。</p>
</div>
<div class="section" id="specifying-rmw-implementations">
<h2><a class="toc-backref" href="#id2">指定RMW实现</a><a class="headerlink" href="#specifying-rmw-implementations" title="永久链接至标题"></a></h2>
<p>要使用多个RMW实现，您必须安装ROS 2二进制文件和特定RMW实现的任何附加依赖项，或者从源代码构建ROS 2并在工作空间中使用多个RMW实现（如果编译时依赖项满足，则默认包括RMW实现在构建中）。参见:doc:<a class="reference internal" href="../Installation/DDS-Implementations.html"><span class="doc">安装DDS实现</span></a>。</p>
<hr class="docutils" />
<p>C++和Python节点都支持一个环境变量``RMW_IMPLEMENTATION``，允许用户在运行ROS 2应用程序时选择要使用的RMW实现。</p>
<p>用户可以将此变量设置为特定的实现标识符，例如 <code class="docutils literal notranslate"><span class="pre">rmw_cyclonedds_cpp</span></code>、<code class="docutils literal notranslate"><span class="pre">rmw_fastrtps_cpp</span></code>、<code class="docutils literal notranslate"><span class="pre">rmw_connextdds</span></code> 或 <code class="docutils literal notranslate"><span class="pre">rmw_gurumdds_cpp</span></code>。</p>
<p>例如，要使用C++ talker 和 Python listener 以 Connext RMW 实现运行 talker 示例：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-0-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button><button aria-controls="panel-0-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-0-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-0-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">RMW_IMPLEMENTATION</span><span class="o">=</span>rmw_connextdds ros2 run demo_nodes_cpp talker

<span class="c1"># Run in another terminal</span>
<span class="nv">RMW_IMPLEMENTATION</span><span class="o">=</span>rmw_connextdds ros2 run demo_nodes_py listener
</pre></div>
</div>
</div><div aria-labelledby="tab-0-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">RMW_IMPLEMENTATION</span><span class="o">=</span>rmw_connextdds ros2 run demo_nodes_cpp talker

<span class="c1"># Run in another terminal</span>
<span class="nv">RMW_IMPLEMENTATION</span><span class="o">=</span>rmw_connextdds ros2 run demo_nodes_py listener
</pre></div>
</div>
</div><div aria-labelledby="tab-0-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><div class="highlight-bat notranslate"><div class="highlight"><pre><span></span><span class="k">set</span> <span class="nv">RMW_IMPLEMENTATION</span><span class="p">=</span>rmw_connextdds
ros2 run demo_nodes_cpp talker

<span class="c1">REM run in another terminal</span>
<span class="k">set</span> <span class="nv">RMW_IMPLEMENTATION</span><span class="p">=</span>rmw_connextdds
ros2 run demo_nodes_py listener
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="adding-rmw-implementations-to-your-workspace">
<h2><a class="toc-backref" href="#id3">将 RMW 实现添加到您的工作空间中</a><a class="headerlink" href="#adding-rmw-implementations-to-your-workspace" title="永久链接至标题"></a></h2>
<p>假设您已经构建了只安装了 Fast DDS 的 ROS 2 工作空间，因此只有 Fast DDS RMW 实现被构建。上次构建工作空间时，其他任何 RMW 实现包（例如 <code class="docutils literal notranslate"><span class="pre">rmw_connextdds</span></code>）可能都无法找到相关 DDS 实现的安装。如果您随后安装了额外的 DDS 实现，例如 Connext，您将需要重新触发构建 Connext RMW 实现时的 Connext 安装检查。您可以在下一个工作空间构建中指定 <code class="docutils literal notranslate"><span class="pre">--cmake-clean-cache</span></code> 标志来执行此操作，并且您应该看到 RMW 实现包将为新安装的 DDS 实现进行构建。</p>
<p>使用``--cmake-clean-cache``选项在添加额外的RMW实现时，重新构建工作空间可能会遇到问题，构建时会报告默认的RMW实现发生了变化。要解决这个问题，您可以通过``RMW_IMPLEMENTATION`` CMake参数将默认实现设置为之前的值，或者可以删除报错的包的构建文件夹，并使用``--packages-start &lt;package name&gt;``继续构建。</p>
</div>
<div class="section" id="troubleshooting">
<h2><a class="toc-backref" href="#id4">故障排除</a><a class="headerlink" href="#troubleshooting" title="永久链接至标题"></a></h2>
<div class="section" id="checking-the-current-rmw">
<h3><a class="toc-backref" href="#id5">检查当前的RMW</a><a class="headerlink" href="#checking-the-current-rmw" title="永久链接至标题"></a></h3>
<p>要检查当前使用的RMW，只需检查``RMW_IMPLEMENTATION``环境变量。在Linux系统上，<code class="docutils literal notranslate"><span class="pre">printenv``打印出完整的环境变量列表。其他操作系统将有其他查看环境变量的方法。如果环境中不存在``RMW_IMPLEMENTATION</span></code>，则可以安全地假设您正在使用ROS发行版的默认值，否则当前的RMW是所列值。每个ROS发行版的默认RMW可以在`REP-2000 &lt;<a class="reference external" href="https://www.ros.org/reps/rep-2000.html#platforms-by-distribution">https://www.ros.org/reps/rep-2000.html#platforms-by-distribution</a>&gt;`_中找到。</p>
</div>
<div class="section" id="ensuring-use-of-a-particular-rmw-implementation">
<h3><a class="toc-backref" href="#id6">确保使用特定的RMW实现</a><a class="headerlink" href="#ensuring-use-of-a-particular-rmw-implementation" title="永久链接至标题"></a></h3>
<p>如果``RMW_IMPLEMENTATION``环境变量设置为未安装支持的RMW实现，且你只安装了一个实现，则会看到类似以下错误消息：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Expected RMW implementation identifier of <span class="s1">&#39;rmw_connextdds&#39;</span> but instead found <span class="s1">&#39;rmw_fastrtps_cpp&#39;</span>, exiting with <span class="m">102</span>.
</pre></div>
</div>
<p>如果你安装了多个RMW实现并请求使用未安装的实现，则会看到类似的消息：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Error getting RMW implementation identifier / RMW implementation not installed <span class="o">(</span>expected identifier of <span class="s1">&#39;rmw_connextdds&#39;</span><span class="o">)</span>, exiting with <span class="m">1</span>.
</pre></div>
</div>
<p>如果出现这种情况，请仔细检查你的ROS 2安装是否包含你在``RMW_IMPLEMENTATION``环境变量中指定的RMW实现的支持。</p>
<p>如果您想在不同的RMW实现之间切换，请验证ROS 2守护进程未使用先前的RMW实现运行，以避免节点和命令行工具（如``ros2 node``）之间出现任何问题。例如，如果您运行以下命令：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">RMW_IMPLEMENTATION</span><span class="o">=</span>rmw_connextdds ros2 run demo_nodes_cpp talker
</pre></div>
</div>
<p>并且</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 node list
</pre></div>
</div>
<p>将生成一个使用Fast DDS实现的守护进程：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">21318</span> <span class="m">22</span>.0  <span class="m">0</span>.6 <span class="m">535896</span> <span class="m">55044</span> pts/8    Sl   <span class="m">16</span>:14   <span class="m">0</span>:00 /usr/bin/python3 /opt/ros/humble/bin/_ros2_daemon --rmw-implementation rmw_fastrtps_cpp --ros-domain-id <span class="m">0</span>
</pre></div>
</div>
<p>即使您再次使用正确的RMW实现运行命令行工具，守护进程的RMW实现也不会更改，从而导致ROS 2命令行工具失败。</p>
<p>为解决此问题，请简单地停止守护进程：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 daemon stop
</pre></div>
</div>
<p>然后使用正确的RMW实现重新运行ROS 2命令行工具。</p>
</div>
<div class="section" id="rti-connext-on-osx-failure-due-to-insufficient-shared-memory-kernel-settings">
<h3><a class="toc-backref" href="#id7">RTI Connext在OSX上的故障是由于内核设置的共享内存不足引起的。</a><a class="headerlink" href="#rti-connext-on-osx-failure-due-to-insufficient-shared-memory-kernel-settings" title="永久链接至标题"></a></h3>
<p>如果在OSX上运行RTI Connext时收到类似下面的错误消息</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[D0062|ENABLE]DDS_DomainParticipantPresentation_reserve_participant_index_entryports:!enable reserve participant index</span>
<span class="go">[D0062|ENABLE]DDS_DomainParticipant_reserve_participant_index_entryports:Unusable shared memory transport. For a more in-   depth explanation of the possible problem and solution, please visit https://community.rti.com/kb/osx510.</span>
</pre></div>
</div>
<p>此错误是由操作系统允许的共享内存段数目或大小不足引起的。因此，<code class="docutils literal notranslate"><span class="pre">DomainParticipant</span></code> 无法分配足够的资源并计算其参与者索引，从而导致错误。</p>
<p>您可以临时或永久增加机器的共享内存资源。</p>
<p>要临时增加设置，您可以以 root 用户身份运行以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/usr/sbin/sysctl -w kern.sysv.shmmax=419430400</span>
<span class="go">/usr/sbin/sysctl -w kern.sysv.shmmin=1</span>
<span class="go">/usr/sbin/sysctl -w kern.sysv.shmmni=128</span>
<span class="go">/usr/sbin/sysctl -w kern.sysv.shmseg=1024</span>
<span class="go">/usr/sbin/sysctl -w kern.sysv.shmall=262144</span>
</pre></div>
</div>
<p>要永久增加设置，您需要编辑或创建文件 <code class="docutils literal notranslate"><span class="pre">/etc/sysctl.conf</span></code>。创建或编辑此文件将需要 root 权限。可以将以下行添加到现有的 <code class="docutils literal notranslate"><span class="pre">etc/sysctl.conf</span></code> 文件中，或者创建新的 <code class="docutils literal notranslate"><span class="pre">/etc/sysctl.conf</span></code> 文件：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">kern.sysv.shmmax=419430400</span>
<span class="go">kern.sysv.shmmin=1</span>
<span class="go">kern.sysv.shmmni=128</span>
<span class="go">kern.sysv.shmseg=1024</span>
<span class="go">kern.sysv.shmall=262144</span>
</pre></div>
</div>
<p>在修改此文件后，您需要重新启动机器以使更改生效。</p>
<p>此解决方案是从RTI Connext社区论坛编辑而来。有关更详细的解释，请参阅`原始帖子 &lt;<a class="reference external" href="https://community.rti.com/kb/osx510">https://community.rti.com/kb/osx510</a>&gt;`__。</p>
</div>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>