<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>How-To-Guides/Building-ROS-2-with-Tracing-Instrumentation</title>
</head>
<body>
  <div class="section" id="building-ros-2-with-tracing-instrumentation">
<h1>使用跟踪工具构建ROS 2<a class="headerlink" href="#building-ros-2-with-tracing-instrumentation" title="永久链接至标题"></a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#prerequisites" id="id1">先决条件</a></p></li>
<li><p><a class="reference internal" href="#installing-the-tracer" id="id2">安装追踪器</a></p></li>
<li><p><a class="reference internal" href="#building" id="id3">构建中</a></p>
<ul>
<li><p><a class="reference internal" href="#with-source-installation" id="id4">使用源代码安装</a></p></li>
<li><p><a class="reference internal" href="#with-binary-installation" id="id5">使用二进制安装</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#validating" id="id6">正在验证</a></p></li>
<li><p><a class="reference internal" href="#disabling-tracing" id="id7">禁用跟踪</a></p></li>
</ul>
</div>
<p>本指南介绍了如何使用``ros2_tracing``提供的跟踪工具构建ROS 2。更多信息请参见`存储库 &lt;<a class="reference external" href="https://github.com/ros2/ros2_tracing">https://github.com/ros2/ros2_tracing</a>&gt;`__。</p>
<p>ROS 2源代码中包含了工具仪器。然而，如果使用二进制文件或从源代码构建时，默认情况下工具仪器不会触发跟踪点。要获取跟踪点，需要安装LTTng跟踪器，然后重新从源代码构建ROS 2的一部分。</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>本指南仅适用于Linux系统，并假设使用的是Ubuntu。</p>
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id1">先决条件</a><a class="headerlink" href="#prerequisites" title="永久链接至标题"></a></h2>
<p>设置您的系统以从源代码构建ROS 2。有关更多信息，请参阅:doc:<a class="reference internal" href="../Installation/Alternatives/Ubuntu-Development-Setup.html"><span class="doc">源安装页面</span></a>。</p>
</div>
<div class="section" id="installing-the-tracer">
<h2><a class="toc-backref" href="#id2">安装追踪器</a><a class="headerlink" href="#installing-the-tracer" title="永久链接至标题"></a></h2>
<p>安装 <a class="reference external" href="https://lttng.org/docs">LTTng追踪器</a> 及其相关工具和依赖项。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get update
sudo apt-get install -y lttng-tools liblttng-ust-dev python3-lttng python3-babeltrace babeltrace
</pre></div>
</div>
<p>这只安装了LTTng用户空间追踪器，而不安装LTTng内核追踪器，因为它不需要跟踪ROS 2应用程序。</p>
</div>
<div class="section" id="building">
<h2><a class="toc-backref" href="#id3">构建中</a><a class="headerlink" href="#building" title="永久链接至标题"></a></h2>
<p>这一步取决于您是从源代码构建ROS 2还是使用ROS 2二进制文件。</p>
<div class="section" id="with-source-installation">
<h3><a class="toc-backref" href="#id4">使用源代码安装</a><a class="headerlink" href="#with-source-installation" title="永久链接至标题"></a></h3>
<p>如果在安装LTTng之前已经 <a class="reference internal" href="../Installation/Alternatives/Ubuntu-Development-Setup.html"><span class="doc">从源代码构建了ROS 2</span></a>，您将需要重新构建至少到 <code class="docutils literal notranslate"><span class="pre">tracetools</span></code> 软件包：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/ws
colcon build --packages-up-to tracetools --cmake-force-configure
</pre></div>
</div>
</div>
<div class="section" id="with-binary-installation">
<h3><a class="toc-backref" href="#id5">使用二进制安装</a><a class="headerlink" href="#with-binary-installation" title="永久链接至标题"></a></h3>
<p>如果您依赖于ROS 2二进制文件（<span class="xref std std-doc">Debian packages &lt;../Installation/Ubuntu-Install-Debians&gt;`或:doc:</span>&quot;fat&quot; archive &lt;../Installation/Alternatives/Ubuntu-Install-Binary&gt;`），您需要将``ros2_tracing``存储库克隆到您的工作空间中，并至少构建到``tracetools``包为止：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/ws/src
git clone https://github.com/ros2/ros2_tracing.git
<span class="nb">cd</span> ../
colcon build --packages-up-to tracetools
</pre></div>
</div>
</div>
</div>
<div class="section" id="validating">
<h2><a class="toc-backref" href="#id6">正在验证</a><a class="headerlink" href="#validating" title="永久链接至标题"></a></h2>
<p>源代码并验证跟踪已启用：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/ws
<span class="nb">source</span> install/setup.bash
ros2 run tracetools status
</pre></div>
</div>
<p>它应该打印出：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Tracing enabled
</pre></div>
</div>
<p>如果打印出其他内容，那么出现了错误。</p>
</div>
<div class="section" id="disabling-tracing">
<h2><a class="toc-backref" href="#id7">禁用跟踪</a><a class="headerlink" href="#disabling-tracing" title="永久链接至标题"></a></h2>
<p>如果在构建``tracetools``时安装并找到了LTTng用户空间跟踪器，将自动启用跟踪。或者，要从ROS 2中构建并完全删除跟踪点和跟踪工具，将``TRACETOOLS_DISABLED`` CMake选项设置为``ON``：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>colcon build --cmake-args -DTRACETOOLS_DISABLED<span class="o">=</span>ON --no-warn-unused-cli
</pre></div>
</div>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>