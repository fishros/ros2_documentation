<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>How-To-Guides/Releasing/Subsequent-Releases</title>
</head>
<body>
  <div class="section" id="subsequent-releases">
<h1>后续发布<a class="headerlink" href="#subsequent-releases" title="永久链接至标题"></a></h1>
<p>本指南介绍了如何发布已经发布过的ROS软件包的新版本。</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#be-part-of-the-release-team" id="id1">成为发布团队的一员</a></p></li>
<li><p><a class="reference internal" href="#install-dependencies" id="id2">安装依赖项</a></p></li>
<li><p><a class="reference internal" href="#set-up-a-personal-access-token" id="id3">设置个人访问令牌</a></p></li>
<li><p><a class="reference internal" href="#ensure-repositories-are-up-to-date" id="id4">确保存储库是最新的。</a></p></li>
<li><p><a class="reference internal" href="#updating-changelog" id="id5">更新变更日志</a></p></li>
<li><p><a class="reference internal" href="#bump-the-package-version" id="id6">提升软件包版本</a></p></li>
<li><p><a class="reference internal" href="#bloom-release" id="id7">Bloom发布</a></p></li>
<li><p><a class="reference internal" href="#next-steps" id="id8">下一步</a></p></li>
</ul>
</div>
<div class="section" id="be-part-of-the-release-team">
<h2><a class="toc-backref" href="#id1">成为发布团队的一员</a><a class="headerlink" href="#be-part-of-the-release-team" title="永久链接至标题"></a></h2>
<p>如果您不是具有对发布存储库的写入访问权限的发布团队成员，请参阅 <a class="reference internal" href="Release-Team-Repository.html#join-a-release-team"><span class="std std-ref">加入发布团队</span></a>。</p>
</div>
<div class="section" id="install-dependencies">
<h2><a class="toc-backref" href="#id2">安装依赖项</a><a class="headerlink" href="#install-dependencies" title="永久链接至标题"></a></h2>
<p>根据你的平台安装你将在接下来的步骤中使用的工具：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-RGViaWFuIChlZy4gVWJ1bnR1KQ==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-RGViaWFuIChlZy4gVWJ1bnR1KQ==" name="RGViaWFuIChlZy4gVWJ1bnR1KQ==" role="tab" tabindex="0">Debian (eg. Ubuntu)</button><button aria-controls="panel-0-UlBNIChlZy4gUkhFTCk=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-UlBNIChlZy4gUkhFTCk=" name="UlBNIChlZy4gUkhFTCk=" role="tab" tabindex="-1">RPM (eg. RHEL)</button><button aria-controls="panel-0-T3RoZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-T3RoZXI=" name="T3RoZXI=" role="tab" tabindex="-1">Other</button></div><div aria-labelledby="tab-0-RGViaWFuIChlZy4gVWJ1bnR1KQ==" class="sphinx-tabs-panel group-tab" id="panel-0-RGViaWFuIChlZy4gVWJ1bnR1KQ==" name="RGViaWFuIChlZy4gVWJ1bnR1KQ==" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt install python3-bloom python3-catkin-pkg
</pre></div>
</div>
</div><div aria-labelledby="tab-0-UlBNIChlZy4gUkhFTCk=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-UlBNIChlZy4gUkhFTCk=" name="UlBNIChlZy4gUkhFTCk=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo dnf install python3-bloom python3-catkin_pkg
</pre></div>
</div>
</div><div aria-labelledby="tab-0-T3RoZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-T3RoZXI=" name="T3RoZXI=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip3 install -U bloom catkin_pkg
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="set-up-a-personal-access-token">
<h2><a class="toc-backref" href="#id3">设置个人访问令牌</a><a class="headerlink" href="#set-up-a-personal-access-token" title="永久链接至标题"></a></h2>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>如果您的计算机上存在文件 <code class="docutils literal notranslate"><span class="pre">~/.config/bloom</span></code>，那么您很可能之前已经进行过这个操作，所以您应该跳过此部分。</p>
</div>
<p>在发布过程中，将执行多个需要密码验证的 HTTPS Git 操作。为了避免反复询问密码，将设置一个 <a class="reference external" href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token">个人访问令牌 (PAT)</a>。如果您的 GitHub 帐户已设置了多因素身份验证，<strong>必须</strong> 设置一个个人访问令牌。</p>
<p>按照以下步骤创建个人访问令牌：</p>
<ol class="arabic simple">
<li><p>登录 GitHub 并转到 <a class="reference external" href="https://github.com/settings/tokens">个人访问令牌</a>。</p></li>
<li><p>点击 <strong>生成新令牌</strong> 按钮。</p></li>
<li><p>将 <strong>Note</strong> 设置为类似于 <code class="docutils literal notranslate"><span class="pre">Bloom</span> <span class="pre">token</span></code> 的内容。</p></li>
<li><p>将 <strong>Expiration</strong> 设置为 <strong>无过期时间</strong>。</p></li>
<li><p>选中 <code class="docutils literal notranslate"><span class="pre">public_repo</span></code> 和 <code class="docutils literal notranslate"><span class="pre">workflow</span></code> 复选框。</p></li>
<li><p>点击 <strong>生成令牌</strong> 按钮。</p></li>
</ol>
<p>创建令牌后，您将返回到*个人访问令牌*页面。<strong>复制突出显示的绿色字母数字令牌</strong>。</p>
<p>将您的GitHub用户名和PAT保存到名为``~/.config/bloom``的新文件中，格式如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
   &quot;github_user&quot;: &quot;&lt;your-github-username&gt;&quot;,
   &quot;oauth_token&quot;: &quot;&lt;token-you-created-for-bloom&gt;&quot;
}
</pre></div>
</div>
</div>
<div class="section" id="ensure-repositories-are-up-to-date">
<h2><a class="toc-backref" href="#id4">确保存储库是最新的。</a><a class="headerlink" href="#ensure-repositories-are-up-to-date" title="永久链接至标题"></a></h2>
<p>请确保：</p>
<ul class="simple">
<li><p>您的代码仓库已托管在诸如GitHub之类的远程服务器上。</p></li>
<li><p>您在计算机上克隆了该代码仓库，并且处于正确的分支上。</p></li>
<li><p>远程代码仓库和您的克隆版本都是最新的。</p></li>
</ul>
</div>
<div class="section" id="updating-changelog">
<h2><a class="toc-backref" href="#id5">更新变更日志</a><a class="headerlink" href="#updating-changelog" title="永久链接至标题"></a></h2>
<p>为了您的用户和开发人员，请确保变更日志简明扼要且保持最新。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>catkin_generate_changelog
</pre></div>
</div>
<p>在编辑器中打开所有的 <code class="docutils literal notranslate"><span class="pre">CHANGELOG.rst</span></code> 文件。您会看到 <code class="docutils literal notranslate"><span class="pre">catkin_generate_changelog</span></code> 自动生成了一个即将发布的部分，其中包含了提交信息的注释：</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="gh">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="gh">Changelog for package your_package</span>
<span class="gh">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

<span class="gh">Forthcoming</span>
<span class="gh">-----------</span>
<span class="m">*</span> you can modify this commit message
<span class="m">*</span> and this
</pre></div>
</div>
<p>整理提交信息列表，以简明扼要地传达自上次发布以来软件包所做的重要更改，并**提交所有的 CHANGELOG.rst 文件。<a href="#id1"><span class="problematic" id="id2">**</span></a>不要修改 <code class="docutils literal notranslate"><span class="pre">Forthcoming</span></code> 标题。</p>
</div>
<div class="section" id="bump-the-package-version">
<h2><a class="toc-backref" href="#id6">提升软件包版本</a><a class="headerlink" href="#bump-the-package-version" title="永久链接至标题"></a></h2>
<p>每个软件包的发布版本必须具有比上一个发布版本更高的唯一版本号。运行：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>catkin_prepare_release
</pre></div>
</div>
<p>执行以下操作：</p>
<ol class="arabic simple">
<li><p>在``package.xml``中增加软件包版本</p></li>
<li><p>在``CHANGELOG.rst``文件中用``版本（日期）``（例如``0.0.1（2022-01-08）``）替换``即将发布``标题</p></li>
<li><p>提交这些更改</p></li>
<li><p>创建一个标签（例如``0.0.1``）</p></li>
<li><p>将更改和标签推送到您的远程存储库</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>默认情况下，软件包的补丁版本会递增，例如从``0.0.0``增加到``0.0.1``。若要递增次要版本或主要版本，请运行``catkin_prepare_release --bump minor``或``catkin_prepare_release --bump major``命令。有关详细信息，请参阅``catkin_prepare_release --help``。</p>
</div>
</div>
<div class="section" id="bloom-release">
<h2><a class="toc-backref" href="#id7">Bloom发布</a><a class="headerlink" href="#bloom-release" title="永久链接至标题"></a></h2>
<p>运行以下命令，将``my_repo``替换为包含软件包的存储库名称：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bloom-release --rosdistro humble my_repo
</pre></div>
</div>
<p>Bloom将自动为您创建针对`rosdistro &lt;<a class="reference external" href="https://github.com/ros/rosdistro">https://github.com/ros/rosdistro</a>&gt;`_的拉取请求。</p>
</div>
<div class="section" id="next-steps">
<h2><a class="toc-backref" href="#id8">下一步</a><a class="headerlink" href="#next-steps" title="永久链接至标题"></a></h2>
<p>一旦您的拉取请求被提交，通常在一两天内，rosdistro的维护人员将会审查并合并您的拉取请求。如果您的软件包构建成功，在24-48小时内，您的软件包将会在**ros-testing**存储库中可用，您可以在那里:doc:<a class="reference internal" href="../../Installation/Testing.html"><span class="doc">测试预发布的二进制文件</span></a>。</p>
<p>大约每两到四周，发行版的发布经理会手动将ros-testing的内容与主要ROS仓库同步。这时候你的软件包才会真正对整个ROS社区可用。要获取下一次同步的更新信息，请订阅ROS Discourse上的“打包和发布管理”分类：&lt;<a class="reference external" href="https://discourse.ros.org/c/release/16">https://discourse.ros.org/c/release/16</a>&gt;。</p>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>