<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>How-To-Guides/Overriding-QoS-Policies-For-Recording-And-Playback</title>
</head>
<body>
  <div class="section" id="rosbag2-overriding-qos-policies">
<span id="ros2bag-qos-override"></span><h1>rosbag2：覆盖 QoS 策略 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=627">[627]</a><a class="headerlink" href="#rosbag2-overriding-qos-policies" title="永久链接至标题"></a></h1>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>目标：<a href="#id3"><span class="problematic" id="id4">**</span></a>为录制和播放覆盖 Ros2Bag 的 QoS 配置文件设置。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=628">[628]</a></p>
<div class="contents local topic" id="contents">
<p class="topic-title">内容 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=362">[362]</a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id1">背景 [493]</a></p></li>
<li><p><a class="reference internal" href="#using-qos-overrides" id="id2">使用QoS配置文件覆盖 [631]</a></p></li>
<li><p><a class="reference internal" href="#example" id="id3">示例 [506]</a></p></li>
</ul>
</div>
<div class="section" id="background">
<h2>背景 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=493">[493]</a><a class="headerlink" href="#background" title="永久链接至标题"></a></h2>
<p>随着DDS在ROS 2中的引入，在记录和回放数据时需要考虑发布者/订阅者节点的服务质量（QoS）兼容性。有关QoS工作原理的更多细节可以在此处找到：doc:<a class="reference internal" href="../Concepts/About-Quality-of-Service-Settings.html"><span class="doc">这里</span></a>。对于本指南而言，只需知道可靠性和持久性策略会影响发布者/订阅者是否兼容并能够接收彼此的数据即可。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=629">[629]</a></p>
<p>Ros2Bag在记录/播放主题数据时会根据需要调整其请求/提供的QoS配置文件，以防止丢失消息。在回放过程中，Ros2bag还会尝试保持主题最初提供的策略。在某些情况下，可能需要指定显式的QoS配置文件设置，以便Ros2Bag能够记录/播放主题。可以通过使用``--qos-profile-overrides-path``标志在CLI中指定这些QoS配置文件覆盖。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=630">[630]</a></p>
</div>
<div class="section" id="using-qos-overrides">
<h2>使用QoS配置文件覆盖 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=631">[631]</a><a class="headerlink" href="#using-qos-overrides" title="永久链接至标题"></a></h2>
<p>配置文件覆盖的YAML模式是一个包含主题名称的字典，每个QoS策略都有键值对： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=632">[632]</a></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">topic_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">str</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">qos_policy_name</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">str</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span><span class="w"></span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">qos_duration</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">object</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">sec</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span><span class="w"></span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">nsec</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span><span class="w"></span>
</pre></div>
</div>
<p>如果未指定策略值，该值将回退到Ros2Bag使用的默认值。如果您指定了基于持续时间的策略，例如``deadline``或``lifespan``，则需要同时指定秒和纳秒。策略值由策略的短键确定，可以使用``ros2topic``命令的动词（如``ros2 topic pub --help``）找到。下面列出了所有值以供参考。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=633">[633]</a></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">history</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">keep_all</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">keep_last</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="nt">depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span><span class="w"></span>
<span class="nt">reliability</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">system_default</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">reliable</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">best_effort</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">unknown</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="nt">durability</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">system_default</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">transient_local</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">volatile</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">unknown</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="nt">deadline</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">sec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span><span class="w"></span>
<span class="w">  </span><span class="nt">nsec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span><span class="w"></span>
<span class="nt">lifespan</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">sec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span><span class="w"></span>
<span class="w">  </span><span class="nt">nsec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span><span class="w"></span>
<span class="nt">liveliness</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">system_default</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">automatic</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">manual_by_topic</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">unknown</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="nt">liveliness_lease_duration</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">sec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span><span class="w"></span>
<span class="w">  </span><span class="nt">nsec</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">int</span><span class="w"></span>
<span class="nt">avoid_ros_namespace_conventions</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">true</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">false</span><span class="p p-Indicator">]</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="example">
<h2>示例 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=506">[506]</a><a class="headerlink" href="#example" title="永久链接至标题"></a></h2>
<p>考虑一个提供``transient_local``持续性策略的主题``/talker``。ROS 2发布者默认情况下请求``volatile``持续性。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=634">[634]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 topic pub -r 0.1 --qos-durability transient_local /talker std_msgs/String &quot;data: Hello World&quot;</span>
</pre></div>
</div>
<p>为了让Ros2Bag记录数据，我们需要覆盖该特定主题的记录策略，操作如下： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=635">[635]</a></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># durability_override.yaml</span><span class="w"></span>
<span class="nt">/talker</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">durability</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">transient_local</span><span class="w"></span>
<span class="w">  </span><span class="nt">history</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">keep_all</span><span class="w"></span>
</pre></div>
</div>
<p>然后从命令行调用它： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=636">[636]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 bag record -a -o my_bag --qos-profile-overrides-path durability_override.yaml</span>
</pre></div>
</div>
<p>如果我们想使用不同的可靠性策略回放bag文件，我们可以这样指定； <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=637">[637]</a></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># reliability_override.yaml</span><span class="w"></span>
<span class="nt">/talker</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">reliability</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">best_effort</span><span class="w"></span>
<span class="w">  </span><span class="nt">history</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">keep_all</span><span class="w"></span>
</pre></div>
</div>
<p>然后从命令行调用它： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=636">[636]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 bag play --qos-profile-overrides-path reliability_override.yaml my_bag</span>
</pre></div>
</div>
<p>我们可以使用``ros2 topic``查看结果 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=638">[638]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 topic echo --qos-reliability best_effort /talker std_msgs/String</span>
</pre></div>
</div>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>