<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>How-To-Guides/Ament-CMake-Python-Documentation</title>
</head>
<body>
  <div class="section" id="ament-cmake-python-user-documentation">
<h1>ament_cmake_python 用户文档 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=158">[158]</a><a class="headerlink" href="#ament-cmake-python-user-documentation" title="永久链接至标题"></a></h1>
<p><code class="docutils literal notranslate"><span class="pre">ament_cmake_python</span></code> 是一个为包含 Python 代码的 <code class="docutils literal notranslate"><span class="pre">ament_cmake</span></code> 构建类型的软件包提供 CMake 函数的软件包。有关更多信息，请参阅 <a class="reference internal" href="Ament-CMake-Documentation.html"><span class="doc">ament_cmake 用户文档</span></a>。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=159">[159]</a></p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>在大多数情况下，纯 Python 包应使用 <code class="docutils literal notranslate"><span class="pre">ament_python</span></code> 构建类型。要创建一个 <code class="docutils literal notranslate"><span class="pre">ament_python</span></code> 包，请参阅 <a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html"><span class="doc">创建你的第一个 ROS 2 包</span></a>。<code class="docutils literal notranslate"><span class="pre">ament_cmake_python</span></code> 仅在不可能的情况下才应使用，例如在混合使用 C/C++ 和 Python 代码时。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=160">[160]</a></p>
</div>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">目录 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=7">[]</a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#basics" id="id1">基础知识 []</a></p>
<ul>
<li><p><a class="reference internal" href="#basic-project-outline" id="id2">基本项目概述 [10]</a></p></li>
<li><p><a class="reference internal" href="#using-ament-cmake-python" id="id3">使用ament_cmake_python [163]</a></p></li>
<li><p><a class="reference internal" href="#using-ament-cmake-pytest" id="id4">使用 ament_cmake_pytest [170]</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="basics">
<h2>基础知识 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=8">[]</a><a class="headerlink" href="#basics" title="永久链接至标题"></a></h2>
<div class="section" id="basic-project-outline">
<h3>基本项目概述 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=10">[10]</a><a class="headerlink" href="#basic-project-outline" title="永久链接至标题"></a></h3>
<p>具有``ament_cmake``构建类型，并使用``ament_cmake_python``的名为&quot;my_project&quot;的软件包的概要如下： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=161">[161]</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
└── my_project
    ├── CMakeLists.txt
    ├── package.xml
    └── my_project
        ├── __init__.py
        └── my_script.py
</pre></div>
</div>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>__init__.py``文件可以为空，但需要它来`使Python将包含它的目录视为软件包 &lt;<a class="reference external" href="https://docs.python.org/3/tutorial/modules.html#packages">https://docs.python.org/3/tutorial/modules.html#packages</a>&gt;`__。在``CMakeLists.txt``旁边还可以有一个包含C/C++代码的``src``或``include``目录。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=162">[162]</a></p>
</div>
<div class="section" id="using-ament-cmake-python">
<h3>使用ament_cmake_python <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=163">[163]</a><a class="headerlink" href="#using-ament-cmake-python" title="永久链接至标题"></a></h3>
<p>该软件包必须在其``package.xml``中声明对``ament_cmake_python``的依赖关系。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=164">[164]</a></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;buildtool_depend&gt;</span>ament_cmake_python<span class="nt">&lt;/buildtool_depend&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> 应包含： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=165">[165]</a></p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">ament_cmake_python</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="c"># ...</span>
<span class="nb">ament_python_install_package</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ament_python_install_package()</span></code> 的参数是与包含 Python 文件的 <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> 并列的目录的名称。在这种情况下，它是 <code class="docutils literal notranslate"><span class="pre">my_project</span></code> 或者 <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}</span></code>。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=166">[166]</a></p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>在同一个 CMake 项目中调用 <code class="docutils literal notranslate"><span class="pre">rosidl_generate_interfaces</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ament_python_install_package</span></code> 是不起作用的。请参阅此 <a class="reference external" href="https://github.com/ros2/rosidl_python/issues/141">Github 问题</a> 了解更多信息。最佳实践是将消息生成分离到一个单独的包中。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=167">[167]</a></p>
</div>
<p>然后，另一个正确依赖于 <code class="docutils literal notranslate"><span class="pre">my_project</span></code> 的 Python 包可以将其作为普通的 Python 模块使用： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=168">[168]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">my_project.my_script</span> <span class="kn">import</span> <span class="n">my_function</span>
</pre></div>
</div>
<p>假设 <code class="docutils literal notranslate"><span class="pre">my_script.py</span></code> 包含一个名为 <code class="docutils literal notranslate"><span class="pre">my_function()</span></code> 的函数。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=169">[169]</a></p>
</div>
<div class="section" id="using-ament-cmake-pytest">
<h3>使用 ament_cmake_pytest <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=170">[170]</a><a class="headerlink" href="#using-ament-cmake-pytest" title="永久链接至标题"></a></h3>
<p>包 <code class="docutils literal notranslate"><span class="pre">ament_cmake_pytest</span></code> 用于使测试在 <code class="docutils literal notranslate"><span class="pre">cmake</span></code> 中可被发现。包必须在其 <code class="docutils literal notranslate"><span class="pre">package.xml</span></code> 中声明对 <code class="docutils literal notranslate"><span class="pre">ament_cmake_pytest</span></code> 的测试依赖。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=171">[171]</a></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;test_depend&gt;</span>ament_cmake_pytest<span class="nt">&lt;/test_depend&gt;</span>
</pre></div>
</div>
<p>假设该包的文件结构如下所示，其中的测试位于 <code class="docutils literal notranslate"><span class="pre">tests</span></code> 文件夹中。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=172">[172]</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── CMakeLists.txt
├── my_project
│   └── my_script.py
├── package.xml
└── tests
    ├── test_a.py
    └── test_b.py
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> 应包含： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=165">[165]</a></p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">if</span><span class="p">(</span><span class="s">BUILD_TESTING</span><span class="p">)</span>
<span class="w">  </span><span class="nb">find_package</span><span class="p">(</span><span class="s">ament_cmake_pytest</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="w">  </span><span class="nb">set</span><span class="p">(</span><span class="s">_pytest_tests</span>
<span class="w">    </span><span class="s">tests/test_a.py</span>
<span class="w">    </span><span class="s">tests/test_b.py</span>
<span class="w">    </span><span class="c"># Add other test files here</span>
<span class="w">  </span><span class="p">)</span>
<span class="w">  </span><span class="nb">foreach</span><span class="p">(</span><span class="s">_test_path</span><span class="w"> </span><span class="o">${</span><span class="nv">_pytest_tests</span><span class="o">}</span><span class="p">)</span>
<span class="w">    </span><span class="nb">get_filename_component</span><span class="p">(</span><span class="s">_test_name</span><span class="w"> </span><span class="o">${</span><span class="nv">_test_path</span><span class="o">}</span><span class="w"> </span><span class="s">NAME_WE</span><span class="p">)</span>
<span class="w">    </span><span class="nb">ament_add_pytest_test</span><span class="p">(</span><span class="o">${</span><span class="nv">_test_name</span><span class="o">}</span><span class="w"> </span><span class="o">${</span><span class="nv">_test_path</span><span class="o">}</span>
<span class="w">      </span><span class="s">APPEND_ENV</span><span class="w"> </span><span class="s">PYTHONPATH=</span><span class="o">${</span><span class="nv">CMAKE_CURRENT_BINARY_DIR</span><span class="o">}</span>
<span class="w">      </span><span class="s">TIMEOUT</span><span class="w"> </span><span class="s">60</span>
<span class="w">      </span><span class="s">WORKING_DIRECTORY</span><span class="w"> </span><span class="o">${</span><span class="nv">CMAKE_SOURCE_DIR</span><span class="o">}</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">  </span><span class="nb">endforeach</span><span class="p">()</span>
<span class="nb">endif</span><span class="p">()</span>
</pre></div>
</div>
<p>与支持自动测试发现的ament_python的使用相比，ament_cmake_pytest必须使用每个测试文件的路径进行调用。超时时间可以根据需要缩短。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=173">[173]</a></p>
<p>现在，您可以使用:doc:<a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=174">标准的colcon测试命令&lt;../Tutorials/Intermediate/Testing/CLI&gt;`来调用您的测试。 `[174]</a></p>
</div>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>