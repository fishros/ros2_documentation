<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>How-To-Guides/Cross-compilation</title>
</head>
<body>
  <div class="section" id="cross-compilation">
<h1>交叉编译 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=207">[207]</a><a class="headerlink" href="#cross-compilation" title="永久链接至标题"></a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">目录 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=7">[]</a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#cross-compile-tool" id="id1">交叉编译工具 [210]</a></p></li>
<li><p><a class="reference internal" href="#legacy-tool-instructions" id="id2">传统工具说明 [212]</a></p>
<ul>
<li><p><a class="reference internal" href="#cmake-toolchain-file" id="id3">CMake 工具链文件 [220]</a></p></li>
<li><p><a class="reference internal" href="#target-file-system" id="id4">目标文件系统 [237]</a></p></li>
<li><p><a class="reference internal" href="#build-process" id="id5">构建过程 [244]</a></p></li>
<li><p><a class="reference internal" href="#cross-compiling-examples-for-arm" id="id6">为 Arm 进行交叉编译示例 [247]</a></p></li>
<li><p><a class="reference internal" href="#automated-cross-compilation" id="id7">自动交叉编译 [277]</a></p></li>
<li><p><a class="reference internal" href="#cross-compiling-against-a-pre-built-ros-2" id="id8">针对预构建的 ROS 2 进行交叉编译 [283]</a></p></li>
<li><p><a class="reference internal" href="#run-on-the-target" id="id9">在目标设备上运行 [290]</a></p></li>
</ul>
</li>
</ul>
</div>
<p>有关交叉编译的背景信息，请参阅 <a class="reference internal" href="../Concepts/About-Cross-Compilation.html"><span class="doc">概念文章</span></a>。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=208">[208]</a></p>
<p>本文档为您提供有关如何交叉编译ROS 2软件栈的详细信息，以及提供基于Arm核心的系统的交叉编译示例。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=209">[209]</a></p>
<div class="section" id="cross-compile-tool">
<h2>交叉编译工具 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=210">[210]</a><a class="headerlink" href="#cross-compile-tool" title="永久链接至标题"></a></h2>
<p>使用该工具的说明在 <a class="reference external" href="https://github.com/ros-tooling/cross_compile">cross_compile package</a> 中。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=211">[211]</a></p>
</div>
<div class="section" id="legacy-tool-instructions">
<h2>传统工具说明 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=212">[212]</a><a class="headerlink" href="#legacy-tool-instructions" title="永久链接至标题"></a></h2>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>只有在使用旧版本（发布版 <a class="reference external" href="https://github.com/ros-tooling/cross_compile/releases/tag/0.0.1">0.0.1</a>）的交叉编译工具时才按照以下步骤操作。对于其他情况，请参考 <a class="reference external" href="https://github.com/ros-tooling/cross_compile">cross_compile</a> 包文档。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=213">[213]</a></p>
</div>
<dl class="simple">
<dt>尽管ROS 2是一个具有多个依赖项的丰富软件堆栈，但它主要使用两种不同类型的软件包： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=214">[214]</a></dt><dd><ul class="simple">
<li><p>基于Python的软件，不需要进行交叉编译。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=215">[215]</a></p></li>
<li><p>基于CMake的软件，提供了进行交叉编译的机制。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=216">[216]</a></p></li>
</ul>
</dd>
</dl>
<p>此外，ROS 2 软件栈使用 <a class="reference external" href="https://github.com/colcon/colcon-core">Colcon</a> 构建，它提供了一种机制，可以将参数传递给用于构建 ROS 2 发行版中每个包/库的单独构建的 CMake 实例。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=217">[217]</a></p>
<p>在本地构建 ROS 2 时，开发人员需要在编译 ROS 2 发行版中的包之前下载所有的依赖项（例如 Python 和其他库）。在交叉编译时，也需要相同的方法。开发人员必须首先拥有目标系统的文件系统，并已安装所有的依赖项。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=218">[218]</a></p>
<p>本文档的后续部分详细说明了使用 <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/cmake-toolchains.7.html">cmake-toolchains</a> 和 <a class="reference external" href="https://cmake.org/cmake/help/latest/variable/CMAKE_SYSROOT.html">CMAKE_SYSROOT</a> 功能进行 ROS 2 交叉编译的方法。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=219">[219]</a></p>
<div class="section" id="cmake-toolchain-file">
<h3>CMake 工具链文件 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=220">[220]</a><a class="headerlink" href="#cmake-toolchain-file" title="永久链接至标题"></a></h3>
<p>CMake工具链文件是用于配置CMake进行交叉编译的文件，它定义了变量。基本条目如下： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=221">[221]</a></p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_SYSTEM_NAME</span></code>：目标平台，例如``linux`` <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=222">[222]</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_SYSTEM_PROCESSOR</span></code>：目标架构，例如``aarch64``或``arm`` <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=223">[223]</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_SYSROOT</span></code>：目标文件系统的路径 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=224">[224]</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_C_COMPILER</span></code>：C交叉编译器，例如``aarch64-linux-gnu-gcc`` <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=225">[225]</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_CXX_COMPILER</span></code>：C++交叉编译器，例如``aarch64-linux-gnu-g++`` <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=226">[226]</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_FIND_ROOT_PATH</span></code>：<a href="#id1"><span class="problematic" id="id2">``</span></a>find_*``命令用来查找文件系统的替代路径 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=227">[227]</a></p></li>
</ul>
</div></blockquote>
<p>在进行ROS 2交叉编译时，需要设置以下选项： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=228">[228]</a></p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_FIND_ROOT_PATH</span></code>：<a href="#id1"><span class="problematic" id="id2">``</span></a>find_*``命令使用的替代路径，用于指定ROS 2 <a href="#id3"><span class="problematic" id="id4">``</span></a>/install``文件夹的路径 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=229">[229]</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_FIND_ROOT_PATH_MODE_*</span></code>：程序、包、库和包含文件的搜索策略，通常有：<a href="#id1"><span class="problematic" id="id2">``</span></a>NEVER``（在主机文件系统上查找）、<a href="#id3"><span class="problematic" id="id4">``</span></a>ONLY``（在sysroot上查找）和``BOTH``（在sysroot和主机文件系统上都查找） <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=230">[230]</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PYTHON_SOABI</span></code>：由ROS 2生成的Python库的索引名称，例如``cpython-36m-aarch64-linux-gnu`` <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=231">[231]</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">THREADS_PTHREAD_ARG</span> <span class="pre">&quot;0&quot;</span> <span class="pre">CACHE</span> <span class="pre">STRING</span> <span class="pre">&quot;Result</span> <span class="pre">from</span> <span class="pre">TRY_RUN&quot;</span> <span class="pre">FORCE</span></code>：将``TRY_RUN``命令的结果强制为0（成功），因为二进制文件无法在主机系统上运行。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=232">[232]</a></p></li>
</ul>
</div></blockquote>
<p>将工具链文件提供给CMake时，使用``-DCMAKE_TOOLCHAIN_FILE=path/to/file``参数。这还将把``CMAKE_CROSSCOMPILING``变量设置为``true``，软件构建时可以使用该变量。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=233">[233]</a></p>
<p>对于ROS 2来说，<a href="#id1"><span class="problematic" id="id2">``</span></a>CMAKE_SYSROOT``非常重要，因为软件包需要许多依赖项（例如python、openssl、opencv、poco、eigen3等）。将``CMAKE_SYSROOT``设置为安装了所有依赖项的目标文件系统，将允许CMake在交叉编译过程中找到它们。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=234">[234]</a></p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>您可以在CMake的 <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/cmake-toolchains.7.html">文档</a> 页面上找到更多信息。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=235">[235]</a></p>
</div>
<p>在下载ROS 2源代码时，存储库`ros-tooling/cross_compile/cmake-toolchains &lt;<a class="reference external" href="https://github.com/ros-tooling/cross_compile">https://github.com/ros-tooling/cross_compile</a>&gt;`__中提供了一个通用的工具链文件，可以单独下载。有关如何使用它的更多示例，请参阅`Cross-compiling examples for Arm`_部分。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=236">[236]</a></p>
</div>
<div class="section" id="target-file-system">
<h3>目标文件系统 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=237">[237]</a><a class="headerlink" href="#target-file-system" title="永久链接至标题"></a></h3>
<p>如前所述，ROS 2需要不同的库文件来进行交叉编译。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=238">[238]</a></p>
<dl class="simple">
<dt>获取文件系统有多种方式： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=239">[239]</a></dt><dd><ul class="simple">
<li><p>下载预构建的映像 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=240">[240]</a></p></li>
<li><p>在目标设备上安装依赖项并导出文件系统（例如使用sshfs） <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=241">[241]</a></p></li>
<li><p>使用qemu + docker（或chroot）在主机上生成文件系统。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=242">[242]</a></p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>您可以在接下来的`Cross-compiling examples for Arm`_部分找到有关如何使用Docker + qemu的信息。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=243">[243]</a></p>
</div>
</div>
<div class="section" id="build-process">
<h3>构建过程 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=244">[244]</a><a class="headerlink" href="#build-process" title="永久链接至标题"></a></h3>
<p>构建过程类似于本地编译，唯一的区别是给 <code class="docutils literal notranslate"><span class="pre">Colcon</span></code> 添加了一个额外的参数来指定 <code class="docutils literal notranslate"><span class="pre">toolchain-file</span></code>： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=245">[245]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>colcon build --merge-install <span class="se">\</span>
    --cmake-force-configure <span class="se">\</span>
    --cmake-args <span class="se">\</span>
        -DCMAKE_TOOLCHAIN_FILE<span class="o">=</span><span class="s2">&quot;&lt;path_to_toolchain/toolchainfile.cmake&gt;&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">toolchain-file</span></code> 提供给 CMake 有关 <code class="docutils literal notranslate"><span class="pre">交叉编译器</span></code> 和 <code class="docutils literal notranslate"><span class="pre">目标文件系统</span></code> 的信息。<code class="docutils literal notranslate"><span class="pre">Colcon</span></code> 将在 ROS 2 的每个软件包上使用给定的 toolchain-file 来调用 CMake。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=246">[246]</a></p>
</div>
<div class="section" id="cross-compiling-examples-for-arm">
<h3>为 Arm 进行交叉编译示例 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=247">[247]</a><a class="headerlink" href="#cross-compiling-examples-for-arm" title="永久链接至标题"></a></h3>
<p>在 <a class="reference internal" href="../Installation/Alternatives/Ubuntu-Development-Setup.html"><span class="doc">下载 ROS 2 源代码</span></a> 后，您可以通过 <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/ros-tooling/cross_compile.git</span> <span class="pre">-b</span> <span class="pre">0.0.1</span> <span class="pre">src/ros2/cross_compile</span></code> 将交叉编译资产添加到工作空间。这些是关于如何为 Arm 内核进行交叉编译的可行示例。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=248">[248]</a></p>
<dl class="simple">
<dt>支持以下目标： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=249">[249]</a></dt><dd><ul class="simple">
<li><p>Ubuntu-arm64：适用于任何基于ARMv8-A的系统。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=250">[250]</a></p></li>
<li><p>Ubuntu-armhf：适用于任何现代基于ARMv7-A的系统。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=251">[251]</a></p></li>
</ul>
</dd>
<dt>以下是主要步骤： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=252">[252]</a></dt><dd><ul class="simple">
<li><p>安装开发工具 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=253">[253]</a></p></li>
<li><p>下载 ROS 2 源代码 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=254">[254]</a></p></li>
<li><p>下载 ROS 2 交叉编译资产 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=255">[255]</a></p></li>
<li><p>准备 sysroot <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=256">[256]</a></p></li>
<li><p>交叉编译ROS 2软件栈 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=257">[257]</a></p></li>
</ul>
</dd>
</dl>
<p>下面的章节详细解释了每个步骤。如果需要快速设置，请参阅`Automated Cross-compilation`_。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=258">[258]</a></p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>这些步骤在Ubuntu 18.04（Bionic）上进行了测试 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=259">[259]</a></p>
</div>
<div class="section" id="install-development-tools">
<h4>1. 安装开发工具 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=260">[260]</a><a class="headerlink" href="#install-development-tools" title="永久链接至标题"></a></h4>
<p>这个步骤与本地构建类似。不同之处在于一些库和工具不需要，因为它们将在sysroot中。需要以下软件包： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=261">[261]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt update <span class="o">&amp;&amp;</span> sudo apt install -y <span class="se">\</span>
    cmake <span class="se">\</span>
    git <span class="se">\</span>
    wget <span class="se">\</span>
    python3-pip <span class="se">\</span>
    qemu-user-static <span class="se">\</span>
    g++-aarch64-linux-gnu <span class="se">\</span>
    g++-arm-linux-gnueabihf <span class="se">\</span>
    pkg-config-aarch64-linux-gnu

python3 -m pip install -U <span class="se">\</span>
    vcstool <span class="se">\</span>
    colcon-common-extensions
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>您可以使用pip安装vcstool和colcon-common-extensions。这意味着您不需要添加额外的apt仓库。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=262">[262]</a></p>
</div>
<p>Docker用于构建目标环境。请按照官方 <a class="reference external" href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">文档</a> 进行安装。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=263">[263]</a></p>
</div>
<div class="section" id="download-ros-2-source-code">
<h4>2. 下载ROS 2源代码 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=264">[264]</a><a class="headerlink" href="#download-ros-2-source-code" title="永久链接至标题"></a></h4>
<p>然后创建一个工作空间并下载ROS 2源代码： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=265">[265]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir -p ~/cc_ws/ros2_ws/src
<span class="nb">cd</span> ~/cc_ws/ros2_ws
wget https://raw.githubusercontent.com/ros2/ros2/release-latest/ros2.repos
vcs-import src &lt; ros2.repos
git clone https://github.com/ros-tooling/cross_compile.git -b <span class="m">0</span>.0.1 src/ros2/cross_compile
<span class="nb">cd</span> ..
</pre></div>
</div>
</div>
<div class="section" id="prepare-the-sysroot">
<h4>3. 准备 sysroot <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=266">[266]</a><a class="headerlink" href="#prepare-the-sysroot" title="永久链接至标题"></a></h4>
<p>使用Docker和qemu构建带有所有ROS 2依赖项的arm Ubuntu镜像：将``qemu-static``二进制文件复制到工作空间。它将用于使用Docker在目标文件系统上安装ROS 2依赖项。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=267">[267]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir qemu-user-static
cp /usr/bin/qemu-*-static qemu-user-static
</pre></div>
</div>
<p>ROS 2的标准:doc:<code class="xref any docutils literal notranslate"><span class="pre">设置</span> <span class="pre">&lt;../Installation/Alternatives/Ubuntu-Development-Setup&gt;`过程在arm</span> <span class="pre">docker内运行。这得益于``qemu-static`</span></code>，它将模拟一个arm机器。使用的基础镜像是来自Docker Hub的Ubuntu Bionic。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=268">[268]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker build -t arm_ros2:latest -f ros2_ws/src/ros2/cross_compile/sysroot/Dockerfile_ubuntu_arm .
docker run --name arm_sysroot arm_ros2:latest
</pre></div>
</div>
<p>将生成的容器导出为tarball文件并解压缩： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=269">[269]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker container <span class="nb">export</span> -o sysroot_docker.tar arm_sysroot
mkdir sysroot_docker
tar -C sysroot_docker -xf sysroot_docker.tar lib usr opt etc
docker rm arm_sysroot
</pre></div>
</div>
<p>此容器稍后可用作虚拟目标，以运行创建的文件系统和运行演示代码。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=270">[270]</a></p>
</div>
<div class="section" id="build">
<h4>4. 构建 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=271">[271]</a><a class="headerlink" href="#build" title="永久链接至标题"></a></h4>
<p>设置通用工具链文件使用的变量 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=272">[272]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">TARGET_ARCH</span><span class="o">=</span>aarch64
<span class="nb">export</span> <span class="nv">TARGET_TRIPLE</span><span class="o">=</span>aarch64-linux-gnu
<span class="nb">export</span> <span class="nv">CC</span><span class="o">=</span>/usr/bin/<span class="nv">$TARGET_TRIPLE</span>-gcc
<span class="nb">export</span> <span class="nv">CXX</span><span class="o">=</span>/usr/bin/<span class="nv">$TARGET_TRIPLE</span>-g++
<span class="nb">export</span> <span class="nv">CROSS_COMPILE</span><span class="o">=</span>/usr/bin/<span class="nv">$TARGET_TRIPLE</span>-
<span class="nb">export</span> <span class="nv">SYSROOT</span><span class="o">=</span>~/cc_ws/sysroot_docker
<span class="nb">export</span> <span class="nv">ROS2_INSTALL_PATH</span><span class="o">=</span>~/cc_ws/ros2_ws/install
<span class="nb">export</span> <span class="nv">PYTHON_SOABI</span><span class="o">=</span>cpython-36m-<span class="nv">$TARGET_TRIPLE</span>
</pre></div>
</div>
<p>以下软件包在交叉编译过程中仍然导致错误（正在调查中），现在必须禁用它们。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=273">[273]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>touch <span class="se">\</span>
    ros2_ws/src/ros2/rviz/COLCON_IGNORE <span class="se">\</span>
    ros2_ws/src/ros-visualization/COLCON_IGNORE
</pre></div>
</div>
<p>预构建的 <code class="docutils literal notranslate"><span class="pre">Poco</span></code> 存在一个已知问题，它在主机系统上搜索 <code class="docutils literal notranslate"><span class="pre">libz</span></code> 和 <code class="docutils literal notranslate"><span class="pre">libpcre</span></code> 而不是 SYSROOT。暂时的解决方法是，请将这两个库链接到主机的文件系统中。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=274">[274]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir -p /usr/lib/<span class="nv">$TARGET_TRIPLE</span>
ln -s <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/sysroot_docker/lib/<span class="nv">$TARGET_TRIPLE</span>/libz.so.1 /usr/lib/<span class="nv">$TARGET_TRIPLE</span>/libz.so
ln -s <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/sysroot_docker/lib/<span class="nv">$TARGET_TRIPLE</span>/libpcre.so.3 /usr/lib/<span class="nv">$TARGET_TRIPLE</span>/libpcre.so
</pre></div>
</div>
<p>然后，使用 colcon 指定工具链文件启动构建： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=275">[275]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ros2_ws

colcon build --merge-install <span class="se">\</span>
    --cmake-force-configure <span class="se">\</span>
    --cmake-args <span class="se">\</span>
        -DCMAKE_VERBOSE_MAKEFILE:BOOL<span class="o">=</span>ON <span class="se">\</span>
        -DCMAKE_TOOLCHAIN_FILE<span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">/src/ros2/cross_compile/cmake-toolchains/generic_linux.cmake&quot;</span> <span class="se">\</span>
        -DSECURITY<span class="o">=</span>ON
</pre></div>
</div>
<p>完成！安装目录和构建目录将包含交叉编译的资源。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=276">[276]</a></p>
</div>
</div>
<div class="section" id="automated-cross-compilation">
<h3>自动交叉编译 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=277">[277]</a><a class="headerlink" href="#automated-cross-compilation" title="永久链接至标题"></a></h3>
<p>上述所有步骤也包含在一个Dockerfile中，可以用于自动化/持续集成。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=278">[278]</a></p>
<p>首先，下载Dockerfile并构建镜像： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=279">[279]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget https://raw.githubusercontent.com/ros-tooling/cross_compile/master/Dockerfile_cc_for_arm
docker build -t ros2-crosscompiler:latest - &lt; Dockerfile_cc_for_arm
</pre></div>
</div>
<p>现在运行镜像：（这将需要一些时间！） <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=280">[280]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -it --name ros2_cc <span class="se">\</span>
    -v /var/run/docker.sock:/var/run/docker.sock <span class="se">\</span>
    ros2-crosscompiler:latest
</pre></div>
</div>
<p>..注意:: 使用 -v /var/run/docker.sock 允许我们在 Docker 中使用 Docker。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=281">[281]</a></p>
<p>构建的结果将在 <code class="docutils literal notranslate"><span class="pre">ros2_ws</span></code> 目录中，可以使用以下命令导出： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=282">[282]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker cp ros2_cc:/root/cc_ws/ros2_ws .
</pre></div>
</div>
</div>
<div class="section" id="cross-compiling-against-a-pre-built-ros-2">
<h3>针对预构建的 ROS 2 进行交叉编译 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=283">[283]</a><a class="headerlink" href="#cross-compiling-against-a-pre-built-ros-2" title="永久链接至标题"></a></h3>
<p>您可以将您的软件包与预构建的 ROS 2 进行交叉编译。步骤与之前的“为 ARM 进行交叉编译示例”_ 部分相似，只需进行以下修改： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=284">[284]</a></p>
<p>不需要下载ROS 2堆栈，只需将您的软件包（在此示例中是ros2 examples）和交叉编译资产填充到您的工作空间中： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=285">[285]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir -p ~/cc_ws/ros2_ws/src
<span class="nb">cd</span> ~/cc_ws/ros2_ws/src
git clone https://github.com/ros2/examples.git
git clone https://github.com/ros-tooling/cross_compile.git -b <span class="m">0</span>.0.1
<span class="nb">cd</span> ..
</pre></div>
</div>
<p>按照`3. 准备sysroot`_中所述的方法生成和导出文件系统，但使用提供的``Dockerfile_ubuntu_arm64_prebuilt``。这些``_prebuilt`` Dockerfile将使用:doc:<a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=286">二进制包 &lt;../Installation/Ubuntu-Install-Debians&gt;`来安装ROS 2，而不是从源代码构建。 `[286]</a></p>
<p>修改环境变量``ROS2_INSTALL_PATH``，指向安装目录： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=287">[287]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ROS2_INSTALL_PATH</span><span class="o">=</span>~/cc_ws/sysroot_docker/opt/ros/crystal
</pre></div>
</div>
<p>在目标文件系统上调用``setup.bash``脚本： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=288">[288]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> <span class="nv">$ROS2_INSTALL_PATH</span>/setup.bash
</pre></div>
</div>
<p>然后，使用``Colcon``指定``toolchain-file``来开始构建： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=289">[289]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>colcon build <span class="se">\</span>
    --merge-install <span class="se">\</span>
    --cmake-force-configure <span class="se">\</span>
    --cmake-args <span class="se">\</span>
        -DCMAKE_VERBOSE_MAKEFILE:BOOL<span class="o">=</span>ON <span class="se">\</span>
        -DCMAKE_TOOLCHAIN_FILE<span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">/src/cross_compile/cmake-toolchains/generic_linux.cmake&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="run-on-the-target">
<h3>在目标设备上运行 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=290">[290]</a><a class="headerlink" href="#run-on-the-target" title="永久链接至标题"></a></h3>
<p>将文件系统复制到目标设备上或使用先前构建的 Docker 镜像： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=291">[291]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -it --rm -v <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/ros2_ws:/ros2_ws arm_ros2:latest
</pre></div>
</div>
<p>加载环境： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=292">[292]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> /ros2_ws/install/local_setup.bash
</pre></div>
</div>
<p>运行一些C++或Python示例： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=293">[293]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 run demo_nodes_cpp listener <span class="p">&amp;</span>
ros2 run demo_nodes_py talker
</pre></div>
</div>
</div>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>