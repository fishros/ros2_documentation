<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Releases/Release-Crystal-Clemmys</title>
</head>
<body>
  <div class="section" id="crystal-clemmys-crystal">
<h1>Crystal Clemmys (<code class="docutils literal notranslate"><span class="pre">crystal</span></code>)<a class="headerlink" href="#crystal-clemmys-crystal" title="永久链接至标题"></a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#supported-platforms" id="id1">支持的平台</a></p></li>
<li><p><a class="reference internal" href="#new-features-in-this-ros-2-release" id="id2">这个ROS 2版本的新功能有：</a></p></li>
<li><p><a class="reference internal" href="#changes-since-the-bouncy-release" id="id3">与Bouncy版本发布相比的更改</a></p></li>
<li><p><a class="reference internal" href="#known-issues" id="id4">已知问题</a></p></li>
</ul>
</div>
<p><em>Crystal Clemmys</em> 是 ROS 2 的第三个发布版本。</p>
<div class="section" id="supported-platforms">
<h2><a class="toc-backref" href="#id1">支持的平台</a><a class="headerlink" href="#supported-platforms" title="永久链接至标题"></a></h2>
<p>Crystal Clemmys 主要支持以下平台（完整详情请参阅 <a class="reference external" href="https://www.ros.org/reps/rep-2000.html#crystal-clemmys-december-2018-december-2019">REP 2000</a>）：</p>
<p>一级平台：</p>
<ul class="simple">
<li><p>Ubuntu 18.04 (Bionic)</p></li>
<li><p>Mac macOS 10.12 (Sierra)</p></li>
<li><p>Windows 10</p></li>
</ul>
<p>二级平台：</p>
<ul class="simple">
<li><p>Ubuntu 16.04 (Xenial)</p></li>
</ul>
</div>
<div class="section" id="new-features-in-this-ros-2-release">
<h2><a class="toc-backref" href="#id2">这个ROS 2版本的新功能有：</a><a class="headerlink" href="#new-features-in-this-ros-2-release" title="永久链接至标题"></a></h2>
<ul class="simple">
<li><p>C / C++ 中的操作（<a class="reference external" href="https://github.com/ros2/examples/tree/af08e6f7ac50f7808dbe6165f1adfd8e6cd3a79c/rclcpp/minimal_action_server">服务器</a> / <a class="reference external" href="https://github.com/ros2/examples/tree/af08e6f7ac50f7808dbe6165f1adfd8e6cd3a79c/rclcpp/minimal_action_client">客户端</a> 示例)</p></li>
<li><p><a class="reference external" href="http://gazebosim.org/tutorials?tut=ros2_overview">gazebo_ros_pkgs</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros-perception/image_common/wiki/ROS2-Migration">image_transport</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros-planning/navigation2/blob/master/README.md">navigation2</a></p></li>
<li><p><a class="reference external" href="https://index.ros.org/r/rosbag2/github-ros2-rosbag2/#crystal">rosbag2</a></p></li>
<li><p><a class="reference internal" href="../Concepts/About-RQt.html"><span class="doc">rqt</span></a></p></li>
<li><p>内存管理的改进</p></li>
<li><p>节点的内省信息</p></li>
<li><p>启动系统的改进</p>
<ul>
<li><p><a class="reference external" href="https://github.com/ros2/launch/pull/123">参数</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/launch/issues/116">嵌套启动文件</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/launch/issues/105">条件</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/launch/issues/117">将参数传递给节点</a></p></li>
</ul>
</li>
<li><p>为 <a class="reference external" href="https://github.com/ros2/rcl/pull/327">基于文件的日志记录和/rosout发布功能奠定基础</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rclpy/issues/186">Python中的时间和持续时间API</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rclpy/issues/202">参数在Python节点中的工作</a></p></li>
</ul>
</div>
<div class="section" id="changes-since-the-bouncy-release">
<h2><a class="toc-backref" href="#id3">与Bouncy版本发布相比的更改</a><a class="headerlink" href="#changes-since-the-bouncy-release" title="永久链接至标题"></a></h2>
<p>与 <a class="reference internal" href="Release-Bouncy-Bolson.html"><span class="doc">Bouncy Bolson</span></a> 版本发布相比的更改：</p>
<ul>
<li><p>geometry2 - <code class="docutils literal notranslate"><span class="pre">tf2_ros::Buffer</span></code> API 更改</p>
<p><code class="docutils literal notranslate"><span class="pre">tf2_ros::Buffer</span></code> 现在使用 <code class="docutils literal notranslate"><span class="pre">rclcpp::Time</span></code>，构造函数需要一个指向 <code class="docutils literal notranslate"><span class="pre">rclcpp::Clock</span></code> 实例的 <code class="docutils literal notranslate"><span class="pre">shared_ptr</span></code>。有关详细信息，请参见 <a class="reference external" href="https://github.com/ros2/geometry2/pull/67">https://github.com/ros2/geometry2/pull/67</a>，示例用法如下：</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;tf2_ros/transform_listener.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;rclcpp/rclcpp.hpp&gt;</span><span class="cp"></span>
<span class="p">...</span><span class="w"></span>
<span class="cp"># Assuming you have a rclcpp::Node my_node</span>
<span class="n">tf2_ros</span><span class="o">::</span><span class="n">Buffer</span><span class="w"> </span><span class="n">buffer</span><span class="p">(</span><span class="n">my_node</span><span class="p">.</span><span class="n">get_clock</span><span class="p">());</span><span class="w"></span>
<span class="n">tf2_ros</span><span class="o">::</span><span class="n">TransformListener</span><span class="w"> </span><span class="nf">tf_listener</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>所有 <code class="docutils literal notranslate"><span class="pre">rclcpp</span></code> 和 <code class="docutils literal notranslate"><span class="pre">rcutils</span></code> 的日志宏都需要分号。</p>
<p>有关详细信息，请参见 <a class="reference external" href="https://github.com/ros2/rcutils/issues/113">https://github.com/ros2/rcutils/issues/113</a>。</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">rcutils_get_error_string_safe()</span></code> 和 <code class="docutils literal notranslate"><span class="pre">rcl_get_error_string_safe()</span></code> 已被替换为 <code class="docutils literal notranslate"><span class="pre">rcutils_get_error_string().str</span></code> 和 <code class="docutils literal notranslate"><span class="pre">rcl_get_error_string().str</span></code>。</p>
<p>有关详细信息，请参见 <a class="reference external" href="https://github.com/ros2/rcutils/pull/121">https://github.com/ros2/rcutils/pull/121</a>。</p>
</li>
<li><p>rmw - <code class="docutils literal notranslate"><span class="pre">rmw_init</span></code> API 变更</p>
<p>引入了两个新的结构体：<code class="docutils literal notranslate"><span class="pre">rcl_context_t</span></code> 和 <code class="docutils literal notranslate"><span class="pre">rcl_init_options_t</span></code>，它们与 <code class="docutils literal notranslate"><span class="pre">rmw_init</span></code> 一起使用。初始化选项结构体用于向中间件传递选项，并作为 <code class="docutils literal notranslate"><span class="pre">rmw_init</span></code> 的输入参数。上下文是一个句柄，是 <code class="docutils literal notranslate"><span class="pre">rmw_init</span></code> 函数的输出，用于标识每个实体与哪个初始化-关闭周期相关联，其中“实体”可以是节点、守护条件等。</p>
<p>将此列在此处是因为替代 rmw 实现的维护人员需要实现这些新函数，以使其 rmw 实现在 Crystal 中正常工作。</p>
<p>这是函数的签名发生变化的地方：</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ros2/rmw/blob/b7234243588a70fce105ea20b073f5ef6c1b685c/rmw/include/rmw/init.h#L54-L82">rmw_init</a></p></li>
</ul>
<p>此外，每个 rmw 实现都需要实现以下这些新函数：</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ros2/rmw/blob/b7234243588a70fce105ea20b073f5ef6c1b685c/rmw/include/rmw/init.h#L84-L109">rmw_shutdown</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rmw/blob/b7234243588a70fce105ea20b073f5ef6c1b685c/rmw/include/rmw/init_options.h#L62-L92">rmw_init_options_init</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rmw/blob/b7234243588a70fce105ea20b073f5ef6c1b685c/rmw/include/rmw/init_options.h#L94-L128">rmw_init_options_copy</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rmw/blob/b7234243588a70fce105ea20b073f5ef6c1b685c/rmw/include/rmw/init_options.h#L130-L153">rmw_init_options_fini</a></p></li>
</ul>
<p>以下是一个示例，最小限度地更改 rmw 实现以符合此 API 更改：</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ros2/rmw_fastrtps/pull/237/files">rmw_fastrtps pr</a></p></li>
</ul>
</li>
<li><p>rcl - <code class="docutils literal notranslate"><span class="pre">rcl_init</span></code> API变更</p>
<p>和上面的``rmw``变更一样，在``rcl``中引入了两个新的结构体，分别是``rcl_context_t``和``rcl_init_options_t``。初始化选项被作为输入参数传递给``rcl_init``函数，而上下文则作为输出参数传递。上下文用于将所有其他的rcl实体关联到特定的初始化-关闭周期，有效地使初始化和关闭不再是全局函数，或者说这些函数不再使用全局状态，而是将所有状态封装在上下文类型中。</p>
<p>任何一个客户端库实现的维护者（也在底层使用``rcl``）都需要进行更改以适应Crystal。</p>
<p>以下函数已被移除:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rcl_get_global_arguments</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rcl_get_instance_id</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rcl_ok</span></code></p></li>
</ul>
<p>这些函数的签名发生了变化：</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/init.h#L30-L82">rcl_init</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/init.h#L84-L111">rcl_shutdown</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/guard_condition.h#L54-L99">rcl_guard_condition_init</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/guard_condition.h#L101-L140">rcl_guard_condition_init_from_rmw</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/node.h#L100-L194">rcl_node_init</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/timer.h#L64-L159">rcl_timer_init</a></p></li>
</ul>
<p>以下是新的函数和类型:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/context.h#L36-L136">rcl_context_t</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/context.h#L138-L142">rcl_get_zero_initialized_context</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/context.h#L146-L171">rcl_context_fini</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/context.h#L175-L205">rcl_context_get_init_options</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/context.h#L207-L233">rcl_context_get_instance_id</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/context.h#L235-L255">rcl_context_is_valid</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/init_options.h#L32-L37">rcl_init_options_t</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/init_options.h#L39-L43">rcl_get_zero_initialized_init_options</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/init_options.h#L45-L73">rcl_init_options_init</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/init_options.h#L75-L105">rcl_init_options_copy</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/init_options.h#L107-L128">rcl_init_options_fini</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/init_options.h#L130-L153">rcl_init_options_get_rmw_init_options</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/node.h#L288-L299">rcl_node_is_valid_except_context</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/publisher.h#L378-L404">rcl_publisher_get_context</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rcl/blob/657d9e84c73e4268176efd163e96fda73c1a76d9/rcl/include/rcl/publisher.h#L428-L439">rcl_publisher_is_valid_except_context</a></p></li>
</ul>
<p>这些新的和修改过的函数将影响您在客户端库中处理初始化和关闭的方式。有关示例，请查看以下 <code class="docutils literal notranslate"><span class="pre">rclcpp</span></code> 和 <code class="docutils literal notranslate"><span class="pre">rclpy</span></code> PR：</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ros2/rclcpp/pull/587">rclcpp</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros2/rclpy/pull/249">rclpy</a></p></li>
</ul>
<p>但是，您可以继续在您的客户端库中提供单个全局初始化和关闭，并只存储一个全局上下文对象。</p>
</li>
</ul>
</div>
<div class="section" id="known-issues">
<h2><a class="toc-backref" href="#id4">已知问题</a><a class="headerlink" href="#known-issues" title="永久链接至标题"></a></h2>
<ul class="simple">
<li><p>Fast-RTPS 1.7.0 中的竞争条件可能会在压力下导致消息丢失（<a class="reference external" href="https://github.com/ros2/rmw_fastrtps/issues/258">Issue</a>）。</p></li>
<li><p>在使用 rmw_fastrtps_cpp 的 TRANSIENT_LOCAL QoS 设置时，可能会导致具有大消息的应用程序崩溃（<a class="reference external" href="https://github.com/ros2/rmw_fastrtps/issues/257">Issue</a>）。</p></li>
<li><p>在Windows上，<a class="reference external" href="https://github.com/ros2/rmw_fastrtps/issues/246">rmw_fastrtps_cpp`与其他实现之间的跨供应商通信不起作用（`问题</a>）。</p></li>
<li><p>在macOS和Windows上使用OpenSplice（版本 &lt; 6.9.190227）时，如果引用其他软件包中具有相同名称的字段类型，可能会遇到命名冲突，如果当前软件包中也存在相同的名称（<a class="reference external" href="https://github.com/ros2/rmw_opensplice/issues/259">问题</a>）。通过升级到更新版本的OpenSplice以及至少Crystal的第三个补丁版本，问题应该得到解决。在Linux上，更新到最新的Debian软件包将包含最新的OpenSplice版本。</p></li>
</ul>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>