<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Concepts/About-Domain-ID</title>
</head>
<body>
  <div class="section" id="the-ros-domain-id">
<h1>ROS_DOMAIN_ID <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6876">[6876]</a><a class="headerlink" href="#the-ros-domain-id" title="永久链接至标题"></a></h1>
<div class="section" id="overview">
<h2>概述 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6823">[6823]</a><a class="headerlink" href="#overview" title="永久链接至标题"></a></h2>
<p>如其他地方所解释的，ROS 2用于通信的默认中间件是DDS。在DDS中，不同逻辑网络共享物理网络的主要机制被称为Domain ID。同一域中的ROS 2节点可以自由地发现和相互发送消息，而不同域中的ROS 2节点则不能。所有ROS 2节点默认使用域ID 0。为了避免在同一网络上运行ROS 2的不同计算机组之间的干扰，应为每个组设置不同的域ID。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6877">[6877]</a></p>
</div>
<div class="section" id="choosing-a-domain-id-short-version">
<h2>选择域ID（简短版本） <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6878">[6878]</a><a class="headerlink" href="#choosing-a-domain-id-short-version" title="永久链接至标题"></a></h2>
<p>下面的文本解释了应在ROS 2中使用的域ID范围的推导过程。如果想跳过这些背景知识，只需选择一个安全的数字，简单地选择一个介于0和101之间（包括0和101）的域ID即可。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6879">[6879]</a></p>
</div>
<div class="section" id="choosing-a-domain-id-long-version">
<h2>选择域ID（详细版本） <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6880">[6880]</a><a class="headerlink" href="#choosing-a-domain-id-long-version" title="永久链接至标题"></a></h2>
<p>域ID由DDS用于计算用于发现和通信的UDP端口。有关端口计算的详细信息，请参阅`此文章 &lt;<a class="reference external" href="https://community.rti.com/content/forum-topic/statically-configure-firewall-let-omg-dds-traffic-through">https://community.rti.com/content/forum-topic/statically-configure-firewall-let-omg-dds-traffic-through</a>&gt;`__。根据我们的基本网络知识，UDP端口是一个`无符号16位整数 &lt;<a class="reference external" href="https://en.wikipedia.org/wiki/User_Datagram_Protocol#Ports">https://en.wikipedia.org/wiki/User_Datagram_Protocol#Ports</a>&gt;`__。因此，最高可以分配的端口号是65535。通过使用上述文章中的公式进行一些计算，可以得知可能分配的最高域ID是232，而最低域ID是0。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6881">[6881]</a></p>
<div class="section" id="platform-specific-constraints">
<h3>平台特定约束 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6882">[6882]</a><a class="headerlink" href="#platform-specific-constraints" title="永久链接至标题"></a></h3>
<p>为了最大兼容性，在选择域ID时应遵循一些额外的平台特定约束。特别是，在操作系统的`临时端口范围 &lt;<a class="reference external" href="https://en.wikipedia.org/wiki/Ephemeral_port">https://en.wikipedia.org/wiki/Ephemeral_port</a>&gt;`__中最好避免分配域ID。这样可以避免ROS 2节点和计算机上其他网络服务之间可能的端口冲突。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6883">[6883]</a></p>
<p>以下是有关临时端口的特定平台注意事项。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6884">[6884]</a></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-0-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button><button aria-controls="panel-0-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-0-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-0-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><p>默认情况下，Linux内核使用32768-60999的端口作为临时端口。这意味着域ID为0-101和215-232的端口可以安全使用，不会与临时端口冲突。在Linux中，可以通过在``/proc/sys/net/ipv4/ip_local_port_range``中设置自定义值来配置临时端口范围。如果使用自定义临时端口范围，则可能需要相应地调整上述数字。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6886">[6886]</a></p>
</div><div aria-labelledby="tab-0-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><p>默认情况下，macOS的临时端口范围是49152-65535。这意味着域ID为0-166的端口可以安全使用，不会与临时端口冲突。在macOS中，可以通过设置``net.inet.ip.portrange.first``和``net.inet.ip.portrange.last``的自定义sysctl值来配置临时端口范围。如果使用自定义临时端口范围，则可能需要相应地调整上述数字。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6888">[6888]</a></p>
</div><div aria-labelledby="tab-0-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><p>默认情况下，Windows 上的临时端口范围是49152-65535。这意味着可以安全地使用域ID 0-166，而不会与临时端口冲突。在 Windows 中，可以通过`使用 netsh &lt;<a class="reference external" href="https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/default-dynamic-port-range-tcpip-chang">https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/default-dynamic-port-range-tcpip-chang</a>&gt;`__ 来配置临时端口范围。如果使用了自定义的临时端口范围，上述数字可能需要相应地进行调整。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6890">[6890]</a></p>
</div></div>
</div>
<div class="section" id="participant-constraints">
<h3>参与者限制 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6891">[6891]</a><a class="headerlink" href="#participant-constraints" title="永久链接至标题"></a></h3>
<p>在计算机上运行的每个 ROS 2 进程都会创建一个 DDS“参与者”。由于每个 DDS 参与者占用计算机上的两个端口，如果在一台计算机上运行超过120个 ROS 2 进程，则可能会溢出到其他域ID或临时端口。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6892">[6892]</a></p>
<p>为了理解原因，请考虑域ID 1和2。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6893">[6893]</a></p>
<ul class="simple">
<li><p>域ID 1使用端口7650和7651进行组播。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6894">[6894]</a></p></li>
<li><p>域ID 2使用端口7900和7901进行组播。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6895">[6895]</a></p></li>
<li><p>在创建域ID为1的第一个进程（第零个参与者）时，使用端口7660和7661进行单播。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6896">[6896]</a></p></li>
<li><p>在创建域ID为1的第120个进程（第119个参与者）时，使用端口7898和7899进行单播。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6897">[6897]</a></p></li>
<li><p>在创建域ID为1的第121个进程（第120个参与者）时，使用端口7900和7901进行单播，并与域ID为2重叠。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6898">[6898]</a></p></li>
</ul>
<p>如果已知计算机一次只会处于一个域ID上，并且域ID足够低，则可以安全地创建超过此数量的ROS 2进程。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6899">[6899]</a></p>
<p>当选择接近平台特定域ID范围顶部的域ID时，应考虑一个额外的约束条件。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6900">[6900]</a></p>
<p>例如，假设具有域ID为101的Linux计算机： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6901">[6901]</a></p>
<ul class="simple">
<li><p>计算机上的第零个ROS 2进程将连接到端口32650、32651、32660和32661。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6902">[6902]</a></p></li>
<li><p>计算机上的第一个ROS 2进程将连接到端口32650、32651、32662和32663。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6903">[6903]</a></p></li>
<li><p>计算机上的第53个ROS 2进程将连接到端口32650、32651、32766和32767。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6904">[6904]</a></p></li>
<li><p>计算机上的第54个ROS 2进程将连接到端口32650、32651、32768和32769，并进入临时端口范围。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6905">[6905]</a></p></li>
</ul>
<p>因此，在Linux上使用域ID 101时，应创建的最大进程数为54。同样，在Linux上使用域ID 232时，应创建的最大进程数为63，因为最大端口号为65535。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6906">[6906]</a></p>
<p>在macOS和Windows上的情况类似，但数字不同。在macOS和Windows上，选择域ID为166（范围顶部）时，计算机上在进入临时端口范围之前可以创建的最大ROS 2进程数为120。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6907">[6907]</a></p>
</div>
<div class="section" id="domain-id-to-udp-port-calculator">
<h3>域 ID 到 UDP 端口计算器 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6908">[6908]</a><a class="headerlink" href="#domain-id-to-udp-port-calculator" title="永久链接至标题"></a></h3>
<table>
  <tr>
    <td style="text-align: right; vertical-align: middle;"><label>Domain ID:</label></td>
    <td><input type="number" min="0" max="232" size="3" class="display" value="0" id="domainID" onChange="calculate(this.value)"/></td>
  </tr>
  <tr>
    <td style="text-align: right; vertical-align: middle;"><label>Participant ID:</label></td>
    <td><input type="number" min="0" size="3" class="display" value="0" id="participantID" onChange="calculate(this.value)"/></td>
  </tr>
</table>
<hr/>
<table>
  <tr>
    <td style="text-align: right; vertical-align: middle;"><label>Discovery Multicast Port:</label></td>
    <td><input type="text" size="5" class="discoveryMulticastPort" disabled/></td>
  </tr>
  <tr>
    <td style="text-align: right; vertical-align: middle;"><label>User Multicast Port:</label></td>
    <td><input type="text" size="5" class="userMulticastPort" disabled/></td>
  </tr>
  <tr>
    <td style="text-align: right; vertical-align: middle;"><label>Discovery Unicast Port:</label></td>
    <td><input type="text" size="5" class="discoveryUnicastPort" disabled/></td>
  </tr>
  <tr>
    <td style="text-align: right; vertical-align: middle;"><label>User Unicast Port:</label></td>
    <td><input type="text" size="5" class="userUnicastPort" disabled/></td>
  </tr>
</table>
<br/>
<br/>

<script type="text/javascript">
  window.addEventListener('load', (event) => {
     calculate(event);
  });
  const discoveryMcastPort = document.querySelector('.discoveryMulticastPort');
  const userMcastPort = document.querySelector('.userMulticastPort');
  const discoveryUnicastPort = document.querySelector('.discoveryUnicastPort');
  const userUnicastPort = document.querySelector('.userUnicastPort');

  const domainID = document.getElementById('domainID');
  const participantID = document.getElementById('participantID');

  // calculate function
  function calculate(event) {
    const d0 = 0;
    const d2 = 1;
    const d1 = 10;
    const d3 = 11;
    const PB = 7400;
    const DG = 250;
    const PG = 2;

    discoveryMcastPort.value = PB + (DG * domainID.value) + d0;
    userMcastPort.value = PB + (DG * domainID.value) + d2;
    discoveryUnicastPort.value = PB + (DG * domainID.value) + d1 + (PG * participantID.value);
    userUnicastPort.value = PB + (DG * domainID.value) + d3 + (PG * participantID.value);
  }
</script></div>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>