<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Concepts/About-Composition</title>
</head>
<body>
  <div class="section" id="about-composition">
<h1>关于组合 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6800">[6800]</a><a class="headerlink" href="#about-composition" title="永久链接至标题"></a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">目录 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6709">[]</a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#ros-1-nodes-vs-nodelets" id="id1">ROS 1 - 节点 vs. Nodelets [6801]</a></p></li>
<li><p><a class="reference internal" href="#ros-2-unified-api" id="id2">ROS 2 - 统一API [6803]</a></p></li>
<li><p><a class="reference internal" href="#writing-a-component" id="id3">编写组件 [6810]</a></p></li>
<li><p><a class="reference internal" href="#using-components" id="id4">使用组件 [6815]</a></p></li>
<li><p><a class="reference internal" href="#practical-application" id="id5">实际应用 [6820]</a></p></li>
</ul>
</div>
<div class="section" id="ros-1-nodes-vs-nodelets">
<h2>ROS 1 - 节点 vs. Nodelets <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6801">[6801]</a><a class="headerlink" href="#ros-1-nodes-vs-nodelets" title="永久链接至标题"></a></h2>
<p>在ROS 1中，您可以将代码编写为 <a class="reference external" href="https://wiki.ros.org/Nodes">ROS节点</a> 或 <a class="reference external" href="https://wiki.ros.org/nodelet">ROS nodelet</a>。ROS 1节点被编译为可执行文件。另一方面，ROS 1 nodelet被编译为共享库，然后由容器进程在运行时加载。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6802">[6802]</a></p>
</div>
<div class="section" id="ros-2-unified-api">
<h2>ROS 2 - 统一API <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6803">[6803]</a><a class="headerlink" href="#ros-2-unified-api" title="永久链接至标题"></a></h2>
<p>在ROS 2中，编写代码的推荐方式类似于nodelet - 我们称之为 <code class="docutils literal notranslate"><span class="pre">Component</span></code>。这使得向现有代码添加常见概念变得容易，例如 <a class="reference external" href="https://design.ros2.org/articles/node_lifecycle.html">生命周期</a>。ROS 1中的最大缺点是具有不同的API，而在ROS 2中通过使用相同的API来避免了这个问题。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6804">[6804]</a></p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>仍然可以使用类似节点的&quot;编写自己的main&quot;的方式，但对于常见情况，不建议这样做。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6805">[6805]</a></p>
</div>
<p>通过使进程布局成为部署时的决策，用户可以在以下选项之间进行选择： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6806">[6806]</a></p>
<ul class="simple">
<li><p>以独立进程运行多个节点，具有进程/故障隔离的优点，以及更容易调试单个节点。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6807">[6807]</a></p></li>
<li><p>在单个进程中运行多个节点，降低开销，并可选择更高效的通信方式（参见 <a class="reference internal" href="../Tutorials/Demos/Intra-Process-Communication.html"><span class="doc">Intra Process Communication</span></a>）。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6808">[6808]</a></p></li>
</ul>
<p>此外，<code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">launch</span></code> 可以通过专门的启动操作来自动化这些操作。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6809">[6809]</a></p>
</div>
<div class="section" id="writing-a-component">
<h2>编写组件 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6810">[6810]</a><a class="headerlink" href="#writing-a-component" title="永久链接至标题"></a></h2>
<p>由于组件仅构建为共享库，因此它没有 <code class="docutils literal notranslate"><span class="pre">main</span></code> 函数（请参见 <a class="reference external" href="https://github.com/ros2/demos/blob/humble/composition/src/talker_component.cpp">Talker源代码</a> ）。组件通常是 <code class="docutils literal notranslate"><span class="pre">rclcpp::Node</span></code> 的子类。由于它无法控制线程，因此不应在构造函数中执行任何长时间运行或阻塞的任务。相反，它可以使用计时器来获取周期性通知。此外，它还可以创建发布器、订阅器、服务器和客户端。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6811">[6811]</a></p>
<p>使此类成为组件的一个重要方面是，该类使用来自 <code class="docutils literal notranslate"><span class="pre">rclcpp_components</span></code> 包的宏进行注册（请参见源代码的最后一行）。这使得在将其库加载到正在运行的进程中时，组件可以被发现-它充当了一种入口点。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6812">[6812]</a></p>
<p>另外，一旦创建了一个组件，它必须在索引中注册，以便工具能够发现它。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6813">[6813]</a></p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">add_library</span><span class="p">(</span><span class="s">talker_component</span><span class="w"> </span><span class="s">SHARED</span><span class="w"> </span><span class="s">src/talker_component.cpp</span><span class="p">)</span>
<span class="nb">rclcpp_components_register_nodes</span><span class="p">(</span><span class="s">talker_component</span><span class="w"> </span><span class="s2">&quot;composition::Talker&quot;</span><span class="p">)</span>
<span class="c"># To register multiple components in the same shared library, use multiple calls</span>
<span class="c"># rclcpp_components_register_nodes(talker_component &quot;composition::Talker2&quot;)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>为了使组件容器能够找到所需的组件，必须在已经加载了相应工作空间的shell中执行或启动它。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6814">[6814]</a></p>
</div>
</div>
<div class="section" id="using-components">
<span id="composition-using-components"></span><h2>使用组件 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6815">[6815]</a><a class="headerlink" href="#using-components" title="永久链接至标题"></a></h2>
<p><a class="reference external" href="https://github.com/ros2/demos/tree/humble/composition">composition</a> 包中包含了几种不同的使用组件的方法。最常见的三种方法是： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6816">[6816]</a></p>
<ol class="arabic simple">
<li><p>启动一个 (<a class="reference external" href="https://github.com/ros2/rclcpp/blob/humble/rclcpp_components/src/component_container.cpp">generic container process</a>) 并调用容器提供的 ROS 服务 <a class="reference external" href="https://github.com/ros2/rcl_interfaces/blob/humble/composition_interfaces/srv/LoadNode.srv">load_node</a>。ROS 服务将加载由传递的包名和库名指定的组件，并在运行的进程中开始执行它。除了通过编程方式调用 ROS 服务，您还可以使用 <a class="reference external" href="https://github.com/ros2/ros2cli/tree/humble/ros2component">command line tool</a> 来使用传递的命令行参数调用 ROS 服务。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6817">[6817]</a></p></li>
<li><p>创建一个 <a class="reference external" href="https://github.com/ros2/demos/blob/humble/composition/src/manual_composition.cpp">custom executable</a>，其中包含在编译时已知的多个节点。这种方法要求每个组件都有一个头文件（对于第一种情况并非严格需要）。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6818">[6818]</a></p></li>
<li><p>创建一个启动文件，并使用``ros2 launch``创建一个包含多个组件的容器进程。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6819">[6819]</a></p></li>
</ol>
</div>
<div class="section" id="practical-application">
<h2>实际应用 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6820">[6820]</a><a class="headerlink" href="#practical-application" title="永久链接至标题"></a></h2>
<p>尝试使用:doc:<a class="reference internal" href="../Tutorials/Intermediate/Composition.html"><span class="doc">Composition演示</span></a>。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6821">[6821]</a></p>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>