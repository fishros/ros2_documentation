<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Concepts/About-Catment</title>
</head>
<body>
  <div class="section" id="on-the-mixing-of-ament-and-catkin-catment">
<h1>关于 ament 和 catkin 的混合 (catment) <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6707">[6707]</a><a class="headerlink" href="#on-the-mixing-of-ament-and-catkin-catment" title="永久链接至标题"></a></h1>
<p><strong>下面的内容都是实验性和推测性的。</strong> <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6708">[6708]</a></p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">目录 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6709">[]</a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id1">背景 [6710]</a></p></li>
<li><p><a class="reference internal" href="#postulates" id="id2">假设 [6723]</a></p></li>
<li><p><a class="reference internal" href="#use-cases-with-experimental-implementations" id="id3">使用案例和实验性实现 [6729]</a></p>
<ul>
<li><p><a class="reference internal" href="#adding-ros-packages-to-a-ros-2-workspace-and-building-with-ament-build" id="id4">将ROS包添加到ROS 2工作空间并使用``ament build``进行构建 [6730]</a></p></li>
<li><p><a class="reference internal" href="#building-ros-2-packages-with-catkin-make-isolated" id="id5">使用``catkin_make_isolated``构建ROS 2包 [6752]</a></p></li>
<li><p><a class="reference internal" href="#combining-all-of-ros-and-ros-2-in-one-workspace-and-building-it-todo" id="id6">将ROS和ROS 2组合在一个工作空间中，并进行构建（待完成）。 [6761]</a></p></li>
<li><p><a class="reference internal" href="#using-bloom-to-release-ament-packages-todo" id="id7">使用 <code class="docutils literal notranslate"><span class="pre">bloom</span></code> 发布 <code class="docutils literal notranslate"><span class="pre">ament</span></code> 包（待办） [6765]</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="background">
<h2>背景 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6710">[6710]</a><a class="headerlink" href="#background" title="永久链接至标题"></a></h2>
<p>曾经有一个叫做 <code class="docutils literal notranslate"><span class="pre">rosbuild</span></code> 的东西。然后出现了一个叫做 <code class="docutils literal notranslate"><span class="pre">catkin</span></code> 的东西，它在很大程度上取代了 <code class="docutils literal notranslate"><span class="pre">rosbuild</span></code>。最近引入了一个叫做 <code class="docutils literal notranslate"><span class="pre">ament</span></code> 的东西，有朝一日可能会取代 <code class="docutils literal notranslate"><span class="pre">catkin</span></code>。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6711">[6711]</a></p>
<p>这三个工具都可以被称为“元构建系统”。它们位于其他构建系统之上（例如 CMake、Python setuptools），并提供额外的功能，旨在使这些构建系统更易于使用，特别是在管理多个软件包之间的依赖关系和在单个工作空间中构建多个软件包时。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6712">[6712]</a></p>
<p>每个元构建系统都有两个功能： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6713">[6713]</a></p>
<ol class="arabic simple">
<li><p>Adds an API to the underlying build system (e.g. CMake) that can be used to simplify common tasks (e.g. supplying all the flags exported by depended-upon packages when building an executable).
There are usually hooks to allow injection of extra APIs by packages outside of the core meta-build system.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rosbuild</span></code>：<code class="docutils literal notranslate"><span class="pre">mk/cmake.mk</span></code>、<code class="docutils literal notranslate"><span class="pre">rosbuild_init()</span></code>、<code class="docutils literal notranslate"><span class="pre">rosbuild_add_executable()</span></code> 等。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6715">[6715]</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">catkin</span></code>：<code class="docutils literal notranslate"><span class="pre">catkin_package()</span></code>、<code class="docutils literal notranslate"><span class="pre">catkin_install_python()</span></code> 等。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6716">[6716]</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ament</span></code>: <code class="docutils literal notranslate"><span class="pre">ament_target_dependencies()</span></code>, <code class="docutils literal notranslate"><span class="pre">ament_export_dependencies()</span></code>, <code class="docutils literal notranslate"><span class="pre">ament_package()</span></code>, 等等。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6717">[6717]</a></p></li>
</ul>
</li>
<li><p>提供了一个工具，可以按照依赖顺序遍历一个包含多个软件包的工作空间，构建并可能安装每个软件包。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6718">[6718]</a></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">rosbuild</span></code>: <code class="docutils literal notranslate"><span class="pre">rosmake</span></code> <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6719">[6719]</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">catkin</span></code>: <code class="docutils literal notranslate"><span class="pre">catkin</span> <span class="pre">build</span></code>, <code class="docutils literal notranslate"><span class="pre">catkin_make</span></code>, <code class="docutils literal notranslate"><span class="pre">catkin_make_isolated</span></code>，等等。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6720">[6720]</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ament</span></code>: <code class="docutils literal notranslate"><span class="pre">ament</span> <span class="pre">build</span></code> <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6721">[6721]</a></p></li>
</ul>
</li>
</ol>
<p>将所有这些系统联系在一起的共同线索是将代码划分为**包**，每个包包含一个清单文件（<code class="docutils literal notranslate"><span class="pre">manifest.xml</span></code> 或 <code class="docutils literal notranslate"><span class="pre">package.xml</span></code>）。这个清单文件对于元构建系统的两个部分（API 和构建工具）都是必需的（有一些例外），以便其正常运行。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6722">[6722]</a></p>
</div>
<div class="section" id="postulates">
<h2>假设 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6723">[6723]</a><a class="headerlink" href="#postulates" title="永久链接至标题"></a></h2>
<ol class="arabic simple">
<li><p><a href="#id1"><span class="problematic" id="id2">**</span></a>尽管我们通常认为元构建系统的两个方面是耦合在一起的，但它们并不一定是。<a href="#id3"><span class="problematic" id="id4">**</span></a>包内部使用的API和迭代包的工具可以被认为是相互独立的，而包清单则形成了它们之间的接口。原则上没有理由不这样做，例如，“rosmake”可以被修改为在一个充满“catkin”包的工作空间中进行迭代，按照依赖顺序进入每个包，并对每个包执行通常的“mkdir build; cd build; cmake ..; make install”例程（同时向“cmake”和“make”传递适当的标志） <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6724">[6724]</a></p></li>
<li><p><a href="#id1"><span class="problematic" id="id2">**</span></a>将从一个元构建系统迁移到另一个的工作量应该最小化。<a href="#id3"><span class="problematic" id="id4">**</span></a>从“rosbuild”迁移到“catkin”的大规模迁移对社区的许多人来说都是困难的，仍然是一个痛点。虽然要求开发者做出改变以获得新功能是合理的，但所需的改变应该尽可能小，而不会牺牲新系统的有效性。当旧系统被广泛使用时，这一点尤为重要 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6725">[6725]</a></p>
<ol class="arabic simple">
<li><p>推论：<a href="#id1"><span class="problematic" id="id2">**</span></a>除非有非常充分的理由，否则不应要求迁移到新的元构建系统。<a href="#id3"><span class="problematic" id="id4">**</span></a>如果开发者不需要新系统提供的功能，那么除非旧系统出现了不可挽回的问题（例如，“rosbuild”的源代码构建模式和缺乏“install”步骤），否则不应强制他们从旧系统迁移 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6726">[6726]</a></p></li>
</ol>
</li>
<li><p><a href="#id1"><span class="problematic" id="id2">**</span></a>互操作性是一件好事。<a href="#id3"><span class="problematic" id="id4">**</span></a>只要可能（并非所有组合都是实际可行的），开发者应该能够混合和匹配元构建系统，包括混合使用它们的不同方面（即，使用一个系统的构建工具和另一个系统的API）。当开发者想要将使用一个元构建系统（如ROS与“catkin”）的大型现有代码库与使用另一个元构建系统（如ROS 2与“ament”）的代码库提供的新库和工具结合起来时，这种混合和匹配尤其重要。理想情况下，这种组合可以在不要求任何代码库使用的API进行更改的情况下完成，也不会告诉开发者使用哪个构建工具 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6727">[6727]</a></p>
<ol class="arabic simple">
<li><p>推论：<a href="#id1"><span class="problematic" id="id2">**</span></a>工作空间不需要是同构的。<a href="#id3"><span class="problematic" id="id4">**</span></a>只要正在使用的构建工具知道如何构建它们，我们就没有理由不允许在一个工作空间中自由混合使用“catkin”和“amen <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6728">[6728]</a></p></li>
</ol>
</li>
</ol>
</div>
<div class="section" id="use-cases-with-experimental-implementations">
<h2>使用案例和实验性实现 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6729">[6729]</a><a class="headerlink" href="#use-cases-with-experimental-implementations" title="永久链接至标题"></a></h2>
<div class="section" id="adding-ros-packages-to-a-ros-2-workspace-and-building-with-ament-build">
<h3>将ROS包添加到ROS 2工作空间并使用``ament build``进行构建 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6730">[6730]</a><a class="headerlink" href="#adding-ros-packages-to-a-ros-2-workspace-and-building-with-ament-build" title="永久链接至标题"></a></h3>
<p>假设您想将一些现有的ROS包添加到您的ROS 2工作空间，并且不想将ROS包从``catkin``迁移到``ament``（或反之亦然）。以下是两个补丁，可以实现此功能： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6731">[6731]</a></p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ament/ament_package/compare/catkin?expand=1">ament_package</a>：添加对格式1包清单的支持，而不是要求格式2。此更改与``catkin``与``ament``的关系并不严格相关，因为格式2已经存在一段时间了，并且``catkin``也支持它，所以开发者已经可以将其清单更新为格式2。但是，有很多使用格式1的ROS代码存在，因此我们应该支持它。这个实现可以改进，例如通过推理各种依赖标签的不同之处，以及格式1和2之间的差异。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6732">[6732]</a></p></li>
<li><p><a class="reference external" href="https://github.com/ament/ament_tools/compare/catkin?expand=1">ament_tools</a>：向``ament``添加了一个新的``catkin``构建类型。该实现将``catkin``包与普通``cmake``包视为相同，似乎工作正常。可以使其更加复杂。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6733">[6733]</a></p></li>
</ul>
<p>示例用法： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6734">[6734]</a></p>
<ol class="arabic simple">
<li><p>按照通常的方式获取ROS 2代码，使用上述提到的分支。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6735">[6735]</a></p></li>
<li><p>向您的工作空间中添加一些``catkin`` ROS软件包，确保它们的所有依赖项都得到满足（要么在工作空间中存在，要么通过适当的设置shell文件在其他位置安装）。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6736">[6736]</a></p></li>
<li><p>像往常一样构建（例如``colcon build``）。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6737">[6737]</a></p></li>
</ol>
<p>完成了：由于使用了新的构建工具，您现有的代码不会突然中断。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6738">[6738]</a></p>
<div class="section" id="variation-building-ros-packages-with-ament-build">
<h4>变种：使用``ament build``构建ROS软件包 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6739">[6739]</a><a class="headerlink" href="#variation-building-ros-packages-with-ament-build" title="永久链接至标题"></a></h4>
<p>假设您喜欢新的``ament``工具，并希望使用它来构建使用``catkin``的现有ROS软件包。以下是一个示例，演示如何通过最小安装``ament``并使用它构建一个由ROS``catkin``软件包填充的工作空间： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6740">[6740]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir -p ~/ament_ws/src
<span class="nb">cd</span> ~/ament_ws/src
git clone https://github.com/osrf/osrf_pycommon.git
git clone https://github.com/ament/ament_package.git
<span class="nb">cd</span> ament_package
git checkout catkin
<span class="nb">cd</span> ..
git clone https://github.com/ament/ament_tools.git
<span class="nb">cd</span> ament_tools
git checkout catkin
<span class="nb">cd</span> ../..
 ./src/ament_tools/scripts/ament.py build
</pre></div>
</div>
<p>现在构建ROS软件包： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6741">[6741]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>. <span class="nv">$HOME</span>/ament_ws/install/setup.bash
<span class="nb">cd</span> ~/ros_catkin_ws
ament build
</pre></div>
</div>
<p>看哪：你使用了``ament``构建工具来构建你的``catkin``软件包，而无需迁移它们。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6742">[6742]</a></p>
</div>
<div class="section" id="variation-using-the-catkin-api-in-a-ros-2-package">
<h4>变化：在ROS 2软件包中使用``catkin`` API <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6743">[6743]</a><a class="headerlink" href="#variation-using-the-catkin-api-in-a-ros-2-package" title="永久链接至标题"></a></h4>
<p>假设你正在构建基于ROS 2的软件包，它在内部使用``ament`` API，并且你想要添加一个使用``catkin`` API的新软件包。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6744">[6744]</a></p>
<p>为了使其工作，你需要一个Python 3安装的``catkin``（二进制Debian包使用Python 2.7）。这里是一个安装到``$HOME/catkin``的示例： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6745">[6745]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># install catkin_pkg</span>
git clone https://github.com/ros-infrastructure/catkin_pkg.git
<span class="nb">cd</span> catkin_pkg
git checkout ament
python3 setup.py install --prefix <span class="nv">$HOME</span>/catkin --single-version-externally-managed --record foo --install-layout deb
<span class="c1"># install catkin</span>
git clone https://github.com/ros/catkin.git
<span class="nb">cd</span> catkin
git checkout ament
mkdir build
<span class="nb">cd</span> build
<span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$HOME</span>/catkin/lib/python3/dist-packages/ cmake .. -DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$HOME</span>/catkin -DPYTHON_EXECUTABLE<span class="o">=</span>/usr/bin/python3
make install
</pre></div>
</div>
<p>要使用那个版本的catkin，你只需要source <a href="#id1"><span class="problematic" id="id2">``</span></a>$HOME/catkin/setup.bash``文件。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6746">[6746]</a></p>
<p>假设您在``~/ros2_ws``中有一个常规的ROS 2工作空间，并且您在``ament_package``和``ament_tools``的``catkin``分支上。在该工作空间中添加来自https://github.com/gerkey/catment的``image_tools_catkin``包。它是ROS 2 <code class="docutils literal notranslate"><span class="pre">image_tools``包的一个简单移植，将其从``ament</span></code> API转换为``catkin`` API。要构建它： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6747">[6747]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/ros2_ws
. <span class="nv">$HOME</span>/catkin/setup.bash
./src/ament/ament_tools/scripts/ament.py build
</pre></div>
</div>
<p>大功告成：在构建ROS 2上的新包时，您可以自由选择首选的CMake API来编写您的包。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6748">[6748]</a></p>
<ul class="simple">
<li><p><strong>注意</strong>：需要在``catkin_package()``中注释掉对``CATKIN_DEPENDS``的使用，因为某个地方有人因为像``rclcpp``之类的不是``catkin``包而感到不满。需要以某种方式放宽这个约束。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6749">[6749]</a></p></li>
<li><p><strong>TODO</strong>：使用依赖于``catkin``包的``ament``包进行相同的演示（这很容易）。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6750">[6750]</a></p></li>
<li><p><strong>TODO</strong>：使用既不使用``ament``也不使用``catkin``的普通``CMakeLists.txt``的包进行相同的演示，并提供一个手动生成的``fooConfig.cmake``文件，向外部提供正确的内容以使其看起来与外部包相同。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6751">[6751]</a></p></li>
</ul>
</div>
</div>
<div class="section" id="building-ros-2-packages-with-catkin-make-isolated">
<h3>使用``catkin_make_isolated``构建ROS 2包 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6752">[6752]</a><a class="headerlink" href="#building-ros-2-packages-with-catkin-make-isolated" title="永久链接至标题"></a></h3>
<p>假设您已经熟悉ROS和`catkin`，并且很想尝试ROS 2，但又不想学习关于`ament`的知识。您更愿意坚持您所了解的，比如使用`catkin_make_isolated`来构建所有内容。下面是一个补丁，可以让您这样做： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6753">[6753]</a></p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ros/catkin/compare/ament?expand=1">catkin</a>：为声明自己具有``ament_*``构建类型的软件包添加支持。此实现调用``ament``来构建每个此类软件包。尽管可以将``ament_cmake``软件包视为普通的``cmake``软件包（就像我们在为``ament``添加``catkin``支持时所做的那样），但是``ament_python``软件包需要一些复杂的Python调用。与其试图在``catkin``中复制该逻辑，不如让``ament``来处理会更容易。此外，在此补丁中，我们将``buildtool_export_depend``软件包添加到构建时考虑的软件包集合中。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6754">[6754]</a></p></li>
<li><p><a class="reference external" href="https://github.com/ros-infrastructure/catkin_pkg/compare/ament?expand=1">catkin_pkg</a>：在此补丁中，我们还将``buildtool_export_depend``软件包添加到计算拓扑顺序时考虑的集合中。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6755">[6755]</a></p></li>
</ul>
<p>由于我们将调用``ament build``，我们还需要一个最小的``ament``安装，就像在之前的示例中一样： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6756">[6756]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir -p ~/ament_ws/src
<span class="nb">cd</span> ~/ament_ws/src
git clone https://github.com/osrf/osrf_pycommon.git
git clone https://github.com/ament/ament_package.git
<span class="nb">cd</span> ament_package
git checkout catkin
<span class="nb">cd</span> ..
git clone https://github.com/ament/ament_tools.git
<span class="nb">cd</span> ament_tools
git checkout catkin
<span class="nb">cd</span> ../..
 ./src/ament_tools/scripts/ament.py build
</pre></div>
</div>
<p>然后，我们需要将修改后的catkin版本安装在某个位置： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6757">[6757]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># install catkin_pkg</span>
git clone https://github.com/ros-infrastructure/catkin_pkg.git
<span class="nb">cd</span> catkin_pkg
git checkout ament
python3 setup.py install --prefix <span class="nv">$HOME</span>/catkin --single-version-externally-managed --record foo --install-layout deb
<span class="c1"># install catkin</span>
git clone https://github.com/ros/catkin.git
<span class="nb">cd</span> catkin
git checkout ament
mkdir build
<span class="nb">cd</span> build
<span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$HOME</span>/catkin/lib/python3/dist-packages/ cmake .. -DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$HOME</span>/catkin -DPYTHON_EXECUTABLE<span class="o">=</span>/usr/bin/python3
make install
</pre></div>
</div>
<p>现在构建ROS 2软件包： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6758">[6758]</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>. <span class="nv">$HOME</span>/catkin/setup.bash
. <span class="nv">$HOME</span>/ament_ws/install/setup.bash
<span class="nb">cd</span> ~/ros2_ws
touch src/eProsima/AMENT_IGNORE
<span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$PYTHONPATH</span>:/home/gerkey/ros2_ws_catkin/install_isolated/lib/python3.5/site-packages catkin_make_isolated --install
</pre></div>
</div>
<p>瞧！你使用你熟悉的工具构建了ROS 2。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6759">[6759]</a></p>
<ul class="simple">
<li><p><strong>注意</strong>：我们忽略了工作空间中的``eProsima``包，因为它们缺少``package.xml``文件，这意味着``catkin``无法识别它们。<code class="docutils literal notranslate"><span class="pre">ament``有一些处理此类包的启发式方法。选项：将这些启发式方法回溯到``catkin</span></code>；将不包含``package.xml``文件的包安装到工作空间之外；或者只需在这些包中添加``package.xml``（例如，在我们自己的分支中）。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6760">[6760]</a></p></li>
</ul>
</div>
<div class="section" id="combining-all-of-ros-and-ros-2-in-one-workspace-and-building-it-todo">
<h3>将ROS和ROS 2组合在一个工作空间中，并进行构建（待完成）。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6761">[6761]</a><a class="headerlink" href="#combining-all-of-ros-and-ros-2-in-one-workspace-and-building-it-todo" title="永久链接至标题"></a></h3>
<p>这一步将需要解决一些问题，至少包括以下内容： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6762">[6762]</a></p>
<ul class="simple">
<li><p>包名称冲突。我们目前有ROS消息包的ROS 2版本，以及``geometry2``中的一些内容。要么将功能合并到一个可以支持两个系统的包中，要么新版本需要有不同的名称。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6763">[6763]</a></p></li>
<li><p>消息生成。ROS和ROS 2有不同的消息生成步骤，其输出可能会发生冲突，也可能不会。需要进行一些复杂的处理，以允许从单个消息包生成所有正确的构件（或者如上所示，新的消息包需要有不同的名称）。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6764">[6764]</a></p></li>
</ul>
</div>
<div class="section" id="using-bloom-to-release-ament-packages-todo">
<h3>使用 <code class="docutils literal notranslate"><span class="pre">bloom</span></code> 发布 <code class="docutils literal notranslate"><span class="pre">ament</span></code> 包（待办） <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6765">[6765]</a><a class="headerlink" href="#using-bloom-to-release-ament-packages-todo" title="永久链接至标题"></a></h3>
<p>似乎 <code class="docutils literal notranslate"><span class="pre">bloom</span></code> 应该能够发布使用 <code class="docutils literal notranslate"><span class="pre">ament</span></code> CMake API 的包，并且生成的发布版本应该能够在 farm 上构建。我们可以根据需要对 <code class="docutils literal notranslate"><span class="pre">bloom</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ros_buildfarm</span></code> 进行更改，以支持这种用例。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6766">[6766]</a></p>
</div>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>