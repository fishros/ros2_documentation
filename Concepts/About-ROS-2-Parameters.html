<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Concepts/About-ROS-2-Parameters</title>
</head>
<body>
  <div class="section" id="about-parameters-in-ros-2">
<span id="aboutparameters"></span><h1>关于 ROS 2 中的参数<a class="headerlink" href="#about-parameters-in-ros-2" title="永久链接至标题"></a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id1">概述</a></p></li>
<li><p><a class="reference internal" href="#parameters-background" id="id2">参数背景</a></p>
<ul>
<li><p><a class="reference internal" href="#declaring-parameters" id="id3">声明参数</a></p></li>
<li><p><a class="reference internal" href="#parameter-types" id="id4">参数类型</a></p></li>
<li><p><a class="reference internal" href="#parameter-callbacks" id="id5">参数回调</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#interacting-with-parameters" id="id6">与参数交互</a></p></li>
<li><p><a class="reference internal" href="#setting-initial-parameter-values-when-running-a-node" id="id7">在运行节点时设置初始参数值</a></p></li>
<li><p><a class="reference internal" href="#setting-initial-parameter-values-when-launching-nodes" id="id8">启动节点时设置初始参数值</a></p></li>
<li><p><a class="reference internal" href="#manipulating-parameter-values-at-runtime" id="id9">运行时操作参数值</a></p></li>
<li><p><a class="reference internal" href="#migrating-from-ros-1" id="id10">从ROS 1迁移</a></p></li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id1">概述</a><a class="headerlink" href="#overview" title="永久链接至标题"></a></h2>
<p>ROS 中的参数与各个节点相关联。参数用于在启动时（和运行时）配置节点，而无需更改代码。参数的生命周期与节点的生命周期相关联（尽管节点可以实现某种持久性以在重新启动后重新加载值）。</p>
<p>参数通过节点名称、节点命名空间、参数名称和参数命名空间来进行标识。提供参数命名空间是可选的。</p>
<p>每个参数由键、值和描述符组成。键是一个字符串，值可以是以下类型之一：bool、int64、float64、string、byte[]、bool[]、int64[]、float64[] 或 string[]。默认情况下，所有描述符都是空的，但可以包含参数描述、值范围、类型信息和其他约束条件。</p>
<p>有关使用ROS参数的实用教程，请参阅:doc:<a class="reference internal" href="../Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Parameters/Understanding-ROS2-Parameters.html"><span class="doc">理解参数</span></a>。</p>
</div>
<div class="section" id="parameters-background">
<h2><a class="toc-backref" href="#id2">参数背景</a><a class="headerlink" href="#parameters-background" title="永久链接至标题"></a></h2>
<div class="section" id="declaring-parameters">
<h3><a class="toc-backref" href="#id3">声明参数</a><a class="headerlink" href="#declaring-parameters" title="永久链接至标题"></a></h3>
<p>默认情况下，节点需要在其生命周期内*声明*将要接受的所有参数。这样，参数的类型和名称在节点启动时就被明确定义，从而降低了后续配置错误的可能性。请参阅以下教程了解如何从节点中声明和使用参数：<a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Using-Parameters-In-A-Class-CPP.html"><span class="doc">在类中使用参数（C++）</span></a> 或 <a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Using-Parameters-In-A-Class-Python.html"><span class="doc">在类中使用参数（Python）</span></a>。</p>
<p>对于某些类型的节点，不是所有参数都能提前知道。在这种情况下，可以使用``allow_undeclared_parameters``设置为``true``来实例化节点，即使参数没有被声明，也允许在节点上进行参数的获取和设置。</p>
</div>
<div class="section" id="parameter-types">
<h3><a class="toc-backref" href="#id4">参数类型</a><a class="headerlink" href="#parameter-types" title="永久链接至标题"></a></h3>
<p>ROS 2节点上的每个参数都有预定义的参数类型，如概述中所述。默认情况下，尝试在运行时更改已声明参数的类型将失败。这可以防止常见的错误，例如将布尔值放入整数参数中。</p>
<p>如果一个参数需要具有多种不同的类型，并且使用该参数的代码可以处理它，可以更改此默认行为。在声明参数时，应使用具有``dynamic_typing``成员变量设置为``true``的``ParameterDescriptor``进行声明。</p>
</div>
<div class="section" id="parameter-callbacks">
<h3><a class="toc-backref" href="#id5">参数回调</a><a class="headerlink" href="#parameter-callbacks" title="永久链接至标题"></a></h3>
<p>ROS 2节点可以注册两种不同类型的回调函数，以在参数发生更改时进行通知。之所以存在两种类型的回调函数，是为了在参数更改发生之前有机会介入，并在参数更改发生之后有机会做出反应。节点可以注册这两种回调类型中的任何一种、全部或者不注册。以下分别描述了这两种类型。</p>
<p>第一种类型称为“设置参数”回调，可以通过从节点API调用``add_on_set_parameters_callback``进行设置。回调函数应接受一个``Parameter``对象的列表，并返回一个``rcl_interfaces/msg/SetParametersResult``。在节点声明或更改参数之前将调用此回调。此回调的主要目的是让用户有能力检查即将发生的参数更改并显式拒绝更改。</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>“设置参数”回调必须没有副作用很重要。由于可以链接多个“设置参数”回调，因此单个回调无法知道后续的回调是否会拒绝更新。例如，如果单个回调对其所在的类进行更改，可能会与实际参数不同步。要在参数成功更改后获取回调，请参阅下面的下一种回调类型。</p>
</div>
<p>第二种类型的回调称为“参数事件”回调，可以通过调用参数客户端API之一的``on_parameter_event``进行设置。回调函数应接受一个``rcl_interfaces/msg/ParameterEvent``对象，并返回空。在输入事件中的所有参数已声明、更改或删除后将调用此回调。此回调的主要目的是使用户能够对已成功接受的参数更改做出反应。</p>
</div>
</div>
<div class="section" id="interacting-with-parameters">
<h2><a class="toc-backref" href="#id6">与参数交互</a><a class="headerlink" href="#interacting-with-parameters" title="永久链接至标题"></a></h2>
<p>ROS 2节点可以通过节点API执行参数操作，如 <a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Using-Parameters-In-A-Class-CPP.html"><span class="doc">在类中使用参数（C++）</span></a> 或 <a class="reference internal" href="../Tutorials/Beginner-Client-Libraries/Using-Parameters-In-A-Class-Python.html"><span class="doc">在类中使用参数（Python）</span></a> 中所述。外部进程可以通过默认创建的参数服务执行参数操作，这些服务在实例化节点时默认创建。默认创建的服务包括：</p>
<ul class="simple">
<li><p>/node_name/describe_parameters：使用``rcl_interfaces/srv/DescribeParameters``作为服务类型。给定参数名称列表，返回与参数关联的描述符列表。</p></li>
<li><p>/node_name/get_parameter_types：使用 <code class="docutils literal notranslate"><span class="pre">rcl_interfaces/srv/GetParameterTypes</span></code> 服务类型。给定参数名称列表，返回与参数关联的参数类型列表。</p></li>
<li><p>/node_name/get_parameters：使用 <code class="docutils literal notranslate"><span class="pre">rcl_interfaces/srv/GetParameters</span></code> 服务类型。给定参数名称列表，返回与参数关联的参数值列表。</p></li>
<li><p>/node_name/list_parameters：使用 <code class="docutils literal notranslate"><span class="pre">rcl_interfaces/srv/ListParameters</span></code> 服务类型。给定可选的参数前缀列表，返回具有该前缀的可用参数列表。如果前缀为空，则返回所有参数。</p></li>
<li><p>/node_name/set_parameters：使用 <code class="docutils literal notranslate"><span class="pre">rcl_interfaces/srv/SetParameters</span></code> 服务类型。给定参数名称和值列表，尝试设置节点上的参数。返回尝试设置每个参数的结果列表；其中一些可能成功，一些可能失败。</p></li>
<li><p>/node_name/set_parameters_atomically：使用 <code class="docutils literal notranslate"><span class="pre">rcl_interfaces/srv/SetParametersAtomically</span></code> 服务类型。给定参数名称和值列表，尝试以原子方式设置节点上的参数。返回尝试设置所有参数的单个结果，因此如果有一个失败，则全部失败。</p></li>
</ul>
</div>
<div class="section" id="setting-initial-parameter-values-when-running-a-node">
<h2><a class="toc-backref" href="#id7">在运行节点时设置初始参数值</a><a class="headerlink" href="#setting-initial-parameter-values-when-running-a-node" title="永久链接至标题"></a></h2>
<p>运行节点时可以通过单独的命令行参数或YAML文件设置初始参数值。有关如何设置初始参数值的示例，请参阅 <a class="reference internal" href="../How-To-Guides/Node-arguments.html#nodeargsparameters"><span class="std std-ref">直接从命令行设置参数</span></a>。</p>
</div>
<div class="section" id="setting-initial-parameter-values-when-launching-nodes">
<h2><a class="toc-backref" href="#id8">启动节点时设置初始参数值</a><a class="headerlink" href="#setting-initial-parameter-values-when-launching-nodes" title="永久链接至标题"></a></h2>
<p>在通过ROS 2启动机制运行节点时，也可以设置初始参数值。有关如何通过启动机制指定参数的信息，请参阅 <a class="reference internal" href="../Tutorials/Intermediate/Launch/Using-ROS2-Launch-For-Large-Projects.html"><span class="doc">本文档</span></a>。</p>
</div>
<div class="section" id="manipulating-parameter-values-at-runtime">
<h2><a class="toc-backref" href="#id9">运行时操作参数值</a><a class="headerlink" href="#manipulating-parameter-values-at-runtime" title="永久链接至标题"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">param</span></code> 命令是与已经运行的节点交互的通用方式。<code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">param</span></code> 使用上述描述的参数服务 API 执行各种操作。有关如何使用 <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">param</span></code> 的详细信息，请参阅 <a class="reference internal" href="../How-To-Guides/Using-ros2-param.html"><span class="doc">本操作指南</span></a>。</p>
</div>
<div class="section" id="migrating-from-ros-1">
<h2><a class="toc-backref" href="#id10">从ROS 1迁移</a><a class="headerlink" href="#migrating-from-ros-1" title="永久链接至标题"></a></h2>
<p>在 <a class="reference internal" href="../How-To-Guides/Launch-files-migration-guide.html"><span class="doc">启动文件迁移指南</span></a> 中，解释了如何将 ROS 1 中的 <code class="docutils literal notranslate"><span class="pre">param</span></code> 和 <code class="docutils literal notranslate"><span class="pre">rosparam</span></code> 启动标签迁移到 ROS 2。</p>
<p>在 <a class="reference internal" href="../How-To-Guides/Parameters-YAML-files-migration-guide.html"><span class="doc">YAML 参数文件迁移指南</span></a> 中，解释了如何将参数文件从 ROS 1 迁移到 ROS 2。</p>
<p>在 ROS 1 中，<code class="docutils literal notranslate"><span class="pre">roscore</span></code> 的作用类似于全局参数黑板，所有节点都可以获取和设置参数。由于 ROS 2 中没有中央 <code class="docutils literal notranslate"><span class="pre">roscore</span></code>，这个功能不再存在。ROS 2 中推荐的方法是使用与使用它们的节点密切相关的每个节点参数。如果仍然需要全局黑板，可以为此创建一个专用节点。ROS 2 中附带了一个名为 <code class="docutils literal notranslate"><span class="pre">parameter_blackboard</span></code> 的节点，位于 <code class="docutils literal notranslate"><span class="pre">ros-humble-demo-nodes-cpp</span></code> 包中；可以使用以下命令运行：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 run demo_nodes_cpp parameter_blackboard</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">parameter_blackboard</span></code> 的代码在 <a class="reference external" href="https://github.com/ros2/demos/blob/humble/demo_nodes_cpp/src/parameters/parameter_blackboard.cpp">此处</a>。</p>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>