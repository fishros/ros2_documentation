<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Concepts/About-ROS-Interfaces</title>
</head>
<body>
  <div class="section" id="about-ros-2-interfaces">
<span id="interfaceconcept"></span><h1>关于 ROS 2 接口<a class="headerlink" href="#about-ros-2-interfaces" title="永久链接至标题"></a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id1">1. 背景</a></p></li>
<li><p><a class="reference internal" href="#message-description-specification" id="id2">2. 消息描述规范</a></p>
<ul>
<li><p><a class="reference internal" href="#fields" id="id3">2.1 字段</a></p>
<ul>
<li><p><a class="reference internal" href="#field-types" id="id4">2.1.1 字段类型</a></p></li>
<li><p><a class="reference internal" href="#field-names" id="id5">2.1.2 字段名称</a></p></li>
<li><p><a class="reference internal" href="#field-default-value" id="id6">2.1.3 字段默认值</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#constants" id="id7">2.2 常量</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#service-description-specification" id="id8">3. 服务描述规范</a></p></li>
<li><p><a class="reference internal" href="#new-features-in-ros-2-interfaces" id="id9">4. ROS 2接口中的新功能</a></p></li>
</ul>
</div>
<div class="section" id="background">
<h2><a class="toc-backref" href="#id1">1. 背景</a><a class="headerlink" href="#background" title="永久链接至标题"></a></h2>
<p>ROS 应用通常通过三种类型的接口进行通信：消息（messages）、服务（services）和动作（actions）。ROS 2 使用一种简化的描述语言，即接口定义语言（IDL），来描述这些接口。这种描述使得 ROS 工具能够自动为接口类型在多种目标语言中生成源代码。</p>
<p>在本文档中，我们将描述支持的类型：</p>
<ul class="simple">
<li><p>msg: <code class="docutils literal notranslate"><span class="pre">.msg</span></code> 文件是描述 ROS 消息字段的简单文本文件。它们用于在不同语言中生成消息的源代码。</p></li>
<li><p>srv: <code class="docutils literal notranslate"><span class="pre">.srv</span></code> 文件描述一个服务。它由两部分组成：请求和响应。请求和响应都是消息声明。</p></li>
<li><p>action: <code class="docutils literal notranslate"><span class="pre">.action</span></code> 文件描述一个动作。它由三部分组成：目标、结果和反馈。每个部分本身都是消息声明。</p></li>
</ul>
</div>
<div class="section" id="message-description-specification">
<h2><a class="toc-backref" href="#id2">2. 消息描述规范</a><a class="headerlink" href="#message-description-specification" title="永久链接至标题"></a></h2>
<p>ROS包的``msg/<code class="docutils literal notranslate"><span class="pre">目录中的</span></code>.msg``文件描述和定义了消息。<a href="#id1"><span class="problematic" id="id2">``</span></a>.msg``文件由两个部分组成：字段和常量。</p>
<div class="section" id="fields">
<h3><a class="toc-backref" href="#id3">2.1 字段</a><a class="headerlink" href="#fields" title="永久链接至标题"></a></h3>
<p>每个字段由类型和名称组成，用空格分隔，例如：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>fieldtype1 fieldname1
fieldtype2 fieldname2
fieldtype3 fieldname3
</pre></div>
</div>
<p>例如：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>int32 my_int
string my_string
</pre></div>
</div>
<div class="section" id="field-types">
<h4><a class="toc-backref" href="#id4">2.1.1 字段类型</a><a class="headerlink" href="#field-types" title="永久链接至标题"></a></h4>
<p>字段类型可以是：</p>
<ul class="simple">
<li><p>内置类型</p></li>
<li><p>独立定义的消息描述的名称，例如 &quot;geometry_msgs/PoseStamped&quot;</p></li>
</ul>
<p><em>当前支持的内置类型:</em></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>类型名称</p></th>
<th class="head"><p><a class="reference external" href="https://design.ros2.org/articles/generated_interfaces_cpp.html">C++</a></p></th>
<th class="head"><p><a class="reference external" href="https://design.ros2.org/articles/generated_interfaces_python.html">Python</a></p></th>
<th class="head"><p><a class="reference external" href="https://design.ros2.org/articles/mapping_dds_types.html">DDS 类型</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>bool</p></td>
<td><p>bool</p></td>
<td><p>builtins.bool</p></td>
<td><p>boolean</p></td>
</tr>
<tr class="row-odd"><td><p>byte</p></td>
<td><p>uint8_t</p></td>
<td><p>内建字节串*</p></td>
<td><p>八位字节</p></td>
</tr>
<tr class="row-even"><td><p>字符</p></td>
<td><p>字符</p></td>
<td><p>内建字符串*</p></td>
<td><p>字符</p></td>
</tr>
<tr class="row-odd"><td><p>单精度浮点数</p></td>
<td><p>浮点数</p></td>
<td><p>内置浮点型*</p></td>
<td><p>浮点数</p></td>
</tr>
<tr class="row-even"><td><p>float64</p></td>
<td><p>双精度</p></td>
<td><p>内置浮点型*</p></td>
<td><p>双精度</p></td>
</tr>
<tr class="row-odd"><td><p>int8</p></td>
<td><p>int8_t</p></td>
<td><p>内置整型*</p></td>
<td><p>八位字节</p></td>
</tr>
<tr class="row-even"><td><p>无符号8位整数</p></td>
<td><p>uint8_t</p></td>
<td><p>内置整型*</p></td>
<td><p>八位字节</p></td>
</tr>
<tr class="row-odd"><td><p>有符号16位整数</p></td>
<td><p>有符号16位整数</p></td>
<td><p>内置整型*</p></td>
<td><p>短整数</p></td>
</tr>
<tr class="row-even"><td><p>无符号16位整数</p></td>
<td><p>无符号16位整数</p></td>
<td><p>内置整型*</p></td>
<td><p>无符号短整型</p></td>
</tr>
<tr class="row-odd"><td><p>32位整型</p></td>
<td><p>int32_t</p></td>
<td><p>内置整型*</p></td>
<td><p>长整型</p></td>
</tr>
<tr class="row-even"><td><p>无符号32位整型</p></td>
<td><p>uint32_t</p></td>
<td><p>内置整型*</p></td>
<td><p>无符号长整型</p></td>
</tr>
<tr class="row-odd"><td><p>64位整型</p></td>
<td><p>int64_t</p></td>
<td><p>内置整型*</p></td>
<td><p>长长整型</p></td>
</tr>
<tr class="row-even"><td><p>无符号64位整型</p></td>
<td><p>uint64_t</p></td>
<td><p>内置整型*</p></td>
<td><p>无符号长长整型</p></td>
</tr>
<tr class="row-odd"><td><p>字符串</p></td>
<td><p>std::字符串</p></td>
<td><p>内建.字符串</p></td>
<td><p>字符串</p></td>
</tr>
<tr class="row-even"><td><p>宽字符串</p></td>
<td><p>std::u16字符串</p></td>
<td><p>内建.字符串</p></td>
<td><p>宽字符串</p></td>
</tr>
</tbody>
</table>
<p><em>每个内置类型都可以用来定义数组:</em></p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>类型名称</p></th>
<th class="head"><p><a class="reference external" href="https://design.ros2.org/articles/generated_interfaces_cpp.html">C++</a></p></th>
<th class="head"><p><a class="reference external" href="https://design.ros2.org/articles/generated_interfaces_python.html">Python</a></p></th>
<th class="head"><p><a class="reference external" href="https://design.ros2.org/articles/mapping_dds_types.html">DDS 类型</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>静态数组</p></td>
<td><p>std::array&lt;T, N&gt;</p></td>
<td><p>内置类型列表*</p></td>
<td><p>T[N]</p></td>
</tr>
<tr class="row-odd"><td><p>无界动态数组</p></td>
<td><p>std::vector</p></td>
<td><p>builtins.list</p></td>
<td><p>sequence</p></td>
</tr>
<tr class="row-even"><td><p>bounded dynamic array</p></td>
<td><p>custom_class&lt;T, N&gt;</p></td>
<td><p>内置类型列表*</p></td>
<td><p>sequence&lt;T, N&gt;</p></td>
</tr>
<tr class="row-odd"><td><p>有界字符串</p></td>
<td><p>std::字符串</p></td>
<td><p>内建字符串*</p></td>
<td><p>字符串</p></td>
</tr>
</tbody>
</table>
<p>所有比它们的ROS定义更宽松的类型都通过软件强制执行范围和长度上的ROS约束</p>
<p><em>使用数组和有界类型的消息定义示例:</em></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>int32<span class="o">[]</span> unbounded_integer_array
int32<span class="o">[</span><span class="m">5</span><span class="o">]</span> five_integers_array
int32<span class="o">[</span>&lt;<span class="o">=</span><span class="m">5</span><span class="o">]</span> up_to_five_integers_array

string string_of_unbounded_size
string&lt;<span class="o">=</span><span class="m">10</span> up_to_ten_characters_string

string<span class="o">[</span>&lt;<span class="o">=</span><span class="m">5</span><span class="o">]</span> up_to_five_unbounded_strings
string&lt;<span class="o">=</span><span class="m">10</span><span class="o">[]</span> unbounded_array_of_strings_up_to_ten_characters_each
string&lt;<span class="o">=</span><span class="m">10</span><span class="o">[</span>&lt;<span class="o">=</span><span class="m">5</span><span class="o">]</span> up_to_five_strings_up_to_ten_characters_each
</pre></div>
</div>
</div>
<div class="section" id="field-names">
<h4><a class="toc-backref" href="#id5">2.1.2 字段名称</a><a class="headerlink" href="#field-names" title="永久链接至标题"></a></h4>
<p>字段名称必须是小写字母数字字符，用下划线分隔单词。它们必须以字母字符开头，不能以下划线结尾，也不能有两个连续的下划线。</p>
</div>
<div class="section" id="field-default-value">
<h4><a class="toc-backref" href="#id6">2.1.3 字段默认值</a><a class="headerlink" href="#field-default-value" title="永久链接至标题"></a></h4>
<p>消息类型中的任何字段都可以设置默认值。目前不支持为字符串数组和复杂类型（即不在上面的内置类型表中的类型，适用于所有嵌套消息）设置默认值。</p>
<p>通过在字段定义行中添加第三个元素来定义默认值，例如：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>fieldtype fieldname fielddefaultvalue
</pre></div>
</div>
<p>例如：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>uint8 x <span class="m">42</span>
int16 y -2000
string full_name <span class="s2">&quot;John Doe&quot;</span>
int32<span class="o">[]</span> samples <span class="o">[</span>-200, -100, <span class="m">0</span>, <span class="m">100</span>, <span class="m">200</span><span class="o">]</span>
</pre></div>
</div>
<p>注意：</p>
<ul class="simple">
<li><p>字符串值必须用单引号 <code class="docutils literal notranslate"><span class="pre">'</span></code> 或双引号 <code class="docutils literal notranslate"><span class="pre">&quot;</span></code> 定义</p></li>
<li><p>当前字符串值不被转义</p></li>
</ul>
</div>
</div>
<div class="section" id="constants">
<h3><a class="toc-backref" href="#id7">2.2 常量</a><a class="headerlink" href="#constants" title="永久链接至标题"></a></h3>
<p>每个常量定义都类似于具有默认值的字段描述，但是这个值在程序中不能被改变。这个值的赋值通过等号 '=' 来表示，例如。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>constanttype <span class="nv">CONSTANTNAME</span><span class="o">=</span>constantvalue
</pre></div>
</div>
<p>例如：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>int32 <span class="nv">X</span><span class="o">=</span><span class="m">123</span>
int32 <span class="nv">Y</span><span class="o">=</span>-123
string <span class="nv">FOO</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span>
string <span class="nv">EXAMPLE</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>常量名称必须是大写字母。</p>
</div>
</div>
</div>
<div class="section" id="service-description-specification">
<h2><a class="toc-backref" href="#id8">3. 服务描述规范</a><a class="headerlink" href="#service-description-specification" title="永久链接至标题"></a></h2>
<p>服务在 ROS 包的 'srv/' 目录下的 '.srv' 文件中进行描述和定义。</p>
<p>一个服务描述文件由请求和响应的消息类型组成，用 '---' 分隔。任何两个 '.msg' 文件通过 '---' 连接在一起都构成一个合法的服务描述。</p>
<p>以下是一个非常简单的服务示例，它接收一个字符串并返回一个字符串：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>string str
---
string str
</pre></div>
</div>
<p>当然，我们可以变得更加复杂（如果你想引用同一包中的消息，不需要提及包名）：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#request constants</span>
int8 <span class="nv">FOO</span><span class="o">=</span><span class="m">1</span>
int8 <span class="nv">BAR</span><span class="o">=</span><span class="m">2</span>
<span class="c1">#request fields</span>
int8 foobar
another_pkg/AnotherMessage msg
---
<span class="c1">#response constants</span>
uint32 <span class="nv">SECRET</span><span class="o">=</span><span class="m">123456</span>
<span class="c1">#response fields</span>
another_pkg/YetAnotherMessage val
CustomMessageDefinedInThisPackage value
uint32 an_integer
</pre></div>
</div>
<p>你不能在一个服务中嵌入另一个服务。</p>
</div>
<div class="section" id="new-features-in-ros-2-interfaces">
<h2><a class="toc-backref" href="#id9">4. ROS 2接口中的新功能</a><a class="headerlink" href="#new-features-in-ros-2-interfaces" title="永久链接至标题"></a></h2>
<p>ROS 2 IDL与 <a class="reference external" href="https://wiki.ros.org/msg">ROS 1 IDL</a> 密切相关。大多数现有的 ROS 1 <code class="docutils literal notranslate"><span class="pre">.msg</span></code> 和 <code class="docutils literal notranslate"><span class="pre">.srv</span></code> 文件应该可以直接在 ROS 2 中使用。在 ROS 1 的现有功能集的基础上，ROS 2 IDL 还引入了一些新功能，包括：</p>
<ul class="simple">
<li><p><strong>有界数组</strong>：与 ROS 1 IDL 允许无界数组（例如，<code class="docutils literal notranslate"><span class="pre">int32[]</span> <span class="pre">foo</span></code>）和固定大小数组（例如，<code class="docutils literal notranslate"><span class="pre">int32[5]</span> <span class="pre">bar</span></code>）不同，ROS 2 IDL 进一步允许有界数组（例如，<code class="docutils literal notranslate"><span class="pre">int32[&lt;=5]</span> <span class="pre">bat</span></code>）。在某些情况下，能够对数组的大小设定上限是很重要的，而不必始终使用那么多的空间（例如，在需要预分配执行期间将使用的所有内存的实时系统中）。</p></li>
<li><p><strong>有界字符串</strong>：与 ROS 1 IDL 允许无界字符串（例如，<code class="docutils literal notranslate"><span class="pre">string</span> <span class="pre">foo</span></code>）不同，ROS 2 IDL 进一步允许有界字符串（例如，<code class="docutils literal notranslate"><span class="pre">string&lt;=5</span> <span class="pre">bar</span></code>）。</p></li>
<li><p><strong>默认值</strong>: ROS 1 IDL 允许使用常量字段（例如，<code class="docutils literal notranslate"><span class="pre">int32</span> <span class="pre">X=123</span></code>），而 ROS 2 IDL 进一步允许指定默认值（例如，<code class="docutils literal notranslate"><span class="pre">int32</span> <span class="pre">X</span> <span class="pre">123</span></code>）。默认值在构造消息/服务对象时使用，并且可以通过对字段进行赋值来覆盖。您还可以为动作部分指定默认值。</p></li>
</ul>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>