<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutorials/Intermediate/Creating-an-Action</title>
</head>
<body>
  <div class="section" id="creating-an-action">
<span id="actioncreate"></span><h1>创建一个动作<a class="headerlink" href="#creating-an-action" title="永久链接至标题"></a></h1>
<p><strong>目标：</strong> 在ROS 2软件包中定义一个动作。</p>
<p><strong>教程级别：</strong> 中级</p>
<p><strong>时间：</strong> 5分钟</p>
<div class="contents local topic" id="contents">
<p class="topic-title">内容</p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id1">背景</a></p></li>
<li><p><a class="reference internal" href="#prerequisites" id="id2">先决条件</a></p></li>
<li><p><a class="reference internal" href="#tasks" id="id3">任务</a></p>
<ul>
<li><p><a class="reference internal" href="#defining-an-action" id="id4">1 定义一个动作</a></p></li>
<li><p><a class="reference internal" href="#building-an-action" id="id5">2 构建一个action</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#summary" id="id6">总结</a></p></li>
<li><p><a class="reference internal" href="#next-steps" id="id7">下一步</a></p></li>
<li><p><a class="reference internal" href="#related-content" id="id8">相关内容</a></p></li>
</ul>
</div>
<div class="section" id="background">
<h2><a class="toc-backref" href="#id1">背景</a><a class="headerlink" href="#background" title="永久链接至标题"></a></h2>
<p>在之前的 <a class="reference internal" href="../Beginner-CLI-Tools/Understanding-ROS2-Actions/Understanding-ROS2-Actions.html"><span class="doc">理解行为</span></a> 教程中，你学习了关于动作的内容。和其他通信类型及其相应的接口（topics/msg 和 services/srv）一样，你也可以在你的包中自定义定义动作。本教程将向你展示如何定义和构建一个动作，你可以在下一个教程中使用该动作服务器和动作客户端进行编写。</p>
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id2">先决条件</a><a class="headerlink" href="#prerequisites" title="永久链接至标题"></a></h2>
<p>你应该已经安装了 <a class="reference internal" href="../../Installation.html"><span class="doc">ROS 2</span></a> 和 <a class="reference external" href="https://colcon.readthedocs.org">colcon</a>。</p>
<p>设置一个 <a class="reference internal" href="../Beginner-Client-Libraries/Creating-A-Workspace/Creating-A-Workspace.html"><span class="doc">workspace</span></a> 并创建一个名为 <code class="docutils literal notranslate"><span class="pre">action_tutorials_interfaces</span></code> 的包：</p>
<p>（记得首先 <a class="reference internal" href="../Beginner-CLI-Tools/Configuring-ROS2-Environment.html"><span class="doc">source your ROS 2 installation</span></a>。）</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-0-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button><button aria-controls="panel-0-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-0-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-0-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir -p ros2_ws/src <span class="c1">#you can reuse existing workspace with this naming convention</span>
<span class="nb">cd</span> ros2_ws/src
ros2 pkg create action_tutorials_interfaces
</pre></div>
</div>
</div><div aria-labelledby="tab-0-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir -p ros2_ws/src
<span class="nb">cd</span> ros2_ws/src
ros2 pkg create action_tutorials_interfaces
</pre></div>
</div>
</div><div aria-labelledby="tab-0-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>md ros2_ws<span class="se">\s</span>rc
<span class="nb">cd</span> ros2_ws<span class="se">\s</span>rc
ros2 pkg create action_tutorials_interfaces
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="tasks">
<h2><a class="toc-backref" href="#id3">任务</a><a class="headerlink" href="#tasks" title="永久链接至标题"></a></h2>
<div class="section" id="defining-an-action">
<h3><a class="toc-backref" href="#id4">1 定义一个动作</a><a class="headerlink" href="#defining-an-action" title="永久链接至标题"></a></h3>
<p>动作在 <code class="docutils literal notranslate"><span class="pre">.action</span></code> 文件中定义，格式如下：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Request</span>
---
<span class="c1"># Result</span>
---
<span class="c1"># Feedback</span>
</pre></div>
</div>
<p>一个动作定义由三个消息定义组成，用 <code class="docutils literal notranslate"><span class="pre">---</span></code> 分隔。</p>
<ul class="simple">
<li><p>一个 <em>请求</em> 消息是从动作客户端发送到动作服务器，用于启动一个新的目标。</p></li>
<li><p>一个 <em>结果</em> 消息是从动作服务器发送到动作客户端，表示一个目标已完成。</p></li>
<li><p><em>Feedback</em> messages are periodically sent from an action server to an action client with updates about a goal.</p></li>
</ul>
<p>一个动作的实例通常被称为一个 <em>目标</em>。</p>
<p>假设我们想要定义一个用于计算 <a class="reference external" href="https://en.wikipedia.org/wiki/Fibonacci_number">斐波那契数列</a> 的新动作 &quot;Fibonacci&quot;。</p>
<p>在我们的ROS 2包`action_tutorials_interfaces`中创建一个名为`action`的目录：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-1-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button><button aria-controls="panel-1-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-1-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-1-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> action_tutorials_interfaces
mkdir action
</pre></div>
</div>
</div><div aria-labelledby="tab-1-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> action_tutorials_interfaces
mkdir action
</pre></div>
</div>
</div><div aria-labelledby="tab-1-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> action_tutorials_interfaces
md action
</pre></div>
</div>
</div></div>
<p>在`action`目录中创建一个名为`Fibonacci.action`的文件，并包含以下内容：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">int32 order</span>
<span class="go">---</span>
<span class="go">int32[] sequence</span>
<span class="go">---</span>
<span class="go">int32[] partial_sequence</span>
</pre></div>
</div>
<p>目标请求是我们想要计算的斐波那契序列的`order`，结果是最终的`sequence`，反馈是到目前为止计算出的`partial_sequence`。</p>
</div>
<div class="section" id="building-an-action">
<h3><a class="toc-backref" href="#id5">2 构建一个action</a><a class="headerlink" href="#building-an-action" title="永久链接至标题"></a></h3>
<p>在我们的代码中使用新的Fibonacci action类型之前，我们必须将定义传递给rosidl代码生成流程。</p>
<p>这可以通过在`action_tutorials_interfaces`的`CMakeLists.txt`文件中在`ament_package()`之前添加以下行来实现：</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">find_package</span><span class="p">(</span><span class="s">rosidl_default_generators</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>

<span class="nb">rosidl_generate_interfaces</span><span class="p">(</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span>
<span class="w">  </span><span class="s2">&quot;action/Fibonacci.action&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>我们还需要将所需的依赖项添加到我们的 <code class="docutils literal notranslate"><span class="pre">package.xml</span></code> 文件中：</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;buildtool_depend&gt;</span>rosidl_default_generators<span class="nt">&lt;/buildtool_depend&gt;</span>

<span class="nt">&lt;depend&gt;</span>action_msgs<span class="nt">&lt;/depend&gt;</span>

<span class="nt">&lt;member_of_group&gt;</span>rosidl_interface_packages<span class="nt">&lt;/member_of_group&gt;</span>
</pre></div>
</div>
<p>注意，我们需要依赖于 <code class="docutils literal notranslate"><span class="pre">action_msgs</span></code>，因为动作定义包括附加元数据（例如目标 ID）。</p>
<p>现在，我们应该能够构建包含 <code class="docutils literal notranslate"><span class="pre">Fibonacci</span></code> 动作定义的软件包：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change to the root of the workspace</span>
<span class="nb">cd</span> ~/ros2_ws
<span class="c1"># Build</span>
colcon build
</pre></div>
</div>
<p>我们完成了！</p>
<p>按照惯例，动作类型将以其包名称和单词 <code class="docutils literal notranslate"><span class="pre">action</span></code> 作为前缀。因此，当我们想引用我们的新动作时，它将具有完整的名称 <code class="docutils literal notranslate"><span class="pre">action_tutorials_interfaces/action/Fibonacci</span></code>。</p>
<p>我们可以使用命令行工具检查我们的动作是否成功构建：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Source our workspace</span>
<span class="c1"># On Windows: call install/setup.bat</span>
. install/setup.bash
<span class="c1"># Check that our action definition exists</span>
ros2 interface show action_tutorials_interfaces/action/Fibonacci
</pre></div>
</div>
<p>你应该在屏幕上看到打印出的斐波那契动作定义。</p>
</div>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id6">总结</a><a class="headerlink" href="#summary" title="永久链接至标题"></a></h2>
<p>在本教程中，你学会了动作定义的结构。你还学会了如何正确构建一个新的动作接口，使用 <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> 和 <code class="docutils literal notranslate"><span class="pre">package.xml</span></code>，以及如何验证构建的成功。</p>
</div>
<div class="section" id="next-steps">
<h2><a class="toc-backref" href="#id7">下一步</a><a class="headerlink" href="#next-steps" title="永久链接至标题"></a></h2>
<p>接下来，让我们利用你新定义的动作接口来创建一个动作服务和客户端（在 <a class="reference internal" href="Writing-an-Action-Server-Client/Py.html"><span class="doc">Python</span></a> 或 <a class="reference internal" href="Writing-an-Action-Server-Client/Cpp.html"><span class="doc">C++</span></a> 中）。</p>
</div>
<div class="section" id="related-content">
<h2><a class="toc-backref" href="#id8">相关内容</a><a class="headerlink" href="#related-content" title="永久链接至标题"></a></h2>
<p>有关ROS动作的更详细信息，请参阅 <a class="reference external" href="http://design.ros2.org/articles/actions.html">设计文章</a>。</p>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>