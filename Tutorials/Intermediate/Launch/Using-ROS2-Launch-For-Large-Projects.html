<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutorials/Intermediate/Launch/Using-ROS2-Launch-For-Large-Projects</title>
</head>
<body>
  <div class="section" id="managing-large-projects">
<span id="usingros2launchforlargeprojects"></span><h1>管理大型项目<a class="headerlink" href="#managing-large-projects" title="永久链接至标题"></a></h1>
<p><strong>目标:</strong> 学习使用ROS 2启动文件管理大型项目的最佳实践。</p>
<p><strong>教程级别：</strong> 中级</p>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>时间：<a href="#id3"><span class="problematic" id="id4">**</span></a>20分钟</p>
<div class="contents local topic" id="contents">
<p class="topic-title">内容</p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id1">背景</a></p></li>
<li><p><a class="reference internal" href="#prerequisites" id="id2">先决条件</a></p></li>
<li><p><a class="reference internal" href="#introduction" id="id3">介绍</a></p></li>
<li><p><a class="reference internal" href="#writing-launch-files" id="id4">编写启动文件</a></p>
<ul>
<li><p><a class="reference internal" href="#top-level-organization" id="id5">1 顶层组织</a></p></li>
<li><p><a class="reference internal" href="#parameters" id="id6">2 参数</a></p>
<ul>
<li><p><a class="reference internal" href="#setting-parameters-in-the-launch-file" id="id7">2.1 在启动文件中设置参数</a></p></li>
<li><p><a class="reference internal" href="#loading-parameters-from-yaml-file" id="id8">2.2 从YAML文件中加载参数</a></p></li>
<li><p><a class="reference internal" href="#using-wildcards-in-yaml-files" id="id9">2.3 在YAML文件中使用通配符</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#namespaces" id="id10">3 个命名空间</a></p></li>
<li><p><a class="reference internal" href="#reusing-nodes" id="id11">4 重复使用节点</a></p></li>
<li><p><a class="reference internal" href="#parameter-overrides" id="id12">5 参数覆盖</a></p></li>
<li><p><a class="reference internal" href="#remapping" id="id13">6 重映射</a></p></li>
<li><p><a class="reference internal" href="#config-files" id="id14">7 配置文件</a></p></li>
<li><p><a class="reference internal" href="#environment-variables" id="id15">8 环境变量</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-launch-files" id="id16">运行启动文件</a></p>
<ul>
<li><p><a class="reference internal" href="#update-setup-py" id="id17">1 更新 setup.py</a></p></li>
<li><p><a class="reference internal" href="#build-and-run" id="id18">2 构建和运行</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#summary" id="id19">总结</a></p></li>
</ul>
</div>
<div class="section" id="background">
<h2><a class="toc-backref" href="#id1">背景</a><a class="headerlink" href="#background" title="永久链接至标题"></a></h2>
<p>本教程介绍了编写大型项目启动文件的一些技巧。重点是如何结构化启动文件，使其在不同情况下尽可能地被重用。此外，还介绍了不同的ROS 2启动工具的使用示例，例如参数、YAML文件、重映射、命名空间、默认参数和RViz配置。</p>
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id2">先决条件</a><a class="headerlink" href="#prerequisites" title="永久链接至标题"></a></h2>
<p>本教程使用了 <a class="reference internal" href="../../Beginner-CLI-Tools/Introducing-Turtlesim/Introducing-Turtlesim.html"><span class="doc">turtlesim</span></a> 和 <a class="reference internal" href="../Tf2/Introduction-To-Tf2.html"><span class="doc">turtle_tf2_py</span></a> 包。本教程还假设您已经 <a class="reference internal" href="../../Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html"><span class="doc">创建了一个名为``launch_tutorial``的新包</span></a>，其构建类型为``ament_python``。</p>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id3">介绍</a><a class="headerlink" href="#introduction" title="永久链接至标题"></a></h2>
<p>机器人上的大型应用程序通常涉及多个相互连接的节点，每个节点可以有很多参数。多个海龟在海龟模拟器中的仿真可以作为一个很好的例子。海龟仿真由多个海龟节点、世界配置以及TF广播器和监听器节点组成。在所有节点之间，有很多ROS参数会影响这些节点的行为和外观。ROS 2启动文件允许我们在一个地方启动所有节点并设置相应的参数。在教程的最后，您将在``launch_tutorial``包中构建``launch_turtlesim.launch.py``启动文件。该启动文件将启动负责模拟两个turtlesim仿真的不同节点，启动TF广播器和监听器，加载参数，并启动RViz配置。在本教程中，我们将介绍该启动文件及其所有相关功能。</p>
</div>
<div class="section" id="writing-launch-files">
<h2><a class="toc-backref" href="#id4">编写启动文件</a><a class="headerlink" href="#writing-launch-files" title="永久链接至标题"></a></h2>
<div class="section" id="top-level-organization">
<h3><a class="toc-backref" href="#id5">1 顶层组织</a><a class="headerlink" href="#top-level-organization" title="永久链接至标题"></a></h3>
<p>在编写启动文件的过程中，一个目标应该是尽可能使它们可重用。这可以通过将相关的节点和配置聚集到单独的启动文件中来实现。然后，可以编写一个专门用于特定配置的顶层启动文件。这样，即使在完全不更改启动文件的情况下，也可以在相同的机器人之间进行切换。甚至只需进行少量更改，例如从真实机器人切换到模拟机器人。</p>
<p>现在我们将介绍使此功能成为可能的顶层启动文件结构。首先，我们将创建一个调用其他启动文件的启动文件。为此，请在“launch_tutorial”软件包的“/launch”文件夹中创建一个名为“launch_turtlesim.launch.py”的文件。</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">ament_index_python.packages</span> <span class="kn">import</span> <span class="n">get_package_share_directory</span>

<span class="kn">from</span> <span class="nn">launch</span> <span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span> <span class="nn">launch.actions</span> <span class="kn">import</span> <span class="n">IncludeLaunchDescription</span>
<span class="kn">from</span> <span class="nn">launch.launch_description_sources</span> <span class="kn">import</span> <span class="n">PythonLaunchDescriptionSource</span>


<span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>
   <span class="n">turtlesim_world_1</span> <span class="o">=</span> <span class="n">IncludeLaunchDescription</span><span class="p">(</span>
      <span class="n">PythonLaunchDescriptionSource</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
         <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;launch_tutorial&#39;</span><span class="p">),</span> <span class="s1">&#39;launch&#39;</span><span class="p">),</span>
         <span class="s1">&#39;/turtlesim_world_1.launch.py&#39;</span><span class="p">])</span>
      <span class="p">)</span>
   <span class="n">turtlesim_world_2</span> <span class="o">=</span> <span class="n">IncludeLaunchDescription</span><span class="p">(</span>
      <span class="n">PythonLaunchDescriptionSource</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
         <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;launch_tutorial&#39;</span><span class="p">),</span> <span class="s1">&#39;launch&#39;</span><span class="p">),</span>
         <span class="s1">&#39;/turtlesim_world_2.launch.py&#39;</span><span class="p">])</span>
      <span class="p">)</span>
   <span class="n">broadcaster_listener_nodes</span> <span class="o">=</span> <span class="n">IncludeLaunchDescription</span><span class="p">(</span>
      <span class="n">PythonLaunchDescriptionSource</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
         <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;launch_tutorial&#39;</span><span class="p">),</span> <span class="s1">&#39;launch&#39;</span><span class="p">),</span>
         <span class="s1">&#39;/broadcaster_listener.launch.py&#39;</span><span class="p">]),</span>
      <span class="n">launch_arguments</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;target_frame&#39;</span><span class="p">:</span> <span class="s1">&#39;carrot1&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
      <span class="p">)</span>
   <span class="n">mimic_node</span> <span class="o">=</span> <span class="n">IncludeLaunchDescription</span><span class="p">(</span>
      <span class="n">PythonLaunchDescriptionSource</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
         <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;launch_tutorial&#39;</span><span class="p">),</span> <span class="s1">&#39;launch&#39;</span><span class="p">),</span>
         <span class="s1">&#39;/mimic.launch.py&#39;</span><span class="p">])</span>
      <span class="p">)</span>
   <span class="n">fixed_frame_node</span> <span class="o">=</span> <span class="n">IncludeLaunchDescription</span><span class="p">(</span>
      <span class="n">PythonLaunchDescriptionSource</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
         <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;launch_tutorial&#39;</span><span class="p">),</span> <span class="s1">&#39;launch&#39;</span><span class="p">),</span>
         <span class="s1">&#39;/fixed_broadcaster.launch.py&#39;</span><span class="p">])</span>
      <span class="p">)</span>
   <span class="n">rviz_node</span> <span class="o">=</span> <span class="n">IncludeLaunchDescription</span><span class="p">(</span>
      <span class="n">PythonLaunchDescriptionSource</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
         <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;launch_tutorial&#39;</span><span class="p">),</span> <span class="s1">&#39;launch&#39;</span><span class="p">),</span>
         <span class="s1">&#39;/turtlesim_rviz.launch.py&#39;</span><span class="p">])</span>
      <span class="p">)</span>

   <span class="k">return</span> <span class="n">LaunchDescription</span><span class="p">([</span>
      <span class="n">turtlesim_world_1</span><span class="p">,</span>
      <span class="n">turtlesim_world_2</span><span class="p">,</span>
      <span class="n">broadcaster_listener_nodes</span><span class="p">,</span>
      <span class="n">mimic_node</span><span class="p">,</span>
      <span class="n">fixed_frame_node</span><span class="p">,</span>
      <span class="n">rviz_node</span>
   <span class="p">])</span>
</pre></div>
</div>
<p>该启动文件包括一组其他启动文件。这些被包含的启动文件中每一个都包含了与系统的一个部分相关的节点、参数，以及可能的嵌套包含项。确切地说，我们启动了两个turtlesim仿真世界、TF广播器、TF监听器、模仿器、固定帧广播器和RViz节点。</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>设计提示：顶层启动文件应该简短，由包含到应用程序的子组件对应文件的包含项组成，并包含常常更改的参数。</p>
</div>
<p>按照以下方式编写启动文件可以轻松地替换系统的某个部分，我们稍后将会看到。然而，出于性能和使用原因，有时需要单独启动某些节点或启动文件。</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>设计提示：在决定应用程序需要多少个顶层启动文件时，请注意权衡。</p>
</div>
</div>
<div class="section" id="parameters">
<h3><a class="toc-backref" href="#id6">2 参数</a><a class="headerlink" href="#parameters" title="永久链接至标题"></a></h3>
<div class="section" id="setting-parameters-in-the-launch-file">
<h4><a class="toc-backref" href="#id7">2.1 在启动文件中设置参数</a><a class="headerlink" href="#setting-parameters-in-the-launch-file" title="永久链接至标题"></a></h4>
<p>我们将首先编写一个启动文件，用于启动我们的第一个turtlesim仿真。首先，创建一个名为``turtlesim_world_1.launch.py``的新文件。</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">launch</span> <span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span> <span class="nn">launch.actions</span> <span class="kn">import</span> <span class="n">DeclareLaunchArgument</span>
<span class="kn">from</span> <span class="nn">launch.substitutions</span> <span class="kn">import</span> <span class="n">LaunchConfiguration</span><span class="p">,</span> <span class="n">TextSubstitution</span>

<span class="kn">from</span> <span class="nn">launch_ros.actions</span> <span class="kn">import</span> <span class="n">Node</span>


<span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>
   <span class="n">background_r_launch_arg</span> <span class="o">=</span> <span class="n">DeclareLaunchArgument</span><span class="p">(</span>
      <span class="s1">&#39;background_r&#39;</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">TextSubstitution</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
   <span class="p">)</span>
   <span class="n">background_g_launch_arg</span> <span class="o">=</span> <span class="n">DeclareLaunchArgument</span><span class="p">(</span>
      <span class="s1">&#39;background_g&#39;</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">TextSubstitution</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;84&#39;</span><span class="p">)</span>
   <span class="p">)</span>
   <span class="n">background_b_launch_arg</span> <span class="o">=</span> <span class="n">DeclareLaunchArgument</span><span class="p">(</span>
      <span class="s1">&#39;background_b&#39;</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="n">TextSubstitution</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;122&#39;</span><span class="p">)</span>
   <span class="p">)</span>

   <span class="k">return</span> <span class="n">LaunchDescription</span><span class="p">([</span>
      <span class="n">background_r_launch_arg</span><span class="p">,</span>
      <span class="n">background_g_launch_arg</span><span class="p">,</span>
      <span class="n">background_b_launch_arg</span><span class="p">,</span>
      <span class="n">Node</span><span class="p">(</span>
         <span class="n">package</span><span class="o">=</span><span class="s1">&#39;turtlesim&#39;</span><span class="p">,</span>
         <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;turtlesim_node&#39;</span><span class="p">,</span>
         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sim&#39;</span><span class="p">,</span>
         <span class="n">parameters</span><span class="o">=</span><span class="p">[{</span>
            <span class="s1">&#39;background_r&#39;</span><span class="p">:</span> <span class="n">LaunchConfiguration</span><span class="p">(</span><span class="s1">&#39;background_r&#39;</span><span class="p">),</span>
            <span class="s1">&#39;background_g&#39;</span><span class="p">:</span> <span class="n">LaunchConfiguration</span><span class="p">(</span><span class="s1">&#39;background_g&#39;</span><span class="p">),</span>
            <span class="s1">&#39;background_b&#39;</span><span class="p">:</span> <span class="n">LaunchConfiguration</span><span class="p">(</span><span class="s1">&#39;background_b&#39;</span><span class="p">),</span>
         <span class="p">}]</span>
      <span class="p">),</span>
   <span class="p">])</span>
</pre></div>
</div>
<p>该启动文件启动``turtlesim_node``节点，该节点启动turtlesim仿真，并将定义和传递给节点的仿真配置参数。</p>
</div>
<div class="section" id="loading-parameters-from-yaml-file">
<h4><a class="toc-backref" href="#id8">2.2 从YAML文件中加载参数</a><a class="headerlink" href="#loading-parameters-from-yaml-file" title="永久链接至标题"></a></h4>
<p>在第二个启动文件中，我们将使用不同的配置启动第二个turtlesim仿真。现在创建一个``turtlesim_world_2.launch.py``文件。</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">ament_index_python.packages</span> <span class="kn">import</span> <span class="n">get_package_share_directory</span>

<span class="kn">from</span> <span class="nn">launch</span> <span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span> <span class="nn">launch_ros.actions</span> <span class="kn">import</span> <span class="n">Node</span>


<span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>
   <span class="n">config</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
      <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;launch_tutorial&#39;</span><span class="p">),</span>
      <span class="s1">&#39;config&#39;</span><span class="p">,</span>
      <span class="s1">&#39;turtlesim.yaml&#39;</span>
      <span class="p">)</span>

   <span class="k">return</span> <span class="n">LaunchDescription</span><span class="p">([</span>
      <span class="n">Node</span><span class="p">(</span>
         <span class="n">package</span><span class="o">=</span><span class="s1">&#39;turtlesim&#39;</span><span class="p">,</span>
         <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;turtlesim_node&#39;</span><span class="p">,</span>
         <span class="n">namespace</span><span class="o">=</span><span class="s1">&#39;turtlesim2&#39;</span><span class="p">,</span>
         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sim&#39;</span><span class="p">,</span>
         <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="n">config</span><span class="p">]</span>
      <span class="p">)</span>
   <span class="p">])</span>
</pre></div>
</div>
<p>这个启动文件将使用直接从YAML配置文件中加载的参数值来启动相同的``turtlesim_node``。在YAML文件中定义参数和变量可以方便地存储和加载大量的变量。此外，YAML文件可以轻松地从当前的``ros2 param``列表导出。要了解如何做到这一点，请参考 <a class="reference internal" href="../../Beginner-CLI-Tools/Understanding-ROS2-Parameters/Understanding-ROS2-Parameters.html"><span class="doc">了解参数</span></a> 教程。</p>
<p>现在让我们在包的``/config``文件夹中创建一个名为``turtlesim.yaml``的配置文件，这个文件将被我们的启动文件加载。</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">/turtlesim2/sim</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="nt">ros__parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">background_b</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">255</span><span class="w"></span>
<span class="w">      </span><span class="nt">background_g</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">86</span><span class="w"></span>
<span class="w">      </span><span class="nt">background_r</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">150</span><span class="w"></span>
</pre></div>
</div>
<p>如果我们现在启动``turtlesim_world_2.launch.py``启动文件，我们将启动带有预配置背景颜色的``turtlesim_node``。</p>
<p>要了解更多关于使用参数和使用YAML文件的信息，请查看 <a class="reference internal" href="../../Beginner-CLI-Tools/Understanding-ROS2-Parameters/Understanding-ROS2-Parameters.html"><span class="doc">了解参数</span></a> 教程。</p>
</div>
<div class="section" id="using-wildcards-in-yaml-files">
<h4><a class="toc-backref" href="#id9">2.3 在YAML文件中使用通配符</a><a class="headerlink" href="#using-wildcards-in-yaml-files" title="永久链接至标题"></a></h4>
<p>有些情况下，我们希望在多个节点中设置相同的参数。这些节点可能有不同的命名空间或名称，但仍具有相同的参数。定义单独的YAML文件来显式定义命名空间和节点名称是不高效的。解决方案是使用通配符字符，它们作为未知字符的替代，将参数应用于多个不同的节点。</p>
<p>现在让我们创建一个新的 <code class="docutils literal notranslate"><span class="pre">turtlesim_world_3.launch.py</span></code> 文件，与 <code class="docutils literal notranslate"><span class="pre">turtlesim_world_2.launch.py</span></code> 类似，添加一个额外的 <code class="docutils literal notranslate"><span class="pre">turtlesim_node</span></code> 节点。</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">Node</span><span class="p">(</span>
   <span class="n">package</span><span class="o">=</span><span class="s1">&#39;turtlesim&#39;</span><span class="p">,</span>
   <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;turtlesim_node&#39;</span><span class="p">,</span>
   <span class="n">namespace</span><span class="o">=</span><span class="s1">&#39;turtlesim3&#39;</span><span class="p">,</span>
   <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sim&#39;</span><span class="p">,</span>
   <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="n">config</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>然而，加载相同的 YAML 文件不会影响第三个 turtlesim 世界的外观。原因是它的参数存储在另一个命名空间下，如下所示：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/turtlesim3/sim:</span>
<span class="go">   background_b</span>
<span class="go">   background_g</span>
<span class="go">   background_r</span>
</pre></div>
</div>
<p>因此，我们可以使用通配符语法，而不是为使用相同参数的同一节点创建新的配置。<code class="docutils literal notranslate"><span class="pre">/**</span></code> 将为每个节点分配所有参数，尽管节点名称和命名空间存在差异。</p>
<p>现在我们将按照以下方式更新 <code class="docutils literal notranslate"><span class="pre">/config</span></code> 文件夹中的 <code class="docutils literal notranslate"><span class="pre">turtlesim.yaml</span></code>：</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">/**</span><span class="p">:</span><span class="w"></span>
<span class="w">   </span><span class="nt">ros__parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">background_b</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">255</span><span class="w"></span>
<span class="w">      </span><span class="nt">background_g</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">86</span><span class="w"></span>
<span class="w">      </span><span class="nt">background_r</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">150</span><span class="w"></span>
</pre></div>
</div>
<p>现在在我们的主要启动文件中包含 <code class="docutils literal notranslate"><span class="pre">turtlesim_world_3.launch.py</span></code> 启动描述。在我们的启动描述中使用该配置文件将为 <code class="docutils literal notranslate"><span class="pre">turtlesim3/sim</span></code> 和 <code class="docutils literal notranslate"><span class="pre">turtlesim2/sim</span></code> 节点分配 <code class="docutils literal notranslate"><span class="pre">background_b</span></code>、<code class="docutils literal notranslate"><span class="pre">background_g</span></code> 和 <code class="docutils literal notranslate"><span class="pre">background_r</span></code> 参数指定的值。</p>
</div>
</div>
<div class="section" id="namespaces">
<h3><a class="toc-backref" href="#id10">3 个命名空间</a><a class="headerlink" href="#namespaces" title="永久链接至标题"></a></h3>
<p>正如您可能已经注意到的那样，我们在``turtlesim_world_2.launch.py``文件中定义了turtlesim世界的命名空间。唯一的命名空间可以让系统在没有节点名称或主题名称冲突的情况下启动两个相似的节点。</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">namespace</span><span class="o">=</span><span class="s1">&#39;turtlesim2&#39;</span><span class="p">,</span>
</pre></div>
</div>
<p>然而，如果启动文件包含大量节点，为每个节点定义命名空间可能会变得繁琐。为解决这个问题，可以使用``PushRosNamespace``操作来为每个启动文件描述定义全局命名空间。每个嵌套节点将自动继承该命名空间。</p>
<p>要实现这一点，首先，我们需要从``turtlesim_world_2.launch.py``文件中移除``namespace='turtlesim2'<a href="#id1"><span class="problematic" id="id2">``</span></a>行。然后，我们需要更新``launch_turtlesim.launch.py``文件，包含以下行：</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">launch.actions</span> <span class="kn">import</span> <span class="n">GroupAction</span>
<span class="kn">from</span> <span class="nn">launch_ros.actions</span> <span class="kn">import</span> <span class="n">PushRosNamespace</span>

   <span class="o">...</span>
   <span class="n">turtlesim_world_2</span> <span class="o">=</span> <span class="n">IncludeLaunchDescription</span><span class="p">(</span>
      <span class="n">PythonLaunchDescriptionSource</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
         <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;launch_tutorial&#39;</span><span class="p">),</span> <span class="s1">&#39;launch&#39;</span><span class="p">),</span>
         <span class="s1">&#39;/turtlesim_world_2.launch.py&#39;</span><span class="p">])</span>
      <span class="p">)</span>
   <span class="n">turtlesim_world_2_with_namespace</span> <span class="o">=</span> <span class="n">GroupAction</span><span class="p">(</span>
     <span class="n">actions</span><span class="o">=</span><span class="p">[</span>
         <span class="n">PushRosNamespace</span><span class="p">(</span><span class="s1">&#39;turtlesim2&#39;</span><span class="p">),</span>
         <span class="n">turtlesim_world_2</span><span class="p">,</span>
      <span class="p">]</span>
   <span class="p">)</span>
</pre></div>
</div>
<p>最后，在``return LaunchDescription``语句中将``turtlesim_world_2``替换为``turtlesim_world_2_with_namespace``。结果是，<a href="#id1"><span class="problematic" id="id2">``</span></a>turtlesim_world_2.launch.py``启动描述中的每个节点都将具有``turtlesim2``命名空间。</p>
</div>
<div class="section" id="reusing-nodes">
<h3><a class="toc-backref" href="#id11">4 重复使用节点</a><a class="headerlink" href="#reusing-nodes" title="永久链接至标题"></a></h3>
<p>现在创建一个``broadcaster_listener.launch.py``文件。</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">launch</span> <span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span> <span class="nn">launch.actions</span> <span class="kn">import</span> <span class="n">DeclareLaunchArgument</span>
<span class="kn">from</span> <span class="nn">launch.substitutions</span> <span class="kn">import</span> <span class="n">LaunchConfiguration</span>

<span class="kn">from</span> <span class="nn">launch_ros.actions</span> <span class="kn">import</span> <span class="n">Node</span>


<span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>
   <span class="k">return</span> <span class="n">LaunchDescription</span><span class="p">([</span>
      <span class="n">DeclareLaunchArgument</span><span class="p">(</span>
         <span class="s1">&#39;target_frame&#39;</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;turtle1&#39;</span><span class="p">,</span>
         <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Target frame name.&#39;</span>
      <span class="p">),</span>
      <span class="n">Node</span><span class="p">(</span>
         <span class="n">package</span><span class="o">=</span><span class="s1">&#39;turtle_tf2_py&#39;</span><span class="p">,</span>
         <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;turtle_tf2_broadcaster&#39;</span><span class="p">,</span>
         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;broadcaster1&#39;</span><span class="p">,</span>
         <span class="n">parameters</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;turtlename&#39;</span><span class="p">:</span> <span class="s1">&#39;turtle1&#39;</span><span class="p">}</span>
         <span class="p">]</span>
      <span class="p">),</span>
      <span class="n">Node</span><span class="p">(</span>
         <span class="n">package</span><span class="o">=</span><span class="s1">&#39;turtle_tf2_py&#39;</span><span class="p">,</span>
         <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;turtle_tf2_broadcaster&#39;</span><span class="p">,</span>
         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;broadcaster2&#39;</span><span class="p">,</span>
         <span class="n">parameters</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;turtlename&#39;</span><span class="p">:</span> <span class="s1">&#39;turtle2&#39;</span><span class="p">}</span>
         <span class="p">]</span>
      <span class="p">),</span>
      <span class="n">Node</span><span class="p">(</span>
         <span class="n">package</span><span class="o">=</span><span class="s1">&#39;turtle_tf2_py&#39;</span><span class="p">,</span>
         <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;turtle_tf2_listener&#39;</span><span class="p">,</span>
         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;listener&#39;</span><span class="p">,</span>
         <span class="n">parameters</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;target_frame&#39;</span><span class="p">:</span> <span class="n">LaunchConfiguration</span><span class="p">(</span><span class="s1">&#39;target_frame&#39;</span><span class="p">)}</span>
         <span class="p">]</span>
      <span class="p">),</span>
   <span class="p">])</span>
</pre></div>
</div>
<p>在该文件中，我们使用默认值``turtle1``声明了``target_frame``的启动参数。默认值意味着启动文件可以接收一个参数并传递给其节点，或者在未提供参数的情况下，将默认值传递给其节点。</p>
<p>之后，我们在启动过程中两次使用了不同名称和参数的``turtle_tf2_broadcaster``节点。这样可以在不冲突的情况下复制相同的节点。</p>
<p>我们还启动了一个``turtle_tf2_listener``节点，并设置了先前声明和获取的``target_frame``参数。</p>
</div>
<div class="section" id="parameter-overrides">
<h3><a class="toc-backref" href="#id12">5 参数覆盖</a><a class="headerlink" href="#parameter-overrides" title="永久链接至标题"></a></h3>
<p>回想一下，在我们的顶层启动文件中调用了``broadcaster_listener.launch.py``文件。除此之外，我们还传递了``target_frame``启动参数，如下所示：</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">broadcaster_listener_nodes</span> <span class="o">=</span> <span class="n">IncludeLaunchDescription</span><span class="p">(</span>
   <span class="n">PythonLaunchDescriptionSource</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
      <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;launch_tutorial&#39;</span><span class="p">),</span> <span class="s1">&#39;launch&#39;</span><span class="p">),</span>
      <span class="s1">&#39;/broadcaster_listener.launch.py&#39;</span><span class="p">]),</span>
   <span class="n">launch_arguments</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;target_frame&#39;</span><span class="p">:</span> <span class="s1">&#39;carrot1&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
   <span class="p">)</span>
</pre></div>
</div>
<p>这个语法允许我们将默认目标框架更改为``carrot1``。如果你希望``turtle2``跟随``turtle1``而不是``carrot1``，只需删除定义``launch_arguments``的那一行。这将将``target_frame``分配为其默认值，即``turtle1``。</p>
</div>
<div class="section" id="remapping">
<h3><a class="toc-backref" href="#id13">6 重映射</a><a class="headerlink" href="#remapping" title="永久链接至标题"></a></h3>
<p>现在创建一个 <code class="docutils literal notranslate"><span class="pre">mimic.launch.py</span></code> 文件。</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">launch</span> <span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span> <span class="nn">launch_ros.actions</span> <span class="kn">import</span> <span class="n">Node</span>


<span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>
   <span class="k">return</span> <span class="n">LaunchDescription</span><span class="p">([</span>
      <span class="n">Node</span><span class="p">(</span>
         <span class="n">package</span><span class="o">=</span><span class="s1">&#39;turtlesim&#39;</span><span class="p">,</span>
         <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;mimic&#39;</span><span class="p">,</span>
         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mimic&#39;</span><span class="p">,</span>
         <span class="n">remappings</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;/input/pose&#39;</span><span class="p">,</span> <span class="s1">&#39;/turtle2/pose&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;/output/cmd_vel&#39;</span><span class="p">,</span> <span class="s1">&#39;/turtlesim2/turtle1/cmd_vel&#39;</span><span class="p">),</span>
         <span class="p">]</span>
      <span class="p">)</span>
   <span class="p">])</span>
</pre></div>
</div>
<p>这个启动文件将启动 <code class="docutils literal notranslate"><span class="pre">mimic</span></code> 节点，该节点将向一个 turtlesim 发送指令，让它跟随另一个 turtlesim。该节点设计用于在主题 <code class="docutils literal notranslate"><span class="pre">/input/pose</span></code> 上接收目标姿态。在我们的情况下，我们希望将目标姿态重映射到 <code class="docutils literal notranslate"><span class="pre">/turtle2/pose</span></code> 主题上。最后，我们将 <code class="docutils literal notranslate"><span class="pre">/output/cmd_vel</span></code> 主题重映射到 <code class="docutils literal notranslate"><span class="pre">/turtlesim2/turtle1/cmd_vel</span></code>。这样，在我们的 <code class="docutils literal notranslate"><span class="pre">turtlesim2</span></code> 模拟世界中的 <code class="docutils literal notranslate"><span class="pre">turtle1</span></code> 将跟随我们初始 turtlesim 世界中的 <code class="docutils literal notranslate"><span class="pre">turtle2</span></code>。</p>
</div>
<div class="section" id="config-files">
<h3><a class="toc-backref" href="#id14">7 配置文件</a><a class="headerlink" href="#config-files" title="永久链接至标题"></a></h3>
<p>现在让我们创建一个名为 <code class="docutils literal notranslate"><span class="pre">turtlesim_rviz.launch.py</span></code> 的文件。</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">ament_index_python.packages</span> <span class="kn">import</span> <span class="n">get_package_share_directory</span>

<span class="kn">from</span> <span class="nn">launch</span> <span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span> <span class="nn">launch_ros.actions</span> <span class="kn">import</span> <span class="n">Node</span>


<span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>
   <span class="n">rviz_config</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
      <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;turtle_tf2_py&#39;</span><span class="p">),</span>
      <span class="s1">&#39;rviz&#39;</span><span class="p">,</span>
      <span class="s1">&#39;turtle_rviz.rviz&#39;</span>
      <span class="p">)</span>

   <span class="k">return</span> <span class="n">LaunchDescription</span><span class="p">([</span>
      <span class="n">Node</span><span class="p">(</span>
         <span class="n">package</span><span class="o">=</span><span class="s1">&#39;rviz2&#39;</span><span class="p">,</span>
         <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;rviz2&#39;</span><span class="p">,</span>
         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;rviz2&#39;</span><span class="p">,</span>
         <span class="n">arguments</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="n">rviz_config</span><span class="p">]</span>
      <span class="p">)</span>
   <span class="p">])</span>
</pre></div>
</div>
<p>这个启动文件将使用 <code class="docutils literal notranslate"><span class="pre">turtle_tf2_py</span></code> 包中定义的配置文件启动 RViz。这个 RViz 配置将设置世界坐标系，启用 TF 可视化，并以俯视图启动 RViz。</p>
</div>
<div class="section" id="environment-variables">
<h3><a class="toc-backref" href="#id15">8 环境变量</a><a class="headerlink" href="#environment-variables" title="永久链接至标题"></a></h3>
<p>现在我们来创建最后一个启动文件，名为``fixed_broadcaster.launch.py``，放在我们的包中。</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">launch</span> <span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span> <span class="nn">launch.actions</span> <span class="kn">import</span> <span class="n">DeclareLaunchArgument</span>
<span class="kn">from</span> <span class="nn">launch.substitutions</span> <span class="kn">import</span> <span class="n">EnvironmentVariable</span><span class="p">,</span> <span class="n">LaunchConfiguration</span>
<span class="kn">from</span> <span class="nn">launch_ros.actions</span> <span class="kn">import</span> <span class="n">Node</span>


<span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>
   <span class="k">return</span> <span class="n">LaunchDescription</span><span class="p">([</span>
      <span class="n">DeclareLaunchArgument</span><span class="p">(</span>
            <span class="s1">&#39;node_prefix&#39;</span><span class="p">,</span>
            <span class="n">default_value</span><span class="o">=</span><span class="p">[</span><span class="n">EnvironmentVariable</span><span class="p">(</span><span class="s1">&#39;USER&#39;</span><span class="p">),</span> <span class="s1">&#39;_&#39;</span><span class="p">],</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;prefix for node name&#39;</span>
      <span class="p">),</span>
      <span class="n">Node</span><span class="p">(</span>
            <span class="n">package</span><span class="o">=</span><span class="s1">&#39;turtle_tf2_py&#39;</span><span class="p">,</span>
            <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;fixed_frame_tf2_broadcaster&#39;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="p">[</span><span class="n">LaunchConfiguration</span><span class="p">(</span><span class="s1">&#39;node_prefix&#39;</span><span class="p">),</span> <span class="s1">&#39;fixed_broadcaster&#39;</span><span class="p">],</span>
      <span class="p">),</span>
   <span class="p">])</span>
</pre></div>
</div>
<p>该启动文件展示了在启动文件中如何调用环境变量。环境变量可用于定义或推送命名空间，以区分不同计算机或机器人上的节点。</p>
</div>
</div>
<div class="section" id="running-launch-files">
<h2><a class="toc-backref" href="#id16">运行启动文件</a><a class="headerlink" href="#running-launch-files" title="永久链接至标题"></a></h2>
<div class="section" id="update-setup-py">
<h3><a class="toc-backref" href="#id17">1 更新 setup.py</a><a class="headerlink" href="#update-setup-py" title="永久链接至标题"></a></h3>
<p>打开``setup.py``并添加以下行，以便安装``launch/<a href="#id1"><span class="problematic" id="id2">``</span></a>文件夹中的启动文件和``config/<a href="#id3"><span class="problematic" id="id4">``</span></a>中的配置文件。<a href="#id5"><span class="problematic" id="id6">``</span></a>data_files``字段现在应该如下所示：</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">data_files</span><span class="o">=</span><span class="p">[</span>
      <span class="o">...</span>
      <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;share&#39;</span><span class="p">,</span> <span class="n">package_name</span><span class="p">,</span> <span class="s1">&#39;launch&#39;</span><span class="p">),</span>
         <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;launch&#39;</span><span class="p">,</span> <span class="s1">&#39;*.launch.py&#39;</span><span class="p">))),</span>
      <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;share&#39;</span><span class="p">,</span> <span class="n">package_name</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">),</span>
         <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;*.yaml&#39;</span><span class="p">))),</span>
   <span class="p">],</span>
</pre></div>
</div>
</div>
<div class="section" id="build-and-run">
<h3><a class="toc-backref" href="#id18">2 构建和运行</a><a class="headerlink" href="#build-and-run" title="永久链接至标题"></a></h3>
<p>为了最终看到我们代码的结果，请使用以下命令构建包并启动顶层启动文件：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 launch launch_tutorial launch_turtlesim.launch.py</span>
</pre></div>
</div>
<p>现在您将看到两个turtlesim模拟开始运行。第一个模拟中有两只乌龟，第二个模拟中只有一只乌龟。在第一个模拟中，“turtle2”被生成在世界的左下角。它的目标是相对于“turtle1”框架在x轴上距离为五米的“carrot1”框架。</p>
<p>第二个模拟中的“turtlesim2/turtle1”被设计成模仿“turtle2”的行为。</p>
<p>如果您想控制“turtle1”，请运行teleop节点。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 run turtlesim turtle_teleop_key</span>
</pre></div>
</div>
<p>结果，您将看到类似的画面：</p>
<img alt="../../../_images/turtlesim_worlds.png" src="../../../_images/turtlesim_worlds.png" />
<p>除此之外，RViz应该已经启动。它将显示所有相对于“world”框架的乌龟框架，其原点位于左下角。</p>
<img alt="../../../_images/turtlesim_rviz.png" src="../../../_images/turtlesim_rviz.png" />
</div>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id19">总结</a><a class="headerlink" href="#summary" title="永久链接至标题"></a></h2>
<p>在本教程中，您学习了使用ROS 2 launch文件管理大型项目的各种提示和实践。</p>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>