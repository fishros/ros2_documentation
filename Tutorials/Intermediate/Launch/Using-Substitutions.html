<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutorials/Intermediate/Launch/Using-Substitutions</title>
</head>
<body>
  <div class="section" id="using-substitutions">
<h1>使用替代项 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5563">[5563]</a><a class="headerlink" href="#using-substitutions" title="永久链接至标题"></a></h1>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>目标：<a href="#id3"><span class="problematic" id="id4">**</span></a>了解ROS 2启动文件中的替代项。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5564">[5564]</a></p>
<p><strong>教程级别：</strong> 中级 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5286">[5286]</a></p>
<p><strong>时间：</strong> 15分钟 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=3507">[3507]</a></p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">目录 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=3070">[]</a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id2">背景 [3072]</a></p></li>
<li><p><a class="reference internal" href="#prerequisites" id="id3">先决条件 [3124]</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id4">使用替代项 [5563]</a></p>
<ul>
<li><p><a class="reference internal" href="#create-and-setup-the-package" id="id5">1 创建并设置包 [5568]</a></p></li>
<li><p><a class="reference internal" href="#parent-launch-file" id="id6">2. 父级启动文件 [5572]</a></p></li>
<li><p><a class="reference internal" href="#substitutions-example-launch-file" id="id7">3个替代方式示例的启动文件 [5576]</a></p></li>
<li><p><a class="reference internal" href="#build-the-package" id="id8">4 构建软件包 [5584]</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#launching-example" id="id9">启动示例 [5484]</a></p></li>
<li><p><a class="reference internal" href="#modifying-launch-arguments" id="id10">修改启动参数 [5586]</a></p></li>
<li><p><a class="reference internal" href="#documentation" id="id11">文档 [5464]</a></p></li>
<li><p><a class="reference internal" href="#summary" id="id12">总结 [3353]</a></p></li>
</ul>
</div>
<div class="section" id="background">
<h2>背景 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=3072">[3072]</a><a class="headerlink" href="#background" title="永久链接至标题"></a></h2>
<p>启动文件用于启动节点、服务和执行进程。这组操作可能有参数，这些参数会影响它们的行为。在参数中可以使用替代项，以提供更多的灵活性，描述可重复使用的启动文件。替代项是仅在启动描述执行期间评估的变量，可以用于获取特定的信息，比如启动配置、环境变量，或者评估任意的Python表达式。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5565">[5565]</a></p>
<p>本教程展示了在ROS 2启动文件中使用替代项的用法示例。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5566">[5566]</a></p>
</div>
<div class="section" id="prerequisites">
<h2>先决条件 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=3124">[3124]</a><a class="headerlink" href="#prerequisites" title="永久链接至标题"></a></h2>
<p>本教程使用了 <a class="reference internal" href="../../Beginner-CLI-Tools/Introducing-Turtlesim/Introducing-Turtlesim.html"><span class="doc">turtlesim</span></a> 包。同时假设你已经熟悉 <a class="reference internal" href="../../Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html"><span class="doc">创建包</span></a>。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5567">[5567]</a></p>
<p>如往常一样，在每次打开新的终端时不要忘记在 :doc`每个新终端中启用ROS 2环境 &lt;../../Beginner-CLI-Tools/Configuring-ROS2-Environment&gt;`。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5392">[5392]</a></p>
</div>
<div class="section" id="id1">
<h2>使用替代项 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5563">[5563]</a><a class="headerlink" href="#id1" title="永久链接至标题"></a></h2>
<div class="section" id="create-and-setup-the-package">
<h3>1 创建并设置包 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5568">[5568]</a><a class="headerlink" href="#create-and-setup-the-package" title="永久链接至标题"></a></h3>
<p>创建一个名为``launch_tutorial``的新构建类型为``ament_python``的软件包： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5569">[5569]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 pkg create launch_tutorial --build-type ament_python</span>
</pre></div>
</div>
<p>在该软件包中创建一个名为``launch``的目录： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5570">[5570]</a></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-0-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button><button aria-controls="panel-0-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-0-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-0-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir launch_tutorial/launch
</pre></div>
</div>
</div><div aria-labelledby="tab-0-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir launch_tutorial/launch
</pre></div>
</div>
</div><div aria-labelledby="tab-0-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>md launch_tutorial/launch
</pre></div>
</div>
</div></div>
<p>最后，确保在软件包的``setup.py``中添加更改，以便安装启动文件： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5571">[5571]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">package_name</span> <span class="o">=</span> <span class="s1">&#39;launch_tutorial&#39;</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="c1"># Other parameters ...</span>
    <span class="n">data_files</span><span class="o">=</span><span class="p">[</span>
        <span class="c1"># ... Other data files</span>
        <span class="c1"># Include all launch files.</span>
        <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;share&#39;</span><span class="p">,</span> <span class="n">package_name</span><span class="p">,</span> <span class="s1">&#39;launch&#39;</span><span class="p">),</span> <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;launch&#39;</span><span class="p">,</span> <span class="s1">&#39;*launch.[pxy][yma]*&#39;</span><span class="p">)))</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="parent-launch-file">
<h3>2. 父级启动文件 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5572">[5572]</a><a class="headerlink" href="#parent-launch-file" title="永久链接至标题"></a></h3>
<p>让我们创建一个启动文件，调用并传递参数给另一个启动文件。为此，在``launch_tutorial``软件包的``launch``文件夹中创建一个名为``example_main.launch.py``的文件。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5573">[5573]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">launch_ros.substitutions</span> <span class="kn">import</span> <span class="n">FindPackageShare</span>

<span class="kn">from</span> <span class="nn">launch</span> <span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span> <span class="nn">launch.actions</span> <span class="kn">import</span> <span class="n">IncludeLaunchDescription</span>
<span class="kn">from</span> <span class="nn">launch.launch_description_sources</span> <span class="kn">import</span> <span class="n">PythonLaunchDescriptionSource</span>
<span class="kn">from</span> <span class="nn">launch.substitutions</span> <span class="kn">import</span> <span class="n">PathJoinSubstitution</span><span class="p">,</span> <span class="n">TextSubstitution</span>


<span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;background_r&#39;</span><span class="p">:</span> <span class="s1">&#39;200&#39;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">LaunchDescription</span><span class="p">([</span>
        <span class="n">IncludeLaunchDescription</span><span class="p">(</span>
            <span class="n">PythonLaunchDescriptionSource</span><span class="p">([</span>
                <span class="n">PathJoinSubstitution</span><span class="p">([</span>
                    <span class="n">FindPackageShare</span><span class="p">(</span><span class="s1">&#39;launch_tutorial&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;launch&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;example_substitutions.launch.py&#39;</span>
                <span class="p">])</span>
            <span class="p">]),</span>
            <span class="n">launch_arguments</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;turtlesim_ns&#39;</span><span class="p">:</span> <span class="s1">&#39;turtlesim2&#39;</span><span class="p">,</span>
                <span class="s1">&#39;use_provided_red&#39;</span><span class="p">:</span> <span class="s1">&#39;True&#39;</span><span class="p">,</span>
                <span class="s1">&#39;new_background_r&#39;</span><span class="p">:</span> <span class="n">TextSubstitution</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;background_r&#39;</span><span class="p">]))</span>
            <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="p">])</span>
</pre></div>
</div>
<p>在``example_main.launch.py``文件中，使用``FindPackageShare``替代找到``launch_tutorial``软件包的路径。然后，使用``PathJoinSubstitution``替代将该软件包路径与``example_substitutions.launch.py``文件名连接起来。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5574">[5574]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PathJoinSubstitution</span><span class="p">([</span>
    <span class="n">FindPackageShare</span><span class="p">(</span><span class="s1">&#39;launch_tutorial&#39;</span><span class="p">),</span>
    <span class="s1">&#39;launch&#39;</span><span class="p">,</span>
    <span class="s1">&#39;example_substitutions.launch.py&#39;</span>
<span class="p">])</span>
</pre></div>
</div>
<p>将具有 <code class="docutils literal notranslate"><span class="pre">turtlesim_ns</span></code> 和 <code class="docutils literal notranslate"><span class="pre">use_provided_red</span></code> 参数的 <code class="docutils literal notranslate"><span class="pre">launch_arguments</span></code> 字典传递给 <code class="docutils literal notranslate"><span class="pre">IncludeLaunchDescription</span></code> 动作。使用 <code class="docutils literal notranslate"><span class="pre">TextSubstitution</span></code> 替代方式来定义具有 <code class="docutils literal notranslate"><span class="pre">colors</span></code> 字典中 <code class="docutils literal notranslate"><span class="pre">background_r</span></code> 键的值的 <code class="docutils literal notranslate"><span class="pre">new_background_r</span></code> 参数。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5575">[5575]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">launch_arguments</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;turtlesim_ns&#39;</span><span class="p">:</span> <span class="s1">&#39;turtlesim2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;use_provided_red&#39;</span><span class="p">:</span> <span class="s1">&#39;True&#39;</span><span class="p">,</span>
    <span class="s1">&#39;new_background_r&#39;</span><span class="p">:</span> <span class="n">TextSubstitution</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">colors</span><span class="p">[</span><span class="s1">&#39;background_r&#39;</span><span class="p">]))</span>
<span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="substitutions-example-launch-file">
<h3>3个替代方式示例的启动文件 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5576">[5576]</a><a class="headerlink" href="#substitutions-example-launch-file" title="永久链接至标题"></a></h3>
<p>现在在相同文件夹中创建一个名为 <code class="docutils literal notranslate"><span class="pre">example_substitutions.launch.py</span></code> 的文件。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5577">[5577]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">launch_ros.actions</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="kn">from</span> <span class="nn">launch</span> <span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span> <span class="nn">launch.actions</span> <span class="kn">import</span> <span class="n">DeclareLaunchArgument</span><span class="p">,</span> <span class="n">ExecuteProcess</span><span class="p">,</span> <span class="n">TimerAction</span>
<span class="kn">from</span> <span class="nn">launch.conditions</span> <span class="kn">import</span> <span class="n">IfCondition</span>
<span class="kn">from</span> <span class="nn">launch.substitutions</span> <span class="kn">import</span> <span class="n">LaunchConfiguration</span><span class="p">,</span> <span class="n">PythonExpression</span>


<span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>
    <span class="n">turtlesim_ns</span> <span class="o">=</span> <span class="n">LaunchConfiguration</span><span class="p">(</span><span class="s1">&#39;turtlesim_ns&#39;</span><span class="p">)</span>
    <span class="n">use_provided_red</span> <span class="o">=</span> <span class="n">LaunchConfiguration</span><span class="p">(</span><span class="s1">&#39;use_provided_red&#39;</span><span class="p">)</span>
    <span class="n">new_background_r</span> <span class="o">=</span> <span class="n">LaunchConfiguration</span><span class="p">(</span><span class="s1">&#39;new_background_r&#39;</span><span class="p">)</span>

    <span class="n">turtlesim_ns_launch_arg</span> <span class="o">=</span> <span class="n">DeclareLaunchArgument</span><span class="p">(</span>
        <span class="s1">&#39;turtlesim_ns&#39;</span><span class="p">,</span>
        <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;turtlesim1&#39;</span>
    <span class="p">)</span>
    <span class="n">use_provided_red_launch_arg</span> <span class="o">=</span> <span class="n">DeclareLaunchArgument</span><span class="p">(</span>
        <span class="s1">&#39;use_provided_red&#39;</span><span class="p">,</span>
        <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;False&#39;</span>
    <span class="p">)</span>
    <span class="n">new_background_r_launch_arg</span> <span class="o">=</span> <span class="n">DeclareLaunchArgument</span><span class="p">(</span>
        <span class="s1">&#39;new_background_r&#39;</span><span class="p">,</span>
        <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;200&#39;</span>
    <span class="p">)</span>

    <span class="n">turtlesim_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
        <span class="n">package</span><span class="o">=</span><span class="s1">&#39;turtlesim&#39;</span><span class="p">,</span>
        <span class="n">namespace</span><span class="o">=</span><span class="n">turtlesim_ns</span><span class="p">,</span>
        <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;turtlesim_node&#39;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sim&#39;</span>
    <span class="p">)</span>
    <span class="n">spawn_turtle</span> <span class="o">=</span> <span class="n">ExecuteProcess</span><span class="p">(</span>
        <span class="n">cmd</span><span class="o">=</span><span class="p">[[</span>
            <span class="s1">&#39;ros2 service call &#39;</span><span class="p">,</span>
            <span class="n">turtlesim_ns</span><span class="p">,</span>
            <span class="s1">&#39;/spawn &#39;</span><span class="p">,</span>
            <span class="s1">&#39;turtlesim/srv/Spawn &#39;</span><span class="p">,</span>
            <span class="s1">&#39;&quot;{x: 2, y: 2, theta: 0.2}&quot;&#39;</span>
        <span class="p">]],</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">change_background_r</span> <span class="o">=</span> <span class="n">ExecuteProcess</span><span class="p">(</span>
        <span class="n">cmd</span><span class="o">=</span><span class="p">[[</span>
            <span class="s1">&#39;ros2 param set &#39;</span><span class="p">,</span>
            <span class="n">turtlesim_ns</span><span class="p">,</span>
            <span class="s1">&#39;/sim background_r &#39;</span><span class="p">,</span>
            <span class="s1">&#39;120&#39;</span>
        <span class="p">]],</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">change_background_r_conditioned</span> <span class="o">=</span> <span class="n">ExecuteProcess</span><span class="p">(</span>
        <span class="n">condition</span><span class="o">=</span><span class="n">IfCondition</span><span class="p">(</span>
            <span class="n">PythonExpression</span><span class="p">([</span>
                <span class="n">new_background_r</span><span class="p">,</span>
                <span class="s1">&#39; == 200&#39;</span><span class="p">,</span>
                <span class="s1">&#39; and &#39;</span><span class="p">,</span>
                <span class="n">use_provided_red</span>
            <span class="p">])</span>
        <span class="p">),</span>
        <span class="n">cmd</span><span class="o">=</span><span class="p">[[</span>
            <span class="s1">&#39;ros2 param set &#39;</span><span class="p">,</span>
            <span class="n">turtlesim_ns</span><span class="p">,</span>
            <span class="s1">&#39;/sim background_r &#39;</span><span class="p">,</span>
            <span class="n">new_background_r</span>
        <span class="p">]],</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">LaunchDescription</span><span class="p">([</span>
        <span class="n">turtlesim_ns_launch_arg</span><span class="p">,</span>
        <span class="n">use_provided_red_launch_arg</span><span class="p">,</span>
        <span class="n">new_background_r_launch_arg</span><span class="p">,</span>
        <span class="n">turtlesim_node</span><span class="p">,</span>
        <span class="n">spawn_turtle</span><span class="p">,</span>
        <span class="n">change_background_r</span><span class="p">,</span>
        <span class="n">TimerAction</span><span class="p">(</span>
            <span class="n">period</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span><span class="n">change_background_r_conditioned</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="p">])</span>
</pre></div>
</div>
<p>在 <code class="docutils literal notranslate"><span class="pre">example_substitutions.launch.py</span></code> 文件中，定义了 <code class="docutils literal notranslate"><span class="pre">turtlesim_ns</span></code>、<code class="docutils literal notranslate"><span class="pre">use_provided_red</span></code> 和 <code class="docutils literal notranslate"><span class="pre">new_background_r</span></code> 的启动配置。它们用于在上述变量中存储启动参数的值，并将其传递给所需的动作。这些 <code class="docutils literal notranslate"><span class="pre">LaunchConfiguration</span></code> 替代方式允许我们在启动描述的任何部分中获取启动参数的值。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5578">[5578]</a></p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">DeclareLaunchArgument</span></code> 定义可以从上述启动文件或控制台传递的启动参数。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5579">[5579]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">turtlesim_ns</span> <span class="o">=</span> <span class="n">LaunchConfiguration</span><span class="p">(</span><span class="s1">&#39;turtlesim_ns&#39;</span><span class="p">)</span>
<span class="n">use_provided_red</span> <span class="o">=</span> <span class="n">LaunchConfiguration</span><span class="p">(</span><span class="s1">&#39;use_provided_red&#39;</span><span class="p">)</span>
<span class="n">new_background_r</span> <span class="o">=</span> <span class="n">LaunchConfiguration</span><span class="p">(</span><span class="s1">&#39;new_background_r&#39;</span><span class="p">)</span>

<span class="n">turtlesim_ns_launch_arg</span> <span class="o">=</span> <span class="n">DeclareLaunchArgument</span><span class="p">(</span>
    <span class="s1">&#39;turtlesim_ns&#39;</span><span class="p">,</span>
    <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;turtlesim1&#39;</span>
<span class="p">)</span>
<span class="n">use_provided_red_launch_arg</span> <span class="o">=</span> <span class="n">DeclareLaunchArgument</span><span class="p">(</span>
    <span class="s1">&#39;use_provided_red&#39;</span><span class="p">,</span>
    <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;False&#39;</span>
<span class="p">)</span>
<span class="n">new_background_r_launch_arg</span> <span class="o">=</span> <span class="n">DeclareLaunchArgument</span><span class="p">(</span>
    <span class="s1">&#39;new_background_r&#39;</span><span class="p">,</span>
    <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;200&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>定义了具有 <code class="docutils literal notranslate"><span class="pre">namespace</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">turtlesim_ns</span></code> 的 <code class="docutils literal notranslate"><span class="pre">turtlesim_node</span></code> 节点，并使用 <code class="docutils literal notranslate"><span class="pre">LaunchConfiguration</span></code> 替代方式。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5580">[5580]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">turtlesim_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
    <span class="n">package</span><span class="o">=</span><span class="s1">&#39;turtlesim&#39;</span><span class="p">,</span>
    <span class="n">namespace</span><span class="o">=</span><span class="n">turtlesim_ns</span><span class="p">,</span>
    <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;turtlesim_node&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sim&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>之后，定义了``ExecuteProcess``动作``spawn_turtle``，并提供相应的``cmd``参数。此命令调用了turtlesim节点的spawn服务。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5581">[5581]</a></p>
<p>此外，使用``LaunchConfiguration``替代方式获取``turtlesim_ns``启动参数的值，以构建命令字符串。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5582">[5582]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">spawn_turtle</span> <span class="o">=</span> <span class="n">ExecuteProcess</span><span class="p">(</span>
    <span class="n">cmd</span><span class="o">=</span><span class="p">[[</span>
        <span class="s1">&#39;ros2 service call &#39;</span><span class="p">,</span>
        <span class="n">turtlesim_ns</span><span class="p">,</span>
        <span class="s1">&#39;/spawn &#39;</span><span class="p">,</span>
        <span class="s1">&#39;turtlesim/srv/Spawn &#39;</span><span class="p">,</span>
        <span class="s1">&#39;&quot;{x: 2, y: 2, theta: 0.2}&quot;&#39;</span>
    <span class="p">]],</span>
    <span class="n">shell</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<p>同样的方法被用于更改turtlesim背景红色参数的``change_background_r``和``change_background_r_conditioned``动作。区别在于，只有当提供的``new_background_r``参数等于``200``并且``use_provided_red``启动参数设置为``True``时，才会执行``change_background_r_conditioned``动作。在``IfCondition``内部的评估使用``PythonExpression``替代方式完成。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5583">[5583]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">change_background_r</span> <span class="o">=</span> <span class="n">ExecuteProcess</span><span class="p">(</span>
    <span class="n">cmd</span><span class="o">=</span><span class="p">[[</span>
        <span class="s1">&#39;ros2 param set &#39;</span><span class="p">,</span>
        <span class="n">turtlesim_ns</span><span class="p">,</span>
        <span class="s1">&#39;/sim background_r &#39;</span><span class="p">,</span>
        <span class="s1">&#39;120&#39;</span>
    <span class="p">]],</span>
    <span class="n">shell</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">change_background_r_conditioned</span> <span class="o">=</span> <span class="n">ExecuteProcess</span><span class="p">(</span>
    <span class="n">condition</span><span class="o">=</span><span class="n">IfCondition</span><span class="p">(</span>
        <span class="n">PythonExpression</span><span class="p">([</span>
            <span class="n">new_background_r</span><span class="p">,</span>
            <span class="s1">&#39; == 200&#39;</span><span class="p">,</span>
            <span class="s1">&#39; and &#39;</span><span class="p">,</span>
            <span class="n">use_provided_red</span>
        <span class="p">])</span>
    <span class="p">),</span>
    <span class="n">cmd</span><span class="o">=</span><span class="p">[[</span>
        <span class="s1">&#39;ros2 param set &#39;</span><span class="p">,</span>
        <span class="n">turtlesim_ns</span><span class="p">,</span>
        <span class="s1">&#39;/sim background_r &#39;</span><span class="p">,</span>
        <span class="n">new_background_r</span>
    <span class="p">]],</span>
    <span class="n">shell</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="build-the-package">
<h3>4 构建软件包 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5584">[5584]</a><a class="headerlink" href="#build-the-package" title="永久链接至标题"></a></h3>
<p>转到工作空间的根目录，并构建软件包： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5482">[5482]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">colcon build</span>
</pre></div>
</div>
<p>构建完成后，请记得设置工作空间环境。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5483">[5483]</a></p>
</div>
</div>
<div class="section" id="launching-example">
<h2>启动示例 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5484">[5484]</a><a class="headerlink" href="#launching-example" title="永久链接至标题"></a></h2>
<p>现在可以使用``ros2 launch``命令启动``example_main.launch.py``文件。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5585">[5585]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 launch launch_tutorial example_main.launch.py</span>
</pre></div>
</div>
<p>这将执行以下操作： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5486">[5486]</a></p>
<ol class="arabic simple">
<li><p>启动一个带有蓝色背景的turtlesim节点 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5487">[5487]</a></p></li>
<li><p>生成第二只乌龟 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5488">[5488]</a></p></li>
<li><p>如果提供的``background_r``参数为``200``且``use_provided_red``参数为``True``，则将颜色更改为紫色 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5489">[5489]</a></p></li>
<li><p>如果提供的``background_r``参数为``200``且``use_provided_red``参数为``True``，则在两秒后将颜色更改为粉色 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5490">[5490]</a></p></li>
</ol>
</div>
<div class="section" id="modifying-launch-arguments">
<h2>修改启动参数 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5586">[5586]</a><a class="headerlink" href="#modifying-launch-arguments" title="永久链接至标题"></a></h2>
<p>如果您想要更改提供的启动参数，您可以在``example_main.launch.py``中的``launch_arguments``字典中更新它们，或者使用首选参数启动``example_substitutions.launch.py``。要查看可能提供给启动文件的参数，请运行以下命令： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5587">[5587]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 launch launch_tutorial example_substitutions.launch.py --show-args</span>
</pre></div>
</div>
<p>这将显示可能提供给启动文件的参数及其默认值。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5588">[5588]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Arguments (pass arguments as &#39;&lt;name&gt;:=&lt;value&gt;&#39;):</span>

<span class="go">    &#39;turtlesim_ns&#39;:</span>
<span class="go">        no description given</span>
<span class="go">        (default: &#39;turtlesim1&#39;)</span>

<span class="go">    &#39;use_provided_red&#39;:</span>
<span class="go">        no description given</span>
<span class="go">        (default: &#39;False&#39;)</span>

<span class="go">    &#39;new_background_r&#39;:</span>
<span class="go">        no description given</span>
<span class="go">        (default: &#39;200&#39;)</span>
</pre></div>
</div>
<p>现在，您可以按以下方式传递所需的参数给启动文件： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5589">[5589]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 launch launch_tutorial example_substitutions.launch.py turtlesim_ns:=&#39;turtlesim3&#39; use_provided_red:=&#39;True&#39; new_background_r:=200</span>
</pre></div>
</div>
</div>
<div class="section" id="documentation">
<h2>文档 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5464">[5464]</a><a class="headerlink" href="#documentation" title="永久链接至标题"></a></h2>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>The launch documentation &lt;<a class="reference external" href="https://github.com/ros2/launch/blob/humble/launch/doc/source/architecture.rst">https://github.com/ros2/launch/blob/humble/launch/doc/source/architecture.rst</a>&gt;`_ 提供了有关可用替换的详细信息。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5590">[5590]</a></p>
</div>
<div class="section" id="summary">
<h2>总结 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=3353">[3353]</a><a class="headerlink" href="#summary" title="永久链接至标题"></a></h2>
<p>在本教程中，您了解了如何在启动文件中使用替换。您了解了它们的可能性和能力，以创建可重用的启动文件。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5591">[5591]</a></p>
<p>您现在可以了解更多关于 <a class="reference internal" href="Using-Event-Handlers.html"><span class="doc">在启动文件中使用事件处理程序</span></a> 的信息，它们用于定义一组复杂的规则，可用于动态修改启动文件。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5592">[5592]</a></p>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>