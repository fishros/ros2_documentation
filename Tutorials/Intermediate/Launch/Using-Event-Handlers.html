<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutorials/Intermediate/Launch/Using-Event-Handlers</title>
</head>
<body>
  <div class="section" id="using-event-handlers">
<h1>使用事件处理程序 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5467">[5467]</a><a class="headerlink" href="#using-event-handlers" title="永久链接至标题"></a></h1>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>目标：<a href="#id3"><span class="problematic" id="id4">**</span></a>了解ROS 2启动文件中的事件处理程序 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5468">[5468]</a></p>
<p><strong>教程级别：</strong> 中级 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5286">[5286]</a></p>
<p><strong>时间：</strong> 15分钟 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=3507">[3507]</a></p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">目录 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=3070">[]</a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id2">背景 [3072]</a></p></li>
<li><p><a class="reference internal" href="#prerequisites" id="id3">先决条件 [3124]</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id4">使用事件处理程序 [5467]</a></p>
<ul>
<li><p><a class="reference internal" href="#event-handlers-example-launch-file" id="id5">1 事件处理程序示例启动文件 [5473]</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#build-the-package" id="id6">构建软件包 [5481]</a></p></li>
<li><p><a class="reference internal" href="#launching-example" id="id7">启动示例 [5484]</a></p></li>
<li><p><a class="reference internal" href="#documentation" id="id8">文档 [5464]</a></p></li>
<li><p><a class="reference internal" href="#summary" id="id9">总结 [3353]</a></p></li>
</ul>
</div>
<div class="section" id="background">
<h2>背景 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=3072">[3072]</a><a class="headerlink" href="#background" title="永久链接至标题"></a></h2>
<p>在ROS 2中，启动是执行和管理用户定义的进程的系统。它负责监视其启动的进程的状态，以及报告和响应这些进程状态的变化。这些变化称为事件，并可以通过向启动系统注册事件处理程序来处理。事件处理程序可以注册为特定事件，并且对于监视进程的状态非常有用。此外，它们可以用于定义一组复杂的规则，用于动态修改启动文件。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5469">[5469]</a></p>
<p>本教程展示了ROS 2启动文件中事件处理程序的使用示例。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5470">[5470]</a></p>
</div>
<div class="section" id="prerequisites">
<h2>先决条件 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=3124">[3124]</a><a class="headerlink" href="#prerequisites" title="永久链接至标题"></a></h2>
<p>本教程使用 <a class="reference internal" href="../../Beginner-CLI-Tools/Introducing-Turtlesim/Introducing-Turtlesim.html"><span class="doc">turtlesim</span></a> 包。本教程还假设您已经 <a class="reference internal" href="../../Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html"><span class="doc">创建了一个名为“launch_tutorial”的新包</span></a>，其构建类型为``ament_python``。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5471">[5471]</a></p>
<p>本教程扩展了 <a class="reference internal" href="Using-Substitutions.html"><span class="doc">在启动文件中使用替换</span></a> 教程中展示的代码。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5472">[5472]</a></p>
</div>
<div class="section" id="id1">
<h2>使用事件处理程序 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5467">[5467]</a><a class="headerlink" href="#id1" title="永久链接至标题"></a></h2>
<div class="section" id="event-handlers-example-launch-file">
<h3>1 事件处理程序示例启动文件 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5473">[5473]</a><a class="headerlink" href="#event-handlers-example-launch-file" title="永久链接至标题"></a></h3>
<p>在“launch_tutorial”包的“launch”文件夹中创建一个名为“example_event_handlers.launch.py”的新文件。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5474">[5474]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">launch_ros.actions</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="kn">from</span> <span class="nn">launch</span> <span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span> <span class="nn">launch.actions</span> <span class="kn">import</span> <span class="p">(</span><span class="n">DeclareLaunchArgument</span><span class="p">,</span> <span class="n">EmitEvent</span><span class="p">,</span> <span class="n">ExecuteProcess</span><span class="p">,</span>
                            <span class="n">LogInfo</span><span class="p">,</span> <span class="n">RegisterEventHandler</span><span class="p">,</span> <span class="n">TimerAction</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">launch.conditions</span> <span class="kn">import</span> <span class="n">IfCondition</span>
<span class="kn">from</span> <span class="nn">launch.event_handlers</span> <span class="kn">import</span> <span class="p">(</span><span class="n">OnExecutionComplete</span><span class="p">,</span> <span class="n">OnProcessExit</span><span class="p">,</span>
                                <span class="n">OnProcessIO</span><span class="p">,</span> <span class="n">OnProcessStart</span><span class="p">,</span> <span class="n">OnShutdown</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">launch.events</span> <span class="kn">import</span> <span class="n">Shutdown</span>
<span class="kn">from</span> <span class="nn">launch.substitutions</span> <span class="kn">import</span> <span class="p">(</span><span class="n">EnvironmentVariable</span><span class="p">,</span> <span class="n">FindExecutable</span><span class="p">,</span>
                                <span class="n">LaunchConfiguration</span><span class="p">,</span> <span class="n">LocalSubstitution</span><span class="p">,</span>
                                <span class="n">PythonExpression</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>
    <span class="n">turtlesim_ns</span> <span class="o">=</span> <span class="n">LaunchConfiguration</span><span class="p">(</span><span class="s1">&#39;turtlesim_ns&#39;</span><span class="p">)</span>
    <span class="n">use_provided_red</span> <span class="o">=</span> <span class="n">LaunchConfiguration</span><span class="p">(</span><span class="s1">&#39;use_provided_red&#39;</span><span class="p">)</span>
    <span class="n">new_background_r</span> <span class="o">=</span> <span class="n">LaunchConfiguration</span><span class="p">(</span><span class="s1">&#39;new_background_r&#39;</span><span class="p">)</span>

    <span class="n">turtlesim_ns_launch_arg</span> <span class="o">=</span> <span class="n">DeclareLaunchArgument</span><span class="p">(</span>
        <span class="s1">&#39;turtlesim_ns&#39;</span><span class="p">,</span>
        <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;turtlesim1&#39;</span>
    <span class="p">)</span>
    <span class="n">use_provided_red_launch_arg</span> <span class="o">=</span> <span class="n">DeclareLaunchArgument</span><span class="p">(</span>
        <span class="s1">&#39;use_provided_red&#39;</span><span class="p">,</span>
        <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;False&#39;</span>
    <span class="p">)</span>
    <span class="n">new_background_r_launch_arg</span> <span class="o">=</span> <span class="n">DeclareLaunchArgument</span><span class="p">(</span>
        <span class="s1">&#39;new_background_r&#39;</span><span class="p">,</span>
        <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;200&#39;</span>
    <span class="p">)</span>

    <span class="n">turtlesim_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
        <span class="n">package</span><span class="o">=</span><span class="s1">&#39;turtlesim&#39;</span><span class="p">,</span>
        <span class="n">namespace</span><span class="o">=</span><span class="n">turtlesim_ns</span><span class="p">,</span>
        <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;turtlesim_node&#39;</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sim&#39;</span>
    <span class="p">)</span>
    <span class="n">spawn_turtle</span> <span class="o">=</span> <span class="n">ExecuteProcess</span><span class="p">(</span>
        <span class="n">cmd</span><span class="o">=</span><span class="p">[[</span>
            <span class="n">FindExecutable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ros2&#39;</span><span class="p">),</span>
            <span class="s1">&#39; service call &#39;</span><span class="p">,</span>
            <span class="n">turtlesim_ns</span><span class="p">,</span>
            <span class="s1">&#39;/spawn &#39;</span><span class="p">,</span>
            <span class="s1">&#39;turtlesim/srv/Spawn &#39;</span><span class="p">,</span>
            <span class="s1">&#39;&quot;{x: 2, y: 2, theta: 0.2}&quot;&#39;</span>
        <span class="p">]],</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">change_background_r</span> <span class="o">=</span> <span class="n">ExecuteProcess</span><span class="p">(</span>
        <span class="n">cmd</span><span class="o">=</span><span class="p">[[</span>
            <span class="n">FindExecutable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ros2&#39;</span><span class="p">),</span>
            <span class="s1">&#39; param set &#39;</span><span class="p">,</span>
            <span class="n">turtlesim_ns</span><span class="p">,</span>
            <span class="s1">&#39;/sim background_r &#39;</span><span class="p">,</span>
            <span class="s1">&#39;120&#39;</span>
        <span class="p">]],</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">change_background_r_conditioned</span> <span class="o">=</span> <span class="n">ExecuteProcess</span><span class="p">(</span>
        <span class="n">condition</span><span class="o">=</span><span class="n">IfCondition</span><span class="p">(</span>
            <span class="n">PythonExpression</span><span class="p">([</span>
                <span class="n">new_background_r</span><span class="p">,</span>
                <span class="s1">&#39; == 200&#39;</span><span class="p">,</span>
                <span class="s1">&#39; and &#39;</span><span class="p">,</span>
                <span class="n">use_provided_red</span>
            <span class="p">])</span>
        <span class="p">),</span>
        <span class="n">cmd</span><span class="o">=</span><span class="p">[[</span>
            <span class="n">FindExecutable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ros2&#39;</span><span class="p">),</span>
            <span class="s1">&#39; param set &#39;</span><span class="p">,</span>
            <span class="n">turtlesim_ns</span><span class="p">,</span>
            <span class="s1">&#39;/sim background_r &#39;</span><span class="p">,</span>
            <span class="n">new_background_r</span>
        <span class="p">]],</span>
        <span class="n">shell</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">LaunchDescription</span><span class="p">([</span>
        <span class="n">turtlesim_ns_launch_arg</span><span class="p">,</span>
        <span class="n">use_provided_red_launch_arg</span><span class="p">,</span>
        <span class="n">new_background_r_launch_arg</span><span class="p">,</span>
        <span class="n">turtlesim_node</span><span class="p">,</span>
        <span class="n">RegisterEventHandler</span><span class="p">(</span>
            <span class="n">OnProcessStart</span><span class="p">(</span>
                <span class="n">target_action</span><span class="o">=</span><span class="n">turtlesim_node</span><span class="p">,</span>
                <span class="n">on_start</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">LogInfo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Turtlesim started, spawning turtle&#39;</span><span class="p">),</span>
                    <span class="n">spawn_turtle</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">RegisterEventHandler</span><span class="p">(</span>
            <span class="n">OnProcessIO</span><span class="p">(</span>
                <span class="n">target_action</span><span class="o">=</span><span class="n">spawn_turtle</span><span class="p">,</span>
                <span class="n">on_stdout</span><span class="o">=</span><span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">LogInfo</span><span class="p">(</span>
                    <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Spawn request says &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">event</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">RegisterEventHandler</span><span class="p">(</span>
            <span class="n">OnExecutionComplete</span><span class="p">(</span>
                <span class="n">target_action</span><span class="o">=</span><span class="n">spawn_turtle</span><span class="p">,</span>
                <span class="n">on_completion</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">LogInfo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Spawn finished&#39;</span><span class="p">),</span>
                    <span class="n">change_background_r</span><span class="p">,</span>
                    <span class="n">TimerAction</span><span class="p">(</span>
                        <span class="n">period</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                        <span class="n">actions</span><span class="o">=</span><span class="p">[</span><span class="n">change_background_r_conditioned</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">RegisterEventHandler</span><span class="p">(</span>
            <span class="n">OnProcessExit</span><span class="p">(</span>
                <span class="n">target_action</span><span class="o">=</span><span class="n">turtlesim_node</span><span class="p">,</span>
                <span class="n">on_exit</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">LogInfo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="p">(</span><span class="n">EnvironmentVariable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;USER&#39;</span><span class="p">),</span>
                            <span class="s1">&#39; closed the turtlesim window&#39;</span><span class="p">)),</span>
                    <span class="n">EmitEvent</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">Shutdown</span><span class="p">(</span>
                        <span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Window closed&#39;</span><span class="p">))</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="p">),</span>
        <span class="n">RegisterEventHandler</span><span class="p">(</span>
            <span class="n">OnShutdown</span><span class="p">(</span>
                <span class="n">on_shutdown</span><span class="o">=</span><span class="p">[</span><span class="n">LogInfo</span><span class="p">(</span>
                    <span class="n">msg</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Launch was asked to shutdown: &#39;</span><span class="p">,</span>
                        <span class="n">LocalSubstitution</span><span class="p">(</span><span class="s1">&#39;event.reason&#39;</span><span class="p">)]</span>
                <span class="p">)]</span>
            <span class="p">)</span>
        <span class="p">),</span>
    <span class="p">])</span>
</pre></div>
</div>
<p>在启动描述中定义了“OnProcessStart”、“OnProcessIO”、“OnExecutionComplete”、“OnProcessExit”和“OnShutdown”事件的“RegisterEventHandler”操作。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5475">[5475]</a></p>
<p>“OnProcessStart”事件处理程序用于注册在turtlesim节点启动时执行的回调函数。它在turtlesim节点启动时向控制台记录一条消息，并执行“spawn_turtle”操作。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5476">[5476]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RegisterEventHandler</span><span class="p">(</span>
    <span class="n">OnProcessStart</span><span class="p">(</span>
        <span class="n">target_action</span><span class="o">=</span><span class="n">turtlesim_node</span><span class="p">,</span>
        <span class="n">on_start</span><span class="o">=</span><span class="p">[</span>
            <span class="n">LogInfo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Turtlesim started, spawning turtle&#39;</span><span class="p">),</span>
            <span class="n">spawn_turtle</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">),</span>
</pre></div>
</div>
<p>“OnProcessIO”事件处理程序用于注册在“spawn_turtle”操作写入其标准输出时执行的回调函数。它记录生成请求的结果。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5477">[5477]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RegisterEventHandler</span><span class="p">(</span>
    <span class="n">OnProcessIO</span><span class="p">(</span>
        <span class="n">target_action</span><span class="o">=</span><span class="n">spawn_turtle</span><span class="p">,</span>
        <span class="n">on_stdout</span><span class="o">=</span><span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">LogInfo</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Spawn request says &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">event</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">),</span>
</pre></div>
</div>
<p>“OnExecutionComplete”事件处理程序用于注册在“spawn_turtle”操作完成时执行的回调函数。它在生成操作完成时向控制台记录一条消息，并执行“change_background_r”和“change_background_r_conditioned”操作。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5478">[5478]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RegisterEventHandler</span><span class="p">(</span>
    <span class="n">OnExecutionComplete</span><span class="p">(</span>
        <span class="n">target_action</span><span class="o">=</span><span class="n">spawn_turtle</span><span class="p">,</span>
        <span class="n">on_completion</span><span class="o">=</span><span class="p">[</span>
            <span class="n">LogInfo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Spawn finished&#39;</span><span class="p">),</span>
            <span class="n">change_background_r</span><span class="p">,</span>
            <span class="n">TimerAction</span><span class="p">(</span>
                <span class="n">period</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                <span class="n">actions</span><span class="o">=</span><span class="p">[</span><span class="n">change_background_r_conditioned</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">),</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">OnProcessExit</span></code> 事件处理程序用于注册一个回调函数，当 turtlesim 节点退出时执行该函数。它将一条消息记录到控制台，并执行 <code class="docutils literal notranslate"><span class="pre">EmitEvent</span></code> 操作以在 turtlesim 节点退出时触发一个 <code class="docutils literal notranslate"><span class="pre">Shutdown</span></code> 事件。这意味着当 turtlesim 窗口关闭时，启动过程将会关闭。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5479">[5479]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RegisterEventHandler</span><span class="p">(</span>
    <span class="n">OnProcessExit</span><span class="p">(</span>
        <span class="n">target_action</span><span class="o">=</span><span class="n">turtlesim_node</span><span class="p">,</span>
        <span class="n">on_exit</span><span class="o">=</span><span class="p">[</span>
            <span class="n">LogInfo</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="p">(</span><span class="n">EnvironmentVariable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;USER&#39;</span><span class="p">),</span>
                    <span class="s1">&#39; closed the turtlesim window&#39;</span><span class="p">)),</span>
            <span class="n">EmitEvent</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">Shutdown</span><span class="p">(</span>
                <span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Window closed&#39;</span><span class="p">))</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">),</span>
</pre></div>
</div>
<p>最后，<code class="docutils literal notranslate"><span class="pre">OnShutdown</span></code> 事件处理程序用于注册一个回调函数，在要求关闭启动文件时执行该函数。它将一条消息记录到控制台，说明为什么要求关闭启动文件。它将消息记录为关闭的原因，例如 turtlesim 窗口的关闭或用户发出的 <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">ctrl</kbd>-<kbd class="kbd docutils literal notranslate">c</kbd></kbd> 信号。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5480">[5480]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RegisterEventHandler</span><span class="p">(</span>
    <span class="n">OnShutdown</span><span class="p">(</span>
        <span class="n">on_shutdown</span><span class="o">=</span><span class="p">[</span><span class="n">LogInfo</span><span class="p">(</span>
            <span class="n">msg</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Launch was asked to shutdown: &#39;</span><span class="p">,</span>
                <span class="n">LocalSubstitution</span><span class="p">(</span><span class="s1">&#39;event.reason&#39;</span><span class="p">)]</span>
        <span class="p">)]</span>
    <span class="p">)</span>
<span class="p">),</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="build-the-package">
<h2>构建软件包 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5481">[5481]</a><a class="headerlink" href="#build-the-package" title="永久链接至标题"></a></h2>
<p>转到工作空间的根目录，并构建软件包： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5482">[5482]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">colcon build</span>
</pre></div>
</div>
<p>构建完成后，请记得设置工作空间环境。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5483">[5483]</a></p>
</div>
<div class="section" id="launching-example">
<h2>启动示例 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5484">[5484]</a><a class="headerlink" href="#launching-example" title="永久链接至标题"></a></h2>
<p>现在你可以使用``ros2 launch``命令来启动``example_event_handlers.launch.py``文件。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5485">[5485]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 launch launch_tutorial example_event_handlers.launch.py turtlesim_ns:=&#39;turtlesim3&#39; use_provided_red:=&#39;True&#39; new_background_r:=200</span>
</pre></div>
</div>
<p>这将执行以下操作： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5486">[5486]</a></p>
<ol class="arabic simple">
<li><p>启动一个带有蓝色背景的turtlesim节点 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5487">[5487]</a></p></li>
<li><p>生成第二只乌龟 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5488">[5488]</a></p></li>
<li><p>如果提供的``background_r``参数为``200``且``use_provided_red``参数为``True``，则将颜色更改为紫色 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5489">[5489]</a></p></li>
<li><p>如果提供的``background_r``参数为``200``且``use_provided_red``参数为``True``，则在两秒后将颜色更改为粉色 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5490">[5490]</a></p></li>
<li><p>当turtlesim窗口关闭时关闭启动文件 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5491">[5491]</a></p></li>
</ol>
<p>此外，当以下情况发生时，它将在控制台上记录消息： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5492">[5492]</a></p>
<ol class="arabic simple">
<li><p>turtlesim节点启动 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5493">[5493]</a></p></li>
<li><p>执行spawn动作 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5494">[5494]</a></p></li>
<li><p>执行``change_background_r``动作 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5495">[5495]</a></p></li>
<li><p>执行``change_background_r_conditioned``动作 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5496">[5496]</a></p></li>
<li><p>turtlesim节点退出 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5497">[5497]</a></p></li>
<li><p>要求终止启动进程。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5498">[5498]</a></p></li>
</ol>
</div>
<div class="section" id="documentation">
<h2>文档 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5464">[5464]</a><a class="headerlink" href="#documentation" title="永久链接至标题"></a></h2>
<p><a class="reference external" href="https://github.com/ros2/launch/blob/humble/launch/doc/source/architecture.rst">启动文档</a> 提供了关于可用事件处理程序的详细信息。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5499">[5499]</a></p>
</div>
<div class="section" id="summary">
<h2>总结 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=3353">[3353]</a><a class="headerlink" href="#summary" title="永久链接至标题"></a></h2>
<p>在本教程中，您学习了如何在启动文件中使用事件处理程序。您了解了它们的语法和使用示例，以定义一组复杂的规则，以动态修改启动文件。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5500">[5500]</a></p>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>