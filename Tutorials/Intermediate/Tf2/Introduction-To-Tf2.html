<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutorials/Intermediate/Tf2/Introduction-To-Tf2</title>
</head>
<body>
  <div class="section" id="introducing-tf2">
<span id="intrototf2"></span><h1>介绍``tf2``<a class="headerlink" href="#introducing-tf2" title="永久链接至标题"></a></h1>
<p><strong>目标：</strong> 运行一个turtlesim演示，并在使用turtlesim的多机器人示例中展示tf2的部分功能。</p>
<p><strong>教程级别：</strong> 中级</p>
<p><strong>时间:</strong> 10分钟</p>
<div class="contents local topic" id="contents">
<p class="topic-title">内容</p>
<ul class="simple">
<li><p><a class="reference internal" href="#installing-the-demo" id="id1">安装演示程序</a></p></li>
<li><p><a class="reference internal" href="#running-the-demo" id="id2">运行演示</a></p></li>
<li><p><a class="reference internal" href="#what-is-happening" id="id3">发生了什么事？</a></p></li>
<li><p><a class="reference internal" href="#tf2-tools" id="id4">tf2工具</a></p>
<ul>
<li><p><a class="reference internal" href="#using-view-frames" id="id5">1 使用view_frames</a></p></li>
<li><p><a class="reference internal" href="#using-tf2-echo" id="id6">2 使用 tf2_echo</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#rviz-and-tf2" id="id7">rviz和tf2</a></p></li>
</ul>
</div>
<div class="section" id="installing-the-demo">
<h2><a class="toc-backref" href="#id1">安装演示程序</a><a class="headerlink" href="#installing-the-demo" title="永久链接至标题"></a></h2>
<p>让我们首先安装演示包及其依赖项。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-TGludXggQmluYXJpZXM=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-TGludXggQmluYXJpZXM=" name="TGludXggQmluYXJpZXM=" role="tab" tabindex="0">Linux Binaries</button><button aria-controls="panel-0-RnJvbSBTb3VyY2U=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-RnJvbSBTb3VyY2U=" name="RnJvbSBTb3VyY2U=" role="tab" tabindex="-1">From Source</button></div><div aria-labelledby="tab-0-TGludXggQmluYXJpZXM=" class="sphinx-tabs-panel group-tab" id="panel-0-TGludXggQmluYXJpZXM=" name="TGludXggQmluYXJpZXM=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt-get install ros-humble-turtle-tf2-py ros-humble-tf2-tools ros-humble-tf-transformations</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-RnJvbSBTb3VyY2U=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-RnJvbSBTb3VyY2U=" name="RnJvbSBTb3VyY2U=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>Clone and build the geometry_tutorials repo using the branch that matches your installation
<span class="go">git clone https://github.com/ros/geometry_tutorials.git -b ros2</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="running-the-demo">
<h2><a class="toc-backref" href="#id2">运行演示</a><a class="headerlink" href="#running-the-demo" title="永久链接至标题"></a></h2>
<p>既然我们已经安装了``turtle_tf2_py``教程包，让我们来运行演示。首先，打开一个新的终端并：doc:<a class="reference internal" href="../../Beginner-CLI-Tools/Configuring-ROS2-Environment.html"><span class="doc">配置你的ROS 2环境</span></a>，这样``ros2``命令就能正常工作了。然后运行以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 launch turtle_tf2_py turtle_tf2_demo.launch.py</span>
</pre></div>
</div>
<p>你将看到turtlesim启动并有两只海龟。</p>
<img alt="../../../_images/turtlesim_follow1.png" src="../../../_images/turtlesim_follow1.png" />
<p>在第二个终端窗口中输入以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 run turtlesim turtle_teleop_key</span>
</pre></div>
</div>
<p>一旦turtlesim启动，你可以使用键盘的箭头键驱动中央的海龟在turtlesim中移动，选择第二个终端窗口，这样你的按键操作将被捕捉到来驱动海龟。</p>
<img alt="../../../_images/turtlesim_follow2.png" src="../../../_images/turtlesim_follow2.png" />
<p>你会看到一只海龟不断地跟随着你驱动的海龟移动。</p>
</div>
<div class="section" id="what-is-happening">
<h2><a class="toc-backref" href="#id3">发生了什么事？</a><a class="headerlink" href="#what-is-happening" title="永久链接至标题"></a></h2>
<p>此演示使用tf2库创建了三个坐标系：<a href="#id1"><span class="problematic" id="id2">``</span></a>world``坐标系、<a href="#id3"><span class="problematic" id="id4">``</span></a>turtle1``坐标系和``turtle2``坐标系。本教程使用tf2广播器发布乌龟坐标系，并使用tf2监听器计算乌龟坐标系之间的差异，并使一只乌龟跟随另一只乌龟移动。</p>
</div>
<div class="section" id="tf2-tools">
<h2><a class="toc-backref" href="#id4">tf2工具</a><a class="headerlink" href="#tf2-tools" title="永久链接至标题"></a></h2>
<p>现在让我们看看tf2是如何用于创建这个演示的。我们可以使用``tf2_tools``来查看tf2在幕后的工作。</p>
<div class="section" id="using-view-frames">
<h3><a class="toc-backref" href="#id5">1 使用view_frames</a><a class="headerlink" href="#using-view-frames" title="永久链接至标题"></a></h3>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>view_frames``会创建一个图示，显示tf2通过ROS广播的坐标系。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 run tf2_tools view_frames</span>
</pre></div>
</div>
<p>您将看到：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Listening to tf data during 5 seconds...</span>
<span class="go">Generating graph in frames.pdf file...</span>
</pre></div>
</div>
<p>这里有一个 tf2 监听器在监听通过 ROS 广播的帧，并绘制连接帧的树形结构。要查看树形结构，请使用您喜欢的 PDF 查看器打开生成的“frames.pdf”文件。</p>
<img alt="../../../_images/turtlesim_frames.png" src="../../../_images/turtlesim_frames.png" />
<p>这里我们可以看到由 tf2 广播的三个帧：<code class="docutils literal notranslate"><span class="pre">world</span></code>、<code class="docutils literal notranslate"><span class="pre">turtle1``和``turtle2</span></code>。<code class="docutils literal notranslate"><span class="pre">world</span></code> 是``turtle1``和``turtle2``帧的父级。<a href="#id1"><span class="problematic" id="id2">``</span></a>view_frames``还报告了一些诊断信息，包括接收到的最旧和最新帧变换的时间以及用于调试目的将 tf2 帧发布到 tf2 的速度。</p>
</div>
<div class="section" id="using-tf2-echo">
<h3><a class="toc-backref" href="#id6">2 使用 tf2_echo</a><a class="headerlink" href="#using-tf2-echo" title="永久链接至标题"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">tf2_echo</span></code> 报告了在 ROS 上广播的任意两个帧之间的变换。</p>
<p>用法：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 run tf2_ros tf2_echo [source_frame] [target_frame]</span>
</pre></div>
</div>
<p>让我们看看“turtle2”相对于“turtle1”帧的变换，它等同于：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 run tf2_ros tf2_echo turtle2 turtle1</span>
</pre></div>
</div>
<p>当“tf2_echo”监听器接收到在ROS 2上广播的帧时，您将看到变换显示出来。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">At time 1622031731.625364060</span>
<span class="go">- Translation: [2.796, 1.039, 0.000]</span>
<span class="go">- Rotation: in Quaternion [0.000, 0.000, 0.202, 0.979]</span>
<span class="go">At time 1622031732.614745114</span>
<span class="go">- Translation: [1.608, 0.250, 0.000]</span>
<span class="go">- Rotation: in Quaternion [0.000, 0.000, 0.032, 0.999]</span>
</pre></div>
</div>
<p>当您驱动乌龟移动时，您将看到变换随着两只乌龟相对移动而改变。</p>
</div>
</div>
<div class="section" id="rviz-and-tf2">
<h2><a class="toc-backref" href="#id7">rviz和tf2</a><a class="headerlink" href="#rviz-and-tf2" title="永久链接至标题"></a></h2>
<p>“rviz”是一个可用于检查tf2帧的可视化工具。让我们使用rviz来查看我们的乌龟帧。使用“-d”选项，启动“rviz”，并使用“turtle_rviz.rviz”配置文件：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 run rviz2 rviz2 -d $(ros2 pkg prefix --share turtle_tf2_py)/rviz/turtle_rviz.rviz</span>
</pre></div>
</div>
<img alt="../../../_images/turtlesim_rviz1.png" src="../../../_images/turtlesim_rviz1.png" />
<p>在侧边栏中，您将看到tf2广播的帧。当您驱动乌龟时，您将看到这些帧在rviz中移动。</p>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>