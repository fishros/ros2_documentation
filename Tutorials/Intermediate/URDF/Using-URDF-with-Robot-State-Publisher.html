<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutorials/Intermediate/URDF/Using-URDF-with-Robot-State-Publisher</title>
</head>
<body>
  <div class="section" id="using-urdf-with-robot-state-publisher">
<span id="urdfplusrsp"></span><h1>使用URDF和``robot_state_publisher``<a class="headerlink" href="#using-urdf-with-robot-state-publisher" title="永久链接至标题"></a></h1>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>目标：<a href="#id3"><span class="problematic" id="id4">**</span></a>模拟使用URDF建模的行走机器人，并在Rviz中查看。</p>
<p><strong>教程级别：</strong> 中级</p>
<p><strong>时间：</strong> 15分钟</p>
<div class="contents local topic" id="contents">
<p class="topic-title">内容</p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id1">背景</a></p></li>
<li><p><a class="reference internal" href="#prerequisites" id="id2">先决条件</a></p></li>
<li><p><a class="reference internal" href="#tasks" id="id3">任务</a></p>
<ul>
<li><p><a class="reference internal" href="#create-a-package" id="id4">1 创建一个包</a></p></li>
<li><p><a class="reference internal" href="#create-the-urdf-file" id="id5">2 创建URDF文件</a></p></li>
<li><p><a class="reference internal" href="#publish-the-state" id="id6">3 发布状态</a></p></li>
<li><p><a class="reference internal" href="#create-a-launch-file" id="id7">4 创建一个launch文件</a></p></li>
<li><p><a class="reference internal" href="#edit-the-setup-py-file" id="id8">5 编辑setup.py文件</a></p></li>
<li><p><a class="reference internal" href="#install-the-package" id="id9">6 安装包</a></p></li>
<li><p><a class="reference internal" href="#view-the-results" id="id10">7 查看结果</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#summary" id="id11">总结</a></p></li>
</ul>
</div>
<div class="section" id="background">
<h2><a class="toc-backref" href="#id1">背景</a><a class="headerlink" href="#background" title="永久链接至标题"></a></h2>
<p>本教程将向您展示如何建模行走机器人，将其状态发布为 <a class="reference external" href="https://wiki.ros.org/tf2">tf2</a> 消息，并在Rviz中进行仿真查看。首先，我们创建描述机器人装配的URDF模型。接下来，我们编写一个节点来模拟运动并发布JointState和变换。然后，我们使用``robot_state_publisher``将整个机器人状态发布到``/tf2``。</p>
<img alt="../../../_images/r2d2_rviz_demo.gif" src="../../../_images/r2d2_rviz_demo.gif" />
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id2">先决条件</a><a class="headerlink" href="#prerequisites" title="永久链接至标题"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://index.ros.org/p/rviz2/">rviz2</a></p></li>
</ul>
<p>如往常一样，在每次打开新的终端时不要忘记在 :doc`每个新终端中启用ROS 2环境 &lt;../../Beginner-CLI-Tools/Configuring-ROS2-Environment&gt;`。</p>
</div>
<div class="section" id="tasks">
<h2><a class="toc-backref" href="#id3">任务</a><a class="headerlink" href="#tasks" title="永久链接至标题"></a></h2>
<div class="section" id="create-a-package">
<h3><a class="toc-backref" href="#id4">1 创建一个包</a><a class="headerlink" href="#create-a-package" title="永久链接至标题"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir -p ~/second_ros2_ws/src  # change as needed</span>
<span class="go">cd ~/second_ros2_ws/src</span>
<span class="go">ros2 pkg create urdf_tutorial_r2d2 --build-type ament_python --dependencies rclpy</span>
<span class="go">cd urdf_tutorial_r2d2</span>
</pre></div>
</div>
<p>您现在应该看到一个``urdf_tutorial_r2d2``文件夹。接下来，您将对其进行几处更改。</p>
</div>
<div class="section" id="create-the-urdf-file">
<h3><a class="toc-backref" href="#id5">2 创建URDF文件</a><a class="headerlink" href="#create-the-urdf-file" title="永久链接至标题"></a></h3>
<p>创建存储某些资源的目录：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir -p urdf</span>
</pre></div>
</div>
<p>下载:download:<code class="xref any docutils literal notranslate"><span class="pre">URDF文件</span></code>，并将其保存为``~/second_ros2_ws/src/urdf_tutorial_r2d2/urdf/r2d2.urdf.xml``。下载:download:<code class="xref any docutils literal notranslate"><span class="pre">Rviz配置文件</span></code>，并将其保存为``~/second_ros2_ws/src/urdf_tutorial_r2d2/urdf/r2d2.rviz``。</p>
</div>
<div class="section" id="publish-the-state">
<h3><a class="toc-backref" href="#id6">3 发布状态</a><a class="headerlink" href="#publish-the-state" title="永久链接至标题"></a></h3>
<p>现在我们需要一种方法来指定机器人所处的状态。为此，我们必须指定所有三个关节和整体里程计。</p>
<p>启动您喜欢的编辑器，并将以下代码粘贴到``~/second_ros2_ws/src/urdf_tutorial_r2d2/urdf_tutorial_r2d2/state_publisher.py``中</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">pi</span>
<span class="kn">import</span> <span class="nn">rclpy</span>
<span class="kn">from</span> <span class="nn">rclpy.node</span> <span class="kn">import</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="nn">rclpy.qos</span> <span class="kn">import</span> <span class="n">QoSProfile</span>
<span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Quaternion</span>
<span class="kn">from</span> <span class="nn">sensor_msgs.msg</span> <span class="kn">import</span> <span class="n">JointState</span>
<span class="kn">from</span> <span class="nn">tf2_ros</span> <span class="kn">import</span> <span class="n">TransformBroadcaster</span><span class="p">,</span> <span class="n">TransformStamped</span>

<span class="k">class</span> <span class="nc">StatePublisher</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;state_publisher&#39;</span><span class="p">)</span>

        <span class="n">qos_profile</span> <span class="o">=</span> <span class="n">QoSProfile</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">joint_pub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_publisher</span><span class="p">(</span><span class="n">JointState</span><span class="p">,</span> <span class="s1">&#39;joint_states&#39;</span><span class="p">,</span> <span class="n">qos_profile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">broadcaster</span> <span class="o">=</span> <span class="n">TransformBroadcaster</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qos</span><span class="o">=</span><span class="n">qos_profile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodeName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> started&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeName</span><span class="p">))</span>

        <span class="n">degree</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span>
        <span class="n">loop_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_rate</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

        <span class="c1"># robot state</span>
        <span class="n">tilt</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">tinc</span> <span class="o">=</span> <span class="n">degree</span>
        <span class="n">swivel</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">height</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">hinc</span> <span class="o">=</span> <span class="mf">0.005</span>

        <span class="c1"># message declarations</span>
        <span class="n">odom_trans</span> <span class="o">=</span> <span class="n">TransformStamped</span><span class="p">()</span>
        <span class="n">odom_trans</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s1">&#39;odom&#39;</span>
        <span class="n">odom_trans</span><span class="o">.</span><span class="n">child_frame_id</span> <span class="o">=</span> <span class="s1">&#39;axis&#39;</span>
        <span class="n">joint_state</span> <span class="o">=</span> <span class="n">JointState</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">rclpy</span><span class="o">.</span><span class="n">ok</span><span class="p">():</span>
                <span class="n">rclpy</span><span class="o">.</span><span class="n">spin_once</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

                <span class="c1"># update joint_state</span>
                <span class="n">now</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_clock</span><span class="p">()</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                <span class="n">joint_state</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">to_msg</span><span class="p">()</span>
                <span class="n">joint_state</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;swivel&#39;</span><span class="p">,</span> <span class="s1">&#39;tilt&#39;</span><span class="p">,</span> <span class="s1">&#39;periscope&#39;</span><span class="p">]</span>
                <span class="n">joint_state</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="p">[</span><span class="n">swivel</span><span class="p">,</span> <span class="n">tilt</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>

                <span class="c1"># update transform</span>
                <span class="c1"># (moving in a circle with radius=2)</span>
                <span class="n">odom_trans</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">stamp</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">to_msg</span><span class="p">()</span>
                <span class="n">odom_trans</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span>
                <span class="n">odom_trans</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span>
                <span class="n">odom_trans</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.7</span>
                <span class="n">odom_trans</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> \
                    <span class="n">euler_to_quaternion</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">angle</span> <span class="o">+</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># roll,pitch,yaw</span>

                <span class="c1"># send the joint state and transform</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">joint_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">joint_state</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">broadcaster</span><span class="o">.</span><span class="n">sendTransform</span><span class="p">(</span><span class="n">odom_trans</span><span class="p">)</span>

                <span class="c1"># Create new robot state</span>
                <span class="n">tilt</span> <span class="o">+=</span> <span class="n">tinc</span>
                <span class="k">if</span> <span class="n">tilt</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.5</span> <span class="ow">or</span> <span class="n">tilt</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">tinc</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">height</span> <span class="o">+=</span> <span class="n">hinc</span>
                <span class="k">if</span> <span class="n">height</span> <span class="o">&gt;</span> <span class="mf">0.2</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">hinc</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">swivel</span> <span class="o">+=</span> <span class="n">degree</span>
                <span class="n">angle</span> <span class="o">+=</span> <span class="n">degree</span><span class="o">/</span><span class="mi">4</span>

                <span class="c1"># This will adjust as needed per iteration</span>
                <span class="n">loop_rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="k">def</span> <span class="nf">euler_to_quaternion</span><span class="p">(</span><span class="n">roll</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">yaw</span><span class="p">):</span>
    <span class="n">qx</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">roll</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">pitch</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">yaw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">roll</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">pitch</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">yaw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">qy</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">roll</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">pitch</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">yaw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">roll</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">pitch</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">yaw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">qz</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">roll</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">pitch</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">yaw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">roll</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">pitch</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">yaw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">qw</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">roll</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">pitch</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">yaw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">roll</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">pitch</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">yaw</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Quaternion</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">qx</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">qy</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">qz</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">qw</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">StatePublisher</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-launch-file">
<h3><a class="toc-backref" href="#id7">4 创建一个launch文件</a><a class="headerlink" href="#create-a-launch-file" title="永久链接至标题"></a></h3>
<p>创建一个新的``~/second_ros2_ws/src/urdf_tutorial_r2d2/launch``文件夹。打开您的编辑器并将以下代码粘贴到其中，保存为``~/second_ros2_ws/src/urdf_tutorial_r2d2/launch/demo.launch.py``</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">ament_index_python.packages</span> <span class="kn">import</span> <span class="n">get_package_share_directory</span>
<span class="kn">from</span> <span class="nn">launch</span> <span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span> <span class="nn">launch.actions</span> <span class="kn">import</span> <span class="n">DeclareLaunchArgument</span>
<span class="kn">from</span> <span class="nn">launch.substitutions</span> <span class="kn">import</span> <span class="n">LaunchConfiguration</span>
<span class="kn">from</span> <span class="nn">launch_ros.actions</span> <span class="kn">import</span> <span class="n">Node</span>

<span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>

    <span class="n">use_sim_time</span> <span class="o">=</span> <span class="n">LaunchConfiguration</span><span class="p">(</span><span class="s1">&#39;use_sim_time&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;false&#39;</span><span class="p">)</span>

    <span class="n">urdf_file_name</span> <span class="o">=</span> <span class="s1">&#39;r2d2.urdf.xml&#39;</span>
    <span class="n">urdf</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;urdf_tutorial_r2d2&#39;</span><span class="p">),</span>
        <span class="n">urdf_file_name</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">urdf</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infp</span><span class="p">:</span>
        <span class="n">robot_desc</span> <span class="o">=</span> <span class="n">infp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">LaunchDescription</span><span class="p">([</span>
        <span class="n">DeclareLaunchArgument</span><span class="p">(</span>
            <span class="s1">&#39;use_sim_time&#39;</span><span class="p">,</span>
            <span class="n">default_value</span><span class="o">=</span><span class="s1">&#39;false&#39;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Use simulation (Gazebo) clock if true&#39;</span><span class="p">),</span>
        <span class="n">Node</span><span class="p">(</span>
            <span class="n">package</span><span class="o">=</span><span class="s1">&#39;robot_state_publisher&#39;</span><span class="p">,</span>
            <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;robot_state_publisher&#39;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;robot_state_publisher&#39;</span><span class="p">,</span>
            <span class="n">output</span><span class="o">=</span><span class="s1">&#39;screen&#39;</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;use_sim_time&#39;</span><span class="p">:</span> <span class="n">use_sim_time</span><span class="p">,</span> <span class="s1">&#39;robot_description&#39;</span><span class="p">:</span> <span class="n">robot_desc</span><span class="p">}],</span>
            <span class="n">arguments</span><span class="o">=</span><span class="p">[</span><span class="n">urdf</span><span class="p">]),</span>
        <span class="n">Node</span><span class="p">(</span>
            <span class="n">package</span><span class="o">=</span><span class="s1">&#39;urdf_tutorial_r2d2&#39;</span><span class="p">,</span>
            <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;state_publisher&#39;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;state_publisher&#39;</span><span class="p">,</span>
            <span class="n">output</span><span class="o">=</span><span class="s1">&#39;screen&#39;</span><span class="p">),</span>
    <span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="edit-the-setup-py-file">
<h3><a class="toc-backref" href="#id8">5 编辑setup.py文件</a><a class="headerlink" href="#edit-the-setup-py-file" title="永久链接至标题"></a></h3>
<p>您必须告诉**colcon**构建工具如何安装您的Python包。请按照以下方式编辑``~/second_ros2_ws/src/urdf_tutorial_r2d2/setup.py``文件：</p>
<ul class="simple">
<li><p>包括以下导入语句</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>
<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">find_packages</span>
</pre></div>
</div>
<ul class="simple">
<li><p>在 <code class="docutils literal notranslate"><span class="pre">data_files</span></code> 中添加这两行</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data_files</span><span class="o">=</span><span class="p">[</span>
  <span class="o">...</span>
  <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;share&#39;</span><span class="p">,</span> <span class="n">package_name</span><span class="p">,</span> <span class="s1">&#39;launch&#39;</span><span class="p">),</span> <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;launch&#39;</span><span class="p">,</span> <span class="s1">&#39;*launch.[pxy][yma]*&#39;</span><span class="p">))),</span>
  <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;share&#39;</span><span class="p">,</span> <span class="n">package_name</span><span class="p">),</span> <span class="n">glob</span><span class="p">(</span><span class="s1">&#39;urdf/*&#39;</span><span class="p">))</span>
<span class="p">],</span>
</pre></div>
</div>
<ul class="simple">
<li><p>修改 <code class="docutils literal notranslate"><span class="pre">entry_points</span></code> 表，以便稍后可以从控制台运行 'state_publisher'</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;console_scripts&#39;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s1">&#39;state_publisher = urdf_tutorial_r2d2.state_publisher:main&#39;</span>
<span class="p">],</span>
</pre></div>
</div>
<p>保存修改后的 <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> 文件</p>
</div>
<div class="section" id="install-the-package">
<h3><a class="toc-backref" href="#id9">6 安装包</a><a class="headerlink" href="#install-the-package" title="永久链接至标题"></a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~/second_ros2_ws</span>
<span class="go">colcon build --symlink-install --packages-select urdf_tutorial_r2d2</span>
<span class="go">source install/setup.bash</span>
</pre></div>
</div>
</div>
<div class="section" id="view-the-results">
<h3><a class="toc-backref" href="#id10">7 查看结果</a><a class="headerlink" href="#view-the-results" title="永久链接至标题"></a></h3>
<p>启动包</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 launch urdf_tutorial_r2d2 demo.launch.py</span>
</pre></div>
</div>
<p>打开一个新的终端窗口，然后运行 Rviz 使用</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">rviz2 -d ~/second_ros2_ws/install/urdf_tutorial_r2d2/share/urdf_tutorial_r2d2/r2d2.rviz</span>
</pre></div>
</div>
<p>详细了解如何使用 Rviz，请参阅 <a class="reference external" href="http://wiki.ros.org/rviz/UserGuide">用户指南</a>。</p>
</div>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id11">总结</a><a class="headerlink" href="#summary" title="永久链接至标题"></a></h2>
<p>您创建了一个 JointState 发布器节点，并将其与 <code class="docutils literal notranslate"><span class="pre">robot_state_publisher</span></code> 配对以模拟行走机器人。这些示例中使用的代码可以在 <a class="reference external" href="https://github.com/benbongalon/ros2-migration/tree/master/urdf_tutorial">这里</a> 找到。</p>
<p>本文的部分内容是从这个 <a class="reference external" href="http://wiki.ros.org/urdf/Tutorials/Using%20urdf%20with%20robot_state_publisher">ROS 1 教程</a> 中重用的，对该教程的作者表示感谢。</p>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>