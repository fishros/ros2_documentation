<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutorials/Intermediate/URDF/Using-Xacro-to-Clean-Up-a-URDF-File</title>
</head>
<body>
  <div class="section" id="using-xacro-to-clean-up-your-code">
<span id="urdfxacro"></span><h1>使用 Xacro 清理您的代码 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6259">[6259]</a><a class="headerlink" href="#using-xacro-to-clean-up-your-code" title="永久链接至标题"></a></h1>
<p><strong>目标：</strong> 学习使用 Xacro 减少 URDF 文件中的代码量的一些技巧 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6260">[6260]</a></p>
<p><strong>教程级别：</strong> 中级 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=5286">[5286]</a></p>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>时间：<a href="#id3"><span class="problematic" id="id4">**</span></a>20分钟 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=3069">[3069]</a></p>
<div class="contents local topic" id="contents">
<p class="topic-title">内容 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=3277">[3277]</a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#using-xacro" id="id2">使用Xacro [6266]</a></p></li>
<li><p><a class="reference internal" href="#constants" id="id3">常量 [6262]</a></p></li>
<li><p><a class="reference internal" href="#math" id="id4">数学 [6279]</a></p></li>
<li><p><a class="reference internal" href="#macros" id="id5">宏 [6264]</a></p>
<ul>
<li><p><a class="reference internal" href="#simple-macro" id="id6">简单宏 [6283]</a></p></li>
<li><p><a class="reference internal" href="#parameterized-macro" id="id7">参数化宏 [6290]</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#practical-usage" id="id8">实际应用 [6299]</a></p>
<ul>
<li><p><a class="reference internal" href="#leg-macro" id="id9">腿宏 [6303]</a></p></li>
</ul>
</li>
</ul>
</div>
<p>到目前为止，如果你在家里跟着这些步骤自己设计机器人，你可能已经对进行各种数学计算来正确解析非常简单的机器人描述感到厌烦了。幸运的是，你可以使用 <a class="reference external" href="https://index.ros.org/p/xacro">xacro</a> 包来简化你的生活。它有三个非常有帮助的功能。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6261">[6261]</a></p>
<blockquote>
<div><ul class="simple">
<li><p>常量 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6262">[6262]</a></p></li>
<li><p>简单数学 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6263">[6263]</a></p></li>
<li><p>宏 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6264">[6264]</a></p></li>
</ul>
</div></blockquote>
<p>在本教程中，我们将介绍所有这些快捷方式，以帮助减少URDF文件的整体大小，并使其更易于阅读和维护。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6265">[6265]</a></p>
<div class="section" id="using-xacro">
<h2>使用Xacro <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6266">[6266]</a><a class="headerlink" href="#using-xacro" title="永久链接至标题"></a></h2>
<p>正如其名称所示，<a class="reference external" href="https://index.ros.org/p/xacro">xacro</a> 是一种用于 XML 的宏语言。xacro 程序运行所有的宏并输出结果。典型的用法如下所示： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6267">[6267]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">xacro model.xacro &gt; model.urdf</span>
</pre></div>
</div>
<p>您还可以在启动文件中自动生成 URDF。这很方便，因为它会保持最新状态并且不占用硬盘空间。然而，生成过程需要时间，所以请注意您的启动文件可能需要更长的启动时间。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6268">[6268]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">path_to_urdf</span> <span class="o">=</span> <span class="n">get_package_share_path</span><span class="p">(</span><span class="s1">&#39;pr2_description&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;robots&#39;</span> <span class="o">/</span> <span class="s1">&#39;pr2.urdf.xacro&#39;</span>
<span class="n">robot_state_publisher_node</span> <span class="o">=</span> <span class="n">launch_ros</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
    <span class="n">package</span><span class="o">=</span><span class="s1">&#39;robot_state_publisher&#39;</span><span class="p">,</span>
    <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;robot_state_publisher&#39;</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[{</span>
        <span class="s1">&#39;robot_description&#39;</span><span class="p">:</span> <span class="n">ParameterValue</span><span class="p">(</span>
            <span class="n">Command</span><span class="p">([</span><span class="s1">&#39;xacro &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">path_to_urdf</span><span class="p">)]),</span> <span class="n">value_type</span><span class="o">=</span><span class="nb">str</span>
        <span class="p">)</span>
    <span class="p">}]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>在 URDF 文件的顶部，您必须指定一个命名空间，以便文件能够正确解析。例如，下面是有效 xacro 文件的前两行： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6269">[6269]</a></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;robot</span> <span class="na">xmlns:xacro=</span><span class="s">&quot;http://www.ros.org/wiki/xacro&quot;</span> <span class="na">name=</span><span class="s">&quot;firefighter&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="constants">
<h2>常量 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6262">[6262]</a><a class="headerlink" href="#constants" title="永久链接至标题"></a></h2>
<p>让我们快速查看一下 R2D2 中的 base_link。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6270">[6270]</a></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&quot;base_link&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;visual&gt;</span>
    <span class="nt">&lt;geometry&gt;</span>
      <span class="nt">&lt;cylinder</span> <span class="na">length=</span><span class="s">&quot;0.6&quot;</span> <span class="na">radius=</span><span class="s">&quot;0.2&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/geometry&gt;</span>
    <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/visual&gt;</span>
  <span class="nt">&lt;collision&gt;</span>
    <span class="nt">&lt;geometry&gt;</span>
      <span class="nt">&lt;cylinder</span> <span class="na">length=</span><span class="s">&quot;0.6&quot;</span> <span class="na">radius=</span><span class="s">&quot;0.2&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/geometry&gt;</span>
  <span class="nt">&lt;/collision&gt;</span>
<span class="nt">&lt;/link&gt;</span>
</pre></div>
</div>
<p>这里的信息有些冗余。我们重复指定了圆柱体的长度和半径。更糟糕的是，如果我们想要更改它，我们需要在两个不同的位置进行修改。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6271">[6271]</a></p>
<p>幸运的是，xacro 允许您指定属性作为常量。因此，我们可以将上述代码改写为以下形式。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6272">[6272]</a></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&quot;width&quot;</span> <span class="na">value=</span><span class="s">&quot;0.2&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">&quot;bodylen&quot;</span> <span class="na">value=</span><span class="s">&quot;0.6&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&quot;base_link&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;visual&gt;</span>
        <span class="nt">&lt;geometry&gt;</span>
            <span class="nt">&lt;cylinder</span> <span class="na">radius=</span><span class="s">&quot;${width}&quot;</span> <span class="na">length=</span><span class="s">&quot;${bodylen}&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/geometry&gt;</span>
        <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/visual&gt;</span>
    <span class="nt">&lt;collision&gt;</span>
        <span class="nt">&lt;geometry&gt;</span>
            <span class="nt">&lt;cylinder</span> <span class="na">radius=</span><span class="s">&quot;${width}&quot;</span> <span class="na">length=</span><span class="s">&quot;${bodylen}&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/geometry&gt;</span>
    <span class="nt">&lt;/collision&gt;</span>
<span class="nt">&lt;/link&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>两个值在前两行中指定。它们可以在任何地方（假设是有效的XML），在任何级别上定义，并且可以在使用之前或之后定义。通常它们放在顶部。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6273">[6273]</a></p></li>
<li><p>在geometry元素中，我们使用美元符号和大括号表示值，而不是指定实际半径。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6274">[6274]</a></p></li>
<li><p>此代码将生成上述显示的相同代码。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6275">[6275]</a></p></li>
</ul>
<p>然后使用${}构造的内容值来替换${}。这意味着您可以将其与属性中的其他文本组合使用。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6276">[6276]</a></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xacro:property</span> <span class="na">name=</span><span class="s">”robotname”</span> <span class="na">value=</span><span class="s">”marvin”</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">”${robotname}s_leg”</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>这将生成 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6277">[6277]</a></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">”marvins_leg”</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>然而，${}中的内容不仅限于属性，这引出了我们的下一个要点... <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6278">[6278]</a></p>
</div>
<div class="section" id="math">
<h2>数学 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6279">[6279]</a><a class="headerlink" href="#math" title="永久链接至标题"></a></h2>
<p>您可以使用四种基本运算符（+、-、<a href="#id1"><span class="problematic" id="id2">*</span></a>、/）、一元减号和括号在 ${} 结构中构建任意复杂的表达式。例如： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6280">[6280]</a></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cylinder</span> <span class="na">radius=</span><span class="s">&quot;${wheeldiam/2}&quot;</span> <span class="na">length=</span><span class="s">&quot;0.1&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&quot;${reflect*(width+.02)} 0 0.25&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>您还可以使用更多的基本数学运算，例如 <code class="docutils literal notranslate"><span class="pre">sin</span></code> 和 <code class="docutils literal notranslate"><span class="pre">cos</span></code>。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6281">[6281]</a></p>
</div>
<div class="section" id="macros">
<h2>宏 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6264">[6264]</a><a class="headerlink" href="#macros" title="永久链接至标题"></a></h2>
<p>这是 xacro 包中最大且最有用的组件。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6282">[6282]</a></p>
<div class="section" id="simple-macro">
<h3>简单宏 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6283">[6283]</a><a class="headerlink" href="#simple-macro" title="永久链接至标题"></a></h3>
<p>让我们来看一个简单无用的宏。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6284">[6284]</a></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xacro:macro</span> <span class="na">name=</span><span class="s">&quot;default_origin&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&quot;0 0 0&quot;</span> <span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/xacro:macro&gt;</span>
<span class="nt">&lt;xacro:default_origin</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>(这是无用的，因为如果未指定原点，它与此值相同。) 此代码将生成以下内容。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6285">[6285]</a></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;origin</span> <span class="na">rpy=</span><span class="s">&quot;0 0 0&quot;</span> <span class="na">xyz=</span><span class="s">&quot;0 0 0&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>从技术上讲，名称不是必需的元素，但您需要指定它才能使用它。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6286">[6286]</a></p></li>
<li><p>每个``&lt;xacro:$NAME /&gt;``的实例都将替换为``xacro:macro``标记的内容。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6287">[6287]</a></p></li>
<li><p>请注意，即使它们不完全相同（两个属性的顺序已交换），生成的 XML 是等效的。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6288">[6288]</a></p></li>
<li><p>如果找不到具有指定名称的 xacro，则不会扩展它，并且不会生成错误。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6289">[6289]</a></p></li>
</ul>
</div>
<div class="section" id="parameterized-macro">
<h3>参数化宏 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6290">[6290]</a><a class="headerlink" href="#parameterized-macro" title="永久链接至标题"></a></h3>
<p>你还可以对宏进行参数化，这样它们每次生成的文本就不会完全相同。当与数学功能结合使用时，这更加强大。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6291">[6291]</a></p>
<p>首先，让我们以一个在R2D2中使用的简单宏的例子来说明。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6292">[6292]</a></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xacro:macro</span> <span class="na">name=</span><span class="s">&quot;default_inertial&quot;</span> <span class="na">params=</span><span class="s">&quot;mass&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;inertial&gt;</span>
            <span class="nt">&lt;mass</span> <span class="na">value=</span><span class="s">&quot;${mass}&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;inertia</span> <span class="na">ixx=</span><span class="s">&quot;1e-3&quot;</span> <span class="na">ixy=</span><span class="s">&quot;0.0&quot;</span> <span class="na">ixz=</span><span class="s">&quot;0.0&quot;</span>
                 <span class="na">iyy=</span><span class="s">&quot;1e-3&quot;</span> <span class="na">iyz=</span><span class="s">&quot;0.0&quot;</span>
                 <span class="na">izz=</span><span class="s">&quot;1e-3&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/inertial&gt;</span>
<span class="nt">&lt;/xacro:macro&gt;</span>
</pre></div>
</div>
<p>可以与以下代码一起使用 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6293">[6293]</a></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xacro:default_inertial</span> <span class="na">mass=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>参数的作用类似于属性，你可以在表达式中使用它们。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6294">[6294]</a></p>
<p>你还可以使用整个代码块作为参数。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6295">[6295]</a></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xacro:macro</span> <span class="na">name=</span><span class="s">&quot;blue_shape&quot;</span> <span class="na">params=</span><span class="s">&quot;name *shape&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&quot;${name}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;visual&gt;</span>
            <span class="nt">&lt;geometry&gt;</span>
                <span class="nt">&lt;xacro:insert_block</span> <span class="na">name=</span><span class="s">&quot;shape&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/geometry&gt;</span>
            <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&quot;blue&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/visual&gt;</span>
        <span class="nt">&lt;collision&gt;</span>
            <span class="nt">&lt;geometry&gt;</span>
                <span class="nt">&lt;xacro:insert_block</span> <span class="na">name=</span><span class="s">&quot;shape&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/geometry&gt;</span>
        <span class="nt">&lt;/collision&gt;</span>
    <span class="nt">&lt;/link&gt;</span>
<span class="nt">&lt;/xacro:macro&gt;</span>

<span class="nt">&lt;xacro:blue_shape</span> <span class="na">name=</span><span class="s">&quot;base_link&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;cylinder</span> <span class="na">radius=</span><span class="s">&quot;.42&quot;</span> <span class="na">length=</span><span class="s">&quot;.01&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/xacro:blue_shape&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>要指定一个代码块参数，在其参数名之前加上一个星号。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6296">[6296]</a></p></li>
<li><p>可以使用insert_block命令插入一个块 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6297">[6297]</a></p></li>
<li><p>按需插入块，可以插入多次 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6298">[6298]</a></p></li>
</ul>
</div>
</div>
<div class="section" id="practical-usage">
<h2>实际应用 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6299">[6299]</a><a class="headerlink" href="#practical-usage" title="永久链接至标题"></a></h2>
<p>xacro语言非常灵活，允许你做很多事情。除了上面显示的默认惯性宏之外，在`R2D2模型 &lt;<a class="reference external" href="https://github.com/ros/urdf_tutorial/blob/master/urdf/08-macroed.urdf.xacro">https://github.com/ros/urdf_tutorial/blob/master/urdf/08-macroed.urdf.xacro</a>&gt;`_ 中还有一些有用的使用xacro的方法。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6300">[6300]</a></p>
<p>要查看由xacro文件生成的模型，请运行与之前教程相同的命令： <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6301">[6301]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 launch urdf_tutorial display.launch.py model:=urdf/08-macroed.urdf.xacro</span>
</pre></div>
</div>
<p>(启动文件一直在运行xacro命令，但是因为没有需要扩展的宏，所以没有关系) <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6302">[6302]</a></p>
<div class="section" id="leg-macro">
<h3>腿宏 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6303">[6303]</a><a class="headerlink" href="#leg-macro" title="永久链接至标题"></a></h3>
<p>通常情况下，您希望在不同位置创建多个外观相似的对象。您可以使用宏和一些简单的数学计算来减少需要编写的代码量，就像我们在 R2 的两条腿上所做的一样。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6304">[6304]</a></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xacro:macro</span> <span class="na">name=</span><span class="s">&quot;leg&quot;</span> <span class="na">params=</span><span class="s">&quot;prefix reflect&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">name=</span><span class="s">&quot;${prefix}_leg&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;visual&gt;</span>
            <span class="nt">&lt;geometry&gt;</span>
                <span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&quot;${leglen} 0.1 0.2&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/geometry&gt;</span>
            <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&quot;0 0 -${leglen/2}&quot;</span> <span class="na">rpy=</span><span class="s">&quot;0 ${pi/2} 0&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;material</span> <span class="na">name=</span><span class="s">&quot;white&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/visual&gt;</span>
        <span class="nt">&lt;collision&gt;</span>
            <span class="nt">&lt;geometry&gt;</span>
                <span class="nt">&lt;box</span> <span class="na">size=</span><span class="s">&quot;${leglen} 0.1 0.2&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/geometry&gt;</span>
            <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&quot;0 0 -${leglen/2}&quot;</span> <span class="na">rpy=</span><span class="s">&quot;0 ${pi/2} 0&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/collision&gt;</span>
        <span class="nt">&lt;xacro:default_inertial</span> <span class="na">mass=</span><span class="s">&quot;10&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/link&gt;</span>

    <span class="nt">&lt;joint</span> <span class="na">name=</span><span class="s">&quot;base_to_${prefix}_leg&quot;</span> <span class="na">type=</span><span class="s">&quot;fixed&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;parent</span> <span class="na">link=</span><span class="s">&quot;base_link&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;child</span> <span class="na">link=</span><span class="s">&quot;${prefix}_leg&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;origin</span> <span class="na">xyz=</span><span class="s">&quot;0 ${reflect*(width+.02)} 0.25&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/joint&gt;</span>
    <span class="cm">&lt;!-- A bunch of stuff cut --&gt;</span>
<span class="nt">&lt;/xacro:macro&gt;</span>
<span class="nt">&lt;xacro:leg</span> <span class="na">prefix=</span><span class="s">&quot;right&quot;</span> <span class="na">reflect=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;xacro:leg</span> <span class="na">prefix=</span><span class="s">&quot;left&quot;</span> <span class="na">reflect=</span><span class="s">&quot;-1&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>常见技巧 1：使用名称前缀获取两个名称相似的对象。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6305">[6305]</a></p></li>
<li><p>常见技巧 2：使用数学计算来计算关节起源。在改变机器人的尺寸时，通过使用一些数学计算来计算关节偏移量的属性，可以节省很多麻烦。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6306">[6306]</a></p></li>
<li><p>常见技巧 3：使用反射参数，并将其设置为 1 或 -1。请看看我们如何使用反射参数将腿放置在身体的 base_to_${prefix}_leg 起源的两侧。 <a class="reference external" href="http://fishros.org/page/calib/#/home?apihost=http://fishros.org:2023/ros2/calib&amp;msgid=6307">[6307]</a></p></li>
</ul>
</div>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>