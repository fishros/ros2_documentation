<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutorials/Beginner-CLI-Tools/Recording-And-Playing-Back-Data/Recording-And-Playing-Back-Data</title>
</head>
<body>
  <div class="section" id="recording-and-playing-back-data">
<span id="ros2bag"></span><h1>录制和回放数据<a class="headerlink" href="#recording-and-playing-back-data" title="永久链接至标题"></a></h1>
<p><strong>目标：</strong> 记录发布在某个主题上的数据，以便随时回放和检查。</p>
<p><strong>教程级别:</strong> 初学者</p>
<p><strong>时间:</strong> 10分钟</p>
<div class="contents local topic" id="contents">
<p class="topic-title">内容</p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id1">背景</a></p></li>
<li><p><a class="reference internal" href="#prerequisites" id="id2">先决条件</a></p></li>
<li><p><a class="reference internal" href="#tasks" id="id3">任务</a></p>
<ul>
<li><p><a class="reference internal" href="#setup" id="id4">1 设置</a></p></li>
<li><p><a class="reference internal" href="#choose-a-topic" id="id5">2 选择一个主题</a></p></li>
<li><p><a class="reference internal" href="#ros2-bag-record" id="id6">3 ros2 bag record</a></p></li>
<li><p><a class="reference internal" href="#ros2-bag-info" id="id7">4 ros2 bag info</a></p></li>
<li><p><a class="reference internal" href="#ros2-bag-play" id="id8">5 ros2 bag play</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#summary" id="id9">总结</a></p></li>
<li><p><a class="reference internal" href="#next-steps" id="id10">下一步</a></p></li>
<li><p><a class="reference internal" href="#related-content" id="id11">相关内容</a></p></li>
</ul>
</div>
<div class="section" id="background">
<h2><a class="toc-backref" href="#id1">背景</a><a class="headerlink" href="#background" title="永久链接至标题"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">bag</span></code> 是一个命令行工具，用于记录系统中发布在主题上的数据。它会累积通过任意数量的主题传递的数据，并将其保存在数据库中。然后，您可以回放这些数据，以重现您的测试和实验结果。记录主题也是分享您的工作并允许他人重新创建的好方法。</p>
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id2">先决条件</a><a class="headerlink" href="#prerequisites" title="永久链接至标题"></a></h2>
<p>您应该将``ros2 bag``作为常规ROS 2安装的一部分进行安装。</p>
<p>如果您在Linux上从Debian软件包安装了ROS，而您的系统无法识别该命令，请按照以下方式进行安装：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt-get install ros-humble-ros2bag \</span>
<span class="go">                     ros-humble-rosbag2-storage-default-plugins</span>
</pre></div>
</div>
<p>本教程讲解了之前教程中涉及的概念，例如:doc:<code class="xref any docutils literal notranslate"><span class="pre">节点</span></code>。它还使用了:doc:<a class="reference internal" href="../Introducing-Turtlesim/Introducing-Turtlesim.html"><span class="doc">turtlesim package</span></a>。</p>
<p>像往常一样，在 <a class="reference internal" href="../Configuring-ROS2-Environment.html"><span class="doc">每个新开的终端中</span></a> 都不要忘记加载 ROS 2 。</p>
</div>
<div class="section" id="tasks">
<h2><a class="toc-backref" href="#id3">任务</a><a class="headerlink" href="#tasks" title="永久链接至标题"></a></h2>
<div class="section" id="setup">
<h3><a class="toc-backref" href="#id4">1 设置</a><a class="headerlink" href="#setup" title="永久链接至标题"></a></h3>
<p>您将在``turtlesim``系统中记录您的键盘输入，以便稍后保存和回放，请先启动``/turtlesim``和``/teleop_turtle``节点。</p>
<p>打开一个新的终端并运行：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 run turtlesim turtlesim_node</span>
</pre></div>
</div>
<p>打开另一个终端并运行：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 run turtlesim turtle_teleop_key</span>
</pre></div>
</div>
<p>我们还可以创建一个新目录来存储我们的保存录音，这样做是一个好的实践：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir bag_files</span>
<span class="go">cd bag_files</span>
</pre></div>
</div>
</div>
<div class="section" id="choose-a-topic">
<h3><a class="toc-backref" href="#id5">2 选择一个主题</a><a class="headerlink" href="#choose-a-topic" title="永久链接至标题"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">bag</span></code> 只能记录发布在主题中的消息数据。要查看系统的主题列表，请打开一个新终端并运行以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 topic list</span>
</pre></div>
</div>
<p>将返回：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/parameter_events</span>
<span class="go">/rosout</span>
<span class="go">/turtle1/cmd_vel</span>
<span class="go">/turtle1/color_sensor</span>
<span class="go">/turtle1/pose</span>
</pre></div>
</div>
<p>在主题教程中，你学到了 <code class="docutils literal notranslate"><span class="pre">/turtle_teleop</span></code> 节点在 <code class="docutils literal notranslate"><span class="pre">/turtle1/cmd_vel</span></code> 主题上发布命令，使乌龟在 turtlesim 中移动。</p>
<p>要查看 <code class="docutils literal notranslate"><span class="pre">/turtle1/cmd_vel</span></code> 发布的数据，请运行以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 topic echo /turtle1/cmd_vel</span>
</pre></div>
</div>
<p>一开始不会显示任何内容，因为 teleop 没有发布任何数据。返回到运行 teleop 的终端并选择它，使其处于活动状态。使用箭头键来移动乌龟，你将在运行 <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">topic</span> <span class="pre">echo</span></code> 的终端上看到数据被发布。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">linear:</span>
<span class="go">  x: 2.0</span>
<span class="go">  y: 0.0</span>
<span class="go">  z: 0.0</span>
<span class="go">angular:</span>
<span class="go">  x: 0.0</span>
<span class="go">  y: 0.0</span>
<span class="go">  z: 0.0</span>
<span class="go">  ---</span>
</pre></div>
</div>
</div>
<div class="section" id="ros2-bag-record">
<h3><a class="toc-backref" href="#id6">3 ros2 bag record</a><a class="headerlink" href="#ros2-bag-record" title="永久链接至标题"></a></h3>
<p>要记录发布到一个话题上的数据，请使用以下命令语法：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 bag record &lt;topic_name&gt;</span>
</pre></div>
</div>
<p>在对所选择的话题运行此命令之前，请打开一个新的终端并进入之前创建的``bag_files``目录，因为rosbag文件将保存在您运行命令的目录中。</p>
<p>运行以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 bag record /turtle1/cmd_vel</span>
</pre></div>
</div>
<p>你将在终端中看到以下消息（日期和时间会有所不同）：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[INFO] [rosbag2_storage]: Opened database &#39;rosbag2_2019_10_11-05_18_45&#39;.</span>
<span class="go">[INFO] [rosbag2_transport]: Listening for topics...</span>
<span class="go">[INFO] [rosbag2_transport]: Subscribed to topic &#39;/turtle1/cmd_vel&#39;</span>
<span class="go">[INFO] [rosbag2_transport]: All requested topics are subscribed. Stopping discovery...</span>
</pre></div>
</div>
<p>现在``ros2 bag``正在记录发布在``/turtle1/cmd_vel``话题上的数据。返回到teleop终端并再次移动乌龟。移动的具体方式不重要，但尽量制造一个可识别的模式，以便在稍后回放数据时进行观察。</p>
<img alt="../../../_images/record.png" src="../../../_images/record.png" />
<p>按下``Ctrl+C``停止记录。</p>
<p>数据将累积在一个新的袋子目录中，目录的命名方式为``rosbag2_year_month_day-hour_minute_second``。该目录将包含一个``metadata.yaml``文件和以记录格式保存的袋子文件。</p>
<div class="section" id="record-multiple-topics">
<h4>3.1 记录多个主题<a class="headerlink" href="#record-multiple-topics" title="永久链接至标题"></a></h4>
<p>您还可以记录多个主题，并更改文件“ros2 bag”保存的名称。</p>
<p>运行以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 bag record -o subset /turtle1/cmd_vel /turtle1/pose</span>
</pre></div>
</div>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>-o``选项允许您为您的包文件选择一个唯一的名称。在这种情况下，下面的字符串``subset``是文件名。</p>
<p>要同时记录多个主题，只需用空格分隔每个主题。</p>
<p>您将看到以下消息，确认正在记录两个主题。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[INFO] [rosbag2_storage]: Opened database &#39;subset&#39;.</span>
<span class="go">[INFO] [rosbag2_transport]: Listening for topics...</span>
<span class="go">[INFO] [rosbag2_transport]: Subscribed to topic &#39;/turtle1/cmd_vel&#39;</span>
<span class="go">[INFO] [rosbag2_transport]: Subscribed to topic &#39;/turtle1/pose&#39;</span>
<span class="go">[INFO] [rosbag2_transport]: All requested topics are subscribed. Stopping discovery...</span>
</pre></div>
</div>
<p>您可以移动海龟并在完成后按``Ctrl+C``。</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>您还可以在命令中添加另一个选项``-a``，该选项记录系统上的所有主题。</p>
</div>
</div>
</div>
<div class="section" id="ros2-bag-info">
<h3><a class="toc-backref" href="#id7">4 ros2 bag info</a><a class="headerlink" href="#ros2-bag-info" title="永久链接至标题"></a></h3>
<p>运行以下命令可查看有关您的记录的详细信息：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 bag info &lt;bag_file_name&gt;</span>
</pre></div>
</div>
<p>在``subset``包文件上运行此命令将返回文件的信息列表：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 bag info subset</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Files:             subset.db3</span>
<span class="go">Bag size:          228.5 KiB</span>
<span class="go">Storage id:        sqlite3</span>
<span class="go">Duration:          48.47s</span>
<span class="go">Start:             Oct 11 2019 06:09:09.12 (1570799349.12)</span>
<span class="go">End                Oct 11 2019 06:09:57.60 (1570799397.60)</span>
<span class="go">Messages:          3013</span>
<span class="go">Topic information: Topic: /turtle1/cmd_vel | Type: geometry_msgs/msg/Twist | Count: 9 | Serialization Format: cdr</span>
<span class="go">                 Topic: /turtle1/pose | Type: turtlesim/msg/Pose | Count: 3004 | Serialization Format: cdr</span>
</pre></div>
</div>
<p>要查看单个消息，您需要打开数据库，例如sqlite3，在其中进行检查，这超出了ROS 2的范围。</p>
</div>
<div class="section" id="ros2-bag-play">
<h3><a class="toc-backref" href="#id8">5 ros2 bag play</a><a class="headerlink" href="#ros2-bag-play" title="永久链接至标题"></a></h3>
<p>在重新播放bag文件之前，在运行teleop的终端中输入``Ctrl+C``。然后确保turtlesim窗口可见，这样你就可以看到bag文件的效果。</p>
<p>输入以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 bag play subset</span>
</pre></div>
</div>
<p>终端将返回以下消息：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">[INFO] [rosbag2_storage]: Opened database &#39;subset&#39;.</span>
</pre></div>
</div>
<p>当您录制时，您的海龟将按照您输入的相同路径移动（尽管不是100％准确；turtlesim对系统时间的微小变化敏感）。</p>
<img alt="../../../_images/playback.png" src="../../../_images/playback.png" />
<p>因为“subset”文件记录了“/turtle1/pose”主题，所以“ros2 bag play”命令将保持运行，直到您停止turtlesim，即使您没有移动海龟。</p>
<p>这是因为只要“/turtlesim”节点处于活动状态，它就会定期发布“/turtle1/pose”主题的数据。您可能已经注意到上面的“ros2 bag info”示例结果中，“/turtle1/cmd_vel”主题的“Count”信息只有9次；这是我们在录制过程中按下箭头键的次数。</p>
<p>请注意，“/turtle1/pose”主题的“Count”值超过3000；在我们录制时，该主题的数据发布了3000次。</p>
<p>要了解位置数据发布的频率，可以运行以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 topic hz /turtle1/pose</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id9">总结</a><a class="headerlink" href="#summary" title="永久链接至标题"></a></h2>
<p>您可以使用``ros2 bag``命令记录ROS 2系统中传递的数据。无论是与他人分享您的工作还是审查自己的实验，这是一个很好的工具。</p>
</div>
<div class="section" id="next-steps">
<h2><a class="toc-backref" href="#id10">下一步</a><a class="headerlink" href="#next-steps" title="永久链接至标题"></a></h2>
<p>您已完成“入门：CLI工具”教程！下一步是开始解决“入门：客户端库”教程，从 <a class="reference internal" href="../../Beginner-Client-Libraries/Creating-A-Workspace/Creating-A-Workspace.html"><span class="doc">创建一个工作空间</span></a> 开始。</p>
</div>
<div class="section" id="related-content">
<h2><a class="toc-backref" href="#id11">相关内容</a><a class="headerlink" href="#related-content" title="永久链接至标题"></a></h2>
<p>关于``ros2 bag``的更详细说明可以在此处的README <a class="reference external" href="https://github.com/ros2/rosbag2">链接</a> 中找到。有关QoS兼容性和``ros2 bag``的更多信息，请参阅 <a class="reference internal" href="../../../How-To-Guides/Overriding-QoS-Policies-For-Recording-And-Playback.html"><span class="doc">rosbag2：覆盖 QoS 策略</span></a>。</p>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>