<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Services/Understanding-ROS2-Services</title>
</head>
<body>
  <div class="section" id="understanding-services">
<span id="ros2services"></span><h1>了解服务<a class="headerlink" href="#understanding-services" title="永久链接至标题"></a></h1>
<p><strong>目标：</strong> 使用命令行工具学习ROS 2中的服务。</p>
<p><strong>教程级别:</strong> 初学者</p>
<p><strong>时间:</strong> 10分钟</p>
<div class="contents local topic" id="contents">
<p class="topic-title">内容</p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id1">背景</a></p></li>
<li><p><a class="reference internal" href="#prerequisites" id="id2">先决条件</a></p></li>
<li><p><a class="reference internal" href="#tasks" id="id3">任务</a></p>
<ul>
<li><p><a class="reference internal" href="#setup" id="id4">1 设置</a></p></li>
<li><p><a class="reference internal" href="#ros2-service-list" id="id5">2 ros2 service list</a></p></li>
<li><p><a class="reference internal" href="#ros2-service-type" id="id6">3 ros2服务类型</a></p></li>
<li><p><a class="reference internal" href="#ros2-service-find" id="id7">4 ros2 service find</a></p></li>
<li><p><a class="reference internal" href="#ros2-interface-show" id="id8">5 ros2 interface show</a></p></li>
<li><p><a class="reference internal" href="#ros2-service-call" id="id9">6 ros2 服务调用</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#summary" id="id10">总结</a></p></li>
<li><p><a class="reference internal" href="#next-steps" id="id11">下一步</a></p></li>
<li><p><a class="reference internal" href="#related-content" id="id12">相关内容</a></p></li>
</ul>
</div>
<div class="section" id="background">
<h2><a class="toc-backref" href="#id1">背景</a><a class="headerlink" href="#background" title="永久链接至标题"></a></h2>
<p>服务是ROS图中节点之间的另一种通信方法。服务基于调用-响应模型，而不是主题的发布-订阅模型。虽然主题允许节点订阅数据流并获得持续更新，但服务仅在客户端特定调用时提供数据。</p>
<img alt="../../../_images/Service-SingleServiceClient.gif" src="../../../_images/Service-SingleServiceClient.gif" />
<img alt="../../../_images/Service-MultipleServiceClient.gif" src="../../../_images/Service-MultipleServiceClient.gif" />
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id2">先决条件</a><a class="headerlink" href="#prerequisites" title="永久链接至标题"></a></h2>
<p>在本教程中提到的一些概念，如 <a class="reference internal" href="../Understanding-ROS2-Nodes/Understanding-ROS2-Nodes.html"><span class="doc">节点</span></a> 和 <a class="reference internal" href="../Understanding-ROS2-Topics/Understanding-ROS2-Topics.html"><span class="doc">话题</span></a>，在系列教程中已经介绍过了。</p>
<p>你需要安装 <a class="reference internal" href="../Introducing-Turtlesim/Introducing-Turtlesim.html"><span class="doc">turtlesim 包</span></a>。</p>
<p>像往常一样，在 <a class="reference internal" href="../Configuring-ROS2-Environment.html"><span class="doc">每个新开的终端中</span></a> 都不要忘记加载 ROS 2 。</p>
</div>
<div class="section" id="tasks">
<h2><a class="toc-backref" href="#id3">任务</a><a class="headerlink" href="#tasks" title="永久链接至标题"></a></h2>
<div class="section" id="setup">
<h3><a class="toc-backref" href="#id4">1 设置</a><a class="headerlink" href="#setup" title="永久链接至标题"></a></h3>
<p>启动两个 turtlesim 节点，<code class="docutils literal notranslate"><span class="pre">/turtlesim</span></code> 和 <code class="docutils literal notranslate"><span class="pre">/teleop_turtle</span></code>。</p>
<p>打开一个新的终端并运行：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 run turtlesim turtlesim_node</span>
</pre></div>
</div>
<p>打开另一个终端并运行：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 run turtlesim turtle_teleop_key</span>
</pre></div>
</div>
</div>
<div class="section" id="ros2-service-list">
<h3><a class="toc-backref" href="#id5">2 ros2 service list</a><a class="headerlink" href="#ros2-service-list" title="永久链接至标题"></a></h3>
<p>在新终端中运行 <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">service</span> <span class="pre">list</span></code> 命令将返回当前系统中所有活动服务的列表：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/clear</span>
<span class="go">/kill</span>
<span class="go">/reset</span>
<span class="go">/spawn</span>
<span class="go">/teleop_turtle/describe_parameters</span>
<span class="go">/teleop_turtle/get_parameter_types</span>
<span class="go">/teleop_turtle/get_parameters</span>
<span class="go">/teleop_turtle/list_parameters</span>
<span class="go">/teleop_turtle/set_parameters</span>
<span class="go">/teleop_turtle/set_parameters_atomically</span>
<span class="go">/turtle1/set_pen</span>
<span class="go">/turtle1/teleport_absolute</span>
<span class="go">/turtle1/teleport_relative</span>
<span class="go">/turtlesim/describe_parameters</span>
<span class="go">/turtlesim/get_parameter_types</span>
<span class="go">/turtlesim/get_parameters</span>
<span class="go">/turtlesim/list_parameters</span>
<span class="go">/turtlesim/set_parameters</span>
<span class="go">/turtlesim/set_parameters_atomically</span>
</pre></div>
</div>
<p>你会发现两个节点都有相同的六个以``parameters``结尾的服务。ROS 2中几乎每个节点都有这些基础设施服务，参数就是构建在这些服务之上的。下一个教程将更多地介绍参数。在本教程中，将省略对参数服务的讨论。</p>
<p>现在，让我们专注于turtlesim特定的服务，<code class="docutils literal notranslate"><span class="pre">/clear</span></code>、<code class="docutils literal notranslate"><span class="pre">/kill</span></code>、<code class="docutils literal notranslate"><span class="pre">/reset</span></code>、<code class="docutils literal notranslate"><span class="pre">/spawn</span></code>、<code class="docutils literal notranslate"><span class="pre">/turtle1/set_pen</span></code>、<code class="docutils literal notranslate"><span class="pre">/turtle1/teleport_absolute``和</span></code>/turtle1/teleport_relative``。你可能还记得在 <a class="reference internal" href="../Introducing-Turtlesim/Introducing-Turtlesim.html"><span class="doc">使用turtlesim、ros2和rqt</span></a> 教程中使用rqt与其中一些服务进行交互。</p>
</div>
<div class="section" id="ros2-service-type">
<h3><a class="toc-backref" href="#id6">3 ros2服务类型</a><a class="headerlink" href="#ros2-service-type" title="永久链接至标题"></a></h3>
<p>服务具有描述服务的请求和响应数据结构的类型。服务类型的定义类似于主题类型，但服务类型由请求部分和响应部分组成。</p>
<p>要找出服务的类型，请使用以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 service type &lt;service_name&gt;</span>
</pre></div>
</div>
<p>让我们来看一下 turtlesim 的 <code class="docutils literal notranslate"><span class="pre">/clear</span></code> 服务。在新的终端中，输入以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 service type /clear</span>
</pre></div>
</div>
<p>预期的输出应为：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">std_srvs/srv/Empty</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Empty</span></code> 类型表示服务调用在发送请求时不发送任何数据，在接收响应时也不接收任何数据。</p>
<div class="section" id="ros2-service-list-t">
<h4>3.1 ros2 service list -t<a class="headerlink" href="#ros2-service-list-t" title="永久链接至标题"></a></h4>
<p>要同时查看所有活动服务的类型，可以将``--show-types``选项（缩写为``-t``）附加到``list``命令后面：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 service list -t</span>
</pre></div>
</div>
<p>将返回：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/clear [std_srvs/srv/Empty]</span>
<span class="go">/kill [turtlesim/srv/Kill]</span>
<span class="go">/reset [std_srvs/srv/Empty]</span>
<span class="go">/spawn [turtlesim/srv/Spawn]</span>
<span class="go">...</span>
<span class="go">/turtle1/set_pen [turtlesim/srv/SetPen]</span>
<span class="go">/turtle1/teleport_absolute [turtlesim/srv/TeleportAbsolute]</span>
<span class="go">/turtle1/teleport_relative [turtlesim/srv/TeleportRelative]</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ros2-service-find">
<h3><a class="toc-backref" href="#id7">4 ros2 service find</a><a class="headerlink" href="#ros2-service-find" title="永久链接至标题"></a></h3>
<p>如果您想找到特定类型的所有服务，请使用以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 service find &lt;type_name&gt;</span>
</pre></div>
</div>
<p>例如，您可以通过以下方式找到所有“Empty”类型的服务：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 service find std_srvs/srv/Empty</span>
</pre></div>
</div>
<p>将返回：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/clear</span>
<span class="go">/reset</span>
</pre></div>
</div>
</div>
<div class="section" id="ros2-interface-show">
<h3><a class="toc-backref" href="#id8">5 ros2 interface show</a><a class="headerlink" href="#ros2-interface-show" title="永久链接至标题"></a></h3>
<p>您可以从命令行调用服务，但首先需要了解输入参数的结构。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 interface show &lt;type_name&gt;</span>
</pre></div>
</div>
<p>在“/clear”服务的类型“Empty”上尝试一下：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 interface show std_srvs/srv/Empty</span>
</pre></div>
</div>
<p>将返回：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">---</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">---</span></code> 分隔了请求结构（上方）和响应结构（下方）。但是，正如您之前学到的那样，<code class="docutils literal notranslate"><span class="pre">Empty</span></code> 类型不发送或接收任何数据。因此，它的结构自然为空白。</p>
<p>让我们来查看一个发送和接收数据的服务类型，比如 <code class="docutils literal notranslate"><span class="pre">/spawn</span></code>。通过 <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">service</span> <span class="pre">list</span> <span class="pre">-t</span></code> 的结果，我们知道 <code class="docutils literal notranslate"><span class="pre">/spawn</span></code> 的类型是 <code class="docutils literal notranslate"><span class="pre">turtlesim/srv/Spawn</span></code>。</p>
<p>要查看 <code class="docutils literal notranslate"><span class="pre">/spawn</span></code> 服务的请求和响应参数，请运行以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 interface show turtlesim/srv/Spawn</span>
</pre></div>
</div>
<p>将返回：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">float32 x</span>
<span class="go">float32 y</span>
<span class="go">float32 theta</span>
<span class="go">string name # Optional.  A unique name will be created and returned if this is empty</span>
<span class="go">---</span>
<span class="go">string name</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">---</span></code> 行上方的信息告诉我们调用 <code class="docutils literal notranslate"><span class="pre">/spawn</span></code> 需要的参数。<code class="docutils literal notranslate"><span class="pre">x</span></code>、<code class="docutils literal notranslate"><span class="pre">y</span></code> 和 <code class="docutils literal notranslate"><span class="pre">theta</span></code> 决定了生成的乌龟的二维姿态，而 <code class="docutils literal notranslate"><span class="pre">name</span></code> 显然是可选的。</p>
<p>下划线以下的信息在这种情况下不是您需要了解的内容，但它可以帮助您理解调用返回的响应的数据类型。</p>
</div>
<div class="section" id="ros2-service-call">
<h3><a class="toc-backref" href="#id9">6 ros2 服务调用</a><a class="headerlink" href="#ros2-service-call" title="永久链接至标题"></a></h3>
<p>既然您知道了什么是服务类型，如何找到服务的类型，以及如何找到该类型参数的结构，您可以使用以下命令调用服务：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 service call &lt;service_name&gt; &lt;service_type&gt; &lt;arguments&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&lt;arguments&gt;</span></code> 部分是可选的。例如，您知道 <code class="docutils literal notranslate"><span class="pre">Empty</span></code> 类型的服务没有任何参数：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 service call /clear std_srvs/srv/Empty</span>
</pre></div>
</div>
<p>该命令将清除乌龟绘制的所有线条，使得乌龟仿真窗口变空白。</p>
<img alt="../../../_images/clear.png" src="../../../_images/clear.png" />
<p>现在让我们通过调用``/spawn``并设置参数来生成一个新的乌龟。在从命令行进行服务调用时，输入的``&lt;arguments&gt;``需要使用YAML语法。</p>
<p>输入以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 service call /spawn turtlesim/srv/Spawn &quot;{x: 2, y: 2, theta: 0.2, name: &#39;&#39;}&quot;</span>
</pre></div>
</div>
<p>您将会看到方法式的视图，了解正在发生的情况，然后获得服务的响应：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">requester: making request: turtlesim.srv.Spawn_Request(x=2.0, y=2.0, theta=0.2, name=&#39;&#39;)</span>

<span class="go">response:</span>
<span class="go">turtlesim.srv.Spawn_Response(name=&#39;turtle2&#39;)</span>
</pre></div>
</div>
<p>您的乌龟仿真窗口将立即更新，显示新生成的乌龟：</p>
<img alt="../../../_images/spawn1.png" src="../../../_images/spawn1.png" />
</div>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id10">总结</a><a class="headerlink" href="#summary" title="永久链接至标题"></a></h2>
<p>节点可以使用ROS 2中的服务进行通信。与话题不同，话题是一种单向通信模式，其中一个节点发布信息，可以由一个或多个订阅者消费。服务是一种请求/响应模式，其中客户端向提供服务的节点发出请求，服务处理请求并生成响应。</p>
<p>通常情况下，你不应该使用服务进行连续调用；更适合使用话题或者甚至是动作。</p>
<p>在本教程中，你使用命令行工具来识别、内省和调用服务。</p>
</div>
<div class="section" id="next-steps">
<h2><a class="toc-backref" href="#id11">下一步</a><a class="headerlink" href="#next-steps" title="永久链接至标题"></a></h2>
<p>在下一个教程中，<a class="reference internal" href="../Understanding-ROS2-Parameters/Understanding-ROS2-Parameters.html"><span class="doc">理解参数</span></a>，你将学习如何配置节点设置。</p>
</div>
<div class="section" id="related-content">
<h2><a class="toc-backref" href="#id12">相关内容</a><a class="headerlink" href="#related-content" title="永久链接至标题"></a></h2>
<p>请查看 <a class="reference external" href="https://discourse.ubuntu.com/t/call-services-in-ros-2/15261">这个教程</a>；这是一个使用Robotis机械臂进行ROS服务的出色实际应用。</p>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>