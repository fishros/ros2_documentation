<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Parameters/Understanding-ROS2-Parameters</title>
</head>
<body>
  <div class="section" id="understanding-parameters">
<span id="ros2params"></span><h1>理解参数<a class="headerlink" href="#understanding-parameters" title="永久链接至标题"></a></h1>
<p><strong>目标：</strong> 学习如何在 ROS 2 中获取、设置、保存和重新加载参数。</p>
<p><strong>教程级别:</strong> 初学者</p>
<p><strong>时间：</strong> 5分钟</p>
<div class="contents local topic" id="contents">
<p class="topic-title">内容</p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id1">背景</a></p></li>
<li><p><a class="reference internal" href="#prerequisites" id="id2">先决条件</a></p></li>
<li><p><a class="reference internal" href="#tasks" id="id3">任务</a></p>
<ul>
<li><p><a class="reference internal" href="#setup" id="id4">1 设置</a></p></li>
<li><p><a class="reference internal" href="#ros2-param-list" id="id5">2 ros2 param list</a></p></li>
<li><p><a class="reference internal" href="#ros2-param-get" id="id6">3 ros2 param get</a></p></li>
<li><p><a class="reference internal" href="#ros2-param-set" id="id7">运行 ros2 param set 命令来执行第 4 步。</a></p></li>
<li><p><a class="reference internal" href="#ros2-param-dump" id="id8">5 ros2 param dump</a></p></li>
<li><p><a class="reference internal" href="#ros2-param-load" id="id9">6 ros2 param load</a></p></li>
<li><p><a class="reference internal" href="#load-parameter-file-on-node-startup" id="id10">7 在节点启动时加载参数文件</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#summary" id="id11">总结</a></p></li>
<li><p><a class="reference internal" href="#next-steps" id="id12">下一步</a></p></li>
</ul>
</div>
<div class="section" id="background">
<h2><a class="toc-backref" href="#id1">背景</a><a class="headerlink" href="#background" title="永久链接至标题"></a></h2>
<p>参数是节点的配置值。你可以将参数视为节点的设置。节点可以将参数存储为整数、浮点数、布尔值、字符串和列表。在ROS 2中，每个节点都维护其自己的参数。有关参数的更多背景信息，请参阅：<a class="reference internal" href="../../../Concepts/About-ROS-2-Parameters.html"><span class="doc">概念文档</span></a>。</p>
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id2">先决条件</a><a class="headerlink" href="#prerequisites" title="永久链接至标题"></a></h2>
<p>本教程使用 <a class="reference internal" href="../Introducing-Turtlesim/Introducing-Turtlesim.html"><span class="doc">turtlesim 包</span></a>。</p>
<p>像往常一样，在 <a class="reference internal" href="../Configuring-ROS2-Environment.html"><span class="doc">每个新开的终端中</span></a> 都不要忘记加载 ROS 2 。</p>
</div>
<div class="section" id="tasks">
<h2><a class="toc-backref" href="#id3">任务</a><a class="headerlink" href="#tasks" title="永久链接至标题"></a></h2>
<div class="section" id="setup">
<h3><a class="toc-backref" href="#id4">1 设置</a><a class="headerlink" href="#setup" title="永久链接至标题"></a></h3>
<p>启动两个 turtlesim 节点，<code class="docutils literal notranslate"><span class="pre">/turtlesim</span></code> 和 <code class="docutils literal notranslate"><span class="pre">/teleop_turtle</span></code>。</p>
<p>打开一个新的终端并运行：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 run turtlesim turtlesim_node</span>
</pre></div>
</div>
<p>打开另一个终端并运行：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 run turtlesim turtle_teleop_key</span>
</pre></div>
</div>
</div>
<div class="section" id="ros2-param-list">
<h3><a class="toc-backref" href="#id5">2 ros2 param list</a><a class="headerlink" href="#ros2-param-list" title="永久链接至标题"></a></h3>
<p>要查看属于你的节点的参数，打开一个新的终端并输入以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 param list</span>
</pre></div>
</div>
<p>您将看到节点命名空间``/teleop_turtle``和``/turtlesim``，然后是每个节点的参数：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/teleop_turtle:</span>
<span class="go">  qos_overrides./parameter_events.publisher.depth</span>
<span class="go">  qos_overrides./parameter_events.publisher.durability</span>
<span class="go">  qos_overrides./parameter_events.publisher.history</span>
<span class="go">  qos_overrides./parameter_events.publisher.reliability</span>
<span class="go">  scale_angular</span>
<span class="go">  scale_linear</span>
<span class="go">  use_sim_time</span>
<span class="go">/turtlesim:</span>
<span class="go">  background_b</span>
<span class="go">  background_g</span>
<span class="go">  background_r</span>
<span class="go">  qos_overrides./parameter_events.publisher.depth</span>
<span class="go">  qos_overrides./parameter_events.publisher.durability</span>
<span class="go">  qos_overrides./parameter_events.publisher.history</span>
<span class="go">  qos_overrides./parameter_events.publisher.reliability</span>
<span class="go">  use_sim_time</span>
</pre></div>
</div>
<p>每个节点都有参数``use_sim_time``；它不是 turtlesim 特有的。</p>
<p>根据它们的名称，看起来``/turtlesim``的参数使用RGB颜色值来确定 turtlesim 窗口的背景色。</p>
<p>要确定参数的类型，您可以使用``ros2 param get``命令。</p>
</div>
<div class="section" id="ros2-param-get">
<h3><a class="toc-backref" href="#id6">3 ros2 param get</a><a class="headerlink" href="#ros2-param-get" title="永久链接至标题"></a></h3>
<p>要显示参数的类型和当前值，请使用以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 param get &lt;node_name&gt; &lt;parameter_name&gt;</span>
</pre></div>
</div>
<p>让我们找出``/turtlesim``的参数``background_g``的当前值：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 param get /turtlesim background_g</span>
</pre></div>
</div>
<p>将返回该值：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Integer value is: 86</span>
</pre></div>
</div>
<p>现在你知道 <code class="docutils literal notranslate"><span class="pre">background_g</span></code> 保存了一个整数值。</p>
<p>如果你对 <code class="docutils literal notranslate"><span class="pre">background_r</span></code> 和 <code class="docutils literal notranslate"><span class="pre">background_b</span></code> 运行相同的命令，你将分别得到值 <code class="docutils literal notranslate"><span class="pre">69</span></code> 和 <code class="docutils literal notranslate"><span class="pre">255</span></code>。</p>
</div>
<div class="section" id="ros2-param-set">
<h3><a class="toc-backref" href="#id7">运行 ros2 param set 命令来执行第 4 步。</a><a class="headerlink" href="#ros2-param-set" title="永久链接至标题"></a></h3>
<p>要在运行时更改参数的值，请使用以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 param set &lt;node_name&gt; &lt;parameter_name&gt; &lt;value&gt;</span>
</pre></div>
</div>
<p>让我们改变 <code class="docutils literal notranslate"><span class="pre">/turtlesim</span></code> 的背景颜色:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 param set /turtlesim background_r 150</span>
</pre></div>
</div>
<p>你的终端应该返回以下信息:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Set parameter successful</span>
</pre></div>
</div>
<p>然后你的 turtlesim 窗口的背景颜色会改变:</p>
<img alt="../../../_images/set.png" src="../../../_images/set.png" />
<p>使用 <code class="docutils literal notranslate"><span class="pre">set</span></code> 命令设置参数只会在当前会话中生效，而不是永久生效。然而，你可以保存你的设置，并在下次启动节点时重新加载。</p>
</div>
<div class="section" id="ros2-param-dump">
<h3><a class="toc-backref" href="#id8">5 ros2 param dump</a><a class="headerlink" href="#ros2-param-dump" title="永久链接至标题"></a></h3>
<p>你可以使用以下命令查看节点的所有当前参数值：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 param dump &lt;node_name&gt;</span>
</pre></div>
</div>
<p>该命令默认将参数值打印到标准输出（stdout），但你也可以将参数值重定向到文件中以便以后使用。要将当前``/turtlesim``参数的配置保存到文件``turtlesim.yaml``中，请执行以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 param dump /turtlesim &gt; turtlesim.yaml</span>
</pre></div>
</div>
<p>你会在当前工作目录中找到一个新的文件，如果你打开这个文件，你会看到以下内容：</p>
<div class="highlight-YAML notranslate"><div class="highlight"><pre><span></span><span class="nt">/turtlesim</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">ros__parameters</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">background_b</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">255</span><span class="w"></span>
<span class="w">    </span><span class="nt">background_g</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">86</span><span class="w"></span>
<span class="w">    </span><span class="nt">background_r</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">150</span><span class="w"></span>
<span class="w">    </span><span class="nt">qos_overrides</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">/parameter_events</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">publisher</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="nt">depth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span><span class="w"></span>
<span class="w">          </span><span class="nt">durability</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">volatile</span><span class="w"></span>
<span class="w">          </span><span class="nt">history</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">keep_last</span><span class="w"></span>
<span class="w">          </span><span class="nt">reliability</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reliable</span><span class="w"></span>
<span class="w">    </span><span class="nt">use_sim_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
</pre></div>
</div>
<p>将参数转储非常方便，如果您希望将来重新加载具有相同参数的节点。</p>
</div>
<div class="section" id="ros2-param-load">
<h3><a class="toc-backref" href="#id9">6 ros2 param load</a><a class="headerlink" href="#ros2-param-load" title="永久链接至标题"></a></h3>
<p>您可以使用以下命令将参数从文件加载到当前运行的节点：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 param load &lt;node_name&gt; &lt;parameter_file&gt;</span>
</pre></div>
</div>
<p>要将使用``ros2 param dump``生成的``turtlesim.yaml``文件加载到``/turtlesim``节点的参数中，请输入以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 param load /turtlesim turtlesim.yaml</span>
</pre></div>
</div>
<p>终端将返回以下消息:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Set parameter background_b successful</span>
<span class="go">Set parameter background_g successful</span>
<span class="go">Set parameter background_r successful</span>
<span class="go">Set parameter qos_overrides./parameter_events.publisher.depth failed: parameter &#39;qos_overrides./parameter_events.publisher.depth&#39; cannot be set because it is read-only</span>
<span class="go">Set parameter qos_overrides./parameter_events.publisher.durability failed: parameter &#39;qos_overrides./parameter_events.publisher.durability&#39; cannot be set because it is read-only</span>
<span class="go">Set parameter qos_overrides./parameter_events.publisher.history failed: parameter &#39;qos_overrides./parameter_events.publisher.history&#39; cannot be set because it is read-only</span>
<span class="go">Set parameter qos_overrides./parameter_events.publisher.reliability failed: parameter &#39;qos_overrides./parameter_events.publisher.reliability&#39; cannot be set because it is read-only</span>
<span class="go">Set parameter use_sim_time successful</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>只读参数只能在启动时进行修改，不能在之后进行修改，这就是为什么“qos_overrides”参数会有一些警告。</p>
</div>
</div>
<div class="section" id="load-parameter-file-on-node-startup">
<h3><a class="toc-backref" href="#id10">7 在节点启动时加载参数文件</a><a class="headerlink" href="#load-parameter-file-on-node-startup" title="永久链接至标题"></a></h3>
<p>要使用保存的参数值启动相同的节点，请使用以下命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 run &lt;package_name&gt; &lt;executable_name&gt; --ros-args --params-file &lt;file_name&gt;</span>
</pre></div>
</div>
<p>这是您启动turtlesim时经常使用的相同命令，只需添加``--ros-args``和``--params-file``标志，然后加上要加载的文件名。</p>
<p>停止正在运行的turtlesim节点，并尝试使用保存的参数重新加载它，使用命令：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 run turtlesim turtlesim_node --ros-args --params-file turtlesim.yaml</span>
</pre></div>
</div>
<p>turtlesim窗口应该像往常一样显示，但是背景将是您之前设置的紫色背景。</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>当在节点启动时使用参数文件时，包括只读参数在内的所有参数都将被更新。</p>
</div>
</div>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id11">总结</a><a class="headerlink" href="#summary" title="永久链接至标题"></a></h2>
<p>节点具有参数来定义其默认配置值。您可以从命令行中获取和设置参数值。您还可以将参数设置保存到文件中，在将来的会话中重新加载。</p>
</div>
<div class="section" id="next-steps">
<h2><a class="toc-backref" href="#id12">下一步</a><a class="headerlink" href="#next-steps" title="永久链接至标题"></a></h2>
<p>回到ROS 2通信方法，下一篇教程中你将学习：doc: <a class="reference internal" href="../Understanding-ROS2-Actions/Understanding-ROS2-Actions.html"><span class="doc">动作</span></a>。</p>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>