<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutorials/Demos/Logging-and-logger-configuration</title>
</head>
<body>
  <div class="section" id="logging">
<h1>记录日志<a class="headerlink" href="#logging" title="永久链接至标题"></a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">目录</p>
<ul class="simple">
<li><p><a class="reference internal" href="#using-log-statements-in-code" id="id1">在代码中使用日志语句</a></p>
<ul>
<li><p><a class="reference internal" href="#basic-logging" id="id2">基本日志记录</a></p></li>
<li><p><a class="reference internal" href="#logging-only-the-first-time" id="id3">仅记录第一次</a></p></li>
<li><p><a class="reference internal" href="#logging-all-but-the-first-time" id="id4">记录除第一次之外的所有日志</a></p></li>
<li><p><a class="reference internal" href="#logging-throttled" id="id5">记录被节流</a></p></li>
<li><p><a class="reference internal" href="#logging-throttled-all-but-the-first-time" id="id6">除第一次外，日志被限制了频率</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#logging-demo" id="id7">日志演示</a></p></li>
<li><p><a class="reference internal" href="#logging-directory-configuration" id="id8">日志目录配置</a></p></li>
<li><p><a class="reference internal" href="#logger-level-configuration-programmatically" id="id9">日志记录器级别配置：编程方式</a></p></li>
<li><p><a class="reference internal" href="#logger-level-configuration-externally" id="id10">日志记录器级别配置：外部</a></p>
<ul>
<li><p><a class="reference internal" href="#using-the-logger-config-component" id="id11">使用日志记录器配置组件</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#logger-level-configuration-command-line" id="id12">日志级别配置：命令行</a></p>
<ul>
<li><p><a class="reference internal" href="#console-output-formatting" id="id13">控制台输出格式化</a></p></li>
<li><p><a class="reference internal" href="#console-output-colorizing" id="id14">控制台输出着色</a></p></li>
<li><p><a class="reference internal" href="#default-stream-for-console-output" id="id15">默认控制台输出流</a></p></li>
<li><p><a class="reference internal" href="#line-buffered-console-output" id="id16">行缓冲的控制台输出</a></p></li>
</ul>
</li>
</ul>
</div>
<p>有关可用功能的详细信息，请参阅 <a class="reference internal" href="../../Concepts/About-Logging.html"><span class="doc">日志记录页面</span></a>。</p>
<div class="section" id="using-log-statements-in-code">
<h2><a class="toc-backref" href="#id1">在代码中使用日志语句</a><a class="headerlink" href="#using-log-statements-in-code" title="永久链接至标题"></a></h2>
<div class="section" id="basic-logging">
<h3><a class="toc-backref" href="#id2">基本日志记录</a><a class="headerlink" href="#basic-logging" title="永久链接至标题"></a></h3>
<p>下面的代码将在``DEBUG``级别从ROS 2节点输出日志消息：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-Qysr" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-Qysr" name="Qysr" role="tab" tabindex="0">C++</button><button aria-controls="panel-0-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-0-Qysr" class="sphinx-tabs-panel group-tab" id="panel-0-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// printf style</span>
<span class="n">RCLCPP_DEBUG</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;My log message %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"></span>

<span class="c1">// C++ stream style</span>
<span class="n">RCLCPP_DEBUG_STREAM</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;My log message &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-UHl0aG9u" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;My log message </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div></div>
<p>请注意，在两种情况下都不会添加尾随换行符，因为日志记录基础设施将自动添加一个。</p>
</div>
<div class="section" id="logging-only-the-first-time">
<h3><a class="toc-backref" href="#id3">仅记录第一次</a><a class="headerlink" href="#logging-only-the-first-time" title="永久链接至标题"></a></h3>
<p>下面的代码将在``INFO``级别从ROS 2节点输出日志消息，但仅在第一次调用时：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-Qysr" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-Qysr" name="Qysr" role="tab" tabindex="0">C++</button><button aria-controls="panel-1-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-1-Qysr" class="sphinx-tabs-panel group-tab" id="panel-1-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// printf style</span>
<span class="n">RCLCPP_INFO_ONCE</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;My log message %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"></span>

<span class="c1">// C++ stream style</span>
<span class="n">RCLCPP_INFO_STREAM_ONCE</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;My log message &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-UHl0aG9u" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">num</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">node</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;My log message </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">once</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="logging-all-but-the-first-time">
<h3><a class="toc-backref" href="#id4">记录除第一次之外的所有日志</a><a class="headerlink" href="#logging-all-but-the-first-time" title="永久链接至标题"></a></h3>
<p>以下代码将从一个ROS 2节点以``WARN``严重程度输出日志消息，但在第一次触发时不输出：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-Qysr" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-Qysr" name="Qysr" role="tab" tabindex="0">C++</button><button aria-controls="panel-2-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-2-Qysr" class="sphinx-tabs-panel group-tab" id="panel-2-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// printf style</span>
<span class="n">RCLCPP_WARN_SKIPFIRST</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;My log message %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"></span>

<span class="c1">// C++ stream style</span>
<span class="n">RCLCPP_WARN_STREAM_SKIPFIRST</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;My log message &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div><div aria-labelledby="tab-2-UHl0aG9u" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">num</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">node</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;My log message </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">),</span> <span class="n">skip_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="logging-throttled">
<h3><a class="toc-backref" href="#id5">记录被节流</a><a class="headerlink" href="#logging-throttled" title="永久链接至标题"></a></h3>
<p>以下代码将从一个ROS 2节点以``ERROR``严重程度输出日志消息，但每秒钟不超过一次。</p>
<p>间隔参数指定消息之间的毫秒数应具有整数数据类型，以便可以将其转换为 <code class="docutils literal notranslate"><span class="pre">rcutils_duration_value_t``（即</span> <span class="pre">``int64_t</span></code>）：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-Qysr" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-3-Qysr" name="Qysr" role="tab" tabindex="0">C++</button><button aria-controls="panel-3-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-3-Qysr" class="sphinx-tabs-panel group-tab" id="panel-3-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// printf style</span>
<span class="n">RCLCPP_ERROR_THROTTLE</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_clock</span><span class="p">(),</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;My log message %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"></span>

<span class="c1">// C++ stream style</span>
<span class="n">RCLCPP_ERROR_STREAM_THROTTLE</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_lock</span><span class="p">(),</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;My log message &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"></span>

<span class="c1">// For now, use the nanoseconds() method to use an existing rclcpp::Duration value, see https://github.com/ros2/rclcpp/issues/1929</span>
<span class="n">RCLCPP_ERROR_STREAM_THROTTLE</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_clock</span><span class="p">(),</span><span class="w"> </span><span class="n">msg_interval</span><span class="p">.</span><span class="n">nanoseconds</span><span class="p">()</span><span class="o">/</span><span class="mi">1000000</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;My log message &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div><div aria-labelledby="tab-3-UHl0aG9u" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">num</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">node</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;My log message </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">throttle_duration_sec</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="logging-throttled-all-but-the-first-time">
<h3><a class="toc-backref" href="#id6">除第一次外，日志被限制了频率</a><a class="headerlink" href="#logging-throttled-all-but-the-first-time" title="永久链接至标题"></a></h3>
<p>以下代码将在 ROS 2 节点中以 <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> 严重性输出日志消息，每秒最多一次，并跳过第一次命中：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-Qysr" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-4-Qysr" name="Qysr" role="tab" tabindex="0">C++</button><button aria-controls="panel-4-UHl0aG9u" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="-1">Python</button></div><div aria-labelledby="tab-4-Qysr" class="sphinx-tabs-panel group-tab" id="panel-4-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// printf style</span>
<span class="n">RCLCPP_DEBUG_SKIPFIRST_THROTTLE</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_clock</span><span class="p">(),</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;My log message %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"></span>

<span class="n">RCLCPP_DEBUG_SKIPFIRST_THROTTLE</span><span class="p">(</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_logger</span><span class="p">(),</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">get_clock</span><span class="p">(),</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;My log message &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div><div aria-labelledby="tab-4-UHl0aG9u" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">num</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">node</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;My log message </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skip_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">throttle_duration_sec</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div></div>
</div>
</div>
<div class="section" id="logging-demo">
<h2><a class="toc-backref" href="#id7">日志演示</a><a class="headerlink" href="#logging-demo" title="永久链接至标题"></a></h2>
<p>在这个 <a class="reference external" href="https://github.com/ros2/demos/tree/humble/logging_demo">演示</a> 中，展示了不同类型的日志调用，并配置了不同日志记录器的严重级别，可以在本地和外部进行配置。</p>
<p>使用以下命令启动演示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 run logging_demo logging_demo_main
</pre></div>
</div>
<p>随着时间的推移，您将看到具有不同属性的各种日志调用的输出。首先，您只会看到具有严重级别为 <code class="docutils literal notranslate"><span class="pre">INFO</span></code> 及以上（<code class="docutils literal notranslate"><span class="pre">WARN</span></code>、<code class="docutils literal notranslate"><span class="pre">ERROR</span></code>、<code class="docutils literal notranslate"><span class="pre">FATAL</span></code>）的日志调用的输出。请注意，尽管在每次迭代中都会到达该行，但第一条消息只会被记录一次，因为它是用于该消息的日志调用的属性之一。</p>
</div>
<div class="section" id="logging-directory-configuration">
<h2><a class="toc-backref" href="#id8">日志目录配置</a><a class="headerlink" href="#logging-directory-configuration" title="永久链接至标题"></a></h2>
<p>日志目录可以通过两个环境变量进行配置：<code class="docutils literal notranslate"><span class="pre">ROS_LOG_DIR</span></code> 和 <code class="docutils literal notranslate"><span class="pre">ROS_HOME</span></code>。逻辑如下：</p>
<ul class="simple">
<li><p>如果``ROS_LOG_DIR``已设置且非空，则使用``$ROS_LOG_DIR``。</p></li>
<li><p>否则，使用``$ROS_HOME/log``，如果未设置或为空，则使用``~/.ros``作为``ROS_HOME``。</p></li>
</ul>
<p>例如，要将日志目录设置为 <code class="docutils literal notranslate"><span class="pre">~/my_logs</span></code>：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-5-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-5-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-5-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-5-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button><button aria-controls="panel-5-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-5-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-5-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-5-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ROS_LOG_DIR</span><span class="o">=</span>~/my_logs
ros2 run logging_demo logging_demo_main
</pre></div>
</div>
</div><div aria-labelledby="tab-5-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-5-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ROS_LOG_DIR</span><span class="o">=</span>~/my_logs
ros2 run logging_demo logging_demo_main
</pre></div>
</div>
</div><div aria-labelledby="tab-5-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-5-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="s2">&quot;ROS_LOG_DIR=~/my_logs&quot;</span>
ros2 run logging_demo logging_demo_main
</pre></div>
</div>
</div></div>
<p>然后您将在 <code class="docutils literal notranslate"><span class="pre">~/my_logs/</span></code> 下找到日志文件。</p>
<p>另外，您可以设置 <code class="docutils literal notranslate"><span class="pre">ROS_HOME</span></code>，日志目录将相对于它而定（<code class="docutils literal notranslate"><span class="pre">$ROS_HOME/log</span></code>）。<code class="docutils literal notranslate"><span class="pre">ROS_HOME</span></code> 旨在用于需要基础目录的任何内容。请注意，<code class="docutils literal notranslate"><span class="pre">ROS_LOG_DIR</span></code> 必须未设置或为空。例如，当将 <code class="docutils literal notranslate"><span class="pre">ROS_HOME</span></code> 设置为 <code class="docutils literal notranslate"><span class="pre">~/my_ros_home</span></code> 时：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-6-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-6-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-6-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-6-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button><button aria-controls="panel-6-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-6-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-6-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-6-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ROS_HOME</span><span class="o">=</span>~/my_ros_home
ros2 run logging_demo logging_demo_main
</pre></div>
</div>
</div><div aria-labelledby="tab-6-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-6-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ROS_HOME</span><span class="o">=</span>~/my_ros_home
ros2 run logging_demo logging_demo_main
</pre></div>
</div>
</div><div aria-labelledby="tab-6-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-6-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="s2">&quot;ROS_HOME=~/my_ros_home&quot;</span>
ros2 run logging_demo logging_demo_main
</pre></div>
</div>
</div></div>
<p>然后您将在 <code class="docutils literal notranslate"><span class="pre">~/my_ros_home/log/</span></code> 下找到日志文件。</p>
</div>
<div class="section" id="logger-level-configuration-programmatically">
<h2><a class="toc-backref" href="#id9">日志记录器级别配置：编程方式</a><a class="headerlink" href="#logger-level-configuration-programmatically" title="永久链接至标题"></a></h2>
<p>经过10次迭代，日志记录器的级别将被设置为``DEBUG``，这将导致额外的消息被记录。</p>
<p>其中一些调试消息会导致评估额外的函数/表达式，这些函数/表达式在未启用``DEBUG``日志调用时以前被跳过。有关使用的调用的进一步解释，请参阅演示的`源代码 &lt;<a class="reference external" href="https://github.com/ros2/demos/blob/humble/logging_demo/src/logger_usage_component.cpp">https://github.com/ros2/demos/blob/humble/logging_demo/src/logger_usage_component.cpp</a>&gt;`__，并参阅 rclcpp 日志记录文档以获得支持的日志记录调用的完整列表。</p>
</div>
<div class="section" id="logger-level-configuration-externally">
<h2><a class="toc-backref" href="#id10">日志记录器级别配置：外部</a><a class="headerlink" href="#logger-level-configuration-externally" title="永久链接至标题"></a></h2>
<p>将来将会有一种通用方法来在运行时外部配置日志记录器（类似于 ROS 1 中通过远程过程调用允许日志记录器配置的方式，如 <a class="reference external" href="https://wiki.ros.org/rqt_logger_level">rqt_logger_level</a>）。<a href="#id1"><span class="problematic" id="id2">**</span></a>目前，ROS 2 尚未正式支持这个概念。<a href="#id3"><span class="problematic" id="id4">**</span></a>与此同时，此演示提供了一个**示例**服务，可用于外部调用以请求配置进程中已知日志记录器的级别。</p>
<p>之前启动的演示已经在运行这个示例服务。要将演示的日志记录器级别设置回``INFO``，请使用以下命令调用该服务：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 service call /config_logger logging_demo/srv/ConfigLogger <span class="s2">&quot;{logger_name: &#39;logger_usage_demo&#39;, level: INFO}&quot;</span>
</pre></div>
</div>
<p>只要您知道日志记录器的名称，此服务调用将适用于正在运行的任何日志记录器，包括ROS 2核心中的日志记录器，如``rcl``（常见的客户端库包）。要为``rcl``启用调试日志记录，请执行以下命令：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 service call /config_logger logging_demo/srv/ConfigLogger <span class="s2">&quot;{logger_name: &#39;rcl&#39;, level: DEBUG}&quot;</span>
</pre></div>
</div>
<p>您应该会看到``rcl``的调试输出开始显示。</p>
<div class="section" id="using-the-logger-config-component">
<h3><a class="toc-backref" href="#id11">使用日志记录器配置组件</a><a class="headerlink" href="#using-the-logger-config-component" title="永久链接至标题"></a></h3>
<p>响应记录器配置请求的服务器已被开发为一个组件，以便可以将其添加到现有的基于组合的系统中。例如，如果您正在使用`容器运行您的节点&lt;../Intermediate/Composition&gt;`，为了能够配置您的记录器，您只需要请求将``logging_demo::LoggerConfig``组件额外加载到容器中。</p>
<p>例如，如果您想调试``composition::Talker``演示程序，您可以正常启动Talker，如下所示：</p>
<p>Shell 1:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 run rclcpp_components component_container
</pre></div>
</div>
<p>Shell 2:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 component load /ComponentManager composition composition::Talker
</pre></div>
</div>
<p>当您想要启用调试日志记录时，使用以下命令加载“LoggerConfig”组件：</p>
<p>Shell 2</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 component load /ComponentManager logging_demo logging_demo::LoggerConfig
</pre></div>
</div>
<p>最后，通过处理空命名的日志记录器，将所有未设置的日志记录器配置为调试严重性。请注意，已经特别配置为使用特定严重性的日志记录器不会受到此调用的影响。</p>
<p>Shell 2:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 service call /config_logger logging_demo/srv/ConfigLogger <span class="s2">&quot;{logger_name: &#39;&#39;, level: DEBUG}&quot;</span>
</pre></div>
</div>
<p>您应该看到进程中以前未设置的日志记录器开始显示调试输出，包括来自ROS 2核心的输出。</p>
</div>
</div>
<div class="section" id="logger-level-configuration-command-line">
<h2><a class="toc-backref" href="#id12">日志级别配置：命令行</a><a class="headerlink" href="#logger-level-configuration-command-line" title="永久链接至标题"></a></h2>
<p>自 Bouncy ROS 2 版本开始，未显式设置严重性级别的日志记录器的级别可以从命令行进行配置。重新启动演示，包括以下命令行参数：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 run logging_demo logging_demo_main --ros-args --log-level debug
</pre></div>
</div>
<p>这将将任何未设置级别的记录器的默认级别配置为调试级别。您应该能够从演示本身和 ROS 2 核心的记录器看到调试输出。</p>
<p>自 Galactic ROS 2 版本开始，可以从命令行配置单个记录器的严重性级别。重新启动演示，包括以下命令行参数：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-7-R2FsYWN0aWMgYW5kIG5ld2Vy" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-7-R2FsYWN0aWMgYW5kIG5ld2Vy" name="R2FsYWN0aWMgYW5kIG5ld2Vy" role="tab" tabindex="0">Galactic and newer</button></div><div aria-labelledby="tab-7-R2FsYWN0aWMgYW5kIG5ld2Vy" class="sphinx-tabs-panel group-tab" id="panel-7-R2FsYWN0aWMgYW5kIG5ld2Vy" name="R2FsYWN0aWMgYW5kIG5ld2Vy" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 run logging_demo logging_demo_main --ros-args --log-level logger_usage_demo:<span class="o">=</span>debug
</pre></div>
</div>
</div></div>
<div class="section" id="console-output-formatting">
<h3><a class="toc-backref" href="#id13">控制台输出格式化</a><a class="headerlink" href="#console-output-formatting" title="永久链接至标题"></a></h3>
<p>如果您希望获得更详细或更简洁的格式化输出，您可以使用RCUTILS_CONSOLE_OUTPUT_FORMAT环境变量。例如，要在日志调用中额外获取时间戳和位置，请停止演示并使用设置了该环境变量的方式重新启动它：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-8-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-8-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-8-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button><button aria-controls="panel-8-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-8-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-8-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-8-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">RCUTILS_CONSOLE_OUTPUT_FORMAT</span><span class="o">=</span><span class="s2">&quot;[{severity} {time}] [{name}]: {message} ({function_name}() at {file_name}:{line_number})&quot;</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-8-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">RCUTILS_CONSOLE_OUTPUT_FORMAT</span><span class="o">=</span><span class="s2">&quot;[{severity} {time}] [{name}]: {message} ({function_name}() at {file_name}:{line_number})&quot;</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-8-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-8-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># set &quot;RCUTILS_CONSOLE_OUTPUT_FORMAT=[{severity} {time}] [{name}]: {message} ({function_name}() at {file_name}:{line_number})&quot;</span>
ros2 run logging_demo logging_demo_main
</pre></div>
</div>
</div></div>
<p>您应该看到每条消息中额外打印的以秒为单位的时间戳、函数名称、文件名和行号。<em>“time”选项仅在ROS 2 Bouncy版本及以后的版本中受支持。</em></p>
</div>
<div class="section" id="console-output-colorizing">
<h3><a class="toc-backref" href="#id14">控制台输出着色</a><a class="headerlink" href="#console-output-colorizing" title="永久链接至标题"></a></h3>
<p>默认情况下，当输出定向到终端时会进行着色。如果您想强制启用或禁用着色，可以使用``RCUTILS_COLORIZED_OUTPUT``环境变量。例如：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-9-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-9-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-9-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-9-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button><button aria-controls="panel-9-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-9-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-9-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-9-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">RCUTILS_COLORIZED_OUTPUT</span><span class="o">=</span><span class="m">0</span>  <span class="c1"># 1 for forcing it</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-9-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-9-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">RCUTILS_COLORIZED_OUTPUT</span><span class="o">=</span><span class="m">0</span>  <span class="c1"># 1 for forcing it</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-9-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-9-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># set &quot;RCUTILS_COLORIZED_OUTPUT=0&quot;</span>
ros2 run logging_demo logging_demo_main
</pre></div>
</div>
</div></div>
<p>您应该看到现在调试、警告、错误和致命错误日志没有进行着色。</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>在Linux和MacOS中，强制着色输出意味着如果您将输出重定向到文件中，将会出现ANSI转义颜色代码。在Windows中，着色方法依赖于控制台API。如果强制启用，您将收到一条新的警告，表示着色失败。默认行为已经检查输出是否为控制台，因此不建议强制着色。</p>
</div>
</div>
<div class="section" id="default-stream-for-console-output">
<h3><a class="toc-backref" href="#id15">默认控制台输出流</a><a class="headerlink" href="#default-stream-for-console-output" title="永久链接至标题"></a></h3>
<p>从Foxy版本开始，默认情况下所有调试级别的输出都将发送到stderr。通过将``RCUTILS_LOGGING_USE_STDOUT``环境变量设置为``1``，可以强制所有输出发送到stdout。例如：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-10-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-10-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-10-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-10-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button><button aria-controls="panel-10-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-10-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-10-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-10-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">RCUTILS_LOGGING_USE_STDOUT</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-10-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-10-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">RCUTILS_LOGGING_USE_STDOUT</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-10-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-10-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="s2">&quot;RCUTILS_LOGGING_USE_STDOUT=1&quot;</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="line-buffered-console-output">
<h3><a class="toc-backref" href="#id16">行缓冲的控制台输出</a><a class="headerlink" href="#line-buffered-console-output" title="永久链接至标题"></a></h3>
<p>默认情况下，所有日志输出是无缓冲的。通过将``RCUTILS_LOGGING_BUFFERED_STREAM``环境变量设置为1，可以强制将其缓冲。例如：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-11-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-11-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-11-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-11-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button><button aria-controls="panel-11-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-11-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button></div><div aria-labelledby="tab-11-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-11-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">RCUTILS_LOGGING_BUFFERED_STREAM</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-11-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-11-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">RCUTILS_LOGGING_BUFFERED_STREAM</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-11-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-11-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="s2">&quot;RCUTILS_LOGGING_BUFFERED_STREAM=1&quot;</span>
</pre></div>
</div>
</div></div>
<p>然后运行：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 run logging_demo logging_demo_main
</pre></div>
</div>
</div>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>