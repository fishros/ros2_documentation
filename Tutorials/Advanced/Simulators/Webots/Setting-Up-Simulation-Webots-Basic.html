<!DOCTYPE html>
<html class="writer-html5" lang="zh" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Setting up a robot simulation (Basic) [待校准@12561] &mdash; ROS 2 Documentation: Humble  文档</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/tabs.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="canonical" href="https://docs.ros.org/en/humble/Tutorials/Advanced/Simulators/Webots/Setting-Up-Simulation-Webots-Basic.html" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/clipboard.min.js"></script>
        <script src="../../../../_static/copybutton.js"></script>
        <script src="../../../../_static/tabs.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../../search.html" />
    <link rel="next" title="Setting up a robot simulation (Advanced) [待校准@12524]" href="Setting-Up-Simulation-Webots-Advanced.html" />
    <link rel="prev" title="Installation (macOS) [待校准@12421]" href="Installation-MacOS.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> ROS 2 Documentation: Humble
            <img src="../../../../_static/humble-small.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../Installation.html">Installation [待校准&#64;57]</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../Installation/Ubuntu-Install-Debians.html">Ubuntu (Debian) [待校准&#64;513]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Installation/Windows-Install-Binary.html">Windows (binary) [待校准&#64;522]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Installation/RHEL-Install-RPMs.html">RHEL (RPM) [待校准&#64;468]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Installation/Alternatives.html">Alternatives [待校准&#64;87]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../Installation/Alternatives/Ubuntu-Development-Setup.html">Ubuntu (source) [待校准&#64;167]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Installation/Alternatives/Ubuntu-Install-Binary.html">Ubuntu (binary) [待校准&#64;192]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Installation/Alternatives/Windows-Development-Setup.html">Windows (source) [待校准&#64;199]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Installation/Alternatives/RHEL-Development-Setup.html">RHEL (source) [待校准&#64;103]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Installation/Alternatives/RHEL-Install-Binary.html">RHEL (binary) [待校准&#64;148]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Installation/Alternatives/macOS-Development-Setup.html">macOS (source) [待校准&#64;302]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Installation/Alternatives/Fedora-Development-Setup.html">Fedora (source) [待校准&#64;89]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Installation/Alternatives/Latest-Development-Setup.html">Latest development (source) [待校准&#64;93]</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Installation/Maintaining-a-Source-Checkout.html">Maintain source checkout [待校准&#64;449]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Installation/Testing.html">Testing with pre-release binaries [待校准&#64;487]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Installation/DDS-Implementations.html">DDS implementations [待校准&#64;331]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../Installation/DDS-Implementations/Install-Connext-Security-Plugins.html">Connext security plugins [待校准&#64;381]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Installation/DDS-Implementations/Install-Connext-University-Eval.html">RTI Connext DDS [待校准&#64;395]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Installation/DDS-Implementations/Working-with-Eclipse-CycloneDDS.html">Eclipse Cyclone DDS [待校准&#64;407]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Installation/DDS-Implementations/Working-with-GurumNetworks-GurumDDS.html">GurumNetworks GurumDDS [待校准&#64;423]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Installation/DDS-Implementations/Working-with-eProsima-Fast-DDS.html">eProsima Fast DDS [待校准&#64;442]</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Releases.html">Distributions [待校准&#64;548]</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../Releases/Release-Iron-Irwini.html">Iron Irwini (<code class="docutils literal notranslate"><span class="pre">iron</span></code>) [待校准&#64;7633]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../Releases/Iron-Irwini-Complete-Changelog.html">Iron Irwini Changelog [待校准&#64;5006]</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Releases/Release-Humble-Hawksbill.html">Humble Hawksbill (<code class="docutils literal notranslate"><span class="pre">humble</span></code>) [待校准&#64;7413]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../Releases/Humble-Hawksbill-Complete-Changelog.html">Humble Hawksbill changelog [待校准&#64;3416]</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Releases/Release-Foxy-Fitzroy.html">Foxy Fitzroy (<code class="docutils literal notranslate"><span class="pre">foxy</span></code>) [待校准&#64;7053]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Releases/Release-Rolling-Ridley.html">Rolling Ridley (<code class="docutils literal notranslate"><span class="pre">rolling</span></code>) [待校准&#64;7964]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Releases/Development.html">Development Distribution [待校准&#64;793]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../Releases/Release-Jazzy-Jalisco.html">Jazzy Jalisco (codename 'jazzy'; May, 2024) [待校准&#64;7901]</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Releases/End-of-Life.html">End-of-Life Distributions [待校准&#64;795]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../Releases/Release-Galactic-Geochelone.html">Galactic Geochelone (<code class="docutils literal notranslate"><span class="pre">galactic</span></code>) [待校准&#64;7215]</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../Releases/Galactic-Geochelone-Complete-Changelog.html">Galactic Geochelone changelog [待校准&#64;797]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Releases/Release-Eloquent-Elusor.html">Eloquent Elusor (<code class="docutils literal notranslate"><span class="pre">eloquent</span></code>) [待校准&#64;6977]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Releases/Release-Dashing-Diademata.html">Dashing Diademata (<code class="docutils literal notranslate"><span class="pre">dashing</span></code>) [待校准&#64;6787]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Releases/Release-Crystal-Clemmys.html">Crystal Clemmys (<code class="docutils literal notranslate"><span class="pre">crystal</span></code>) [待校准&#64;6708]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Releases/Release-Bouncy-Bolson.html">Bouncy Bolson (<code class="docutils literal notranslate"><span class="pre">bouncy</span></code>) [待校准&#64;6680]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Releases/Release-Ardent-Apalone.html">Ardent Apalone (<code class="docutils literal notranslate"><span class="pre">ardent</span></code>) [待校准&#64;6639]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Releases/Beta3-Overview.html">Beta 3 (<code class="docutils literal notranslate"><span class="pre">r2b3</span></code>) [待校准&#64;774]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Releases/Beta2-Overview.html">Beta 2 (<code class="docutils literal notranslate"><span class="pre">r2b2</span></code>) [待校准&#64;743]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Releases/Beta1-Overview.html">Beta 1 (<code class="docutils literal notranslate"><span class="pre">Asphalt</span></code>) [待校准&#64;709]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../Releases/Alpha-Overview.html">Alphas [待校准&#64;629]</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Releases/Release-Process.html">Development process for a release [待校准&#64;7907]</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../Tutorials.html">Tutorials [待校准&#64;11819]</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../Beginner-CLI-Tools.html">Beginner: CLI tools [待校准&#64;12708]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-CLI-Tools/Configuring-ROS2-Environment.html">Configuring environment [待校准&#64;12709]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-CLI-Tools/Introducing-Turtlesim/Introducing-Turtlesim.html">Using <code class="docutils literal notranslate"><span class="pre">turtlesim</span></code>, <code class="docutils literal notranslate"><span class="pre">ros2</span></code>, and <code class="docutils literal notranslate"><span class="pre">rqt</span></code> [待校准&#64;12741]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-CLI-Tools/Understanding-ROS2-Nodes/Understanding-ROS2-Nodes.html">Understanding nodes [待校准&#64;12924]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-CLI-Tools/Understanding-ROS2-Topics/Understanding-ROS2-Topics.html">Understanding topics [待校准&#64;13038]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-CLI-Tools/Understanding-ROS2-Services/Understanding-ROS2-Services.html">Understanding services [待校准&#64;12998]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-CLI-Tools/Understanding-ROS2-Parameters/Understanding-ROS2-Parameters.html">Understanding parameters [待校准&#64;12960]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-CLI-Tools/Understanding-ROS2-Actions/Understanding-ROS2-Actions.html">Understanding actions [待校准&#64;12873]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-CLI-Tools/Using-Rqt-Console/Using-Rqt-Console.html">Using <code class="docutils literal notranslate"><span class="pre">rqt_console</span></code> to view logs [待校准&#64;13097]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-CLI-Tools/Launching-Multiple-Nodes/Launching-Multiple-Nodes.html">Launching nodes [待校准&#64;12803]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-CLI-Tools/Recording-And-Playing-Back-Data/Recording-And-Playing-Back-Data.html">Recording and playing back data [待校准&#64;12824]</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../Beginner-Client-Libraries.html">Beginner: Client libraries [待校准&#64;13127]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-Client-Libraries/Colcon-Tutorial.html">Using <code class="docutils literal notranslate"><span class="pre">colcon</span></code> to build packages [待校准&#64;13128]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-Client-Libraries/Creating-A-Workspace/Creating-A-Workspace.html">Creating a workspace [待校准&#64;13188]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html">Creating a package [待校准&#64;13256]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-Client-Libraries/Writing-A-Simple-Cpp-Publisher-And-Subscriber.html">Writing a simple publisher and subscriber (C++) [待校准&#64;13592]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-Client-Libraries/Writing-A-Simple-Py-Publisher-And-Subscriber.html">Writing a simple publisher and subscriber (Python) [待校准&#64;13685]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-Client-Libraries/Writing-A-Simple-Cpp-Service-And-Client.html">Writing a simple service and client (C++) [待校准&#64;13647]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-Client-Libraries/Writing-A-Simple-Py-Service-And-Client.html">Writing a simple service and client (Python) [待校准&#64;13724]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-Client-Libraries/Custom-ROS2-Interfaces.html">Creating custom msg and srv files [待校准&#64;13319]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-Client-Libraries/Single-Package-Define-And-Use-Interface.html">Implementing custom interfaces [待校准&#64;13463]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-Client-Libraries/Using-Parameters-In-A-Class-CPP.html">Using parameters in a class (C++) [待校准&#64;13531]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-Client-Libraries/Using-Parameters-In-A-Class-Python.html">Using parameters in a class (Python) [待校准&#64;13572]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-Client-Libraries/Getting-Started-With-Ros2doctor.html">Using <code class="docutils literal notranslate"><span class="pre">ros2doctor</span></code> to identify issues [待校准&#64;13375]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Beginner-Client-Libraries/Pluginlib.html">Creating and using plugins (C++) [待校准&#64;13415]</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../Intermediate.html">Intermediate [待校准&#64;14043]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../Intermediate/Rosdep.html">Managing Dependencies with rosdep [待校准&#64;14387]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Intermediate/Creating-an-Action.html">Creating an action [待校准&#64;14118]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Intermediate/Writing-an-Action-Server-Client/Cpp.html">Writing an action server and client (C++) [待校准&#64;15068]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Intermediate/Writing-an-Action-Server-Client/Py.html">Writing an action server and client (Python) [待校准&#64;15139]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Intermediate/Composition.html">Composing multiple nodes in a single process [待校准&#64;14044]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Intermediate/Monitoring-For-Parameter-Changes-CPP.html">Monitoring for parameter changes (C++) [待校准&#64;14353]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Intermediate/Launch/Launch-Main.html">Launch [待校准&#64;14186]</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Launch/Creating-Launch-Files.html">Creating a launch file [待校准&#64;14148]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Launch/Launch-system.html">Integrating launch files into ROS 2 packages [待校准&#64;14199]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Launch/Using-Substitutions.html">Using substitutions [待校准&#64;14323]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Launch/Using-Event-Handlers.html">Using event handlers [待校准&#64;14227]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Launch/Using-ROS2-Launch-For-Large-Projects.html">Managing large projects [待校准&#64;14261]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../Intermediate/Tf2/Tf2-Main.html"><code class="docutils literal notranslate"><span class="pre">tf2</span></code> [待校准&#64;14657]</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Tf2/Introduction-To-Tf2.html">Introducing <code class="docutils literal notranslate"><span class="pre">tf2</span></code> [待校准&#64;14573]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Tf2/Writing-A-Tf2-Static-Broadcaster-Py.html">Writing a static broadcaster (Python) [待校准&#64;14862]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Tf2/Writing-A-Tf2-Static-Broadcaster-Cpp.html">Writing a static broadcaster (C++) [待校准&#64;14825]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Tf2/Writing-A-Tf2-Broadcaster-Py.html">Writing a broadcaster (Python) [待校准&#64;14788]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Tf2/Writing-A-Tf2-Broadcaster-Cpp.html">Writing a broadcaster (C++) [待校准&#64;14757]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Tf2/Writing-A-Tf2-Listener-Py.html">Writing a listener (Python) [待校准&#64;14819]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Tf2/Writing-A-Tf2-Listener-Cpp.html">Writing a listener (C++) [待校准&#64;14798]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Tf2/Adding-A-Frame-Py.html">Adding a frame (Python) [待校准&#64;14522]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Tf2/Adding-A-Frame-Cpp.html">Adding a frame (C++) [待校准&#64;14479]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Tf2/Learning-About-Tf2-And-Time-Py.html">Using time (Python) [待校准&#64;14620]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Tf2/Learning-About-Tf2-And-Time-Cpp.html">Using time (C++) [待校准&#64;14600]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Tf2/Time-Travel-With-Tf2-Py.html">Traveling in time (Python) [待校准&#64;14709]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Tf2/Time-Travel-With-Tf2-Cpp.html">Traveling in time (C++) [待校准&#64;14684]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Tf2/Debugging-Tf2-Problems.html">Debugging [待校准&#64;14535]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Tf2/Quaternion-Fundamentals.html">Quaternion fundamentals [待校准&#64;14634]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Tf2/Using-Stamped-Datatypes-With-Tf2-Ros-MessageFilter.html">Using stamped datatypes with <code class="docutils literal notranslate"><span class="pre">tf2_ros::MessageFilter</span></code> [待校准&#64;14717]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../Intermediate/Testing/Testing-Main.html">Testing [待校准&#64;14461]</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Testing/CLI.html">Running Tests in ROS 2 from the Command Line [待校准&#64;14427]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Testing/Cpp.html">Writing Basic Tests with C++ with GTest [待校准&#64;14435]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/Testing/Python.html">Writing Basic Tests with Python [待校准&#64;14447]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../Intermediate/URDF/URDF-Main.html">URDF [待校准&#64;14991]</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/URDF/Building-a-Visual-Robot-Model-with-URDF-from-Scratch.html">Building a visual robot model from scratch [待校准&#64;14942]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/URDF/Building-a-Movable-Robot-Model-with-URDF.html">Building a movable robot model [待校准&#64;14920]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/URDF/Adding-Physical-and-Collision-Properties-to-a-URDF-Model.html">Adding physical and collision properties [待校准&#64;14873]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/URDF/Using-Xacro-to-Clean-Up-a-URDF-File.html">Using Xacro to clean up your code [待校准&#64;15019]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../Intermediate/URDF/Using-URDF-with-Robot-State-Publisher.html">Using URDF with <code class="docutils literal notranslate"><span class="pre">robot_state_publisher</span></code> [待校准&#64;14993]</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../Advanced.html">Advanced [待校准&#64;11825]</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../Topic-Statistics-Tutorial/Topic-Statistics-Tutorial.html">Enabling topic statistics (C++) [待校准&#64;12648]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Discovery-Server/Discovery-Server.html">Using Fast DDS Discovery Server as discovery protocol [community-contributed] [待校准&#64;11871]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Allocator-Template-Tutorial.html">Implementing a custom memory allocator [待校准&#64;11826]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../FastDDS-Configuration.html">Unlocking the potential of Fast DDS middleware [community-contributed] [待校准&#64;11958]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Recording-A-Bag-From-Your-Own-Node-CPP.html">Recording a bag from a node (C++) [待校准&#64;12035]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Recording-A-Bag-From-Your-Own-Node-Py.html">Recording a bag from a node (Python) [待校准&#64;12115]</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../Simulation-Main.html">Simulators [待校准&#64;12418]</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="Simulation-Webots.html">Webots [待校准&#64;12646]</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="Installation-Ubuntu.html">Installation (Ubuntu) [待校准&#64;12476]</a></li>
<li class="toctree-l5"><a class="reference internal" href="Installation-Windows.html">Installation (Windows) [待校准&#64;12493]</a></li>
<li class="toctree-l5"><a class="reference internal" href="Installation-MacOS.html">Installation (macOS) [待校准&#64;12421]</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="#">Setting up a robot simulation (Basic) [待校准&#64;12561]</a></li>
<li class="toctree-l5"><a class="reference internal" href="Setting-Up-Simulation-Webots-Advanced.html">Setting up a robot simulation (Advanced) [待校准&#64;12524]</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../Gazebo/Simulation-Gazebo.html">Gazebo [待校准&#64;12416]</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../Gazebo/Gazebo.html">Setting up a robot simulation (Gazebo) [待校准&#64;12388]</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../Security/Security-Main.html">Security [待校准&#64;12314]</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../Security/Introducing-ros2-security.html">Setting up security [待校准&#64;12265]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Security/The-Keystore.html">Understanding the security keystore [待校准&#64;12331]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Security/Security-on-Two.html">Ensuring security across machines [待校准&#64;12315]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Security/Examine-Traffic.html">Examining network traffic [待校准&#64;12230]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Security/Access-Controls.html">Setting access controls [待校准&#64;12143]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Security/Deployment-Guidelines.html">Deployment Guidelines [待校准&#64;12166]</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../Demos.html">Demos [待校准&#64;13752]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../Demos/Quality-of-Service.html">Using quality-of-service settings for lossy networks [待校准&#64;13907]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Demos/Managed-Nodes.html">Managing nodes with managed lifecycles [待校准&#64;13905]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Demos/Intra-Process-Communication.html">Setting up efficient intra-process communication [待校准&#64;13795]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Demos/Rosbag-with-ROS1-Bridge.html">Recording and playing back data with <code class="docutils literal notranslate"><span class="pre">rosbag</span></code> using the ROS 1 bridge [待校准&#64;13998]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Demos/Real-Time-Programming.html">Understanding real-time programming [待校准&#64;13935]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Demos/dummy-robot-demo.html">Experimenting with a dummy robot [待校准&#64;14025]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Demos/Logging-and-logger-configuration.html">Logging [待校准&#64;13844]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Demos/Content-Filtering-Subscription.html">Creating a content filtering subscription [待校准&#64;13761]</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../Miscellaneous.html">Miscellaneous [待校准&#64;15199]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../Miscellaneous/Deploying-ROS-2-on-IBM-Cloud.html">Deploying on IBM Cloud Kubernetes [community-contributed] [待校准&#64;15248]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Miscellaneous/Eclipse-Oxygen-with-ROS-2-and-rviz2.html">Using Eclipse Oxygen with <code class="docutils literal notranslate"><span class="pre">rviz2</span></code> [community-contributed] [待校准&#64;15335]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Miscellaneous/Building-Realtime-rt_preempt-kernel-for-ROS-2.html">Building a real-time Linux kernel [community-contributed] [待校准&#64;15228]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../Miscellaneous/Building-ROS2-Package-with-eclipse-2021-06.html">Building a package with Eclipse 2021-06 [待校准&#64;15200]</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../How-To-Guides.html">How-to Guides [待校准&#64;9690]</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Installation-Troubleshooting.html">Installation troubleshooting [待校准&#64;10060]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Developing-a-ROS-2-Package.html">Developing a ROS 2 package [待校准&#64;10027]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Ament-CMake-Documentation.html">ament_cmake user documentation [待校准&#64;9694]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Ament-CMake-Python-Documentation.html">ament_cmake_python user documentation [待校准&#64;9847]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Launch-files-migration-guide.html">Migrating launch files from ROS 1 to ROS 2 [待校准&#64;10180]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Launch-file-different-formats.html">Using Python, XML, and YAML for ROS 2 Launch Files [待校准&#64;10153]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Launching-composable-nodes.html">Using ROS 2 launch to launch composable nodes [待校准&#64;10276]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Parameters-YAML-files-migration-guide.html">Migrating YAML parameter files from ROS 1 to ROS 2 [待校准&#64;10394]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Node-arguments.html">Passing ROS arguments to nodes via the command-line [待校准&#64;10292]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Sync-Vs-Async.html">Synchronous vs. asynchronous service clients [待校准&#64;10676]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/DDS-tuning.html">DDS tuning information [待校准&#64;9983]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Overriding-QoS-Policies-For-Recording-And-Playback.html">rosbag2: Overriding QoS Policies [待校准&#64;10316]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Working-with-multiple-RMW-implementations.html">Working with multiple ROS 2 middleware implementations [待校准&#64;10916]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Cross-compilation.html">Cross-compilation [待校准&#64;9896]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Releasing/Releasing-a-Package.html">Releasing a Package [待校准&#64;10617]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../How-To-Guides/Releasing/First-Time-Release.html">First Time Release [待校准&#64;10481]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../How-To-Guides/Releasing/Subsequent-Releases.html">Subsequent Releases [待校准&#64;10627]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../How-To-Guides/Releasing/Release-Team-Repository.html">Release Team / Repository [待校准&#64;10555]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../How-To-Guides/Releasing/Release-Track.html">Release Track [待校准&#64;10576]</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Using-Python-Packages.html">Using Python Packages with ROS 2 [待校准&#64;10716]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/RQt-Port-Plugin-Windows.html">Porting RQt plugins to Windows [待校准&#64;10406]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Run-2-nodes-in-single-or-separate-docker-containers.html">Running ROS 2 nodes in Docker [community-contributed] [待校准&#64;10635]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Visualizing-ROS-2-Data-With-Foxglove-Studio.html">Visualizing ROS 2 data with Foxglove Studio [待校准&#64;10852]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Package-maintainer-guide.html">ROS 2 Package Maintainer Guide [待校准&#64;10328]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Building-a-Custom-Debian-Package.html">Building a custom Debian package [待校准&#64;9885]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Building-ROS-2-with-Tracing-Instrumentation.html">Building ROS 2 with tracing instrumentation [待校准&#64;9864]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Topics-Services-Actions.html">Topics vs Services vs Actions [待校准&#64;10702]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Using-Variants.html">Using variants [待校准&#64;10736]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Using-ros2-param.html">Using the <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">param</span></code> command-line tool [待校准&#64;10828]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Using-ros1_bridge-Jammy-upstream.html">Using <code class="docutils literal notranslate"><span class="pre">ros1_bridge</span></code> with upstream ROS on Ubuntu 22.04 [待校准&#64;10811]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Disabling-ZeroCopy-loaned-messages.html">Disabling Zero Copy Loaned Messages [待校准&#64;10050]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Installing-on-Raspberry-Pi.html">ROS 2 on Raspberry Pi [待校准&#64;10133]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Using-callback-groups.html">Using Callback Groups [待校准&#64;10751]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/Setup-ROS-2-with-VSCode-and-Docker-Container.html">Setup ROS 2 with VSCode and Docker [community-contributed] [待校准&#64;10648]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../How-To-Guides/RQt-Source-Install.html">Building RQt from source [待校准&#64;10427]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../How-To-Guides/RQt-Source-Install-MacOS.html">Building RQt from source on macOS [待校准&#64;10452]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../How-To-Guides/RQt-Source-Install-Windows10.html">Building RQt from source on Windows 10 [待校准&#64;10460]</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Concepts.html">Concepts [待校准&#64;10972]</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-Domain-ID.html">The ROS_DOMAIN_ID [待校准&#64;11227]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-Different-Middleware-Vendors.html">About different ROS 2 DDS/RTPS vendors [待校准&#64;11188]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-Logging.html">About logging and logger configuration [待校准&#64;11359]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-Quality-of-Service-Settings.html">About Quality of Service settings [待校准&#64;11467]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-ROS-2-Client-Libraries.html">About ROS 2 client libraries [待校准&#64;11557]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-ROS-Interfaces.html">About ROS 2 interfaces [待校准&#64;11636]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-ROS-2-Parameters.html">About parameters in ROS 2 [待校准&#64;11600]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-Executors.html">Executors [待校准&#64;11260]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-Topic-Statistics.html">About topic statistics [待校准&#64;11800]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-Command-Line-Tools.html">Introspection with command line tools [待校准&#64;11118]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-RQt.html">Overview and usage of RQt [待校准&#64;11735]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-Composition.html">About Composition [待校准&#64;11151]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-Catment.html">On the mixing of ament and catkin (catment) [待校准&#64;11058]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-Cross-Compilation.html">About Cross-compilation [待校准&#64;11173]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-Security.html">About ROS 2 Security [待校准&#64;11762]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-Tf2.html">About tf2 [待校准&#64;11782]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-Build-System.html">About the build system [待校准&#64;11008]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-Internal-Interfaces.html">About internal ROS 2 interfaces [待校准&#64;11300]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-Middleware-Implementations.html">About ROS 2 middleware implementations [待校准&#64;11445]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Concepts/About-ROS-2-Client-Libraries.html">About ROS 2 client libraries [待校准&#64;11557]</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Contact.html">Contact [待校准&#64;15448]</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../The-ROS2-Project.html">The ROS 2 Project [待校准&#64;7973]</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../The-ROS2-Project/Contributing.html">Contributing [待校准&#64;7975]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../The-ROS2-Project/Contributing/Developer-Guide.html">ROS 2 developer guide [待校准&#64;8291]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../The-ROS2-Project/Contributing/Code-Style-Language-Versions.html">Code style and language versions [待校准&#64;8062]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../The-ROS2-Project/Contributing/Quality-Guide.html">Quality guide: ensuring code quality [待校准&#64;8878]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../The-ROS2-Project/Contributing/Migration-Guide.html">Migration guide from ROS 1 [待校准&#64;8646]</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../The-ROS2-Project/Contributing/Migration-Guide-Python.html">Python migration guide from ROS 1 [待校准&#64;8869]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../The-ROS2-Project/Contributing/Build-Farms.html">ROS Build Farms [待校准&#64;8014]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../The-ROS2-Project/Contributing/Windows-Tips-and-Tricks.html">Windows Tips and Tricks [待校准&#64;8970]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../The-ROS2-Project/Contributing/Contributing-To-ROS-2-Documentation.html">Contributing to ROS 2 Documentation [待校准&#64;8219]</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../The-ROS2-Project/Features.html">Features Status [待校准&#64;9093]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../The-ROS2-Project/Feature-Ideas.html">Feature Ideas [待校准&#64;9007]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../The-ROS2-Project/Roadmap.html">Roadmap [待校准&#64;9640]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../The-ROS2-Project/ROSCon-Content.html">ROSCon Talks [待校准&#64;9431]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../The-ROS2-Project/Governance.html">Project Governance [待校准&#64;9152]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../The-ROS2-Project/Governance/ROS2-TSC-Charter.html">ROS 2 Technical Steering Committee Charter [待校准&#64;9275]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../The-ROS2-Project/Governance/ROS2-TSC-Intake-process.html">ROS 2 TSC applicant intake process [待校准&#64;9364]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../The-ROS2-Project/Governance/How-To-Start-A-Community-Working-Group.html">How to Start a Community Working Group [待校准&#64;9248]</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../The-ROS2-Project/Marketing.html">Marketing [待校准&#64;9415]</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../API-Docs.html">API Documentation [待校准&#64;10948]</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Related-Projects.html">相关项目 [&#64;1]</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../Related-Projects/Intel-ROS2-Projects.html">Intel ROS 2 Projects [待校准&#64;14]</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Related-Projects/Nvidia-ROS2-Projects.html">NVIDIA ROS 2 Projects [待校准&#64;32]</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Glossary.html">Glossary [待校准&#64;10956]</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Citations.html">Citations [待校准&#64;15376]</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">ROS 2 Documentation: Humble</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../../Tutorials.html">Tutorials [待校准&#64;11819]</a> &raquo;</li>
          <li><a href="../../../Advanced.html">Advanced [待校准&#64;11825]</a> &raquo;</li>
          <li><a href="../Simulation-Main.html">Simulators [待校准&#64;12418]</a> &raquo;</li>
          <li><a href="Simulation-Webots.html">Webots [待校准&#64;12646]</a> &raquo;</li>
      <li>Setting up a robot simulation (Basic) [待校准&#64;12561]</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ros2/ros2_documentation/blob/humble/source/Tutorials/Advanced/Simulators/Webots/Setting-Up-Simulation-Webots-Basic.rst" class="fa fa-github"> 在 GitHub 上修改</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             


  <div class="section" id="setting-up-a-robot-simulation-basic">
<h1>Setting up a robot simulation (Basic) <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12561">[待校准&#64;12561]</a><a class="headerlink" href="#setting-up-a-robot-simulation-basic" title="永久链接至标题"></a></h1>
<p><strong>Goal:</strong> Setup a robot simulation and control it from ROS 2. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12562">[待校准&#64;12562]</a></p>
<p><strong>Tutorial level:</strong> Advanced <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=11828">[待校准&#64;11828]</a></p>
<p><strong>Time:</strong> 30 minutes <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12563">[待校准&#64;12563]</a></p>
<div class="contents local topic" id="contents">
<p class="topic-title">Contents <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12037">[待校准&#64;12037]</a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id3">Background [待校准&#64;11832]</a></p></li>
<li><p><a class="reference internal" href="#prerequisites" id="id4">Prerequisites [待校准&#64;11884]</a></p></li>
<li><p><a class="reference internal" href="#tasks" id="id5">Tasks [待校准&#64;12042]</a></p>
<ul>
<li><p><a class="reference internal" href="#create-the-package-structure" id="id6">1 Create the package structure [待校准&#64;12570]</a></p></li>
<li><p><a class="reference internal" href="#setup-the-simulation-world" id="id7">2 Setup the simulation world [待校准&#64;12578]</a></p></li>
<li><p><a class="reference internal" href="#edit-the-my-robot-driver-plugin" id="id8">3 Edit the <code class="docutils literal notranslate"><span class="pre">my_robot_driver</span></code> plugin [待校准&#64;12582]</a></p></li>
<li><p><a class="reference internal" href="#create-the-my-robot-urdf-file" id="id9">4 Create the <code class="docutils literal notranslate"><span class="pre">my_robot.urdf</span></code> file [待校准&#64;12604]</a></p></li>
<li><p><a class="reference internal" href="#create-the-launch-file" id="id10">5 Create the launch file [待校准&#64;12612]</a></p></li>
<li><p><a class="reference internal" href="#edit-additional-files" id="id11">6 Edit additional files [待校准&#64;12623]</a></p></li>
<li><p><a class="reference internal" href="#test-the-code" id="id12">7 Test the code [待校准&#64;12633]</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#summary" id="id13">Summary [待校准&#64;12113]</a></p></li>
<li><p><a class="reference internal" href="#next-steps" id="id14">Next steps [待校准&#64;12557]</a></p></li>
</ul>
</div>
<div class="section" id="background">
<h2>Background <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=11832">[待校准&#64;11832]</a><a class="headerlink" href="#background" title="永久链接至标题"></a></h2>
<p>In this tutorial, you are going to use the Webots robot simulator to set-up and run a very simple ROS 2 simulation scenario. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12564">[待校准&#64;12564]</a></p>
<p>The <code class="docutils literal notranslate"><span class="pre">webots_ros2</span></code> package provides an interface between ROS 2 and Webots. It includes several sub-packages, but in this tutorial, you are going to use only the <code class="docutils literal notranslate"><span class="pre">webots_ros2_driver</span></code> sub-package to implement a Python or C++ plugin controlling a simulated robot. Some other sub-packages contain demos with different robots such as the TurtleBot3. They are documented in the <a class="reference external" href="https://github.com/cyberbotics/webots_ros2/wiki/Examples">Webots ROS 2 examples</a> page. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12565">[待校准&#64;12565]</a></p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=11884">[待校准&#64;11884]</a><a class="headerlink" href="#prerequisites" title="永久链接至标题"></a></h2>
<p>It is recommended to understand basic ROS principles covered in the beginner <a class="reference internal" href="../../../../Tutorials.html"><span class="doc">Tutorials [待校准&#64;11819]</span></a>. In particular, <a class="reference internal" href="../../../Beginner-CLI-Tools/Introducing-Turtlesim/Introducing-Turtlesim.html"><span class="doc">Using turtlesim, ros2, and rqt [待校准&#64;12741]</span></a>, <a class="reference internal" href="../../../Beginner-CLI-Tools/Understanding-ROS2-Topics/Understanding-ROS2-Topics.html"><span class="doc">Understanding topics [待校准&#64;13038]</span></a>, <a class="reference internal" href="../../../Beginner-Client-Libraries/Creating-A-Workspace/Creating-A-Workspace.html"><span class="doc">Creating a workspace [待校准&#64;13188]</span></a>, <a class="reference internal" href="../../../Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html"><span class="doc">Creating a package [待校准&#64;13256]</span></a> and <a class="reference internal" href="../../../Intermediate/Launch/Creating-Launch-Files.html"><span class="doc">Creating a launch file [待校准&#64;14148]</span></a> are useful prerequisites. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12566">[待校准&#64;12566]</a></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-0-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button><button aria-controls="panel-0-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button></div><div aria-labelledby="tab-0-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-0-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><p>The Linux and ROS commands of this tutorial can be run in a standard Linux terminal. The following page <a class="reference internal" href="Installation-Ubuntu.html"><span class="doc">Installation (Ubuntu) [待校准&#64;12476]</span></a> explains how to install the <code class="docutils literal notranslate"><span class="pre">webots_ros2</span></code> package on Linux. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12567">[待校准&#64;12567]</a></p>
</div><div aria-labelledby="tab-0-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><p>The Linux and ROS commands of this tutorial must be run in a WSL (Windows Subsystem for Linux) environment. The following page <a class="reference internal" href="Installation-Windows.html"><span class="doc">Installation (Windows) [待校准&#64;12493]</span></a> explains how to install the <code class="docutils literal notranslate"><span class="pre">webots_ros2</span></code> package on Windows. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12568">[待校准&#64;12568]</a></p>
</div><div aria-labelledby="tab-0-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><p>The Linux and ROS commands of this tutorial must be run in a pre-configured Linux Virtual Machine (VM). The following page <a class="reference internal" href="Installation-MacOS.html"><span class="doc">Installation (macOS) [待校准&#64;12421]</span></a> explains how to install the <code class="docutils literal notranslate"><span class="pre">webots_ros2</span></code> package on macOS. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12569">[待校准&#64;12569]</a></p>
</div></div>
</div>
<div class="section" id="tasks">
<h2>Tasks <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12042">[待校准&#64;12042]</a><a class="headerlink" href="#tasks" title="永久链接至标题"></a></h2>
<div class="section" id="create-the-package-structure">
<h3>1 Create the package structure <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12570">[待校准&#64;12570]</a><a class="headerlink" href="#create-the-package-structure" title="永久链接至标题"></a></h3>
<p>Let's organize the code in a custom ROS 2 package. Create a new package named <code class="docutils literal notranslate"><span class="pre">my_package</span></code> from the <code class="docutils literal notranslate"><span class="pre">src</span></code> folder of your ROS 2 workspace. Change the current directory of your terminal to <code class="docutils literal notranslate"><span class="pre">ros2_ws/src</span></code> and run: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12571">[待校准&#64;12571]</a></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-1-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button></div><div aria-labelledby="tab-1-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-1-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 pkg create --build-type ament_python --license Apache-2.0 --node-name my_robot_driver my_package --dependencies rclpy geometry_msgs webots_ros2_driver</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--node-name</span> <span class="pre">my_robot_driver</span></code> option will create a <code class="docutils literal notranslate"><span class="pre">my_robot_driver.py</span></code> template Python plugin in the <code class="docutils literal notranslate"><span class="pre">my_package</span></code> subfolder that you will modify later. The <code class="docutils literal notranslate"><span class="pre">--dependencies</span> <span class="pre">rclpy</span> <span class="pre">geometry_msgs</span> <span class="pre">webots_ros2_driver</span></code> option specifies the packages needed by the <code class="docutils literal notranslate"><span class="pre">my_robot_driver.py</span></code> plugin in the <code class="docutils literal notranslate"><span class="pre">package.xml</span></code> file. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12572">[待校准&#64;12572]</a></p>
<p>Let's add a <code class="docutils literal notranslate"><span class="pre">launch</span></code> and a <code class="docutils literal notranslate"><span class="pre">worlds</span></code> folder inside the <code class="docutils literal notranslate"><span class="pre">my_package</span></code> folder. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12573">[待校准&#64;12573]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd my_package</span>
<span class="go">mkdir launch</span>
<span class="go">mkdir worlds</span>
</pre></div>
</div>
<p>You should end up with the following folder structure: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12574">[待校准&#64;12574]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">src/</span>
<span class="go">└── my_package/</span>
<span class="go">    ├── launch/</span>
<span class="go">    ├── my_package/</span>
<span class="go">    │   ├── __init__.py</span>
<span class="go">    │   └── my_robot_driver.py</span>
<span class="go">    ├── resource/</span>
<span class="go">    │   └── my_package</span>
<span class="go">    ├── test/</span>
<span class="go">    │   ├── test_copyright.py</span>
<span class="go">    │   ├── test_flake8.py</span>
<span class="go">    │   └── test_pep257.py</span>
<span class="go">    ├── worlds/</span>
<span class="go">    ├── package.xml</span>
<span class="go">    ├── setup.cfg</span>
<span class="go">    └── setup.py</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 pkg create --build-type ament_cmake --license Apache-2.0 --node-name MyRobotDriver my_package --dependencies rclcpp geometry_msgs webots_ros2_driver pluginlib</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--node-name</span> <span class="pre">MyRobotDriver</span></code> option will create a <code class="docutils literal notranslate"><span class="pre">MyRobotDriver.cpp</span></code> template C++ plugin in the <code class="docutils literal notranslate"><span class="pre">my_package/src</span></code> subfolder that you will modify later. The <code class="docutils literal notranslate"><span class="pre">--dependencies</span> <span class="pre">rclcpp</span> <span class="pre">geometry_msgs</span> <span class="pre">webots_ros2_driver</span> <span class="pre">pluginlib</span></code> option specifies the packages needed by the <code class="docutils literal notranslate"><span class="pre">MyRobotDriver</span></code> plugin in the <code class="docutils literal notranslate"><span class="pre">package.xml</span></code> file. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12575">[待校准&#64;12575]</a></p>
<p>Let's add a <code class="docutils literal notranslate"><span class="pre">launch</span></code>, a <code class="docutils literal notranslate"><span class="pre">worlds</span></code> and a <code class="docutils literal notranslate"><span class="pre">resource</span></code> folder inside the <code class="docutils literal notranslate"><span class="pre">my_package</span></code> folder. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12576">[待校准&#64;12576]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd my_package</span>
<span class="go">mkdir launch</span>
<span class="go">mkdir worlds</span>
<span class="go">mkdir resource</span>
</pre></div>
</div>
<p>Two additional files must be created: the header file for <code class="docutils literal notranslate"><span class="pre">MyRobotDriver</span></code> and the <code class="docutils literal notranslate"><span class="pre">my_robot_driver.xml</span></code> pluginlib description file. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12577">[待校准&#64;12577]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">touch my_robot_driver.xml</span>
<span class="go">touch include/my_package/MyRobotDriver.hpp</span>
</pre></div>
</div>
<p>You should end up with the following folder structure: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12574">[待校准&#64;12574]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">src/</span>
<span class="go">└── my_package/</span>
<span class="go">    ├── include/</span>
<span class="go">    │   └── my_package/</span>
<span class="go">    │       └── MyRobotDriver.hpp</span>
<span class="go">    ├── launch/</span>
<span class="go">    ├── resource/</span>
<span class="go">    ├── src/</span>
<span class="go">    │   └── MyRobotDriver.cpp</span>
<span class="go">    ├── worlds/</span>
<span class="go">    ├── CMakeList.txt</span>
<span class="go">    ├── my_robot_driver.xml</span>
<span class="go">    └── package.xml</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="setup-the-simulation-world">
<h3>2 Setup the simulation world <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12578">[待校准&#64;12578]</a><a class="headerlink" href="#setup-the-simulation-world" title="永久链接至标题"></a></h3>
<p>You will need a world file containing a robot to launch your simulation. <a class="reference download internal" download="" href="../../../../_downloads/5ad123fc6a8f1ea79553d5039728084a/my_world.wbt"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">this</span> <span class="pre">world</span> <span class="pre">file</span></code></a> and move it inside <code class="docutils literal notranslate"><span class="pre">my_package/worlds/</span></code>. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12579">[待校准&#64;12579]</a></p>
<p>This is actually a fairly simple text file you can visualize in a text editor. A simple robot is already included in this <code class="docutils literal notranslate"><span class="pre">my_world.wbt</span></code> world file. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12580">[待校准&#64;12580]</a></p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>In case you want to learn how to create your own robot model in Webots, you can check this <a class="reference external" href="https://cyberbotics.com/doc/guide/tutorial-6-4-wheels-robot">tutorial</a>. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12581">[待校准&#64;12581]</a></p>
</div>
</div>
<div class="section" id="edit-the-my-robot-driver-plugin">
<h3>3 Edit the <code class="docutils literal notranslate"><span class="pre">my_robot_driver</span></code> plugin <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12582">[待校准&#64;12582]</a><a class="headerlink" href="#edit-the-my-robot-driver-plugin" title="永久链接至标题"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">webots_ros2_driver</span></code> sub-package automatically creates a ROS 2 interface for most sensors. More details on existing device interfaces and how to configure them is given in the second part of the tutorial: <a class="reference internal" href="Setting-Up-Simulation-Webots-Advanced.html"><span class="doc">Setting up a robot simulation (Advanced) [待校准&#64;12524]</span></a>. In this task, you will extend this interface by creating your own custom plugin. This custom plugin is a ROS node equivalent to a robot controller. You can use it to access the <a class="reference external" href="https://cyberbotics.com/doc/reference/robot?tab-language=python">Webots robot API</a> and create your own topics and services to control your robot. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12583">[待校准&#64;12583]</a></p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>The purpose of this tutorial is to show a basic example with a minimum number of dependencies. However, you could avoid the use of this plugin by using another <code class="docutils literal notranslate"><span class="pre">webots_ros2</span></code> sub-package named <code class="docutils literal notranslate"><span class="pre">webots_ros2_control</span></code>, introducing a new dependency. This other sub-package creates an interface with the <code class="docutils literal notranslate"><span class="pre">ros2_control</span></code> package that facilitates the control of a differential wheeled robot. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12584">[待校准&#64;12584]</a></p>
</div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-2-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-2-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button></div><div aria-labelledby="tab-2-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-2-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><p>Open <code class="docutils literal notranslate"><span class="pre">my_package/my_package/my_robot_driver.py</span></code> in your favorite editor and replace its contents with the following: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12585">[待校准&#64;12585]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rclpy</span>
<span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Twist</span>

<span class="n">HALF_DISTANCE_BETWEEN_WHEELS</span> <span class="o">=</span> <span class="mf">0.045</span>
<span class="n">WHEEL_RADIUS</span> <span class="o">=</span> <span class="mf">0.025</span>

<span class="k">class</span> <span class="nc">MyRobotDriver</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">webots_node</span><span class="p">,</span> <span class="n">properties</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__robot</span> <span class="o">=</span> <span class="n">webots_node</span><span class="o">.</span><span class="n">robot</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__left_motor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__robot</span><span class="o">.</span><span class="n">getDevice</span><span class="p">(</span><span class="s1">&#39;left wheel motor&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__right_motor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__robot</span><span class="o">.</span><span class="n">getDevice</span><span class="p">(</span><span class="s1">&#39;right wheel motor&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__left_motor</span><span class="o">.</span><span class="n">setPosition</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__left_motor</span><span class="o">.</span><span class="n">setVelocity</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__right_motor</span><span class="o">.</span><span class="n">setPosition</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__right_motor</span><span class="o">.</span><span class="n">setVelocity</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__target_twist</span> <span class="o">=</span> <span class="n">Twist</span><span class="p">()</span>

        <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__node</span> <span class="o">=</span> <span class="n">rclpy</span><span class="o">.</span><span class="n">create_node</span><span class="p">(</span><span class="s1">&#39;my_robot_driver&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__node</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">Twist</span><span class="p">,</span> <span class="s1">&#39;cmd_vel&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmd_vel_callback</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__cmd_vel_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">twist</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__target_twist</span> <span class="o">=</span> <span class="n">twist</span>

    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rclpy</span><span class="o">.</span><span class="n">spin_once</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__node</span><span class="p">,</span> <span class="n">timeout_sec</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">forward_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__target_twist</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span>
        <span class="n">angular_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__target_twist</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span>

        <span class="n">command_motor_left</span> <span class="o">=</span> <span class="p">(</span><span class="n">forward_speed</span> <span class="o">-</span> <span class="n">angular_speed</span> <span class="o">*</span> <span class="n">HALF_DISTANCE_BETWEEN_WHEELS</span><span class="p">)</span> <span class="o">/</span> <span class="n">WHEEL_RADIUS</span>
        <span class="n">command_motor_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">forward_speed</span> <span class="o">+</span> <span class="n">angular_speed</span> <span class="o">*</span> <span class="n">HALF_DISTANCE_BETWEEN_WHEELS</span><span class="p">)</span> <span class="o">/</span> <span class="n">WHEEL_RADIUS</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__left_motor</span><span class="o">.</span><span class="n">setVelocity</span><span class="p">(</span><span class="n">command_motor_left</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__right_motor</span><span class="o">.</span><span class="n">setVelocity</span><span class="p">(</span><span class="n">command_motor_right</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see, the <code class="docutils literal notranslate"><span class="pre">MyRobotDriver</span></code> class implements three methods. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12586">[待校准&#64;12586]</a></p>
<p>The first method, named <code class="docutils literal notranslate"><span class="pre">init(self,</span> <span class="pre">...)</span></code>, is actually the ROS node counterpart of the Python <code class="docutils literal notranslate"><span class="pre">__init__(self,</span> <span class="pre">...)</span></code> constructor. The <code class="docutils literal notranslate"><span class="pre">init</span></code> method always takes two arguments: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12587">[待校准&#64;12587]</a></p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">webots_node</span></code> argument contains a reference on the Webots instance. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12588">[待校准&#64;12588]</a></p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">properties</span></code> argument is a dictionary created from the XML tags given in the URDF files (<a class="reference internal" href="#create-the-my-robot-urdf-file"><span class="std std-ref">4 Create the my_robot.urdf file [待校准&#64;12604]</span></a>) and allows you to pass parameters to the controller. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12589">[待校准&#64;12589]</a></p></li>
</ul>
<p>The robot instance from the simulation <code class="docutils literal notranslate"><span class="pre">self.__robot</span></code> can be used to access the <a class="reference external" href="https://cyberbotics.com/doc/reference/robot?tab-language=python">Webots robot API</a>. Then, it gets the two motor instances and initializes them with a target position and a target velocity. Finally a ROS node is created and a callback method is registered for a ROS topic named <code class="docutils literal notranslate"><span class="pre">/cmd_vel</span></code> that will handle <code class="docutils literal notranslate"><span class="pre">Twist</span></code> messages. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12590">[待校准&#64;12590]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">webots_node</span><span class="p">,</span> <span class="n">properties</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__robot</span> <span class="o">=</span> <span class="n">webots_node</span><span class="o">.</span><span class="n">robot</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__left_motor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__robot</span><span class="o">.</span><span class="n">getDevice</span><span class="p">(</span><span class="s1">&#39;left wheel motor&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__right_motor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__robot</span><span class="o">.</span><span class="n">getDevice</span><span class="p">(</span><span class="s1">&#39;right wheel motor&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__left_motor</span><span class="o">.</span><span class="n">setPosition</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__left_motor</span><span class="o">.</span><span class="n">setVelocity</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__right_motor</span><span class="o">.</span><span class="n">setPosition</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__right_motor</span><span class="o">.</span><span class="n">setVelocity</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__target_twist</span> <span class="o">=</span> <span class="n">Twist</span><span class="p">()</span>

    <span class="n">rclpy</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__node</span> <span class="o">=</span> <span class="n">rclpy</span><span class="o">.</span><span class="n">create_node</span><span class="p">(</span><span class="s1">&#39;my_robot_driver&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__node</span><span class="o">.</span><span class="n">create_subscription</span><span class="p">(</span><span class="n">Twist</span><span class="p">,</span> <span class="s1">&#39;cmd_vel&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cmd_vel_callback</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Then comes the implementation of the <code class="docutils literal notranslate"><span class="pre">__cmd_vel_callback(self,</span> <span class="pre">twist)</span></code> callback private method that will be called for each <code class="docutils literal notranslate"><span class="pre">Twist</span></code> message received on the <code class="docutils literal notranslate"><span class="pre">/cmd_vel</span></code> topic and will save it in the <code class="docutils literal notranslate"><span class="pre">self.__target_twist</span></code> member variable. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12591">[待校准&#64;12591]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__cmd_vel_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">twist</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__target_twist</span> <span class="o">=</span> <span class="n">twist</span>
</pre></div>
</div>
<p>Finally, the <code class="docutils literal notranslate"><span class="pre">step(self)</span></code> method is called at every time step of the simulation. The call to <code class="docutils literal notranslate"><span class="pre">rclpy.spin_once()</span></code> is needed to keep the ROS node running smoothly. At each time step, the method will retrieve the desired <code class="docutils literal notranslate"><span class="pre">forward_speed</span></code> and <code class="docutils literal notranslate"><span class="pre">angular_speed</span></code> from <code class="docutils literal notranslate"><span class="pre">self.__target_twist</span></code>. As the motors are controlled with angular velocities, the method will then convert the <code class="docutils literal notranslate"><span class="pre">forward_speed</span></code> and <code class="docutils literal notranslate"><span class="pre">angular_speed</span></code> into individual commands for each wheel. This conversion depends on the structure of the robot, more specifically on the radius of the wheel and the distance between them. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12592">[待校准&#64;12592]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">rclpy</span><span class="o">.</span><span class="n">spin_once</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__node</span><span class="p">,</span> <span class="n">timeout_sec</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">forward_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__target_twist</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span>
    <span class="n">angular_speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__target_twist</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span>

    <span class="n">command_motor_left</span> <span class="o">=</span> <span class="p">(</span><span class="n">forward_speed</span> <span class="o">-</span> <span class="n">angular_speed</span> <span class="o">*</span> <span class="n">HALF_DISTANCE_BETWEEN_WHEELS</span><span class="p">)</span> <span class="o">/</span> <span class="n">WHEEL_RADIUS</span>
    <span class="n">command_motor_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">forward_speed</span> <span class="o">+</span> <span class="n">angular_speed</span> <span class="o">*</span> <span class="n">HALF_DISTANCE_BETWEEN_WHEELS</span><span class="p">)</span> <span class="o">/</span> <span class="n">WHEEL_RADIUS</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__left_motor</span><span class="o">.</span><span class="n">setVelocity</span><span class="p">(</span><span class="n">command_motor_left</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__right_motor</span><span class="o">.</span><span class="n">setVelocity</span><span class="p">(</span><span class="n">command_motor_right</span><span class="p">)</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-2-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-2-Qysr" name="Qysr" role="tabpanel" tabindex="0"><p>Open <code class="docutils literal notranslate"><span class="pre">my_package/src/MyRobotDriver.hpp</span></code> in your favorite editor and replace its contents with the following: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12593">[待校准&#64;12593]</a></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef WEBOTS_ROS2_PLUGIN_EXAMPLE_HPP</span>
<span class="cp">#define WEBOTS_ROS2_PLUGIN_EXAMPLE_HPP</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;rclcpp/macros.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;webots_ros2_driver/PluginInterface.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;webots_ros2_driver/WebotsNode.hpp&quot;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;geometry_msgs/msg/twist.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;rclcpp/rclcpp.hpp&quot;</span><span class="cp"></span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">my_robot_driver</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyRobotDriver</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">webots_ros2_driver</span><span class="o">::</span><span class="n">PluginInterface</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">step</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="n">webots_ros2_driver</span><span class="o">::</span><span class="n">WebotsNode</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">parameters</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span><span class="w"></span>

<span class="k">private</span><span class="o">:</span><span class="w"></span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">cmdVelCallback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">Subscription</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">&gt;::</span><span class="n">SharedPtr</span><span class="w"></span>
<span class="w">      </span><span class="n">cmd_vel_subscription_</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="w"> </span><span class="n">cmd_vel_msg</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">WbDeviceTag</span><span class="w"> </span><span class="n">right_motor</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">WbDeviceTag</span><span class="w"> </span><span class="n">left_motor</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="c1">// namespace my_robot_driver</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>The class <code class="docutils literal notranslate"><span class="pre">MyRobotDriver</span></code> is defined, which inherits from the <code class="docutils literal notranslate"><span class="pre">webots_ros2_driver::PluginInterface</span></code> class. The plugin has to override <code class="docutils literal notranslate"><span class="pre">step(...)</span></code> and <code class="docutils literal notranslate"><span class="pre">init(...)</span></code> functions. More details are given in the <code class="docutils literal notranslate"><span class="pre">MyRobotDriver.cpp</span></code> file. Several helper methods, callbacks and member variables that will be used internally by the plugin are declared privately. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12594">[待校准&#64;12594]</a></p>
<p>Then, open <code class="docutils literal notranslate"><span class="pre">my_package/src/MyRobotDriver.cpp</span></code> in your favorite editor and replace its contents with the following: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12595">[待校准&#64;12595]</a></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;my_package/MyRobotDriver.hpp&quot;</span><span class="cp"></span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;rclcpp/rclcpp.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdio&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;functional&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;webots/motor.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;webots/robot.h&gt;</span><span class="cp"></span>

<span class="cp">#define HALF_DISTANCE_BETWEEN_WHEELS 0.045</span>
<span class="cp">#define WHEEL_RADIUS 0.025</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">my_robot_driver</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">MyRobotDriver::init</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">webots_ros2_driver</span><span class="o">::</span><span class="n">WebotsNode</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">parameters</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="n">right_motor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wb_robot_get_device</span><span class="p">(</span><span class="s">&quot;right wheel motor&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">left_motor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wb_robot_get_device</span><span class="p">(</span><span class="s">&quot;left wheel motor&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="n">wb_motor_set_position</span><span class="p">(</span><span class="n">left_motor</span><span class="p">,</span><span class="w"> </span><span class="n">INFINITY</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">wb_motor_set_velocity</span><span class="p">(</span><span class="n">left_motor</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="n">wb_motor_set_position</span><span class="p">(</span><span class="n">right_motor</span><span class="p">,</span><span class="w"> </span><span class="n">INFINITY</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">wb_motor_set_velocity</span><span class="p">(</span><span class="n">right_motor</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="n">cmd_vel_subscription_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">create_subscription</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;/cmd_vel&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">SensorDataQoS</span><span class="p">().</span><span class="n">reliable</span><span class="p">(),</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MyRobotDriver</span><span class="o">::</span><span class="n">cmdVelCallback</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">));</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">MyRobotDriver::cmdVelCallback</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">cmd_vel_msg</span><span class="p">.</span><span class="n">linear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">linear</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">cmd_vel_msg</span><span class="p">.</span><span class="n">angular</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">angular</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">MyRobotDriver::step</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">forward_speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cmd_vel_msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">angular_speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cmd_vel_msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">command_motor_left</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">forward_speed</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">angular_speed</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">HALF_DISTANCE_BETWEEN_WHEELS</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"></span>
<span class="w">      </span><span class="n">WHEEL_RADIUS</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">command_motor_right</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">forward_speed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">angular_speed</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">HALF_DISTANCE_BETWEEN_WHEELS</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"></span>
<span class="w">      </span><span class="n">WHEEL_RADIUS</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">wb_motor_set_velocity</span><span class="p">(</span><span class="n">left_motor</span><span class="p">,</span><span class="w"> </span><span class="n">command_motor_left</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">wb_motor_set_velocity</span><span class="p">(</span><span class="n">right_motor</span><span class="p">,</span><span class="w"> </span><span class="n">command_motor_right</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"> </span><span class="c1">// namespace my_robot_driver</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;pluginlib/class_list_macros.hpp&quot;</span><span class="cp"></span>
<span class="n">PLUGINLIB_EXPORT_CLASS</span><span class="p">(</span><span class="n">my_robot_driver</span><span class="o">::</span><span class="n">MyRobotDriver</span><span class="p">,</span><span class="w"></span>
<span class="w">                       </span><span class="n">webots_ros2_driver</span><span class="o">::</span><span class="n">PluginInterface</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">MyRobotDriver::init</span></code> method is executed once the plugin is loaded by the <code class="docutils literal notranslate"><span class="pre">webots_ros2_driver</span></code> package. It takes two arguments: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12596">[待校准&#64;12596]</a></p>
<ul class="simple">
<li><p>A pointer to the <code class="docutils literal notranslate"><span class="pre">WebotsNode</span></code> defined by <code class="docutils literal notranslate"><span class="pre">webots_ros2_driver</span></code>, which allows to access the ROS 2 node functions. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12597">[待校准&#64;12597]</a></p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">parameters</span></code> argument is an unordered map of strings, created from the XML tags given in the URDF files (<a class="reference internal" href="#create-the-my-robot-urdf-file"><span class="std std-ref">4 Create the my_robot.urdf file [待校准&#64;12604]</span></a>) and allows to pass parameters to the controller. It is not used in this example. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12598">[待校准&#64;12598]</a></p></li>
</ul>
<p>It initializes the plugin by setting up the robot motors, setting their positions and velocities, and subscribing to the <code class="docutils literal notranslate"><span class="pre">/cmd_vel</span></code> topic. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12599">[待校准&#64;12599]</a></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">MyRobotDriver::init</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">webots_ros2_driver</span><span class="o">::</span><span class="n">WebotsNode</span><span class="w"> </span><span class="o">*</span><span class="n">node</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">parameters</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="n">right_motor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wb_robot_get_device</span><span class="p">(</span><span class="s">&quot;right wheel motor&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">left_motor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wb_robot_get_device</span><span class="p">(</span><span class="s">&quot;left wheel motor&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="n">wb_motor_set_position</span><span class="p">(</span><span class="n">left_motor</span><span class="p">,</span><span class="w"> </span><span class="n">INFINITY</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">wb_motor_set_velocity</span><span class="p">(</span><span class="n">left_motor</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="n">wb_motor_set_position</span><span class="p">(</span><span class="n">right_motor</span><span class="p">,</span><span class="w"> </span><span class="n">INFINITY</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">wb_motor_set_velocity</span><span class="p">(</span><span class="n">right_motor</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="n">cmd_vel_subscription_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">node</span><span class="o">-&gt;</span><span class="n">create_subscription</span><span class="o">&lt;</span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">&gt;</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="s">&quot;/cmd_vel&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">rclcpp</span><span class="o">::</span><span class="n">SensorDataQoS</span><span class="p">().</span><span class="n">reliable</span><span class="p">(),</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MyRobotDriver</span><span class="o">::</span><span class="n">cmdVelCallback</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="o">::</span><span class="n">_1</span><span class="p">));</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Then comes the implementation of the <code class="docutils literal notranslate"><span class="pre">cmdVelCallback()</span></code> callback function that will be called for each Twist message received on the <code class="docutils literal notranslate"><span class="pre">/cmd_vel</span></code> topic and will save it in the <code class="docutils literal notranslate"><span class="pre">cmd_vel_msg</span></code> member variable. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12600">[待校准&#64;12600]</a></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">MyRobotDriver::cmdVelCallback</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Twist</span><span class="o">::</span><span class="n">SharedPtr</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">cmd_vel_msg</span><span class="p">.</span><span class="n">linear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">linear</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">cmd_vel_msg</span><span class="p">.</span><span class="n">angular</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">angular</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">step()</span></code> method is called at every time step of the simulation. At each time step, the method will retrieve the desired <code class="docutils literal notranslate"><span class="pre">forward_speed</span></code> and <code class="docutils literal notranslate"><span class="pre">angular_speed</span></code> from <code class="docutils literal notranslate"><span class="pre">cmd_vel_msg</span></code>. As the motors are controlled with angular velocities, the method will then convert the <code class="docutils literal notranslate"><span class="pre">forward_speed</span></code> and <code class="docutils literal notranslate"><span class="pre">angular_speed</span></code> into individual commands for each wheel. This conversion depends on the structure of the robot, more specifically on the radius of the wheel and the distance between them. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12601">[待校准&#64;12601]</a></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">MyRobotDriver::step</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">forward_speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cmd_vel_msg</span><span class="p">.</span><span class="n">linear</span><span class="p">.</span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">angular_speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cmd_vel_msg</span><span class="p">.</span><span class="n">angular</span><span class="p">.</span><span class="n">z</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">command_motor_left</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">forward_speed</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">angular_speed</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">HALF_DISTANCE_BETWEEN_WHEELS</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"></span>
<span class="w">      </span><span class="n">WHEEL_RADIUS</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">command_motor_right</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="p">(</span><span class="n">forward_speed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">angular_speed</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">HALF_DISTANCE_BETWEEN_WHEELS</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"></span>
<span class="w">      </span><span class="n">WHEEL_RADIUS</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">wb_motor_set_velocity</span><span class="p">(</span><span class="n">left_motor</span><span class="p">,</span><span class="w"> </span><span class="n">command_motor_left</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">wb_motor_set_velocity</span><span class="p">(</span><span class="n">right_motor</span><span class="p">,</span><span class="w"> </span><span class="n">command_motor_right</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The final lines of the file define the end of the <code class="docutils literal notranslate"><span class="pre">my_robot_driver</span></code> namespace and include a macro to export the <code class="docutils literal notranslate"><span class="pre">MyRobotDriver</span></code> class as a plugin using the <code class="docutils literal notranslate"><span class="pre">PLUGINLIB_EXPORT_CLASS</span></code> macro. This allows the plugin to be loaded by the Webots ROS2 driver at runtime. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12602">[待校准&#64;12602]</a></p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;pluginlib/class_list_macros.hpp&quot;</span><span class="cp"></span>
<span class="n">PLUGINLIB_EXPORT_CLASS</span><span class="p">(</span><span class="n">my_robot_driver</span><span class="o">::</span><span class="n">MyRobotDriver</span><span class="p">,</span><span class="w"></span>
<span class="w">                       </span><span class="n">webots_ros2_driver</span><span class="o">::</span><span class="n">PluginInterface</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>While the plugin is implemented in C++, the C API must be used to interact with the Webots controller library. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12603">[待校准&#64;12603]</a></p>
</div>
</div></div>
</div>
<div class="section" id="create-the-my-robot-urdf-file">
<span id="id2"></span><h3>4 Create the <code class="docutils literal notranslate"><span class="pre">my_robot.urdf</span></code> file <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12604">[待校准&#64;12604]</a><a class="headerlink" href="#create-the-my-robot-urdf-file" title="永久链接至标题"></a></h3>
<p>You now have to create a URDF file to declare the <code class="docutils literal notranslate"><span class="pre">MyRobotDriver</span></code> plugin. This will allow the <code class="docutils literal notranslate"><span class="pre">webots_ros2_driver</span></code> ROS node to launch the plugin and connect it to the target robot. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12605">[待校准&#64;12605]</a></p>
<p>In the <code class="docutils literal notranslate"><span class="pre">my_package/resource</span></code> folder create a text file named <code class="docutils literal notranslate"><span class="pre">my_robot.urdf</span></code> with this content: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12606">[待校准&#64;12606]</a></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-3-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-3-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-3-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button></div><div aria-labelledby="tab-3-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-3-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; ?&gt;</span>
<span class="nt">&lt;robot</span> <span class="na">name=</span><span class="s">&quot;My robot&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;webots&gt;</span>
        <span class="nt">&lt;plugin</span> <span class="na">type=</span><span class="s">&quot;my_package.my_robot_driver.MyRobotDriver&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/webots&gt;</span>
<span class="nt">&lt;/robot&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">type</span></code> attribute specifies the path to the class given by the hierarchical structure of files. <code class="docutils literal notranslate"><span class="pre">webots_ros2_driver</span></code> is responsible for loading the class based on the specified package and modules. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12607">[待校准&#64;12607]</a></p>
</div><div aria-labelledby="tab-3-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-3-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; ?&gt;</span>
<span class="nt">&lt;robot</span> <span class="na">name=</span><span class="s">&quot;My robot&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;webots&gt;</span>
        <span class="nt">&lt;plugin</span> <span class="na">type=</span><span class="s">&quot;my_robot_driver::MyRobotDriver&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/webots&gt;</span>
<span class="nt">&lt;/robot&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">type</span></code> attribute specifies the namespace and class name to load. <code class="docutils literal notranslate"><span class="pre">pluginlib</span></code> is responsible for loading the class based on the specified information. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12608">[待校准&#64;12608]</a></p>
</div></div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>This simple URDF file doesn't contain any link or joint information about the robot as it is not needed in this tutorial. However, URDF files usually contain much more information as explained in the <a class="reference internal" href="../../../Intermediate/URDF/URDF-Main.html"><span class="doc">URDF [待校准&#64;14991]</span></a> tutorial. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12609">[待校准&#64;12609]</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>Here the plugin does not take any input parameter, but this can be achieved with a tag containing the parameter name. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12610">[待校准&#64;12610]</a></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-4-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-4-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-4-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button></div><div aria-labelledby="tab-4-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-4-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;plugin</span> <span class="na">type=</span><span class="s">&quot;my_package.my_robot_driver.MyRobotDriver&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parameterName&gt;</span>someValue<span class="nt">&lt;/parameterName&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-4-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-4-Qysr" name="Qysr" role="tabpanel" tabindex="0"><div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;plugin</span> <span class="na">type=</span><span class="s">&quot;my_robot_driver::MyRobotDriver&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parameterName&gt;</span>someValue<span class="nt">&lt;/parameterName&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</pre></div>
</div>
</div></div>
<p>This is namely used to pass parameters to existing Webots device plugins (see <a class="reference internal" href="Setting-Up-Simulation-Webots-Advanced.html"><span class="doc">Setting up a robot simulation (Advanced) [待校准&#64;12524]</span></a>). <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12611">[待校准&#64;12611]</a></p>
</div>
</div>
<div class="section" id="create-the-launch-file">
<h3>5 Create the launch file <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12612">[待校准&#64;12612]</a><a class="headerlink" href="#create-the-launch-file" title="永久链接至标题"></a></h3>
<p>Let's create the launch file to easily launch the simulation and the ROS controller with a single command. In the <code class="docutils literal notranslate"><span class="pre">my_package/launch</span></code> folder create a new text file named <code class="docutils literal notranslate"><span class="pre">robot_launch.py</span></code> with this code: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12613">[待校准&#64;12613]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">launch</span>
<span class="kn">from</span> <span class="nn">launch_ros.actions</span> <span class="kn">import</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="nn">launch</span> <span class="kn">import</span> <span class="n">LaunchDescription</span>
<span class="kn">from</span> <span class="nn">ament_index_python.packages</span> <span class="kn">import</span> <span class="n">get_package_share_directory</span>
<span class="kn">from</span> <span class="nn">webots_ros2_driver.webots_launcher</span> <span class="kn">import</span> <span class="n">WebotsLauncher</span>
<span class="kn">from</span> <span class="nn">webots_ros2_driver.utils</span> <span class="kn">import</span> <span class="n">controller_url_prefix</span>


<span class="k">def</span> <span class="nf">generate_launch_description</span><span class="p">():</span>
    <span class="n">package_dir</span> <span class="o">=</span> <span class="n">get_package_share_directory</span><span class="p">(</span><span class="s1">&#39;my_package&#39;</span><span class="p">)</span>
    <span class="n">robot_description</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">package_dir</span><span class="p">,</span> <span class="s1">&#39;resource&#39;</span><span class="p">,</span> <span class="s1">&#39;my_robot.urdf&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>

    <span class="n">webots</span> <span class="o">=</span> <span class="n">WebotsLauncher</span><span class="p">(</span>
        <span class="n">world</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">package_dir</span><span class="p">,</span> <span class="s1">&#39;worlds&#39;</span><span class="p">,</span> <span class="s1">&#39;my_world.wbt&#39;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">my_robot_driver</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
        <span class="n">package</span><span class="o">=</span><span class="s1">&#39;webots_ros2_driver&#39;</span><span class="p">,</span>
        <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;driver&#39;</span><span class="p">,</span>
        <span class="n">output</span><span class="o">=</span><span class="s1">&#39;screen&#39;</span><span class="p">,</span>
        <span class="n">additional_env</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;WEBOTS_CONTROLLER_URL&#39;</span><span class="p">:</span> <span class="n">controller_url_prefix</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;my_robot&#39;</span><span class="p">},</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;robot_description&#39;</span><span class="p">:</span> <span class="n">robot_description</span><span class="p">},</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">LaunchDescription</span><span class="p">([</span>
        <span class="n">webots</span><span class="p">,</span>
        <span class="n">my_robot_driver</span><span class="p">,</span>
        <span class="n">launch</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">RegisterEventHandler</span><span class="p">(</span>
            <span class="n">event_handler</span><span class="o">=</span><span class="n">launch</span><span class="o">.</span><span class="n">event_handlers</span><span class="o">.</span><span class="n">OnProcessExit</span><span class="p">(</span>
                <span class="n">target_action</span><span class="o">=</span><span class="n">webots</span><span class="p">,</span>
                <span class="n">on_exit</span><span class="o">=</span><span class="p">[</span><span class="n">launch</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">EmitEvent</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">launch</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">Shutdown</span><span class="p">())],</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">])</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">WebotsLauncher</span></code> object is a custom action that allows you to start a Webots simulation instance. You have to specify in the constructor which world file the simulator will open. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12614">[待校准&#64;12614]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">webots</span> <span class="o">=</span> <span class="n">WebotsLauncher</span><span class="p">(</span>
    <span class="n">world</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">package_dir</span><span class="p">,</span> <span class="s1">&#39;worlds&#39;</span><span class="p">,</span> <span class="s1">&#39;my_world.wbt&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Then, the ROS node interacting with the simulated robot is created. This node, named <code class="docutils literal notranslate"><span class="pre">driver</span></code>, is located in the <code class="docutils literal notranslate"><span class="pre">webots_ros2_driver</span></code> package. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12615">[待校准&#64;12615]</a></p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-5-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-5-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-5-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-5-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button><button aria-controls="panel-5-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-5-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button></div><div aria-labelledby="tab-5-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-5-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><p>The node will be able to communicate with the simulated robot by using a custom protocol based on IPC and shared memory. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12616">[待校准&#64;12616]</a></p>
</div><div aria-labelledby="tab-5-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-5-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><p>The node (in WSL) will be able to communicate with the simulated robot (in Webots on native Windows) through a TCP connection. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12617">[待校准&#64;12617]</a></p>
</div><div aria-labelledby="tab-5-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-5-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><p>The node (in the docker container) will be able to communicate with the simulated robot (in Webots on native macOS) through a TCP connection. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12618">[待校准&#64;12618]</a></p>
</div></div>
<p>In your case, you need to run a single instance of this node, because you have a single robot in the simulation. But if you had more robots in the simulation, you would have to run one instance of this node per robot. <code class="docutils literal notranslate"><span class="pre">WEBOTS_CONTROLLER_URL</span></code> is used to define the name of the robot the driver should connect to. The <code class="docutils literal notranslate"><span class="pre">controller_url_prefix()</span></code> method is mandatory, as it allows <code class="docutils literal notranslate"><span class="pre">webots_ros2_driver</span></code> to add the correct protocol prefix depending on your platform. The <code class="docutils literal notranslate"><span class="pre">robot_description</span></code> parameter holds the contents of the URDF file which refers to the <code class="docutils literal notranslate"><span class="pre">MyRobotDriver</span></code> plugin. You can see the <code class="docutils literal notranslate"><span class="pre">driver</span></code> node as the interface that connects your controller plugin to the target robot. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12619">[待校准&#64;12619]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_robot_driver</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span>
    <span class="n">package</span><span class="o">=</span><span class="s1">&#39;webots_ros2_driver&#39;</span><span class="p">,</span>
    <span class="n">executable</span><span class="o">=</span><span class="s1">&#39;driver&#39;</span><span class="p">,</span>
    <span class="n">output</span><span class="o">=</span><span class="s1">&#39;screen&#39;</span><span class="p">,</span>
    <span class="n">additional_env</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;WEBOTS_CONTROLLER_URL&#39;</span><span class="p">:</span> <span class="n">controller_url_prefix</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;my_robot&#39;</span><span class="p">},</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;robot_description&#39;</span><span class="p">:</span> <span class="n">robot_description</span><span class="p">},</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>After that, the two nodes are set to be launched in the <code class="docutils literal notranslate"><span class="pre">LaunchDescription</span></code> constructor: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12620">[待校准&#64;12620]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">LaunchDescription</span><span class="p">([</span>
    <span class="n">webots</span><span class="p">,</span>
    <span class="n">my_robot_driver</span><span class="p">,</span>
</pre></div>
</div>
<p>Finally, an optional part is added in order to shutdown all the nodes once Webots terminates (e.g., when it gets closed from the graphical user interface). <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12621">[待校准&#64;12621]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">launch</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">RegisterEventHandler</span><span class="p">(</span>
    <span class="n">event_handler</span><span class="o">=</span><span class="n">launch</span><span class="o">.</span><span class="n">event_handlers</span><span class="o">.</span><span class="n">OnProcessExit</span><span class="p">(</span>
        <span class="n">target_action</span><span class="o">=</span><span class="n">webots</span><span class="p">,</span>
        <span class="n">on_exit</span><span class="o">=</span><span class="p">[</span><span class="n">launch</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">EmitEvent</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">launch</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">Shutdown</span><span class="p">())],</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>More details on <code class="docutils literal notranslate"><span class="pre">webots_ros2_driver</span></code> and <code class="docutils literal notranslate"><span class="pre">WebotsLauncher</span></code> arguments can be found <a class="reference external" href="https://github.com/cyberbotics/webots_ros2/wiki/References-Nodes">on the nodes reference page</a>. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12622">[待校准&#64;12622]</a></p>
</div>
</div>
<div class="section" id="edit-additional-files">
<h3>6 Edit additional files <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12623">[待校准&#64;12623]</a><a class="headerlink" href="#edit-additional-files" title="永久链接至标题"></a></h3>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-6-UHl0aG9u" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-6-UHl0aG9u" name="UHl0aG9u" role="tab" tabindex="0">Python</button><button aria-controls="panel-6-Qysr" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-6-Qysr" name="Qysr" role="tab" tabindex="-1">C++</button></div><div aria-labelledby="tab-6-UHl0aG9u" class="sphinx-tabs-panel group-tab" id="panel-6-UHl0aG9u" name="UHl0aG9u" role="tabpanel" tabindex="0"><p>Before you can start the launch file, you have to modify the <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file to include the extra files you added. Open <code class="docutils literal notranslate"><span class="pre">my_package/setup.py</span></code> and replace its contents with: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12624">[待校准&#64;12624]</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">package_name</span> <span class="o">=</span> <span class="s1">&#39;my_package&#39;</span>
<span class="n">data_files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">data_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;share/ament_index/resource_index/packages&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;resource/&#39;</span> <span class="o">+</span> <span class="n">package_name</span><span class="p">]))</span>
<span class="n">data_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;share/&#39;</span> <span class="o">+</span> <span class="n">package_name</span> <span class="o">+</span> <span class="s1">&#39;/launch&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;launch/robot_launch.py&#39;</span><span class="p">]))</span>
<span class="n">data_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;share/&#39;</span> <span class="o">+</span> <span class="n">package_name</span> <span class="o">+</span> <span class="s1">&#39;/worlds&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;worlds/my_world.wbt&#39;</span><span class="p">]))</span>
<span class="n">data_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;share/&#39;</span> <span class="o">+</span> <span class="n">package_name</span> <span class="o">+</span> <span class="s1">&#39;/resource&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;resource/my_robot.urdf&#39;</span><span class="p">]))</span>
<span class="n">data_files</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;share/&#39;</span> <span class="o">+</span> <span class="n">package_name</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;package.xml&#39;</span><span class="p">]))</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="n">package_name</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;0.0.0&#39;</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="n">package_name</span><span class="p">],</span>
    <span class="n">data_files</span><span class="o">=</span><span class="n">data_files</span><span class="p">,</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;setuptools&#39;</span><span class="p">],</span>
    <span class="n">zip_safe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">maintainer</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span>
    <span class="n">maintainer_email</span><span class="o">=</span><span class="s1">&#39;user.name@mail.com&#39;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;TODO: Package description&#39;</span><span class="p">,</span>
    <span class="n">license</span><span class="o">=</span><span class="s1">&#39;TODO: License declaration&#39;</span><span class="p">,</span>
    <span class="n">tests_require</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pytest&#39;</span><span class="p">],</span>
    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;console_scripts&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;my_robot_driver = my_package.my_robot_driver:main&#39;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This sets-up the package and adds in the <code class="docutils literal notranslate"><span class="pre">data_files</span></code> variable the newly added files: <code class="docutils literal notranslate"><span class="pre">my_world.wbt</span></code>, <code class="docutils literal notranslate"><span class="pre">my_robot.urdf</span></code> and <code class="docutils literal notranslate"><span class="pre">robot_launch.py</span></code>. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12625">[待校准&#64;12625]</a></p>
</div><div aria-labelledby="tab-6-Qysr" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-6-Qysr" name="Qysr" role="tabpanel" tabindex="0"><p>Before you can start the launch file, you have to modify <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">my_robot_driver.xml</span></code> files: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12626">[待校准&#64;12626]</a></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> defines the compilation rules of your plugin. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12627">[待校准&#64;12627]</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">my_robot_driver.xml</span></code> is necessary for the pluginlib to find your Webots ROS 2 plugin. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12628">[待校准&#64;12628]</a></p></li>
</ul>
<p>Open <code class="docutils literal notranslate"><span class="pre">my_package/my_robot_driver.xml</span></code> and replace its contents with: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12629">[待校准&#64;12629]</a></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;library</span> <span class="na">path=</span><span class="s">&quot;my_package&quot;</span><span class="nt">&gt;</span>
  <span class="cm">&lt;!-- The `type` attribute is a reference to the plugin class. --&gt;</span>
  <span class="cm">&lt;!-- The `base_class_type` attribute is always `webots_ros2_driver::PluginInterface`. --&gt;</span>
  <span class="nt">&lt;class</span> <span class="na">type=</span><span class="s">&quot;my_robot_driver::MyRobotDriver&quot;</span> <span class="na">base_class_type=</span><span class="s">&quot;webots_ros2_driver::PluginInterface&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;description&gt;</span>
      This is a Webots ROS 2 plugin example
    <span class="nt">&lt;/description&gt;</span>
  <span class="nt">&lt;/class&gt;</span>
<span class="nt">&lt;/library&gt;</span>
</pre></div>
</div>
<p>Open <code class="docutils literal notranslate"><span class="pre">my_package/CMakeLists.txt</span></code> and replace its contents with: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12630">[待校准&#64;12630]</a></p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.5</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">my_package</span><span class="p">)</span>

<span class="nb">if</span><span class="p">(</span><span class="s">NOT</span><span class="w"> </span><span class="s">CMAKE_CXX_STANDARD</span><span class="p">)</span>
<span class="w">  </span><span class="nb">set</span><span class="p">(</span><span class="s">CMAKE_CXX_STANDARD</span><span class="w"> </span><span class="s">14</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c"># Besides the package specific dependencies we also need the `pluginlib` and `webots_ros2_driver`</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">ament_cmake</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">rclcpp</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">std_msgs</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">geometry_msgs</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">pluginlib</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">webots_ros2_driver</span><span class="w"> </span><span class="s">REQUIRED</span><span class="p">)</span>

<span class="c"># Export the plugin configuration file</span>
<span class="nb">pluginlib_export_plugin_description_file</span><span class="p">(</span><span class="s">webots_ros2_driver</span><span class="w"> </span><span class="s">my_robot_driver.xml</span><span class="p">)</span>

<span class="c"># MyRobotDriver library</span>
<span class="nb">add_library</span><span class="p">(</span>
<span class="w">  </span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span>
<span class="w">  </span><span class="s">SHARED</span>
<span class="w">  </span><span class="s">src/MyRobotDriver.cpp</span>
<span class="p">)</span>
<span class="nb">target_include_directories</span><span class="p">(</span>
<span class="w">  </span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span>
<span class="w">  </span><span class="s">PRIVATE</span>
<span class="w">  </span><span class="s">include</span>
<span class="p">)</span>
<span class="nb">ament_target_dependencies</span><span class="p">(</span>
<span class="w">  </span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span>
<span class="w">  </span><span class="s">pluginlib</span>
<span class="w">  </span><span class="s">rclcpp</span>
<span class="w">  </span><span class="s">webots_ros2_driver</span>
<span class="p">)</span>
<span class="nb">install</span><span class="p">(</span><span class="s">TARGETS</span>
<span class="w">  </span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span>
<span class="w">  </span><span class="s">ARCHIVE</span><span class="w"> </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">lib</span>
<span class="w">  </span><span class="s">LIBRARY</span><span class="w"> </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">lib</span>
<span class="w">  </span><span class="s">RUNTIME</span><span class="w"> </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">bin</span>
<span class="p">)</span>
<span class="c"># Install additional directories.</span>
<span class="nb">install</span><span class="p">(</span><span class="s">DIRECTORY</span>
<span class="w">  </span><span class="s">launch</span>
<span class="w">  </span><span class="s">resource</span>
<span class="w">  </span><span class="s">worlds</span>
<span class="w">  </span><span class="s">DESTINATION</span><span class="w"> </span><span class="s">share/</span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span><span class="s">/</span>
<span class="p">)</span>
<span class="nb">ament_export_include_directories</span><span class="p">(</span>
<span class="w">  </span><span class="s">include</span>
<span class="p">)</span>
<span class="nb">ament_export_libraries</span><span class="p">(</span>
<span class="w">  </span><span class="o">${</span><span class="nv">PROJECT_NAME</span><span class="o">}</span>
<span class="p">)</span>
<span class="nb">ament_package</span><span class="p">()</span>
</pre></div>
</div>
<p>The CMakeLists.txt exports the plugin configuration file with the <code class="docutils literal notranslate"><span class="pre">pluginlib_export_plugin_description_file()</span></code>, defines a shared library of the C++ plugin <code class="docutils literal notranslate"><span class="pre">src/MyRobotDriver.cpp</span></code>, and sets the include and library dependencies using <code class="docutils literal notranslate"><span class="pre">ament_target_dependencies()</span></code>. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12631">[待校准&#64;12631]</a></p>
<p>The file then installs the library, the directories <code class="docutils literal notranslate"><span class="pre">launch</span></code>, <code class="docutils literal notranslate"><span class="pre">resource</span></code>, and <code class="docutils literal notranslate"><span class="pre">worlds</span></code> to the <code class="docutils literal notranslate"><span class="pre">share/my_package</span></code> directory. Finally, it exports the include directories and libraries using <code class="docutils literal notranslate"><span class="pre">ament_export_include_directories()</span></code> and <code class="docutils literal notranslate"><span class="pre">ament_export_libraries()</span></code>, respectively, and declares the package using <code class="docutils literal notranslate"><span class="pre">ament_package()</span></code>. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12632">[待校准&#64;12632]</a></p>
</div></div>
</div>
<div class="section" id="test-the-code">
<h3>7 Test the code <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12633">[待校准&#64;12633]</a><a class="headerlink" href="#test-the-code" title="永久链接至标题"></a></h3>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-7-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-7-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-7-V2luZG93cw==" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-7-V2luZG93cw==" name="V2luZG93cw==" role="tab" tabindex="-1">Windows</button><button aria-controls="panel-7-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-7-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button></div><div aria-labelledby="tab-7-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-7-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><p>From a terminal in your ROS 2 workspace run: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12550">[待校准&#64;12550]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">colcon build</span>
<span class="go">source install/local_setup.bash</span>
<span class="go">ros2 launch my_package robot_launch.py</span>
</pre></div>
</div>
<p>This will launch the simulation. Webots will be automatically installed on the first run in case it was not already installed. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12634">[待校准&#64;12634]</a></p>
</div><div aria-labelledby="tab-7-V2luZG93cw==" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-7-V2luZG93cw==" name="V2luZG93cw==" role="tabpanel" tabindex="0"><p>From a terminal in your WSL ROS 2 workspace run: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12551">[待校准&#64;12551]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">colcon build</span>
<span class="go">export WEBOTS_HOME=/mnt/c/Program\ Files/Webots</span>
<span class="go">source install/local_setup.bash</span>
<span class="go">ros2 launch my_package robot_launch.py</span>
</pre></div>
</div>
<p>Be sure to use the <code class="docutils literal notranslate"><span class="pre">/mnt</span></code> prefix in front of your path to the Webots installation folder to access the Windows file system from WSL. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12552">[待校准&#64;12552]</a></p>
<p>This will launch the simulation. Webots will be automatically installed on the first run in case it was not already installed. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12634">[待校准&#64;12634]</a></p>
</div><div aria-labelledby="tab-7-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-7-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><p>On macOS, a local server must be started on the host to start Webots from the VM. The local server can be downloaded <a class="reference external" href="https://github.com/cyberbotics/webots-server/blob/main/local_simulation_server.py">on the webots-server repository</a>. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12635">[待校准&#64;12635]</a></p>
<p>In a terminal of the host machine (not in the VM), specify the Webots installation folder (e.g. <code class="docutils literal notranslate"><span class="pre">/Applications/Webots.app</span></code>) and start the server using the following commands: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12636">[待校准&#64;12636]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export WEBOTS_HOME=/Applications/Webots.app</span>
<span class="go">python3 local_simulation_server.py</span>
</pre></div>
</div>
<p>From a terminal in the Linux VM in your ROS 2 workspace, build and launch your custom package with: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12637">[待校准&#64;12637]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">colcon build</span>
<span class="go">source install/local_setup.bash</span>
<span class="go">ros2 launch my_package robot_launch.py</span>
</pre></div>
</div>
</div></div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>If you want to install Webots manually, you can download it <a class="reference external" href="https://github.com/cyberbotics/webots/releases/latest">here</a>. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12638">[待校准&#64;12638]</a></p>
</div>
<p>Then, open a second terminal and send a command with: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12639">[待校准&#64;12639]</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 topic pub /cmd_vel geometry_msgs/Twist  &quot;linear: { x: 0.1 }&quot;</span>
</pre></div>
</div>
<p>The robot is now moving forward. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12640">[待校准&#64;12640]</a></p>
<img alt="../../../../_images/Robot_moving_forward.png" src="../../../../_images/Robot_moving_forward.png" />
<p>At this point, the robot is able to blindly follow your motor commands. But it will eventually bump into the wall as you order it to move forwards. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12641">[待校准&#64;12641]</a></p>
<img alt="../../../../_images/Robot_colliding_wall.png" src="../../../../_images/Robot_colliding_wall.png" />
<p>Close the Webots window, this should also shutdown your ROS nodes started from the launcher. Close also the topic command with <code class="docutils literal notranslate"><span class="pre">Ctrl+C</span></code> in the second terminal. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12642">[待校准&#64;12642]</a></p>
</div>
</div>
<div class="section" id="summary">
<h2>Summary <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12113">[待校准&#64;12113]</a><a class="headerlink" href="#summary" title="永久链接至标题"></a></h2>
<p>In this tutorial, you set-up a realistic robot simulation with Webots and implemented a custom plugin to control the motors of the robot. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12643">[待校准&#64;12643]</a></p>
</div>
<div class="section" id="next-steps">
<h2>Next steps <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12557">[待校准&#64;12557]</a><a class="headerlink" href="#next-steps" title="永久链接至标题"></a></h2>
<p>To improve the simulation, the robot's sensors can be used to detect obstacles and avoid them. The second part of the tutorial shows how to implement such behaviour: <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12644">[待校准&#64;12644]</a></p>
<ul class="simple">
<li><p><a class="reference internal" href="Setting-Up-Simulation-Webots-Advanced.html"><span class="doc">Setting up a robot simulation (Advanced) [待校准&#64;12524]</span></a>. <a class="reference external" href="http://dev.ros2.fishros.com/calibpage/#/home?msgid=12645">[待校准&#64;12645]</a></p></li>
</ul>
</div>
</div>



           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Installation-MacOS.html" class="btn btn-neutral float-left" title="Installation (macOS) [待校准@12421]" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="Setting-Up-Simulation-Webots-Advanced.html" class="btn btn-neutral float-right" title="Setting up a robot simulation (Advanced) [待校准@12524]" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2023, Open Robotics.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a>开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EVD5Z6G6NH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-EVD5Z6G6NH', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>