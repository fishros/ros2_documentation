<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutorials/Advanced/Simulators/Webots/Installation-Windows</title>
</head>
<body>
  <div class="section" id="installation-windows">
<h1>安装（Windows）<a class="headerlink" href="#installation-windows" title="永久链接至标题"></a></h1>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>目标：<a href="#id3"><span class="problematic" id="id4">**</span></a>在Windows上安装``webots_ros2``包并运行仿真示例。</p>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>教程级别：<a href="#id3"><span class="problematic" id="id4">**</span></a>高级</p>
<p><strong>时间:</strong> 10分钟</p>
<div class="contents local topic" id="contents">
<p class="topic-title">内容</p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id1">背景</a></p></li>
<li><p><a class="reference internal" href="#prerequisites" id="id2">先决条件</a></p>
<ul>
<li><p><a class="reference internal" href="#multiple-installations-of-webots" id="id3">Webots的多个安装</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tasks" id="id4">任务</a></p>
<ul>
<li><p><a class="reference internal" href="#install-wsl2" id="id5">1 安装WSL2</a></p></li>
<li><p><a class="reference internal" href="#install-ros-2-in-wsl" id="id6">2 在WSL中安装ROS 2</a></p></li>
<li><p><a class="reference internal" href="#install-webots-ros2" id="id7">3 安装``webots_ros2``</a></p></li>
<li><p><a class="reference internal" href="#launch-the-webots-ros2-universal-robot-example" id="id8">4 启动``webots_ros2_universal_robot``示例。</a></p></li>
<li><p><a class="reference internal" href="#rviz-troubleshooting" id="id9">5 RViz故障排除</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="background">
<h2><a class="toc-backref" href="#id1">背景</a><a class="headerlink" href="#background" title="永久链接至标题"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">webots_ros2``包提供了ROS</span> <span class="pre">2和Webots之间的接口。它包括多个子包，其中包括``webots_ros2_driver</span></code>，它允许ROS节点与Webots进行通信。其他子包主要是示例，展示了使用该接口的多种可能实现。在本教程中，您将安装该包并学习如何运行其中一个示例。</p>
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id2">先决条件</a><a class="headerlink" href="#prerequisites" title="永久链接至标题"></a></h2>
<p>建议您先了解入门级ROS原理，详情请参阅初学者 <a class="reference internal" href="../../../../Tutorials.html"><span class="doc">教程</span></a>。特别是 <a class="reference internal" href="../../../Beginner-Client-Libraries/Creating-A-Workspace/Creating-A-Workspace.html"><span class="doc">创建一个工作空间</span></a> 和 <a class="reference internal" href="../../../Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html"><span class="doc">创建软件包</span></a> 是有用的先决条件。</p>
<p>使用``webots_ros2``包需要先安装Webots。您可以按照`安装过程 &lt;<a class="reference external" href="https://cyberbotics.com/doc/guide/installation-procedure">https://cyberbotics.com/doc/guide/installation-procedure</a>&gt;`_ 进行安装，或者从源代码构建（<a class="reference external" href="https://github.com/cyberbotics/webots/wiki/Windows-installation/">从源代码构建</a>）。</p>
<p>另外，您也可以让``webots_ros2``自动下载Webots。当您启动包中的示例并且没有找到Webots安装时，将会出现此选项。</p>
<div class="section" id="multiple-installations-of-webots">
<h3><a class="toc-backref" href="#id3">Webots的多个安装</a><a class="headerlink" href="#multiple-installations-of-webots" title="永久链接至标题"></a></h3>
<p>如果您安装了多个版本的Webots，ROS 2将按照以下顺序查找Webots所在位置：</p>
<ol class="arabic simple">
<li><p>如果设置了``ROS2_WEBOTS_HOME``环境变量，ROS 2将使用此文件夹中的Webots，而不考虑其版本。</p></li>
<li><p>如果设置了``WEBOTS_HOME``环境变量，ROS 2将使用该文件夹中的Webots，而不管其版本如何。</p></li>
<li><p>如果前述方法均未设置或安装，ROS 2将在兼容版本的默认安装路径``C:Program FilesWebots``中查找Webots。</p></li>
<li><p>如果找不到Webots，<code class="docutils literal notranslate"><span class="pre">webots_ros2</span></code> 将显示一个窗口，并提供最后一个兼容版本的Webots自动安装。</p></li>
</ol>
</div>
</div>
<div class="section" id="tasks">
<h2><a class="toc-backref" href="#id4">任务</a><a class="headerlink" href="#tasks" title="永久链接至标题"></a></h2>
<div class="section" id="install-wsl2">
<h3><a class="toc-backref" href="#id5">1 安装WSL2</a><a class="headerlink" href="#install-wsl2" title="永久链接至标题"></a></h3>
<p>在Windows上，使用WSL（Windows子系统Linux）与本机Windows安装相比，可以提升ROS 2的用户体验，因为它在Linux平台上运行。使用与您的ROS发行版兼容的Ubuntu版本安装WSL，并按照`官方Microsoft教程 &lt;<a class="reference external" href="https://learn.microsoft.com/en-us/windows/wsl/install">https://learn.microsoft.com/en-us/windows/wsl/install</a>&gt;`_ 升级到WSL2。</p>
</div>
<div class="section" id="install-ros-2-in-wsl">
<h3><a class="toc-backref" href="#id6">2 在WSL中安装ROS 2</a><a class="headerlink" href="#install-ros-2-in-wsl" title="永久链接至标题"></a></h3>
<p>在Ubuntu WSL中安装ROS 2，按照 <a class="reference internal" href="../../../../Installation/Ubuntu-Install-Debians.html"><span class="doc">Ubuntu（Debian）</span></a> 进行操作。</p>
</div>
<div class="section" id="install-webots-ros2">
<h3><a class="toc-backref" href="#id7">3 安装``webots_ros2``</a><a class="headerlink" href="#install-webots-ros2" title="永久链接至标题"></a></h3>
<p>您可以选择从官方发布的软件包中安装 <code class="docutils literal notranslate"><span class="pre">webots_ros2</span></code>，或者从 <a class="reference external" href="https://github.com/cyberbotics/webots_ros2">Github</a> 的最新源代码中安装。</p>
<p>以下命令必须在WSL环境中运行。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZGlzdHJpYnV0ZWQgcGFja2FnZQ==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZGlzdHJpYnV0ZWQgcGFja2FnZQ==" name="SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZGlzdHJpYnV0ZWQgcGFja2FnZQ==" role="tab" tabindex="0">Install <code class="docutils literal notranslate"><span class="pre">webots_ros2</span></code> distributed package</button><button aria-controls="panel-0-SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZnJvbSBzb3VyY2Vz" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZnJvbSBzb3VyY2Vz" name="SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZnJvbSBzb3VyY2Vz" role="tab" tabindex="-1">Install <code class="docutils literal notranslate"><span class="pre">webots_ros2</span></code> from sources</button></div><div aria-labelledby="tab-0-SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZGlzdHJpYnV0ZWQgcGFja2FnZQ==" class="sphinx-tabs-panel group-tab" id="panel-0-SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZGlzdHJpYnV0ZWQgcGFja2FnZQ==" name="SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZGlzdHJpYnV0ZWQgcGFja2FnZQ==" role="tabpanel" tabindex="0"><p>在终端中运行以下命令。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt-get install ros-humble-webots-ros2</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZnJvbSBzb3VyY2Vz" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZnJvbSBzb3VyY2Vz" name="SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZnJvbSBzb3VyY2Vz" role="tabpanel" tabindex="0"><p>创建一个带有``src``目录的ROS 2工作空间。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir -p ~/ros2_ws/src</span>
</pre></div>
</div>
<p>源化ROS 2环境。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">source /opt/ros/humble/setup.bash</span>
</pre></div>
</div>
<p>从Github获取源代码。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~/ros2_ws</span>
<span class="go">git clone --recurse-submodules https://github.com/cyberbotics/webots_ros2.git src/webots_ros2</span>
</pre></div>
</div>
<p>安装软件包依赖项。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install python3-pip python3-rosdep python3-colcon-common-extensions</span>
<span class="go">sudo rosdep init &amp;&amp; rosdep update</span>
<span class="go">rosdep install --from-paths src --ignore-src --rosdistro humble</span>
</pre></div>
</div>
<p>使用``colcon``构建软件包。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">colcon build</span>
</pre></div>
</div>
<p>在此工作空间中进行源代码配置。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">source install/local_setup.bash</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="launch-the-webots-ros2-universal-robot-example">
<h3><a class="toc-backref" href="#id8">4 启动``webots_ros2_universal_robot``示例。</a><a class="headerlink" href="#launch-the-webots-ros2-universal-robot-example" title="永久链接至标题"></a></h3>
<p>WSL暂时不支持硬件加速。因此，在WSL内部运行ROS部分时，Webots应该在Windows上启动。为此，必须在WSL环境中运行以下命令。</p>
<p>如果尚未完成，请先启动ROS 2环境。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">source /opt/ros/humble/setup.bash</span>
</pre></div>
</div>
<p>设置``WEBOTS_HOME``环境变量可以让您启动特定的Webots安装（例如``C:Program FilesWebots``）。使用挂载点&quot;/mnt&quot;来引用本机Windows上的路径。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export WEBOTS_HOME=/mnt/c/Program\ Files/Webots</span>
</pre></div>
</div>
<p>如果是从源代码安装的，请先启动ROS 2工作区。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~/ros2_ws</span>
<span class="go">source install/local_setup.bash</span>
</pre></div>
</div>
<p>使用ROS 2启动命令来启动演示包（例如``webots_ros2_universal_robot``）。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 launch webots_ros2_universal_robot multirobot_launch.py</span>
</pre></div>
</div>
</div>
<div class="section" id="rviz-troubleshooting">
<h3><a class="toc-backref" href="#id9">5 RViz故障排除</a><a class="headerlink" href="#rviz-troubleshooting" title="永久链接至标题"></a></h3>
<p>在最新版本的WSL2上，RViz应该可以直接使用。</p>
<p>您可以通过运行任何使用RViz的示例来检查它是否正常工作，例如：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install ros-humble-slam-toolbox</span>
<span class="go">ros2 launch webots_ros2_tiago robot_launch.py rviz:=true slam:=true</span>
</pre></div>
</div>
<p>使用 Tiago 机器人可以进行以下控制操作：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 run teleop_twist_keyboard teleop_twist_keyboard</span>
</pre></div>
</div>
<p>在较旧的 WSL 版本中，RViz2 可能无法直接工作，因为没有可用的显示。要使用 RViz，您可以升级 WSL 或启用 X11 转发。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-VXBncmFkZSBXU0w=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-VXBncmFkZSBXU0w=" name="VXBncmFkZSBXU0w=" role="tab" tabindex="0">Upgrade WSL</button><button aria-controls="panel-1-RW5hYmxlIFgxMSBmb3J3YXJkaW5n" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-RW5hYmxlIFgxMSBmb3J3YXJkaW5n" name="RW5hYmxlIFgxMSBmb3J3YXJkaW5n" role="tab" tabindex="-1">Enable X11 forwarding</button></div><div aria-labelledby="tab-1-VXBncmFkZSBXU0w=" class="sphinx-tabs-panel group-tab" id="panel-1-VXBncmFkZSBXU0w=" name="VXBncmFkZSBXU0w=" role="tabpanel" tabindex="0"><p>在 Windows shell 中：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wsl --update</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-RW5hYmxlIFgxMSBmb3J3YXJkaW5n" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-RW5hYmxlIFgxMSBmb3J3YXJkaW5n" name="RW5hYmxlIFgxMSBmb3J3YXJkaW5n" role="tabpanel" tabindex="0"><p>对于旧版本的 WSL，可以按照以下步骤进行：</p>
<ol class="arabic">
<li><p>安装 <a class="reference external" href="https://sourceforge.net/projects/vcxsrv/">VcXsrv</a>。</p></li>
<li><p>启动 VcXsrv。你可以保留大多数参数的默认值，只需在``Extra settings``页面中设置``Clipboard``、<code class="docutils literal notranslate"><span class="pre">Primary</span> <span class="pre">Selection``和``Disable</span> <span class="pre">access</span> <span class="pre">control</span></code>，并取消设置``Native opengl``。</p></li>
<li><p>你可以保存配置以供将来使用。</p></li>
<li><p>点击 <code class="docutils literal notranslate"><span class="pre">Finish</span></code>，你将看到 X11 服务器在图标托盘中运行。</p></li>
<li><p>在你的 WSL 环境中，导出 <code class="docutils literal notranslate"><span class="pre">DISPLAY</span></code> 变量。</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export DISPLAY=$(ip route list default | awk &#39;{print }&#39;):0</span>
</pre></div>
</div>
<p>你可以将这个添加到你的 <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> 文件中，这样它就会被设置在每个将来的 WSL 环境中。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">echo &quot;export DISPLAY=$(ip route list default | awk &#39;{print }&#39;):0&quot; &gt;&gt; ~/.bashrc</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div></div>
</div>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>