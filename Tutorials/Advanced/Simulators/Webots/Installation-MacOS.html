<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutorials/Advanced/Simulators/Webots/Installation-MacOS</title>
</head>
<body>
  <div class="section" id="installation-macos">
<h1>安装（macOS）<a class="headerlink" href="#installation-macos" title="永久链接至标题"></a></h1>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>目标：<a href="#id3"><span class="problematic" id="id4">**</span></a>在macOS上安装``webots_ros2``包并运行仿真示例。</p>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>教程级别：<a href="#id3"><span class="problematic" id="id4">**</span></a>高级</p>
<p><strong>时间:</strong> 10分钟</p>
<div class="contents local topic" id="contents">
<p class="topic-title">内容</p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id1">背景</a></p></li>
<li><p><a class="reference internal" href="#prerequisites" id="id2">先决条件</a></p></li>
<li><p><a class="reference internal" href="#tasks" id="id3">任务</a></p>
<ul>
<li><p><a class="reference internal" href="#create-the-vm-image" id="id4">1 创建虚拟机镜像</a></p></li>
<li><p><a class="reference internal" href="#configure-the-vm" id="id5">2 配置虚拟机</a></p></li>
<li><p><a class="reference internal" href="#install-webots-ros2" id="id6">3 安装``webots_ros2``</a></p></li>
<li><p><a class="reference internal" href="#launch-the-webots-ros2-universal-robot-example" id="id7">4 启动``webots_ros2_universal_robot``示例。</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#pre-configured-images" id="id8">预配置的图像</a></p></li>
</ul>
</div>
<div class="section" id="background">
<h2><a class="toc-backref" href="#id1">背景</a><a class="headerlink" href="#background" title="永久链接至标题"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">webots_ros2``软件包提供了ROS</span> <span class="pre">2和Webots之间的接口。它包括多个子软件包，其中包括``webots_ros2_driver</span></code>，它允许您启动Webots并与其通信。其他子软件包主要是示例，展示了使用该接口的多种可能实现。在本教程中，您将安装该软件包并学习如何运行其中的一个示例。</p>
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id2">先决条件</a><a class="headerlink" href="#prerequisites" title="永久链接至标题"></a></h2>
<p>建议您先了解入门级ROS原理，详情请参阅初学者 <a class="reference internal" href="../../../../Tutorials.html"><span class="doc">教程</span></a>。特别是 <a class="reference internal" href="../../../Beginner-Client-Libraries/Creating-A-Workspace/Creating-A-Workspace.html"><span class="doc">创建一个工作空间</span></a> 和 <a class="reference internal" href="../../../Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html"><span class="doc">创建软件包</span></a> 是有用的先决条件。</p>
<p>为了在虚拟机中使用``webots_ros2``软件包，您需要在Mac上原生安装Webots，具体步骤如下所述。您可以按照`安装过程 &lt;<a class="reference external" href="https://cyberbotics.com/doc/guide/installation-procedure">https://cyberbotics.com/doc/guide/installation-procedure</a>&gt;`_ 进行操作，或者从源代码构建Webots &lt;<a class="reference external" href="https://github.com/cyberbotics/webots/wiki/macOS-installation/">https://github.com/cyberbotics/webots/wiki/macOS-installation/</a>&gt;。</p>
</div>
<div class="section" id="tasks">
<h2><a class="toc-backref" href="#id3">任务</a><a class="headerlink" href="#tasks" title="永久链接至标题"></a></h2>
<p>在macOS上，基于UTM虚拟机的解决方案可以提供比原生macOS安装更好的ROS 2用户体验，因为它在Linux环境中运行ROS。但是，Webots应该在macOS上进行原生安装，并且能够与运行在虚拟机中的ROS节点进行通信。该解决方案允许Webots进行本机的3D硬件加速。虚拟机运行所有ROS部分（包括RViz），通过TCP连接到主机以启动Webots。共享文件夹允许脚本将世界文件和其他资源文件从虚拟机传输到运行Webots的macOS上。</p>
<p>下面的步骤说明了如何使用安装了 <code class="docutils literal notranslate"><span class="pre">webots_ros2</span></code> 发布软件包的方式创建虚拟机镜像。您也可以从源代码进行安装。在 <a class="reference internal" href="#preconfigured-images"><span class="std std-ref">预配置的图像</span></a> 部分，您可以找到已经配置好的Webots每个版本（从R2023a开始）的镜像下载。</p>
<div class="section" id="create-the-vm-image">
<h3><a class="toc-backref" href="#id4">1 创建虚拟机镜像</a><a class="headerlink" href="#create-the-vm-image" title="永久链接至标题"></a></h3>
<p>在您的 macOS 机器上安装 UTM。链接可以在 <a class="reference external" href="https://mac.getutm.app/">official UTM website</a> 上找到。</p>
<p>下载 <a class="reference external" href="https://cdimage.ubuntu.com/jammy/daily-live/current/">Ubuntu 22.04</a> 的 .iso 镜像文件，用于 Humble 和 Rolling 版本，或者下载 <a class="reference external" href="https://cdimage.ubuntu.com/focal/daily-live/pending/">Ubuntu 20.04</a> 的镜像文件，用于 Foxy 版本。请确保下载与您的 CPU 架构相对应的镜像文件。</p>
<p>在UTM软件中：</p>
<ul class="simple">
<li><p>创建一个新的镜像，并选择“虚拟化”选项。</p></li>
<li><p>在“启动ISO镜像”字段中选择你已下载的ISO镜像。</p></li>
<li><p>将所有硬件设置保持默认（包括禁用硬件加速）。</p></li>
<li><p>在``Shared Directory``窗口中，选择一个文件夹，用于``webots_ros2``将所有Webots资源传输到主机。在此示例中，选择的文件夹为``/Users/username/shared``。</p></li>
<li><p>将所有其余参数保持默认。</p></li>
<li><p>启动虚拟机。请注意，每次启动虚拟机时，都可以选择另一个共享文件夹。</p></li>
<li><p>在首次启动虚拟机时，安装Ubuntu并选择一个帐户的用户名。在此示例中，用户名为``ubuntu``。</p></li>
<li><p>安装完Ubuntu后，关闭虚拟机，将iso镜像从CD/DVD字段中移除，并重新启动虚拟机。</p></li>
</ul>
</div>
<div class="section" id="configure-the-vm">
<h3><a class="toc-backref" href="#id5">2 配置虚拟机</a><a class="headerlink" href="#configure-the-vm" title="永久链接至标题"></a></h3>
<p>在本节中，将在虚拟机中安装ROS 2，并配置共享文件夹。以下指令和命令都在虚拟机内运行。</p>
<ul>
<li><p>在启动的虚拟机中打开终端，并按照 <a class="reference internal" href="../../../../Installation/Ubuntu-Install-Debians.html"><span class="doc">Ubuntu（Debian）</span></a> 中的说明安装所需的ROS 2版本。</p></li>
<li><p>在虚拟机中创建一个文件夹，用作共享文件夹。在本示例中，虚拟机中的共享文件夹为``/home/ubuntu/shared``。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir /home/ubuntu/shared</span>
</pre></div>
</div>
</li>
<li><p>要将此文件夹挂载到主机上，请执行以下命令。如果在您的情况下共享文件夹的路径不同，请不要忘记进行修改。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo mount -t 9p -o trans=virtio share /home/ubuntu/shared -oversion=9p2000.L</span>
</pre></div>
</div>
</li>
<li><p>要在启动虚拟机时自动将此文件夹挂载到主机上，请将以下行添加到``/etc/fstab``中。如果在您的情况下共享文件夹的路径不同，请不要忘记进行修改。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">share     /home/ubuntu/shared     9p      trans=virtio,version=9p2000.L,rw,_netdev,nofail 0       0</span>
</pre></div>
</div>
</li>
<li><p>环境变量``WEBOTS_SHARED_FOLDER``必须始终设置，以便使该包在虚拟机中正常工作。此变量指定用于在主机和虚拟机（VM）之间交换数据的共享文件夹的位置，以供``webots_ros2``包使用。此变量的值应采用``&lt;主机共享文件夹&gt;:&lt;VM共享文件夹&gt;``的格式，其中``&lt;主机共享文件夹&gt;``是主机上共享文件夹的路径，<a href="#id1"><span class="problematic" id="id2">``</span></a>&lt;VM共享文件夹&gt;``是虚拟机上相同共享文件夹的路径。</p>
<p>在这个例子中:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export WEBOTS_SHARED_FOLDER=/Users/username/shared:/home/ubuntu/shared</span>
</pre></div>
</div>
<p>你可以将这个命令行添加到``~/.bashrc``文件中，这样在启动新终端时会自动设置这个环境变量。</p>
</li>
</ul>
</div>
<div class="section" id="install-webots-ros2">
<h3><a class="toc-backref" href="#id6">3 安装``webots_ros2``</a><a class="headerlink" href="#install-webots-ros2" title="永久链接至标题"></a></h3>
<p>你可以选择从官方发布的包中安装``webots_ros2``，或者从最新的`Github &lt;<a class="reference external" href="https://github.com/cyberbotics/webots_ros2">https://github.com/cyberbotics/webots_ros2</a>&gt;`_源代码中安装。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZGlzdHJpYnV0ZWQgcGFja2FnZQ==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZGlzdHJpYnV0ZWQgcGFja2FnZQ==" name="SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZGlzdHJpYnV0ZWQgcGFja2FnZQ==" role="tab" tabindex="0">Install <code class="docutils literal notranslate"><span class="pre">webots_ros2</span></code> distributed package</button><button aria-controls="panel-0-SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZnJvbSBzb3VyY2Vz" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZnJvbSBzb3VyY2Vz" name="SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZnJvbSBzb3VyY2Vz" role="tab" tabindex="-1">Install <code class="docutils literal notranslate"><span class="pre">webots_ros2</span></code> from sources</button></div><div aria-labelledby="tab-0-SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZGlzdHJpYnV0ZWQgcGFja2FnZQ==" class="sphinx-tabs-panel group-tab" id="panel-0-SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZGlzdHJpYnV0ZWQgcGFja2FnZQ==" name="SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZGlzdHJpYnV0ZWQgcGFja2FnZQ==" role="tabpanel" tabindex="0"><p>在虚拟机终端中运行以下命令。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt-get install ros-humble-webots-ros2</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-0-SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZnJvbSBzb3VyY2Vz" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZnJvbSBzb3VyY2Vz" name="SW5zdGFsbCBgYHdlYm90c19yb3MyYGAgZnJvbSBzb3VyY2Vz" role="tabpanel" tabindex="0"><p>安装 Git。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt-get install git</span>
</pre></div>
</div>
<p>创建一个带有``src``目录的ROS 2工作空间。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir -p ~/ros2_ws/src</span>
</pre></div>
</div>
<p>源化ROS 2环境。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">source /opt/ros/humble/setup.bash</span>
</pre></div>
</div>
<p>从Github获取源代码。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~/ros2_ws</span>
<span class="go">git clone --recurse-submodules https://github.com/cyberbotics/webots_ros2.git src/webots_ros2</span>
</pre></div>
</div>
<p>安装软件包依赖项。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt install python3-pip python3-rosdep python3-colcon-common-extensions</span>
<span class="go">sudo rosdep init &amp;&amp; rosdep update</span>
<span class="go">rosdep install --from-paths src --ignore-src --rosdistro humble</span>
</pre></div>
</div>
<p>使用``colcon``构建软件包。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">colcon build</span>
</pre></div>
</div>
<p>在此工作空间中进行源代码配置。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">source install/local_setup.bash</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="launch-the-webots-ros2-universal-robot-example">
<h3><a class="toc-backref" href="#id7">4 启动``webots_ros2_universal_robot``示例。</a><a class="headerlink" href="#launch-the-webots-ros2-universal-robot-example" title="永久链接至标题"></a></h3>
<p>如前面的部分所述，该软件包使用共享文件夹从虚拟机与主机之间进行Webots通信。为了能够从虚拟机的ROS软件包启动主机上的Webots，必须运行本地TCP仿真服务器。</p>
<p>服务器可以从这里下载：<a class="reference external" href="https://github.com/cyberbotics/webots-server/blob/main/local_simulation_server.py">local_simulation_server.py</a>。在``WEBOTS_HOME``环境变量中指定Webots安装文件夹（例如``/Applications/Webots.app``），然后在主机上的新终端中使用以下命令运行服务器（不要在虚拟机中运行）：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export WEBOTS_HOME=/Applications/Webots.app</span>
<span class="go">python3 local_simulation_server.py</span>
</pre></div>
</div>
<p>在虚拟机中打开终端并执行以下命令启动软件包：</p>
<p>如果尚未完成，请先启动ROS 2环境。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">source /opt/ros/humble/setup.bash</span>
</pre></div>
</div>
<p>如果是从源代码安装的，请先启动ROS 2工作区。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ~/ros2_ws</span>
<span class="go">source install/local_setup.bash</span>
</pre></div>
</div>
<p>如果尚未在``~/.bashrc``中设置，请设置``WEBOTS_SHARED_FOLDER``（有关详细信息，请参见前面的部分）。请确保根据您各自目录的位置更改路径。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export WEBOTS_SHARED_FOLDER=/Users/username/shared:/home/ubuntu/shared</span>
</pre></div>
</div>
<p>使用ROS 2启动命令来启动演示包（例如``webots_ros2_universal_robot``）。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 launch webots_ros2_universal_robot multirobot_launch.py</span>
</pre></div>
</div>
<p>如果Webots关闭或ROS 2进程中断，本地服务器将自动等待新的包启动，并清理共享文件夹以供下一次运行使用。</p>
</div>
</div>
<div class="section" id="pre-configured-images">
<span id="preconfigured-images"></span><h2><a class="toc-backref" href="#id8">预配置的图像</a><a class="headerlink" href="#pre-configured-images" title="永久链接至标题"></a></h2>
<p>如果您不想从头开始设置虚拟机，以下链接提供了预配置的UTM镜像，适用于每个版本的Webots。<a href="#id1"><span class="problematic" id="id2">``</span></a>webots_ros2``版本是从官方仓库安装的（而不是从源代码），通常是与相应的Webots版本兼容的第一个版本。您可以下载镜像并升级软件包，或者根据需要从源代码安装。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://cyberbotics.com/files/ros2/webots_ros2_2023_0_2.utm.zip">Webots R2023a的2023.0.2版本</a> [6.6 GB]</p></li>
</ul>
<p>在将下载的镜像添加到UTM软件时，在启动虚拟机之前，您还应该在下拉菜单中选择主机共享文件夹的路径（例如``/Users/username/shared``）。一旦虚拟机启动，必须始终设置``WEBOTS_SHARED_FOLDER``环境变量，以使软件包在虚拟机中正常工作。此变量指定给``webots_ros2``软件包用于在主机机器和虚拟机之间交换数据的共享文件夹的位置。此变量的值应为``&lt;主机共享文件夹&gt;:&lt;虚拟机共享文件夹&gt;``的格式，其中``&lt;主机共享文件夹&gt;``是主机机器上共享文件夹的路径，而``&lt;虚拟机共享文件夹&gt;``是虚拟机上相同共享文件夹的路径。</p>
<p>在预配置的镜像中，<a href="#id1"><span class="problematic" id="id2">``</span></a>WEBOTS_SHARED_FOLDER``已在``~/.bashrc``中设置。您需要更新它以使用正确的主机文件夹路径：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export WEBOTS_SHARED_FOLDER=/Users/username/shared:/home/ubuntu/shared</span>
</pre></div>
</div>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>