<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutorials/Advanced/Simulators/Gazebo/Gazebo</title>
</head>
<body>
  <div class="section" id="setting-up-a-robot-simulation-gazebo">
<h1>设置机器人仿真（Gazebo）。<a class="headerlink" href="#setting-up-a-robot-simulation-gazebo" title="永久链接至标题"></a></h1>
<p><strong>目标：</strong> 使用Gazebo和ROS 2启动仿真。</p>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>教程级别：<a href="#id3"><span class="problematic" id="id4">**</span></a>高级</p>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>时间：<a href="#id3"><span class="problematic" id="id4">**</span></a>20分钟</p>
<div class="contents local topic" id="contents">
<p class="topic-title">内容</p>
<ul class="simple">
<li><p><a class="reference internal" href="#prerequisites" id="id1">先决条件</a></p></li>
<li><p><a class="reference internal" href="#tasks" id="id2">任务</a></p>
<ul>
<li><p><a class="reference internal" href="#launch-the-simulation" id="id3">1 启动模拟</a></p></li>
<li><p><a class="reference internal" href="#configuring-ros-2" id="id4">2 配置ROS 2</a></p></li>
<li><p><a class="reference internal" href="#visualizing-lidar-data-in-ros-2" id="id5">3 在ROS 2中可视化激光雷达数据</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#summary" id="id6">总结</a></p></li>
</ul>
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id1">先决条件</a><a class="headerlink" href="#prerequisites" title="永久链接至标题"></a></h2>
<p>首先，您应该安装ROS 2和Gazebo。您有两个选项：</p>
<blockquote>
<div><ul class="simple">
<li><p>通过deb软件包安装。要查看deb软件包提供的版本，请查看此 <a class="reference external" href="https://github.com/gazebosim/ros_ign">表格</a>。</p></li>
<li><p>从源代码编译：</p>
<ul>
<li><p><a class="reference internal" href="../../../../Installation.html"><span class="doc">ROS 2安装说明</span></a></p></li>
<li><p><a class="reference external" href="https://gazebosim.org/docs">Gazebo安装说明</a></p></li>
</ul>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="tasks">
<h2><a class="toc-backref" href="#id2">任务</a><a class="headerlink" href="#tasks" title="永久链接至标题"></a></h2>
<div class="section" id="launch-the-simulation">
<h3><a class="toc-backref" href="#id3">1 启动模拟</a><a class="headerlink" href="#launch-the-simulation" title="永久链接至标题"></a></h3>
<p>在这个演示中，您将在Gazebo中模拟一个简单的差动驱动机器人。您将使用Gazebo示例中定义的一个世界，名为 <a class="reference external" href="https://github.com/gazebosim/gz-sim/blob/main/examples/worlds/visualize_lidar.sdf">visualize_lidar.sdf</a>。要运行此示例，请在终端中执行以下命令：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button></div><div aria-labelledby="tab-0-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-0-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ign gazebo -v 4 -r visualize_lidar.sdf</span>
</pre></div>
</div>
</div></div>
<img alt="../../../../_images/gazebo_diff_drive.png" src="../../../../_images/gazebo_diff_drive.png" />
<p>当模拟正在运行时，您可以使用``ign``命令行工具检查Gazebo提供的主题：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button></div><div aria-labelledby="tab-1-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-1-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ign topic -l</span>
</pre></div>
</div>
<p>这将显示：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/clock</span>
<span class="go">/gazebo/resource_paths</span>
<span class="go">/gui/camera/pose</span>
<span class="go">/gui/record_video/stats</span>
<span class="go">/model/vehicle_blue/odometry</span>
<span class="go">/model/vehicle_blue/tf</span>
<span class="go">/stats</span>
<span class="go">/world/visualize_lidar_world/clock</span>
<span class="go">/world/visualize_lidar_world/dynamic_pose/info</span>
<span class="go">/world/visualize_lidar_world/pose/info</span>
<span class="go">/world/visualize_lidar_world/scene/deletion</span>
<span class="go">/world/visualize_lidar_world/scene/info</span>
<span class="go">/world/visualize_lidar_world/state</span>
<span class="go">/world/visualize_lidar_world/stats</span>
</pre></div>
</div>
</div></div>
<p>由于您尚未启动ROS 2节点，因此``ros2 topic list``命令的输出应该不包含任何机器人相关的主题:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-2-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-2-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button></div><div aria-labelledby="tab-2-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-2-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 topic list</span>
</pre></div>
</div>
<p>这将显示：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">/parameter_events</span>
<span class="go">/rosout</span>
</pre></div>
</div>
</div></div>
</div>
<div class="section" id="configuring-ros-2">
<h3><a class="toc-backref" href="#id4">2 配置ROS 2</a><a class="headerlink" href="#configuring-ros-2" title="永久链接至标题"></a></h3>
<p>为了能够将我们的仿真与ROS 2通信，您需要使用一个名为``ros_gz_bridge``的软件包。该软件包提供了一个网络桥接器，可以在ROS 2和Gazebo Transport之间交换消息。您可以通过输入以下命令来安装该软件包:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-3-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-3-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button></div><div aria-labelledby="tab-3-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-3-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt-get install ros-humble-ros-ign-bridge</span>
</pre></div>
</div>
</div></div>
<p>此时，您可以启动一个从ROS到Gazebo的桥接器。具体来说，您将为主题``/model/vehicle_blue/cmd_vel``创建一个桥接器:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-4-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-4-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button></div><div aria-labelledby="tab-4-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-4-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">source /opt/ros/humble/setup.bash</span>
<span class="go">ros2 run ros_gz_bridge parameter_bridge /model/vehicle_blue/cmd_vel@geometry_msgs/msg/Twist]ignition.msgs.Twist</span>
</pre></div>
</div>
</div></div>
<p>有关``ros_gz_bridge``的更多详细信息，请查看此`README &lt;<a class="reference external" href="https://github.com/gazebosim/ros_gz/tree/ros2/ros_gz_bridge">https://github.com/gazebosim/ros_gz/tree/ros2/ros_gz_bridge</a>&gt;`__。</p>
<p>一旦桥接程序运行，机器人就能够遵循您的电机命令。有两种选择：</p>
<ul class="simple">
<li><p>使用``ros2 topic pub``向主题发送命令</p></li>
</ul>
<blockquote>
<div><div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-5-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-5-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button></div><div aria-labelledby="tab-5-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-5-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ros2 topic pub /model/vehicle_blue/cmd_vel geometry_msgs/Twist &quot;linear: { x: 0.1 }&quot;</span>
</pre></div>
</div>
</div></div>
</div></blockquote>
<ul class="simple">
<li><p><a href="#id1"><span class="problematic" id="id2">``</span></a>teleop_twist_keyboard``软件包。该节点从键盘接收按键，并将其发布为扭矩消息。您可以通过输入以下命令来安装它：</p></li>
</ul>
<blockquote>
<div><div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-6-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-6-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button></div><div aria-labelledby="tab-6-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-6-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo apt-get install ros-humble-teleop-twist-keyboard</span>
</pre></div>
</div>
</div></div>
<p><code class="docutils literal notranslate"><span class="pre">teleop_twist_keyboard``发布Twist消息的默认主题是</span></code>/cmd_vel``，但您可以重新映射此主题以使用桥接中使用的主题：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-7-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-7-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button></div><div aria-labelledby="tab-7-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-7-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">source /opt/ros/humble/setup.bash</span>
<span class="go">ros2 run teleop_twist_keyboard teleop_twist_keyboard --ros-args -r /cmd_vel:=/model/vehicle_blue/cmd_vel</span>
</pre></div>
</div>
<p>将显示如下内容：</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">This node takes keypresses from the keyboard and publishes them</span>
<span class="go">as Twist messages. It works best with a US keyboard layout.</span>
<span class="go">---------------------------</span>
<span class="go">Moving around:</span>
<span class="go">   u    i    o</span>
<span class="go">   j    k    l</span>
<span class="go">   m    ,    .</span>

<span class="go">For Holonomic mode (strafing), hold down the shift key:</span>
<span class="go">---------------------------</span>
<span class="go">   U    I    O</span>
<span class="go">   J    K    L</span>
<span class="go">   M    &lt;    &gt;</span>

<span class="go">t : up (+z)</span>
<span class="go">b : down (-z)</span>

<span class="go">anything else : stop</span>

<span class="go">q/z : increase/decrease max speeds by 10%</span>
<span class="go">w/x : increase/decrease only linear speed by 10%</span>
<span class="go">e/c : increase/decrease only angular speed by 10%</span>

<span class="go">CTRL-C to quit</span>

<span class="go">currently:      speed 0.5       turn 1.0</span>
</pre></div>
</div>
</div></div>
</div></blockquote>
</div>
<div class="section" id="visualizing-lidar-data-in-ros-2">
<h3><a class="toc-backref" href="#id5">3 在ROS 2中可视化激光雷达数据</a><a class="headerlink" href="#visualizing-lidar-data-in-ros-2" title="永久链接至标题"></a></h3>
<p>差动驱动机器人配备了激光雷达。要将Gazebo生成的数据发送到ROS 2，您需要启动另一个桥接程序。在本例中，激光雷达的数据提供在Gazebo传输主题``/lidar2``中，您将在桥接程序中重新映射该主题。该主题将在主题``/lidar_scan``下可用：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-8-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-8-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button></div><div aria-labelledby="tab-8-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-8-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">source /opt/ros/humble/setup.bash</span>
<span class="go">ros2 run ros_gz_bridge parameter_bridge /lidar2@sensor_msgs/msg/LaserScan[ignition.msgs.LaserScan --ros-args -r /lidar2:=/laser_scan</span>
</pre></div>
</div>
</div></div>
<p>要在ROS 2中可视化来自激光雷达的数据，您可以使用Rviz2：</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-9-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-9-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button></div><div aria-labelledby="tab-9-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-9-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">source /opt/ros/humble/setup.bash</span>
<span class="go">rviz2</span>
</pre></div>
</div>
</div></div>
<p>然后，您需要配置“fixed frame”：</p>
<img alt="../../../../_images/fixed_frame.png" src="../../../../_images/fixed_frame.png" />
<p>然后点击“Add”按钮，添加一个显示以可视化激光雷达：</p>
<img alt="../../../../_images/add_lidar.png" src="../../../../_images/add_lidar.png" />
<p>现在您应该在Rviz2中看到来自激光雷达的数据：</p>
<img alt="../../../../_images/rviz2.png" src="../../../../_images/rviz2.png" />
</div>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id6">总结</a><a class="headerlink" href="#summary" title="永久链接至标题"></a></h2>
<p>在本教程中，您使用Gazebo启动了一个机器人模拟，使用执行器和传感器启动了桥接器，可视化了传感器数据，并移动了差分驱动机器人。</p>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>