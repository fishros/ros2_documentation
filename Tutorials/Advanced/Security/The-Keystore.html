<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutorials/Advanced/Security/The-Keystore</title>
</head>
<body>
  <div class="section" id="understanding-the-security-keystore">
<span id="the-keystore"></span><h1>理解安全密钥库<a class="headerlink" href="#understanding-the-security-keystore" title="永久链接至标题"></a></h1>
<p><strong>目标:</strong> 探索位于ROS 2安全密钥库中的文件。</p>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>教程级别：<a href="#id3"><span class="problematic" id="id4">**</span></a>高级</p>
<p><strong>时间：</strong> 15分钟</p>
<div class="contents local topic" id="contents">
<p class="topic-title">内容</p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id1">背景</a></p></li>
<li><p><a class="reference internal" href="#security-artifact-locations" id="id2">安全工件位置</a></p>
<ul>
<li><p><a class="reference internal" href="#public-key-materials" id="id3">公钥材料</a></p></li>
<li><p><a class="reference internal" href="#private-key-materials" id="id4">私钥材料</a></p></li>
<li><p><a class="reference internal" href="#domain-governance-policy" id="id5">域治理政策</a></p></li>
<li><p><a class="reference internal" href="#security-enclaves" id="id6">安全飞地</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#take-the-quiz" id="id7">参加测验吧！</a></p></li>
</ul>
</div>
<div class="section" id="background">
<h2><a class="toc-backref" href="#id1">背景</a><a class="headerlink" href="#background" title="永久链接至标题"></a></h2>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>sros2``包可用于创建在启用ROS 2安全性所必需的密钥、证书和策略。然而，安全配置非常灵活。对ROS 2安全密钥库的基本理解将允许与现有PKI（公钥基础设施）集成，并根据组织政策管理敏感密钥材料。</p>
</div>
<div class="section" id="security-artifact-locations">
<h2><a class="toc-backref" href="#id2">安全工件位置</a><a class="headerlink" href="#security-artifact-locations" title="永久链接至标题"></a></h2>
<p>在前一个教程中启用了通信安全性后，让我们来看看在启用安全性时创建的文件。这些文件使加密成为可能。</p>
<p><code class="docutils literal notranslate"><span class="pre">sros2</span></code> 实用程序（<code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">security</span> <span class="pre">...</span></code>）将文件分为公共、私有和飞地密钥材料。</p>
<p>ROS 使用由环境变量 <code class="docutils literal notranslate"><span class="pre">ROS_SECURITY_KEYSTORE</span></code> 定义的目录作为密钥库。对于本教程，我们使用目录 <code class="docutils literal notranslate"><span class="pre">~/sros2_demo/demo_keystore</span></code>。</p>
<div class="section" id="public-key-materials">
<h3><a class="toc-backref" href="#id3">公钥材料</a><a class="headerlink" href="#public-key-materials" title="永久链接至标题"></a></h3>
<p>在``~/sros2_demo/demo_keys/public``目录中，你会找到三个加密证书；然而，身份和权限证书实际上只是指向证书颁发机构（CA）证书的链接。</p>
<p>在公钥基础设施中，<a href="#id8"><span class="problematic" id="id9">`证书颁发机构（Certificate Authority）&lt;https://en.wikipedia.org/wiki/Certificate_authority&gt;`_</span></a> 充当信任锚点：它验证参与者的身份和权限。对于ROS来说，这意味着所有参与ROS图（可能延伸到整个机器人群）的节点。通过将证书颁发机构的证书（<code class="docutils literal notranslate"><span class="pre">ca.cert.pem</span></code>）放置在机器人上的正确位置，所有ROS节点可以使用相同的证书颁发机构与其他节点建立相互信任。</p>
<p>虽然在我们的教程中我们会即时创建一个证书颁发机构，但在生产系统中，这应该根据预先定义的安全计划进行。通常情况下，生产系统的证书颁发机构将在离线状态下创建，并在机器人的初始设置过程中放置。它可以针对每个机器人是唯一的，也可以在整个机器人群中共享，这些机器人都相互信任。</p>
<p>DDS（以及ROS）支持身份和权限信任链的分离，因此每个功能都有自己的证书颁发机构。在大多数情况下，ROS系统的安全计划不需要在这些职责之间进行分离，因此安全工具生成一个用于身份和权限的单个证书颁发机构。</p>
<p>使用``openssl``命令来查看该x509证书并以文本形式显示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/sros2_demo/demo_keys/public
openssl x509 -in ca.cert.pem -text -noout
</pre></div>
</div>
<p>输出结果应该类似于以下内容：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Certificate</span><span class="p">:</span>
  <span class="n">Data</span><span class="p">:</span>
      <span class="n">Version</span><span class="p">:</span> <span class="mi">3</span> <span class="p">(</span><span class="mh">0x2</span><span class="p">)</span>
      <span class="n">Serial</span> <span class="n">Number</span><span class="p">:</span>
          <span class="mi">02</span><span class="p">:</span><span class="mi">8</span><span class="n">e</span><span class="p">:</span><span class="mi">9</span><span class="n">a</span><span class="p">:</span><span class="mi">24</span><span class="p">:</span><span class="n">ea</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="n">cb</span><span class="p">:</span><span class="n">e6</span><span class="p">:</span><span class="n">ea</span><span class="p">:</span><span class="n">e8</span><span class="p">:</span><span class="mi">7</span><span class="n">a</span><span class="p">:</span><span class="n">c0</span><span class="p">:</span><span class="mi">5</span><span class="n">f</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">6</span><span class="n">d</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">78</span><span class="p">:</span><span class="n">aa</span>
      <span class="n">Signature</span> <span class="n">Algorithm</span><span class="p">:</span> <span class="n">ecdsa</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">SHA256</span>
      <span class="n">Issuer</span><span class="p">:</span> <span class="n">CN</span> <span class="o">=</span> <span class="n">sros2testCA</span>
      <span class="n">Validity</span>
          <span class="n">Not</span> <span class="n">Before</span><span class="p">:</span> <span class="n">Jun</span>  <span class="mi">1</span> <span class="mi">16</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">37</span> <span class="mi">2021</span> <span class="n">GMT</span>
          <span class="n">Not</span> <span class="n">After</span> <span class="p">:</span> <span class="n">May</span> <span class="mi">31</span> <span class="mi">16</span><span class="p">:</span><span class="mi">57</span><span class="p">:</span><span class="mi">37</span> <span class="mi">2031</span> <span class="n">GMT</span>
      <span class="n">Subject</span><span class="p">:</span> <span class="n">CN</span> <span class="o">=</span> <span class="n">sros2testCA</span>
      <span class="n">Subject</span> <span class="n">Public</span> <span class="n">Key</span> <span class="n">Info</span><span class="p">:</span>
          <span class="n">Public</span> <span class="n">Key</span> <span class="n">Algorithm</span><span class="p">:</span> <span class="nb">id</span><span class="o">-</span><span class="n">ecPublicKey</span>
              <span class="n">Public</span><span class="o">-</span><span class="n">Key</span><span class="p">:</span> <span class="p">(</span><span class="mi">256</span> <span class="n">bit</span><span class="p">)</span>
              <span class="n">pub</span><span class="p">:</span>
                  <span class="mi">04</span><span class="p">:</span><span class="mi">71</span><span class="p">:</span><span class="n">e9</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="n">d7</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="n">ba</span><span class="p">:</span><span class="n">b8</span><span class="p">:</span><span class="n">a0</span><span class="p">:</span><span class="mi">97</span><span class="p">:</span><span class="mi">66</span><span class="p">:</span><span class="n">da</span><span class="p">:</span><span class="mi">9</span><span class="n">f</span><span class="p">:</span><span class="n">e3</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span>
                  <span class="mi">08</span><span class="p">:</span><span class="mi">4</span><span class="n">f</span><span class="p">:</span><span class="mi">7</span><span class="n">a</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">24</span><span class="p">:</span><span class="n">c6</span><span class="p">:</span><span class="n">cf</span><span class="p">:</span><span class="mi">6</span><span class="n">a</span><span class="p">:</span><span class="n">f7</span><span class="p">:</span><span class="mi">95</span><span class="p">:</span><span class="n">c5</span><span class="p">:</span><span class="n">cd</span><span class="p">:</span><span class="mi">82</span><span class="p">:</span><span class="n">c0</span><span class="p">:</span>
                  <span class="mi">7</span><span class="n">f</span><span class="p">:</span><span class="mi">7</span><span class="n">f</span><span class="p">:</span><span class="n">e3</span><span class="p">:</span><span class="mi">90</span><span class="p">:</span><span class="n">dd</span><span class="p">:</span><span class="mi">7</span><span class="n">b</span><span class="p">:</span><span class="mi">0</span><span class="n">f</span><span class="p">:</span><span class="mi">77</span><span class="p">:</span><span class="n">d1</span><span class="p">:</span><span class="n">ee</span><span class="p">:</span><span class="mi">0</span><span class="n">e</span><span class="p">:</span><span class="n">af</span><span class="p">:</span><span class="mi">68</span><span class="p">:</span><span class="mi">7</span><span class="n">c</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span>
                  <span class="n">a9</span><span class="p">:</span><span class="n">ca</span><span class="p">:</span><span class="mi">60</span><span class="p">:</span><span class="n">d7</span><span class="p">:</span><span class="mi">1</span><span class="n">e</span><span class="p">:</span><span class="mi">2</span><span class="n">c</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="n">d7</span><span class="p">:</span><span class="n">bc</span><span class="p">:</span><span class="mi">7</span><span class="n">e</span><span class="p">:</span><span class="n">e3</span><span class="p">:</span><span class="mi">86</span><span class="p">:</span><span class="mi">2</span><span class="n">a</span><span class="p">:</span><span class="mi">9</span><span class="n">f</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span>
                  <span class="n">dc</span><span class="p">:</span><span class="n">ed</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="n">c5</span><span class="p">:</span><span class="mi">32</span>
              <span class="n">ASN1</span> <span class="n">OID</span><span class="p">:</span> <span class="n">prime256v1</span>
              <span class="n">NIST</span> <span class="n">CURVE</span><span class="p">:</span> <span class="n">P</span><span class="o">-</span><span class="mi">256</span>
      <span class="n">X509v3</span> <span class="n">extensions</span><span class="p">:</span>
          <span class="n">X509v3</span> <span class="n">Basic</span> <span class="n">Constraints</span><span class="p">:</span> <span class="n">critical</span>
              <span class="n">CA</span><span class="p">:</span><span class="n">TRUE</span><span class="p">,</span> <span class="n">pathlen</span><span class="p">:</span><span class="mi">1</span>
  <span class="n">Signature</span> <span class="n">Algorithm</span><span class="p">:</span> <span class="n">ecdsa</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">SHA256</span>
       <span class="mi">30</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="n">d4</span><span class="p">:</span><span class="n">fc</span><span class="p">:</span><span class="n">d8</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="n">ff</span><span class="p">:</span><span class="n">a4</span><span class="p">:</span><span class="mi">51</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">98</span><span class="p">:</span><span class="mi">4</span><span class="n">c</span><span class="p">:</span><span class="n">f0</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span><span class="mi">3</span><span class="n">f</span><span class="p">:</span>
       <span class="n">e0</span><span class="p">:</span><span class="n">e7</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">8</span><span class="n">e</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">3</span><span class="n">c</span><span class="p">:</span><span class="n">d0</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="n">e7</span><span class="p">:</span><span class="n">e9</span><span class="p">:</span><span class="mi">8</span><span class="n">f</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="n">f0</span><span class="p">:</span><span class="mi">90</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="n">ed</span><span class="p">:</span><span class="n">d7</span><span class="p">:</span>
       <span class="mi">7</span><span class="n">d</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">84</span><span class="p">:</span><span class="n">f7</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">87</span><span class="p">:</span><span class="n">bb</span><span class="p">:</span><span class="mi">4</span><span class="n">f</span><span class="p">:</span><span class="n">d3</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span><span class="p">:</span><span class="mi">95</span><span class="p">:</span><span class="mi">61</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">df</span><span class="p">:</span><span class="mi">83</span><span class="p">:</span>
       <span class="mi">4</span><span class="n">b</span><span class="p">:</span><span class="n">e5</span><span class="p">:</span><span class="mi">92</span><span class="p">:</span><span class="n">b3</span><span class="p">:</span><span class="n">e6</span><span class="p">:</span><span class="n">ee</span><span class="p">:</span><span class="mi">3</span><span class="n">c</span><span class="p">:</span><span class="n">d5</span><span class="p">:</span><span class="n">cf</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">71</span><span class="p">:</span><span class="n">bd</span><span class="p">:</span><span class="n">dd</span><span class="p">:</span><span class="mi">7</span><span class="n">c</span>
</pre></div>
</div>
<dl class="simple">
<dt>关于该CA证书需要注意的一些事项：</dt><dd><ul class="simple">
<li><p>证书主题名称``sros2testCA``是由``sros2``工具提供的默认值。</p></li>
<li><p>该证书有效期为十年，从创建时开始</p></li>
<li><p>与所有证书一样，它包含用于公钥加密的公钥</p></li>
<li><p>作为根证书颁发机构，这是一个`自签名证书 &lt;<a class="reference external" href="https://en.wikipedia.org/wiki/Self-signed_certificate">https://en.wikipedia.org/wiki/Self-signed_certificate</a>&gt;`_；即，它使用自己的私钥进行签名。</p></li>
</ul>
</dd>
</dl>
<p>由于这是一个公共证书，可以根据需要自由复制以在整个ROS系统中建立信任。</p>
</div>
<div class="section" id="private-key-materials">
<h3><a class="toc-backref" href="#id4">私钥材料</a><a class="headerlink" href="#private-key-materials" title="永久链接至标题"></a></h3>
<p>私钥材料可以在密钥库目录 <code class="docutils literal notranslate"><span class="pre">~/sros2_demo/demo_keys/private</span></code> 中找到。与``public``目录类似，其中包含一个证书机构密钥 <code class="docutils literal notranslate"><span class="pre">ca.key.pem</span></code> 和指向它的符号链接，用作身份和权限 CA 的私钥。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>请保护好这个私钥，并进行安全备份！</p>
</div>
<p>这是与公共证书机构相关联的私钥，它是您的ROS系统中所有安全性的锚点。您将使用它来修改ROS图的加密策略并添加新的ROS参与者。根据您的机器人的安全需求，可以使用访问权限保护该密钥，并将其锁定到另一个帐户，或者完全将其移出机器人并放置到另一个系统或设备上。如果文件丢失，您将无法更改访问权限并向系统添加新的参与者。同样，任何具有对该文件访问权限的用户或进程都有修改系统策略和参与者的能力。</p>
<p>这个文件只用于配置机器人，但对于机器人的运行来说是不需要的。可以安全地将它离线存储在另一个系统或可移动介质中。</p>
<p><code class="docutils literal notranslate"><span class="pre">sros2</span></code> 实用程序使用 <a class="reference external" href="https://en.wikipedia.org/wiki/Elliptic-curve_cryptography">椭圆曲线加密</a> 而不是 RSA，以提高安全性和减小密钥大小。使用以下命令显示有关此椭圆曲线私钥的详细信息：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/sros2_demo/demo_keys/private
openssl ec -in ca.key.pem -text -noout
</pre></div>
</div>
<p>你的输出应该类似于以下内容：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">read</span> <span class="n">EC</span> <span class="n">key</span>
<span class="n">Private</span><span class="o">-</span><span class="n">Key</span><span class="p">:</span> <span class="p">(</span><span class="mi">256</span> <span class="n">bit</span><span class="p">)</span>
<span class="n">priv</span><span class="p">:</span>
    <span class="mi">93</span><span class="p">:</span><span class="n">da</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="n">b9</span><span class="p">:</span><span class="n">e3</span><span class="p">:</span><span class="mi">91</span><span class="p">:</span><span class="n">ab</span><span class="p">:</span><span class="n">e9</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span><span class="n">f2</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="n">f1</span><span class="p">:</span><span class="mi">9</span><span class="n">d</span><span class="p">:</span><span class="mi">94</span><span class="p">:</span>
    <span class="mi">90</span><span class="p">:</span><span class="mi">5</span><span class="n">e</span><span class="p">:</span><span class="n">b5</span><span class="p">:</span><span class="mi">96</span><span class="p">:</span><span class="mi">7</span><span class="n">b</span><span class="p">:</span><span class="mi">7</span><span class="n">f</span><span class="p">:</span><span class="mi">71</span><span class="p">:</span><span class="n">ee</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">1</span><span class="n">b</span><span class="p">:</span><span class="n">d4</span><span class="p">:</span><span class="n">a0</span><span class="p">:</span><span class="n">f9</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="n">fb</span><span class="p">:</span>
    <span class="n">ae</span><span class="p">:</span><span class="mi">77</span>
<span class="n">pub</span><span class="p">:</span>
    <span class="mi">04</span><span class="p">:</span><span class="mi">71</span><span class="p">:</span><span class="n">e9</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="n">d7</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="n">ba</span><span class="p">:</span><span class="n">b8</span><span class="p">:</span><span class="n">a0</span><span class="p">:</span><span class="mi">97</span><span class="p">:</span><span class="mi">66</span><span class="p">:</span><span class="n">da</span><span class="p">:</span><span class="mi">9</span><span class="n">f</span><span class="p">:</span><span class="n">e3</span><span class="p">:</span><span class="n">c4</span><span class="p">:</span>
    <span class="mi">08</span><span class="p">:</span><span class="mi">4</span><span class="n">f</span><span class="p">:</span><span class="mi">7</span><span class="n">a</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">24</span><span class="p">:</span><span class="n">c6</span><span class="p">:</span><span class="n">cf</span><span class="p">:</span><span class="mi">6</span><span class="n">a</span><span class="p">:</span><span class="n">f7</span><span class="p">:</span><span class="mi">95</span><span class="p">:</span><span class="n">c5</span><span class="p">:</span><span class="n">cd</span><span class="p">:</span><span class="mi">82</span><span class="p">:</span><span class="n">c0</span><span class="p">:</span>
    <span class="mi">7</span><span class="n">f</span><span class="p">:</span><span class="mi">7</span><span class="n">f</span><span class="p">:</span><span class="n">e3</span><span class="p">:</span><span class="mi">90</span><span class="p">:</span><span class="n">dd</span><span class="p">:</span><span class="mi">7</span><span class="n">b</span><span class="p">:</span><span class="mi">0</span><span class="n">f</span><span class="p">:</span><span class="mi">77</span><span class="p">:</span><span class="n">d1</span><span class="p">:</span><span class="n">ee</span><span class="p">:</span><span class="mi">0</span><span class="n">e</span><span class="p">:</span><span class="n">af</span><span class="p">:</span><span class="mi">68</span><span class="p">:</span><span class="mi">7</span><span class="n">c</span><span class="p">:</span><span class="mi">76</span><span class="p">:</span>
    <span class="n">a9</span><span class="p">:</span><span class="n">ca</span><span class="p">:</span><span class="mi">60</span><span class="p">:</span><span class="n">d7</span><span class="p">:</span><span class="mi">1</span><span class="n">e</span><span class="p">:</span><span class="mi">2</span><span class="n">c</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="n">d7</span><span class="p">:</span><span class="n">bc</span><span class="p">:</span><span class="mi">7</span><span class="n">e</span><span class="p">:</span><span class="n">e3</span><span class="p">:</span><span class="mi">86</span><span class="p">:</span><span class="mi">2</span><span class="n">a</span><span class="p">:</span><span class="mi">9</span><span class="n">f</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span>
    <span class="n">dc</span><span class="p">:</span><span class="n">ed</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="n">c5</span><span class="p">:</span><span class="mi">32</span>
<span class="n">ASN1</span> <span class="n">OID</span><span class="p">:</span> <span class="n">prime256v1</span>
<span class="n">NIST</span> <span class="n">CURVE</span><span class="p">:</span> <span class="n">P</span><span class="o">-</span><span class="mi">256</span>
</pre></div>
</div>
<p>除了私钥本身外，请注意公钥也被列出，并且与证书颁发机构 <code class="docutils literal notranslate"><span class="pre">ca.cert.pem</span></code> 中列出的公钥匹配。</p>
</div>
<div class="section" id="domain-governance-policy">
<h3><a class="toc-backref" href="#id5">域治理政策</a><a class="headerlink" href="#domain-governance-policy" title="永久链接至标题"></a></h3>
<p>在密钥库的保险库目录中，<code class="docutils literal notranslate"><span class="pre">~/sros2_demo/demo_keys/enclaves``中找到域治理政策。``enclave``目录包含XML治理政策文件``governance.xml</span></code>，以及由Permissions CA签署的文档副本``governance.p7s``。</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>governance.p7s``文件包含域范围的设置，例如如何处理未经身份验证的参与者，是否加密发现以及访问主题的默认规则。</p>
<p>使用以下命令验证治理文件的 <a class="reference external" href="https://en.wikipedia.org/wiki/S/MIME">S/MIME签名</a>：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>openssl smime -verify -in governance.p7s -CAfile ../public/permissions_ca.cert.pem
</pre></div>
</div>
<p>该命令将打印出XML文档，最后一行将显示``Verification successful``，以显示文档已由Permissions CA正确签名。</p>
</div>
<div class="section" id="security-enclaves">
<h3><a class="toc-backref" href="#id6">安全飞地</a><a class="headerlink" href="#security-enclaves" title="永久链接至标题"></a></h3>
<p>安全进程（通常为ROS节点）在安全飞地内运行。在最简单的情况下，所有进程可以合并到同一个飞地中，并且所有进程将使用相同的安全策略。然而，为了将不同的策略应用于不同的进程，进程可以在启动时使用不同的安全飞地。有关安全飞地的更多详细信息，请参阅`设计文档 &lt;<a class="reference external" href="https://design.ros2.org/articles/ros2_security_enclaves.html">https://design.ros2.org/articles/ros2_security_enclaves.html</a>&gt;`_。在运行节点时，可以使用ROS参数``--enclave``来指定安全飞地。</p>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>每个安全飞地需要六个文件**以启用安全性。每个文件的名称必须按照下面的定义命名，并且如上面的`DDS Security标准 &lt;<a class="reference external" href="https://www.omg.org/spec/DDS-SECURITY/1.1/About-DDS-SECURITY/">https://www.omg.org/spec/DDS-SECURITY/1.1/About-DDS-SECURITY/</a>&gt;`_中所述。为了避免有多个相同文件的副本，<a href="#id3"><span class="problematic" id="id4">``</span></a>sros2``工具会为每个飞地创建到单个治理策略、身份CA和权限CA的链接。</p>
<p>请查看``listener``飞地内的以下六个文件。其中三个文件是特定于此飞地的，而另外三个文件是通用于此ROS系统的：</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">key.pem</span></code>，用于在此飞地内进行加密和解密的私钥</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cert.pem</span></code>，此飞地的公共证书；该证书已由身份认证机构签名</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">permissions.p7s</span></code>，此飞地的权限；该文件已由权限认证机构签名</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">governance.p7s</span></code>，此域名的签署安全策略文件的链接</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">identity_ca.cert.pem</span></code>，此域名的身份认证中心链接</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">permissions_ca.cert.pem</span></code>，此域名的权限认证中心链接</p></li>
</ul>
</div></blockquote>
<p>私有加密密钥``key.pem``应根据您的安全计划进行保护。该密钥用于加密、解密和验证此特定飞地内的通信。如果密钥丢失或被盗，应撤销该密钥并为该飞地创建新的身份。</p>
<p>该目录中还创建了文件 <code class="docutils literal notranslate"><span class="pre">permissions.xml</span></code>，可用于重新创建已签名的权限文件。但是，启用安全性时不需要此文件，因为DDS使用已签名的文件版本。</p>
</div>
</div>
<div class="section" id="take-the-quiz">
<h2><a class="toc-backref" href="#id7">参加测验吧！</a><a class="headerlink" href="#take-the-quiz" title="永久链接至标题"></a></h2>
<p>看看你是否能回答关于ROS安全密钥库的这些问题。从一个新的终端会话开始，并使用前面教程中创建的密钥库启用安全性：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">ROS_SECURITY_KEYSTORE</span><span class="o">=</span>~/sros2_demo/demo_keys
<span class="nb">export</span> <span class="nv">ROS_SECURITY_ENABLE</span><span class="o">=</span><span class="nb">true</span>
<span class="nb">export</span> <span class="nv">ROS_SECURITY_STRATEGY</span><span class="o">=</span>Enforce

<span class="nb">cd</span> ~/sros2_demo/demo_keys/enclaves/talker_listener/listener
</pre></div>
</div>
<p>在开始之前，先备份 <code class="docutils literal notranslate"><span class="pre">permissions.p7s</span></code> 文件。</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-UXVlc3Rpb24gMQ==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-UXVlc3Rpb24gMQ==" name="UXVlc3Rpb24gMQ==" role="tab" tabindex="0">Question 1</button><button aria-controls="panel-0-QW5zd2VyIDE=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-QW5zd2VyIDE=" name="QW5zd2VyIDE=" role="tab" tabindex="-1">Answer 1</button></div><div aria-labelledby="tab-0-UXVlc3Rpb24gMQ==" class="sphinx-tabs-panel group-tab" id="panel-0-UXVlc3Rpb24gMQ==" name="UXVlc3Rpb24gMQ==" role="tabpanel" tabindex="0"><p>在文本编辑器中打开``permissions.p7s``。对XML内容进行微小的更改（例如，添加一个空格或空白行），然后保存文件。启动监听器节点：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 run demo_nodes_cpp listener --ros-args --enclave /talker_listener/listener
</pre></div>
</div>
<p>你期望会发生什么？</p>
<p>你能否启动说话节点？</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ros2 run demo_nodes_cpp talker --ros-args --enclave /talker_listener/talker
</pre></div>
</div>
<p>启动监听器和启动说话节点有什么区别？</p>
</div><div aria-labelledby="tab-0-QW5zd2VyIDE=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-QW5zd2VyIDE=" name="QW5zd2VyIDE=" role="tabpanel" tabindex="0"><p>监听器无法启动并抛出错误。当``permissions.p7s``文件被修改（即使是微小的修改），文件的签名就会变得无效。当权限文件无效时，节点将无法以启用和强制安全性的方式启动。</p>
<p>讲话者将按预期启动。它在不同的保护区中使用``permissions.p7s``文件，并且该文件仍然有效。</p>
</div></div>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-UXVlc3Rpb24gMg==" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-UXVlc3Rpb24gMg==" name="UXVlc3Rpb24gMg==" role="tab" tabindex="0">Question 2</button><button aria-controls="panel-1-QW5zd2VyIDI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-QW5zd2VyIDI=" name="QW5zd2VyIDI=" role="tab" tabindex="-1">Answer 2</button></div><div aria-labelledby="tab-1-UXVlc3Rpb24gMg==" class="sphinx-tabs-panel group-tab" id="panel-1-UXVlc3Rpb24gMg==" name="UXVlc3Rpb24gMg==" role="tabpanel" tabindex="0"><p>哪个命令可以用来检查修改后的``permissions.p7s``文件的签名是否有效？</p>
</div><div aria-labelledby="tab-1-QW5zd2VyIDI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-QW5zd2VyIDI=" name="QW5zd2VyIDI=" role="tabpanel" tabindex="0"><p>使用``openssl smime``命令来检查``permissions.p7s``是否已由Permissions CA正确签名：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>openssl smime -verify -in permissions.p7s -CAfile permissions_ca.cert.pem
</pre></div>
</div>
</div></div>
<p>在继续下一个教程之前，请恢复您的原始、正确签名的“permissions.p7s”文件。</p>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>