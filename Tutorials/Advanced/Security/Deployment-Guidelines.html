<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tutorials/Advanced/Security/Deployment-Guidelines</title>
</head>
<body>
  <div class="section" id="deployment-guidelines">
<h1>部署指南<a class="headerlink" href="#deployment-guidelines" title="永久链接至标题"></a></h1>
<p><strong>目标:</strong> 了解在将安全工件部署到生产系统时的最佳实践。</p>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>教程级别：<a href="#id3"><span class="problematic" id="id4">**</span></a>高级</p>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>时间：<a href="#id3"><span class="problematic" id="id4">**</span></a>20分钟</p>
<div class="contents local topic" id="contents">
<p class="topic-title">内容</p>
<ul class="simple">
<li><p><a class="reference internal" href="#background" id="id1">背景</a></p></li>
<li><p><a class="reference internal" href="#prerequisites" id="id2">先决条件</a></p></li>
<li><p><a class="reference internal" href="#general-guidelines" id="id3">一般指南</a></p></li>
<li><p><a class="reference internal" href="#building-a-deployment-scenario" id="id4">构建部署方案</a></p>
<ul>
<li><p><a class="reference internal" href="#generating-the-docker-image" id="id5">生成 Docker 镜像</a></p></li>
<li><p><a class="reference internal" href="#understanding-the-compose-file" id="id6">理解compose文件</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-the-example" id="id7">运行示例：</a></p>
<ul>
<li><p><a class="reference internal" href="#examining-the-containers" id="id8">检查容器</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="background">
<h2><a class="toc-backref" href="#id1">背景</a><a class="headerlink" href="#background" title="永久链接至标题"></a></h2>
<p>典型的部署场景通常涉及将容器化应用程序或软件包发送到远程系统。在部署安全启用的应用程序时，需要特别注意，用户需要考虑打包文件的敏感性。</p>
<p>符合 <a class="reference external" href="https://www.omg.org/spec/DDS-SECURITY/1.1/About-DDS-SECURITY/">DDS Security 标准</a>，<code class="docutils literal notranslate"><span class="pre">sros2</span></code> 软件包以高度模块化和灵活的方式提供了一套用于在 ROS 2 环境中管理安全性的实用工具。</p>
<p>基本的核心指南是如何组织不同的证书、密钥和目录，这仍然是避免危害系统安全的关键因素。这包括保护意识和选择最小必要文件集合以在远程生产系统上部署，以减少安全风险的标准。</p>
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id2">先决条件</a><a class="headerlink" href="#prerequisites" title="永久链接至标题"></a></h2>
<ul>
<li><p>带有Compose插件的Docker安装。请参考`Docker安装步骤&lt;<a class="reference external" href="https://docs.docker.com/engine/install/">https://docs.docker.com/engine/install/</a>&gt;`_和`Compose插件&lt;<a class="reference external" href="https://docs.docker.com/compose/install">https://docs.docker.com/compose/install</a>&gt;`_。</p></li>
<li><p>（推荐）对`ROS 2安全设计&lt;<a class="reference external" href="https://design.ros2.org/articles/ros2_dds_security.html">https://design.ros2.org/articles/ros2_dds_security.html</a>&gt;`_有基本的了解。</p></li>
<li><p>（推荐）完成之前的安全教程。特别是：</p>
<blockquote>
<div><ul class="simple">
<li><p><span class="xref std std-doc">介绍-ros2-安全性</span></p></li>
<li><p><span class="xref std std-doc">密钥存储</span></p></li>
<li><p><span class="xref std std-doc">访问控制</span></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="general-guidelines">
<h2><a class="toc-backref" href="#id3">一般指南</a><a class="headerlink" href="#general-guidelines" title="永久链接至标题"></a></h2>
<p>ROS 2利用DDS安全扩展确保同一封闭环境内的消息交换的安全性。封闭环境中的不同签名文件和证书是由受信任的`证书颁发机构（Certificate Authority，CA）&lt;<a class="reference external" href="https://en.wikipedia.org/wiki/Certificate_authority">https://en.wikipedia.org/wiki/Certificate_authority</a>&gt;`_的私钥和证书生成的。实际上，可以为每个封闭环境选择两个不同的CA来进行身份验证和权限控制。这些CA的相关文件存储在`Keystore &lt;<a class="reference external" href="https://design.ros2.org/articles/ros2_security_enclaves.html">https://design.ros2.org/articles/ros2_security_enclaves.html</a>&gt;`_的``private/<a href="#id1"><span class="problematic" id="id2">``</span></a>和``public/<a href="#id3"><span class="problematic" id="id4">``</span></a>子目录中，具有以下文件夹结构：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>keystore
├── enclaves
│   └── ...
│       └── ...
├── private
│   └── ...
└── public
    └── ...
</pre></div>
</div>
<p>对于生产系统的典型部署，使用和创建特定证书颁发机构的一个良好实践是：</p>
<ol class="arabic">
<li><p>将其创建在仅用于内部使用的组织系统内。</p></li>
<li><p>在生成/修改所需的封闭环境时要注意以下事项：</p>
<blockquote>
<div><ul class="simple">
<li><p>并非所有生成的enclave都应该部署到所有目标设备。</p></li>
<li><p>一个合理的方法是每个应用程序都有一个enclave，以实现关注点的分离。</p></li>
</ul>
</div></blockquote>
</li>
<li><p>在设置过程中，将``public/<a href="#id1"><span class="problematic" id="id2">``</span></a>与相应的``enclaves/<a href="#id3"><span class="problematic" id="id4">``</span></a>一起发送到不同的远程生产设备。</p></li>
<li><p>在组织中保留和保护``private/<a href="#id1"><span class="problematic" id="id2">``</span></a>密钥和/或证书请求。</p></li>
</ol>
<p>需要注意的是，如果``private/<a href="#id1"><span class="problematic" id="id2">``</span></a>文件丢失，将无法再更改访问权限、添加或修改安全配置文件。</p>
<p>此外，还可以考虑采取以下进一步措施：</p>
<ul class="simple">
<li><p>将``enclaves/<a href="#id1"><span class="problematic" id="id2">``</span></a>目录内容授予只读权限。</p></li>
<li><p>如果为生成enclave私钥提供了符合PKCS#11标准的URI，则可以使用`硬件安全模块 (HSM) &lt;<a class="reference external" href="https://en.wikipedia.org/wiki/Hardware_security_module">https://en.wikipedia.org/wiki/Hardware_security_module</a>&gt;`_ 来存储它们。</p></li>
</ul>
<p>下表概述了之前关于密钥库目录与推荐位置的陈述：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 19%" />
<col style="width: 20%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>目录 / 位置</p></th>
<th class="head"><p>组织</p></th>
<th class="head"><p>目标设备</p></th>
<th class="head"><p>材料敏感性</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>公开</p></td>
<td><p>✓</p></td>
<td><p>✓</p></td>
<td><p>低</p></td>
</tr>
<tr class="row-odd"><td><p>私有</p></td>
<td><p>✓</p></td>
<td><p>✕</p></td>
<td><p>高</p></td>
</tr>
<tr class="row-even"><td><p>隔离区</p></td>
<td><p>✓</p></td>
<td><p>✓</p></td>
<td><p>中等</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="building-a-deployment-scenario">
<h2><a class="toc-backref" href="#id4">构建部署方案</a><a class="headerlink" href="#building-a-deployment-scenario" title="永久链接至标题"></a></h2>
<p>为了演示一个简单的部署方案，将在提供的``ros:&lt;DISTRO&gt;``镜像之上构建一个新的Docker镜像。从该镜像开始，将创建三个容器，目标是：</p>
<ul class="simple">
<li><p>在本地主机的共享卷中初始化密钥库。</p></li>
<li><p>模拟两个已部署的远程设备，以安全方式相互交互。</p></li>
</ul>
<p>在这个例子中，本地主机作为组织的系统。让我们从创建一个工作空间文件夹开始：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir ~/security_gd_tutorial
<span class="nb">cd</span> ~/security_gd_tutorial
</pre></div>
</div>
<div class="section" id="generating-the-docker-image">
<h3><a class="toc-backref" href="#id5">生成 Docker 镜像</a><a class="headerlink" href="#generating-the-docker-image" title="永久链接至标题"></a></h3>
<p>为了构建一个新的 Docker 镜像，需要一个 Dockerfile。可以使用以下命令获取本教程中提供的 Dockerfile：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download the Dockerfile</span>
wget https://raw.githubusercontent.com/ros2/ros2_documentation/humble/source/Tutorials/Advanced/Security/resources/deployment_gd/Dockerfile
</pre></div>
</div>
<p>现在，使用以下命令构建 Docker 镜像：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build the base image</span>
docker build -t ros2_security/deployment_tutorial --build-arg <span class="nv">ROS_DISTRO</span><span class="o">=</span>humble .
</pre></div>
</div>
</div>
<div class="section" id="understanding-the-compose-file">
<h3><a class="toc-backref" href="#id6">理解compose文件</a><a class="headerlink" href="#understanding-the-compose-file" title="永久链接至标题"></a></h3>
<p>一个compose配置文件会使用镜像创建容器作为服务。在本教程中，配置文件中定义了三个服务：</p>
<ul class="simple">
<li><p><em>keystore-creator</em>：与之前的教程类似，它内部初始化一个新的keystore树目录。这将创建 <em>enclaves/</em>、<em>public/</em> 和 <em>private/</em> 目录，详细说明请参考 <a class="reference external" href="https://design.ros2.org/articles/ros2_security_enclaves.html">ROS 2 Security enclaves</a>。<code class="docutils literal notranslate"><span class="pre">keystore</span></code> 目录被配置为容器之间的共享卷。</p></li>
<li><p><em>listener</em> 和 <em>talker</em>：在本教程中充当远程设备的角色。还会从共享卷中获取所需的``Security``环境变量和必要的keystore文件。</p></li>
</ul>
<p>可以通过以下命令下载compose配置的yaml文件：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download the compose file</span>
wget https://raw.githubusercontent.com/ros2/ros2_documentation/humble/source/Tutorials/Advanced/Security/resources/deployment_gd/compose.deployment.yaml
</pre></div>
</div>
</div>
</div>
<div class="section" id="running-the-example">
<h2><a class="toc-backref" href="#id7">运行示例：</a><a class="headerlink" href="#running-the-example" title="永久链接至标题"></a></h2>
<p>在相同的工作目录 <code class="docutils literal notranslate"><span class="pre">~/security_gd_tutorial</span></code> 下运行：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start the example</span>
docker compose -f compose.deployment.yaml up
</pre></div>
</div>
<p>预期的输出结果如下所示：</p>
<ul class="simple">
<li><p><em>教程-监听者1</em>: <code class="xref any docutils literal notranslate"><span class="pre">发现安全目录:</span> <span class="pre">/keystore/enclaves/talker_listener/listener</span></code></p></li>
<li><p><em>教程-对话者1</em>: <code class="xref any docutils literal notranslate"><span class="pre">发现安全目录:</span> <span class="pre">/keystore/enclaves/talker_listener/talker</span></code></p></li>
<li><p><em>教程-监听者1</em>: <code class="xref any docutils literal notranslate"><span class="pre">发布:</span> <span class="pre">'你好世界:</span> <span class="pre">&lt;number&gt;'</span></code></p></li>
<li><p><em>教程-对话者1</em>: <code class="xref any docutils literal notranslate"><span class="pre">我听到了:</span> <span class="pre">[你好世界:</span> <span class="pre">&lt;number&gt;]</span></code></p></li>
</ul>
<div class="section" id="examining-the-containers">
<h3><a class="toc-backref" href="#id8">检查容器</a><a class="headerlink" href="#examining-the-containers" title="永久链接至标题"></a></h3>
<p>在模拟本教程的两个远程设备的容器运行时，通过打开两个不同的终端并输入以下命令来连接到每个容器：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Terminal 1</span>
docker <span class="nb">exec</span> -it tutorial-listener-1 bash
<span class="nb">cd</span> keystore
tree

<span class="c1"># Terminal 2</span>
docker <span class="nb">exec</span> -it tutorial-talker-1 bash
<span class="nb">cd</span> keystore
tree
</pre></div>
</div>
<p>应该获得类似于下面所示的输出：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Terminal 1</span>
keystore
 ├── enclaves
 │   ├── governance.p7s
 │   ├── governance.xml
 │   └── talker_listener
 │       └── listener
 │           ├── cert.pem
 │           ├── governance.p7s
 │           ├── identity_ca.cert.pem
 │           ├── key.pem
 │           ├── permissions_ca.cert.pem
 │           ├── permissions.p7s
 │           └── permissions.xml
 └── public
     ├── ca.cert.pem
     ├── identity_ca.cert.pem
     └── permissions_ca.cert.pem

<span class="c1"># Terminal 2</span>
keystore
 ├── enclaves
 │   ├── governance.p7s
 │   ├── governance.xml
 │   └── talker_listener
 │       └── talker
 │           ├── cert.pem
 │           ├── governance.p7s
 │           ├── identity_ca.cert.pem
 │           ├── key.pem
 │           ├── permissions_ca.cert.pem
 │           ├── permissions.p7s
 │           └── permissions.xml
 └── public
     ├── ca.cert.pem
     ├── identity_ca.cert.pem
     └── permissions_ca.cert.pem
</pre></div>
</div>
<p>请注意：</p>
<ul class="simple">
<li><p><em>private/</em> 文件夹未被移动，而是留在本地主机（组织）中。</p></li>
<li><p>每个部署设备都包含其所需的最小隔离环境，以供其应用程序使用。</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>为简单起见，同一证书颁发机构（CA）在此隔离环境中同时用于身份和权限。</p>
</div>
</div>
</div>
</div>

  <div id="footer">
    <p>欢迎帮助改进！</p>
  </div>
</body>
</html>